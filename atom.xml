<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>那个码农</title>
  
  <subtitle>钟意的博客 | ThatCoder&#39;s Blog 钟意博客</subtitle>
  <link href="https://blog.thatcoder.cn/atom.xml" rel="self"/>
  
  <link href="https://blog.thatcoder.cn/"/>
  <updated>2024-08-10T14:14:49.458Z</updated>
  <id>https://blog.thatcoder.cn/</id>
  
  <author>
    <name>钟意</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>设计模式系列——责任链模式</title>
    <link href="https://blog.thatcoder.cn/Design-Chain-of-Responsibility/"/>
    <id>https://blog.thatcoder.cn/Design-Chain-of-Responsibility/</id>
    <published>2024-06-10T02:00:00.000Z</published>
    <updated>2024-08-10T14:14:49.458Z</updated>
    
    <content type="html"><![CDATA[<p>开个坑补齐设计模式系列笔记, 顺带回顾Spring源码中的设计模式运用…</p><h2 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h2><blockquote><p>责任链模式（Chain of Responsibility Pattern）是一种行为设计模式，它允许多个对象有机会处理同一个请求，从而避免请求的发送者与多个接收者之间的耦合, 通常用于请求有多个阶段。该模式通过将这些对象连成一条链，并沿着链传递请求，直到有一个对象处理请求为止。如果链的末端没有对象处理请求，整个请求将被丢弃或默认处理。</p></blockquote><ol><li><strong>抽象处理者（Handler）</strong>：<ul><li><strong>定义</strong>：抽象处理者定义了一个处理请求的接口，通常包含一个方法来处理请求以及一个方法来设置下一个处理者。它规定了所有具体处理者都必须实现的基本操作，如处理请求或将请求传递给链中的下一个处理者。</li><li><strong>角色</strong>：<strong>接口或抽象类</strong>  作为处理链的核心定义，保证每个处理者都具有处理请求的能力。</li></ul></li><li><strong>基础处理者</strong> （Base Handler）： <ul><li><strong>定义</strong>：一个可选的抽象类或默认实现，它实现了抽象处理者的部分功能。</li><li><strong>角色</strong>：<strong>复用和扩展</strong>  提供公共的逻辑实现，减少子类的重复代码，增强代码的可复用性。</li></ul></li><li><strong>具体处理者（ConcreteHandlers）</strong>：<ul><li><strong>定义</strong>：责任链中的实际处理者，实现了处理某种请求的逻辑。当它无法处理请求时，会将请求传递给链中的下一个处理者。</li><li><strong>角色</strong>：<strong>链的节点实现</strong>  实现自己的处理逻辑来参与责任链的请求处理。</li></ul></li><li><strong>客户类（Client）</strong>：<ul><li><strong>定义</strong>：客户类是发起请求的对象，它通常会创建并设置责任链，然后向责任链的第一个处理者提交请求。</li><li><strong>角色</strong>：<strong>责任链的创建者</strong>  <strong>请求的发起者</strong></li></ul></li></ol><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/547ba1ae581c65781d4575b7b5792b0c.png" alt="责任链模式结构图" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">责任链模式结构图</span></div></div><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>公司报销流程就像一条责任链，每个环节都根据条件决定是否继续处理：</p><ol><li><strong>填写申请</strong>：你提交的报销单是链上的第一个环节，检查所有必要的字段和金额，确保格式正确。如果不符合条件，它会被退回。</li><li><strong>审批环节</strong>：提交后的申请进入审批环节（链路）。每一级上司根据公司政策比如费用上限或是否有票据判断是否继续处理。如果符合条件或该审批者无权审批，申请会被传递到下一个环节。</li><li><strong>财务审核</strong>：通过所有审批后，财务部门再进行一次核查，确保链路都是<code>true</code>且符合财务规定。如果审核通过，申请继续流向资金发放环节 (实际的处理方法)。</li><li><strong>资金发放</strong>：经过所有环节的条件检查和批准，资金会发放到你的账户中。</li></ol><p>每个环节都有自己的条件判断，每个节点只处理自己能处理的部分，不符合条件的节点将被跳过，确保整个流程高效顺畅。</p><h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><h3 id="Spring-Web"><a href="#Spring-Web" class="headerlink" title="Spring Web"></a>Spring Web</h3><blockquote><p>在 Spring Web 框架中，责任链模式被广泛应用于请求处理的各个阶段，尤其是在处理请求拦截和映射时。</p></blockquote><p>看 Spring Web 案例代码之前，现梳理一遍请求到链路末端处理到返回的逻辑，比如启动并访问 <code>OrderController </code>的 <code>@GetMapping(&quot;/order/list&quot;) </code>的 <code>public ResponseEntity&lt;ResponseRow&gt; list() </code>方法。</p><ol><li>Spring Boot 启动时，<code>SpringApplication.run()</code> 方法会被调用。这一方法负责引导和启动 Spring 应用程序上下文，加载所有的配置类和 Bean。</li><li>理所当然 <a href="https://github.com/spring-projects/spring-framework/blob/bf5e218b3580df20e6df129eadead4721e1f4f03/spring-webmvc/src/main/java/org/springframework/web/servlet/DispatcherServlet.java">DispatcherServlet.java</a>  作为核心组件会被通过自动配置机制自动注册并初始化，当作 Spring MVC 的前端控制器，用于接收和处理所有的 HTTP 请求。</li><li><code>DispatcherServlet</code> 初始化时会调用 <a href="https://github.com/spring-projects/spring-framework/blob/bf5e218b3580df20e6df129eadead4721e1f4f03/spring-webmvc/src/main/java/org/springframework/web/servlet/DispatcherServlet.java#L600-L621">initHandlerMappings()</a> 方法来加载所有的<code>HandlerMapping</code> 实现类储存到私有属性 <code>private List&lt;HandlerMapping&gt; handlerMappings</code>，并且等待处理即将到来的请求。</li><li><a href="https://github.com/spring-projects/spring-framework/blob/bf5e218b3580df20e6df129eadead4721e1f4f03/spring-webmvc/src/main/java/org/springframework/web/servlet/HandlerMapping.java">HandlerMapping</a> 类负责将请求映射到适当的处理器（例如 <code>@Controller</code> 中的方法）。</li><li>用户发出 <code>/order/list</code> 请求时，<code>DispatcherServlet</code> 作为前端控制器接收 HTTP 请求，在 <a href="https://github.com/spring-projects/spring-framework/blob/bf5e218b3580df20e6df129eadead4721e1f4f03/spring-webmvc/src/main/java/org/springframework/web/servlet/DispatcherServlet.java#L1048-L1129">doDispatch()</a> 方法中遍历 <code>handlerMappings</code> 列表并调用每个 <code>HandlerMapping</code> 实现类的 <code>getHandler()</code> 方法，尝试找到合适的 <code>HandlerExecutionChain</code> 来处理这个请求。</li><li>我们举例是 <code>@GetMapping(&quot;/order/list&quot;) </code>所以会用<a href="https://github.com/spring-projects/spring-framework/blob/bf5e218b3580df20e6df129eadead4721e1f4f03/spring-webmvc/src/main/java/org/springframework/web/servlet/mvc/method/annotation/RequestMappingHandlerMapping.java">RequestMappingHandlerMapping</a>识别出 <code>OrderController</code> 中相应的处理方法，并返回一个 <code>HandlerExecutionChain</code>。这个 <code>HandlerExecutionChain</code> 包含了处理该请求的控制器方法（如 <code>OrderController.list()</code>）以及相关的拦截器链。</li><li>当然拦截器（多个 <code>HandlerInterceptor</code> 以及可能是异步的 <code>AsyncHandlerInterceptor</code> 和 <code>WebRequestHandlerInterceptorAdapter</code> ）可能会执行一些通用逻辑，如权限验证、日志记录等，都是按既定顺序执行。如果所有的拦截器都允许请求通过，将调用实际的处理器方法（如 <code>OrderController.list()</code>）。</li><li>调用实际的处理器方法后还会继续调用拦截器的 <code>postHandle()</code> 方法，在生成响应之前对结果进一步处理。最后，无论请求是否成功，<code>afterCompletion()</code> 方法都会被调用，此为清理操作。</li></ol><h4 id="关系图"><a href="#关系图" class="headerlink" title="关系图"></a>关系图</h4><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/20240810215423.png" alt="DispatcherServlet.java" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">DispatcherServlet.java</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/20240810215605.png" alt="RequestMappingHandlerMapping.java" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">RequestMappingHandlerMapping.java</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/20240810214830.png" alt="抽象处理者、基础处理者、具体处理者" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">抽象处理者、基础处理者、具体处理者</span></div></div><h4 id="HandlerInterceptor"><a href="#HandlerInterceptor" class="headerlink" title="HandlerInterceptor"></a>HandlerInterceptor</h4><blockquote><p><strong>抽象处理者</strong> 网络请求处理的不同阶段拦截器</p></blockquote><figure class="highlight java"><figcaption><span>HandlerInterceptor</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;  <br>    <span class="hljs-keyword">default</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <br>    &#125;<span class="hljs-comment">//调用&quot;Controller&quot;方法之前  </span><br>  <br>    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, <span class="hljs-meta">@Nullable</span> ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>    &#125;<span class="hljs-comment">//调用&quot;Controller&quot;方法之后渲染&quot;ModelAndView&quot;之前</span><br>  <br>    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, <span class="hljs-meta">@Nullable</span> Exception ex)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>    &#125;<span class="hljs-comment">//渲染&quot;ModelAndView&quot;之后 </span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="AsyncHandlerInterceptor"><a href="#AsyncHandlerInterceptor" class="headerlink" title="AsyncHandlerInterceptor"></a>AsyncHandlerInterceptor</h4><blockquote><p><strong>基础处理者</strong> 继承了 <code>HandlerInterceptor</code> 接口，并添加了处理异步请求的方法。</p></blockquote><figure class="highlight java"><figcaption><span>AsyncHandlerInterceptor</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AsyncHandlerInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;  <br>    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterConcurrentHandlingStarted</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h4 id="WebRequestHandlerInterceptorAdapter"><a href="#WebRequestHandlerInterceptorAdapter" class="headerlink" title="WebRequestHandlerInterceptorAdapter"></a>WebRequestHandlerInterceptorAdapter</h4><blockquote><p><strong>具体处理者</strong> 实现了 <code>AsyncHandlerInterceptor</code> 接口。并将 <code>WebRequestInterceptor</code> 转换为 <code>HandlerInterceptor</code>。它将 <code>WebRequestInterceptor</code> 的处理逻辑适配为 HTTP 请求处理逻辑，并处理异步请求的逻辑。</p></blockquote><figure class="highlight java"><figcaption><span>WebRequestHandlerInterceptorAdapter</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebRequestHandlerInterceptorAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncHandlerInterceptor</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WebRequestInterceptor requestInterceptor;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WebRequestHandlerInterceptorAdapter</span><span class="hljs-params">(WebRequestInterceptor requestInterceptor)</span> &#123;  <br>        Assert.notNull(requestInterceptor, <span class="hljs-string">&quot;WebRequestInterceptor must not be null&quot;</span>);  <br>        <span class="hljs-built_in">this</span>.requestInterceptor = requestInterceptor;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>        <span class="hljs-built_in">this</span>.requestInterceptor.preHandle(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DispatcherServletWebRequest</span>(request, response));  <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, <span class="hljs-meta">@Nullable</span> ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>        <span class="hljs-built_in">this</span>.requestInterceptor.postHandle(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DispatcherServletWebRequest</span>(request, response), modelAndView != <span class="hljs-literal">null</span> &amp;&amp; !modelAndView.wasCleared() ? modelAndView.getModelMap() : <span class="hljs-literal">null</span>);  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, <span class="hljs-meta">@Nullable</span> Exception ex)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>        <span class="hljs-built_in">this</span>.requestInterceptor.afterCompletion(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DispatcherServletWebRequest</span>(request, response), ex);  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterConcurrentHandlingStarted</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> &#123;  <br>        <span class="hljs-type">WebRequestInterceptor</span> <span class="hljs-variable">var5</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.requestInterceptor;  <br>        <span class="hljs-keyword">if</span> (var5 <span class="hljs-keyword">instanceof</span> AsyncWebRequestInterceptor asyncInterceptor) &#123;  <br>            <span class="hljs-type">DispatcherServletWebRequest</span> <span class="hljs-variable">webRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DispatcherServletWebRequest</span>(request, response);  <br>            asyncInterceptor.afterConcurrentHandlingStarted(webRequest);  <br>        &#125;  <br>  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h4 id="DispatcherServlet"><a href="#DispatcherServlet" class="headerlink" title="DispatcherServlet"></a>DispatcherServlet</h4><blockquote><p><strong>客户端</strong> 该调度程序负责配置和执行拦截器链。Spring MVC 的前端控制器，用于接收和处理所有的 HTTP 请求。</p><p>这条链路客户端到处理器中间其实还有两个部分，稍后就有介绍<br><strong>HandlerMapping</strong>：用于查找与请求匹配的处理器（<code>Controller</code>），并返回<code>HandlerExecutionChain</code>。<br><strong>HandlerExecutionChain</strong>：包含处理器和一系列拦截器（处理器）（<code>HandlerInterceptor</code>）。它负责在请求处理过程中依次调用链中的拦截器。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameworkServlet</span> &#123;<br>...<br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">HandlerExecutionChain</span> <span class="hljs-variable">mappedHandler</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    ...<br>        <span class="hljs-comment">// 获取处理链</span><br>        mappedHandler = <span class="hljs-built_in">this</span>.getHandler(processedRequest);<br>        ...<br>    &#125;<br>    ...<br><span class="hljs-meta">@Nullable</span>  <br><span class="hljs-keyword">protected</span> HandlerExecutionChain <span class="hljs-title function_">getHandler</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.handlerMappings != <span class="hljs-literal">null</span>) &#123;  <br>        <span class="hljs-type">Iterator</span> <span class="hljs-variable">var2</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.handlerMappings.iterator();  <br>  <br>        <span class="hljs-keyword">while</span>(var2.hasNext()) &#123;  <br>            <span class="hljs-type">HandlerMapping</span> <span class="hljs-variable">mapping</span> <span class="hljs-operator">=</span> (HandlerMapping)var2.next();  <br>            <span class="hljs-type">HandlerExecutionChain</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> mapping.getHandler(request);  <br>            <span class="hljs-keyword">if</span> (handler != <span class="hljs-literal">null</span>) &#123;  <br>                <span class="hljs-keyword">return</span> handler;  <br>            &#125;  <br>        &#125;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <br>&#125;<br>...<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="HandlerExecutionChain"><a href="#HandlerExecutionChain" class="headerlink" title="HandlerExecutionChain"></a>HandlerExecutionChain</h4><blockquote><p><strong>处理链管理者</strong> Spring Web中需要一个角色，将处理器和拦截器链组织在一起，按照顺序处理请求。</p><p>它是一个管理处理器和拦截器链的组件。在处理请求时，它负责管理和调用所有的拦截器方法，并最终调用实际的处理器（例如 Controller）。</p></blockquote><h4 id="HandlerMapping"><a href="#HandlerMapping" class="headerlink" title="HandlerMapping"></a>HandlerMapping</h4><blockquote><p><strong>链的建立者</strong> Spring Web中需要一个角色，负责从请求中确定合适的处理器，并将处理器与拦截器链组合起来，形成一个完整的处理链(也就是<code>HandlerExecutionChain</code>)。</p><p>它可以被视为该条责任链的启动点或“链的建立者”。它确定了请求将由哪个处理器处理，并且可能为处理器配置了一些拦截器。</p></blockquote>]]></content>
    
    
    <summary type="html">责任链模式通过链条传递请求，简化责任分配，增强系统灵活性。</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="设计模式" scheme="https://blog.thatcoder.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Tabby的Web前端与Gateway网关部署</title>
    <link href="https://blog.thatcoder.cn/tabby-web-gateway/"/>
    <id>https://blog.thatcoder.cn/tabby-web-gateway/</id>
    <published>2024-05-13T02:00:00.000Z</published>
    <updated>2024-05-13T04:44:56.570Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>经常换设备用终端时候总是要下载 <code>tabby</code> 和添加原来的连接配置，还不同步。一直想搭建官方提供的<code>tabby-web</code>，现在终于有空搞。<br>搭建完发现不只是可以同步，还可以在网页连接配置里的终端，但是要搭建网关，顺便把网关也搭建了。web是http协议，网关是ws协议。<br>但是搭建过程和官方REDEME相比差别甚大 <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_tiaokan.png"/></span> 遂本文记载 <code>tabby-web</code> 与 <code>tabby-gateway</code> 的搭建配置与联动。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/e97c6c33f5dc5124da4eff1a818b454c.png" alt="部署结果" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">部署结果</span></div></div><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ul><li>docker！docker！docker！</li><li>两份域名证书（前端和网关，前端的自己反向代理使用，网关的需要挂载到容器）</li></ul><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><blockquote><p>先部署吧，碰到的小毛病都是部署后面的（只部署 tabby-web 的话自己删一下网关那段）<br>一起整合到了编排文件。</p></blockquote><p>需要修改的地方如下，分是否开启SSL两种：</p><ul><li>开启SSL<ol><li>填写 网关证书目录地址：签名和私钥命名为gateway.pem和gateway.key</li><li>填写 前端容器挂载目录：后面要用到。</li><li>填写 两个映射的端口</li><li>填写 前端域名</li><li>填写 网关密钥（相当于自定义的密码）</li><li>填写 SOCIAL_AUTH_GITHUB_KEY 与 SOCIAL_AUTH_GITHUB_SECRET （用于用户Github登录，<a href="https://github.com/settings/developers">点进来进来创建一个</a>，回调地址填前端域名）</li></ol></li><li>取消SSL<ol><li>修改 tabby-gateway.command: –token-auth –host 0.0.0.0</li><li>删除 tabby-gateway.volumes</li><li>修改 “网关端口:443” -&gt; “网关端口:9000”</li><li>填写 网关密钥</li><li>填写 前端域名</li><li>填写 SOCIAL_AUTH_GITHUB_KEY 与 SOCIAL_AUTH_GITHUB_SECRET</li></ol></li></ul><figure class="highlight yaml"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.0&quot;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">tabby-gateway:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ghcr.io/eugeny/tabby-connection-gateway:master</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">&quot;tabby-gateway&quot;</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">--token-auth</span> <span class="hljs-string">--host</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>  <span class="hljs-string">--port</span> <span class="hljs-number">443</span>  <span class="hljs-string">--certificate</span> <span class="hljs-string">/custom/ssl/gateway.pem</span> <span class="hljs-string">--private-key</span> <span class="hljs-string">/custom/ssl/gateway.key</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">TABBY_AUTH_TOKEN=网关密钥</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;网关端口:443&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/你的网关证书地址:/custom/ssl</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br><br>  <span class="hljs-attr">tabby-web:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ghcr.io/eugeny/tabby-web:latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">tabby-web</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/你的前端容器挂载目录:/data</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">DATABASE_URL=sqlite:////data/db.sqlite3</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">DEBUG=False</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">PORT=8080</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">APP_DIST_STORAGE=file:///data</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">SOCIAL_AUTH_GITHUB_KEY=记得填</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">SOCIAL_AUTH_GITHUB_SECRET=记得填</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">com.centurylinklabs.watchtower.enable=true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">traefik.enable=true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">traefik.http.routers.app-tabby-web.tls=true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">traefik.http.routers.app-tabby-web.tls.certresolver=cloudflare</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">traefik.http.routers.app-tabby-web.entrypoints=websecure</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">traefik.http.routers.app-tabby-web.rule=Host(`前端域名`)</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">traefik.http.routers.app-tabby-web.service=app-tabby-web</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">traefik.http.services.app-tabby-web.loadbalancer.server.port=9090</span><br>    <span class="hljs-attr">logging:</span><br>      <span class="hljs-attr">driver:</span> <span class="hljs-string">json-file</span><br>      <span class="hljs-attr">options:</span><br>        <span class="hljs-attr">max-size:</span> <span class="hljs-string">5m</span><br>        <span class="hljs-attr">max-file:</span> <span class="hljs-string">&quot;5&quot;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;前端端口:8080&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>编排就交给你了，部署完接下来分两步，先跑通web后讲gateway。</p></blockquote><h2 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h2><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/20240513122813.png" alt="前端警告⚠️" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">前端警告⚠️</span></div></div><p>访问前端后会肯定有一个提醒，我们来到tabby-web容器的命令行执行如下</p><figure class="highlight bash"><figcaption><span>web容器</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/manage.sh add_version 1.0.187-nightly.1<br></code></pre></td></tr></table></figure><p><a href="#%E8%B0%83%E6%95%B4%E4%BE%9D%E8%B5%96">下面是毛病吐槽，点击跳过碎碎念。</a></p><p>最新版其实是 <code>1.0.197-nightly.1</code> ，但是容易暴毙。<br>安装完之后重启容器发现仍然是黑屏！ <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_think.png"/></span></p><p>打开F12网络检查会发现找不到 <code>/app-dist/1.0.187-nightly.1/</code> 下面的文件。<br>来到服务器前端容器挂载目录会发现有<code>1.0.187-nightly.1</code>目录，但是它的子目录是<code>/tmpxxxx</code>，而<code>/tmpxxxx</code>目录下面就是前端网络找不到的文件，是不是很抽象。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_annoyed.png"/></span><span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_annoyed.png"/></span></p><p>当你把文件<code>/tmpxxxx</code>目录下面文件移动到<code>1.0.187-nightly.1</code>下面，重启容器，你会发现前端不再黑屏，但是一直在加载，打开F12故技重施发现又要<code>/tmpxxxx</code>下面的文件，而且要的还是<code>1.0.187-nightly.1</code>依赖未解压的版本，实在是抽象。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_vomit.png"/></span><span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_vomit.png"/></span><span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_vomit.png"/></span></p><p>好了我吐槽完了，下面厘清操作。</p><h3 id="调整依赖"><a href="#调整依赖" class="headerlink" title="调整依赖"></a>调整依赖</h3><blockquote><p>在前端容器挂载目录完成。</p></blockquote><ol><li>将 <code>/1.0.187-nightly.1/tmpxxxx</code> 下面的文件移动到 <code>/1.0.187-nightly.1</code></li></ol><figure class="highlight bash"><figcaption><span>移动文件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 去目标目录</span><br><span class="hljs-built_in">cd</span> /前端容器挂载目录/1.0.187-nightly.1<br><span class="hljs-comment"># 查询tmpxxx名字</span><br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">mv</span> ./tmpxxxx/* ./<br></code></pre></td></tr></table></figure><ol start="2"><li>下载源码，解压到 <code>./tmpxxxx</code></li></ol><figure class="highlight bash"><figcaption><span>下载解压</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 去目标目录</span><br><span class="hljs-built_in">cd</span> ./tmpxxx<br><span class="hljs-comment"># 下载解压</span><br>wget https://registry.npmjs.org/tabby-web-demo/-/tabby-web-demo-1.0.187-nightly.1.tgz tar -xvf tabby-web-demo-1.0.187-nightly.1.tgz<br></code></pre></td></tr></table></figure><h3 id="同步配置"><a href="#同步配置" class="headerlink" title="同步配置"></a>同步配置</h3><p>自此重启容器，前端能加载完毕。</p><p>访问：<code>你的域名/login</code>。可以使用Github登录。<br>登陆之后点击设置有token，然后在客户端配置即可，参考下面图片，前者前端，后者客户端。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/cae19f41855f761dd0042734dd91634f.png" alt="前端设置" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">前端设置</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/20240513115712.png" alt="客户端配置" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">客户端配置</span></div></div><h2 id="网关"><a href="#网关" class="headerlink" title="网关"></a>网关</h2><blockquote><p>编排能通过网关就没问题，网关一直重启就是证书目录有问题。</p></blockquote><p>注意：网关是WS协议，不要习惯去http反向代理，然后配置了证书的话网关地址应该是 <code>wss://网关域名:网关端口</code></p><p>填写是在前端填写，这样就能在网页上用同步的配置连接终端，如图。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/94c4cf524760ab9dc43cee6c4365dcbe.png" alt="网页使用配置" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">网页使用配置</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/eddf71237d15b46455b8ba416e9ba197.png" alt="网页通过网关连接终端" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">网页通过网关连接终端</span></div></div><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>遇事不决，欢迎提问。 <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_bye.png"/></span></p>]]></content>
    
    
    <summary type="html">docker-compose的tabby-web与tabby-connection-gateway的部署配置</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="部署" scheme="https://blog.thatcoder.cn/tags/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="捣腾" scheme="https://blog.thatcoder.cn/tags/%E6%8D%A3%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>vue运行时反向代理无限刷新</title>
    <link href="https://blog.thatcoder.cn/bug/vue-reverse-proxy-unlimited-refresh/"/>
    <id>https://blog.thatcoder.cn/bug/vue-reverse-proxy-unlimited-refresh/</id>
    <published>2024-05-12T14:00:00.000Z</published>
    <updated>2024-05-15T01:03:29.545Z</updated>
    
    <content type="html"><![CDATA[<h2 id="吐槽"><a href="#吐槽" class="headerlink" title="吐槽"></a>吐槽</h2><p>本以为是一次习以为常的部署业务。结果要是再刷新下去，CPU都要爆了！！！</p><h2 id="错误情景"><a href="#错误情景" class="headerlink" title="错误情景"></a>错误情景</h2><ul><li><strong>开发版本</strong>：<ul><li>vue：2</li></ul></li><li><strong>开发环境</strong>：正常本地window开发。<ul><li><strong>bug</strong>：无。</li></ul></li><li><strong>生成环境</strong>：项目是运行时，运行在52002端口，nginx反向代理127.0.0.1:52002，挂载到域名开启ssl。<ul><li><strong>bug</strong>：访问域名会无限刷新网页。刷新时候可以看到网页有内容，抓住机会点击跳转也是正常路由跳转，跳转后依然开始无限刷新。</li></ul></li></ul><p>下面是部署项目部分配置代码</p><figure class="highlight js"><figcaption><span>vue.config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;webpack&#x27;</span>)<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;/&#x27;</span>,<br>  <span class="hljs-attr">assetsDir</span>: <span class="hljs-string">&#x27;static&#x27;</span>,<br>  <span class="hljs-attr">productionSourceMap</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">devServer</span>: &#123;<br>    <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>,<br>    <span class="hljs-attr">port</span>: <span class="hljs-number">52002</span>,<br>    <span class="hljs-attr">proxy</span>: &#123;<br>      <span class="hljs-string">&#x27;/proxy/api&#x27;</span>:&#123;<br>        <span class="hljs-attr">target</span>:<span class="hljs-string">&#x27;https://xxx.thatcoder.cn&#x27;</span>,<br>        <span class="hljs-attr">changeOrigin</span>:<span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">pathRewrite</span>:&#123;<br>          <span class="hljs-string">&#x27;/proxy/api&#x27;</span>:<span class="hljs-string">&#x27;https://xxx.thatcoder.cn&#x27;</span><br>        &#125;<br>      &#125;<br>    &#125;,<br>    <span class="hljs-attr">allowedHosts</span>: [<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-string">&#x27;xxx.thatcoder.cn&#x27;</span>],<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><blockquote><p>严谨的说，仅提供博主排错误时看到的类似错误与解决方案收录。因为即使错误表现一致，错误原因可能不一致。</p></blockquote><h3 id="破局一"><a href="#破局一" class="headerlink" title="破局一"></a>破局一</h3><blockquote><p>此方法解决博主问题。</p></blockquote><p>执行打包命令，将反向代理的站点设置为打包的目录（默认是dist）。或者将打包文件复制到站点的目录下。（博主选择后者）</p><h3 id="破局二"><a href="#破局二" class="headerlink" title="破局二"></a>破局二</h3><p>部分人是碰到运行时的热部署经过反向代理后无法通讯导致，热部署是ws协议，与项目共用端口。部分人通过配置关闭热部署能解决。</p><ul><li>vue2和vue3关闭热部署</li></ul><figure class="highlight js"><figcaption><span>vue.config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">devServer</span>: &#123;<br>    <span class="hljs-attr">hot</span>: <span class="hljs-literal">false</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>vite关闭热部署</li></ul><figure class="highlight js"><figcaption><span>vite.config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">server</span>: &#123;<br>    <span class="hljs-attr">hmr</span>: <span class="hljs-literal">false</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="破局三"><a href="#破局三" class="headerlink" title="破局三"></a>破局三</h3><p>部分人是碰到运行时的热部署ws协议端口占用，与项目共用端口。部分人通过修改端口能解决。</p><ul><li>修改热部署ws协议端口</li></ul><figure class="highlight js"><figcaption><span>vue.config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">devServer</span>: &#123;<br>    <span class="hljs-attr">client</span>: &#123;  <br>  <span class="hljs-attr">webSocketURL</span>: <span class="hljs-string">&#x27;ws://0.0.0.0:52003/ws&#x27;</span>  <br>&#125;,<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">服务器vue部署反向代理热重载导致无限刷新。</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="BUG" scheme="https://blog.thatcoder.cn/tags/BUG/"/>
    
  </entry>
  
  <entry>
    <title>OnlyOffice集成到Vue与Spring项目</title>
    <link href="https://blog.thatcoder.cn/OnlyOffice-Vue-Spring/"/>
    <id>https://blog.thatcoder.cn/OnlyOffice-Vue-Spring/</id>
    <published>2024-05-11T22:00:00.000Z</published>
    <updated>2024-05-12T18:28:36.050Z</updated>
    
    <content type="html"><![CDATA[<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul><li>需安装依赖：<code>@onlyoffice/document-editor-vue</code></li><li>需自行搭建OnlyOffice服务：<code>https://office.thatcoder.cn/</code> (仅供测试使用，请勿用于生产环境，随时可能关闭)</li><li>补充：搭建OnlyOffice要开启ssl按官方的比较麻烦，可以移步底下目录有<a href="#%E7%A4%BE%E5%8C%BA%E8%A7%A3%E9%94%81%E7%89%88">解锁版</a>，调教了配置。</li></ul><h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><blockquote><p>一口吃不成胖子，先从最简单的DEMO，来测试所用服务的可靠性。</p></blockquote><p>测试的DEMO，仅需要替换以下变量即可跑通测试。</p><ul><li><code>documentSite</code>：自行搭建的OnlyOffice服务地址。可用 <code>https://office.thatcoder.cn/</code> 进行测试。</li><li><code>documentUrl</code>: DOCX文档地址。</li></ul><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/4e6bc0de79be547da8ad0d62bd6023b0.png" data-fancybox="true"/></div></div><figure class="highlight plaintext"><figcaption><span>office-demo.vue</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>&lt;DocumentEditor<br>    id=&quot;docEditor&quot;<br>    :documentServerUrl=&quot;documentSite&quot;<br>    :config=&quot;editorConfig&quot;<br>    :events_onDocumentReady=&quot;onDocumentReady&quot;<br>/&gt;<br>&lt;/template&gt;<br><br>&lt;script setup&gt;  <br>import &#123;ref&#125; from &quot;vue&quot;;  <br>import &#123; DocumentEditor &#125; from &#x27;@onlyoffice/document-editor-vue&#x27;;  <br>import axios from &quot;axios&quot;;  <br><br>// DOCX文档地址<br>const documentUrl = ref(&#x27;https://resumes.thatcdn.cn/public/template/resumes_001.docx&#x27;); <br>const documentTitle = ref(&#x27;论Vue如何使用OnlyOffice&#x27;);<br>const documentType = ref(&#x27;docx&#x27;);  <br>// 文档标识符<br>const documentKey = ref(&#x27;your-document-key&#x27;);<br>// 私有化的OnlyOffice地址<br>const documentSite = &#x27;https://office.thatcoder.cn/&#x27;<br>// Vue处理OnlyOffice事务的回调地址<br>const documentCallSite = &#x27;https://www.baidu.com/&#x27;<br><br>// 文档加载完毕的回调<br>const onDocumentReady = () =&gt; &#123;  <br>  console.log(&#x27;Document is ready&#x27;);  <br>&#125;;  <br>// 文档变更的回调<br>const onDocumentStateChange = (event) =&gt; &#123;  <br>  if (event.data === &#x27;onDocumentStateChange&#x27;) &#123;  <br>    saveDocument();  <br>  &#125;  <br>&#125;;  <br><br>// 处理文档另存为的回调事件<br>const onRequestSaveAs = (event) =&gt; &#123;  <br>  console.log(&#x27;Document save as requested&#x27;);  <br>  // 执行文档另存为的逻辑,例如弹出保存对话框等  <br>&#125;;  <br><br>// 插入图片的回调事件<br>const onRequestInsertImage = (event) =&gt; &#123;    <br>  console.log(&#x27;Insert image requested&#x27;);  <br>  // 执行插入图片的逻辑,例如打开图片选择器等  <br>&#125;;  <br><br>// 文档保存回调方法<br>const saveDocument = () =&gt; &#123;  <br>  axios.post(&#x27;https://www.baidu.com/save-document&#x27;, &#123;  <br>    documentUrl: documentUrl.value,  <br>    documentType: documentType.value,  <br>    documentKey: documentKey.value,  <br>  &#125;)  <br>      .then(response =&gt; &#123;  <br>        console.log(&#x27;Document saved successfully&#x27;);  <br>      &#125;)  <br>      .catch(error =&gt; &#123;  <br>        console.error(&#x27;Document save error:&#x27;, error);  <br>      &#125;);  <br>&#125;;<br><br>// 初始化OnlyOffice<br>const editorConfig = ref(&#123;  <br>  document: &#123;  <br>    title: documentTitle.value,  <br>    url: documentUrl.value,  <br>    fileType: documentType.value,  <br>    key: documentKey.value,  <br>  &#125;,  <br>  editorConfig: &#123;  <br>    mode: &#x27;edit&#x27;,  <br>    lang: &#x27;zh&#x27;,  <br>    callbackUrl: documentCallSite,  <br>  &#125;,  <br>  events: &#123;  <br>    onReady: onDocumentReady,  <br>    onDocumentStateChange: onDocumentStateChange,  <br>    onRequestSaveAs: onRequestSaveAs,  <br>    onRequestInsertImage: onRequestInsertImage,  <br>    // 添加其他需要处理的回调事件  <br>  &#125;,   <br>&#125;);  <br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h2 id="配置参数"><a href="#配置参数" class="headerlink" title="配置参数"></a>配置参数</h2><blockquote><p>Config提供了大量配置，不过社区版支持的参数不是特别多。</p></blockquote><ul><li><code>editorConfig</code>：参数配置</li><li><code>document</code>：当前文档参数</li><li><code>events</code>：回调事件绑定<br>更多参考官方文档<a href="https://api.onlyoffice.com/zh/editors/config/">ONLYOFFICE API 文档 - Config</a></li></ul><figure class="highlight js"><figcaption><span>office配置</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> editorConfig = <span class="hljs-title function_">ref</span>(&#123;  <br>  <span class="hljs-attr">editorConfig</span>: &#123;  <br>    <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;edit&#x27;</span>,  <br>    <span class="hljs-attr">lang</span>: <span class="hljs-string">&#x27;zh&#x27;</span>,  <br>    <span class="hljs-attr">customization</span>: &#123;  <br>      <span class="hljs-attr">anonymous</span>: &#123;  <br>        <span class="hljs-attr">request</span>: <span class="hljs-literal">true</span>,  <br>        <span class="hljs-attr">label</span>: <span class="hljs-string">&quot;Guest&quot;</span>  <br>      &#125;,  <br>      <span class="hljs-attr">autosave</span>: <span class="hljs-literal">false</span>,  <br>      <span class="hljs-attr">comments</span>: <span class="hljs-literal">true</span>,  <br>      <span class="hljs-attr">compactHeader</span>: <span class="hljs-literal">true</span>,  <br>      <span class="hljs-attr">compactToolbar</span>: <span class="hljs-literal">false</span>,  <br>      <span class="hljs-attr">compatibleFeatures</span>: <span class="hljs-literal">true</span>,  <br>      <span class="hljs-attr">customer</span>: &#123;  <br>        <span class="hljs-attr">address</span>: <span class="hljs-string">&quot;A small corner of China&quot;</span>,  <br>        <span class="hljs-attr">info</span>: <span class="hljs-string">&quot;A member of the open source spirit of the Internet&quot;</span>,  <br>        <span class="hljs-attr">logo</span>: <span class="hljs-string">&quot;https://resume.app.thatcoder.cn/favicon.ico&quot;</span>,  <br>        <span class="hljs-attr">logoDark</span>: <span class="hljs-string">&quot;https://resume.app.thatcoder.cn/favicon.ico&quot;</span>,  <br>        <span class="hljs-attr">mail</span>: <span class="hljs-string">&quot;thatcoder@163.com&quot;</span>,  <br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;钟意&quot;</span>,  <br>        <span class="hljs-attr">phone</span>: <span class="hljs-number">13305374721</span>,  <br>        <span class="hljs-attr">www</span>: <span class="hljs-string">&quot;https://blog.thatcoder.cn&quot;</span>  <br>      &#125;,  <br>      <span class="hljs-attr">forcesave</span>: <span class="hljs-literal">false</span>,  <br>      <span class="hljs-attr">goback</span>: &#123;  <br>        <span class="hljs-attr">blank</span>: <span class="hljs-literal">true</span>,  <br>        <span class="hljs-attr">requestClose</span>: <span class="hljs-literal">false</span>,  <br>        <span class="hljs-attr">text</span>: <span class="hljs-string">&quot;回到简历列表&quot;</span>,  <br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;https://resume.app.thatcoder.cn/mine/folder&quot;</span>  <br>      &#125;,  <br>      <span class="hljs-attr">help</span>: <span class="hljs-literal">false</span>,  <br>      <span class="hljs-attr">hideRightMenu</span>: <span class="hljs-literal">false</span>,  <br>      <span class="hljs-attr">hideRulers</span>: <span class="hljs-literal">true</span>,  <br>      <span class="hljs-attr">integrationMode</span>: <span class="hljs-string">&quot;embed&quot;</span>,  <br>      <span class="hljs-attr">logo</span>: &#123;  <br>        <span class="hljs-attr">image</span>: <span class="hljs-string">&quot;https://resume.app.thatcoder.cn/favicon.ico&quot;</span>,  <br>        <span class="hljs-attr">imageDark</span>: <span class="hljs-string">&quot;https://resume.app.thatcoder.cn/favicon.ico&quot;</span>,  <br>        <span class="hljs-attr">imageEmbedded</span>: <span class="hljs-string">&quot;https://resume.app.thatcoder.cn/favicon.ico&quot;</span>,  <br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;https://resume.app.thatcoder.cn&quot;</span>  <br>      &#125;,  <br>      <span class="hljs-attr">macros</span>: <span class="hljs-literal">true</span>,  <br>      <span class="hljs-attr">macrosMode</span>: <span class="hljs-string">&quot;禁用&quot;</span>,  <br>      <span class="hljs-attr">mentionShare</span>: <span class="hljs-literal">false</span>,  <br>      <span class="hljs-attr">mobileForceView</span>: <span class="hljs-literal">true</span>,  <br>      <span class="hljs-attr">plugins</span>: <span class="hljs-literal">false</span>,  <br>      <span class="hljs-attr">toolbarHideFileName</span>: <span class="hljs-literal">true</span>,  <br>      <span class="hljs-attr">toolbarNoTabs</span>: <span class="hljs-literal">true</span>,  <br>      <span class="hljs-comment">// uiTheme: &quot;theme-dark&quot;,  </span><br>      <span class="hljs-attr">unit</span>: <span class="hljs-string">&quot;厘米&quot;</span>,  <br>      <span class="hljs-attr">zoom</span>: <span class="hljs-number">100</span>  <br>    &#125;,  <br>    <span class="hljs-comment">// callbackUrl: &#x27;https://resume.app.thatcoder.cn/onlyoffice-callback&#x27;,  </span><br>    <span class="hljs-attr">callbackUrl</span>: <span class="hljs-string">&#x27;https://resume.thatapi.cn/office/callback&#x27;</span>,  <br>  &#125;,  <br>  <span class="hljs-attr">document</span>: &#123;  <br>    <span class="hljs-attr">title</span>: documentName,  <br>    <span class="hljs-attr">url</span>: documentUrl,  <br>    <span class="hljs-attr">fileType</span>: documentType,  <br>    <span class="hljs-attr">key</span>: documentKey,  <br>    <span class="hljs-attr">info</span>: &#123;  <br>      <span class="hljs-attr">favorite</span>: <span class="hljs-literal">false</span>,  <br>      <span class="hljs-attr">folder</span>: <span class="hljs-string">&quot;&quot;</span> + thatLocal.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;userId&#x27;</span>),  <br>      <span class="hljs-attr">owner</span>: <span class="hljs-string">&quot;&quot;</span> + thatLocal.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;userName&#x27;</span>),  <br>      <span class="hljs-attr">sharingSettings</span>: [  <br>        &#123;  <br>          <span class="hljs-attr">permissions</span>: <span class="hljs-string">&quot;Full Access&quot;</span>,  <br>          <span class="hljs-attr">user</span>: <span class="hljs-string">&quot;&quot;</span> + thatLocal.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;userName&#x27;</span>)  <br>        &#125;  <br>      ],  <br>      <span class="hljs-attr">uploaded</span>: <span class="hljs-string">&quot;2010-07-07 3:46 PM&quot;</span>  <br>    &#125;  <br>  &#125;,  <br>  <span class="hljs-attr">events</span>: &#123;  <br>    <span class="hljs-attr">onReady</span>: onDocumentReady,  <br>    <span class="hljs-comment">// onDocumentStateChange: onDocumentStateChange,  </span><br>    <span class="hljs-attr">onRequestSaveAs</span>: onRequestSaveAs,  <br>    <span class="hljs-comment">// onRequestInsertImage: onRequestInsertImage,  </span><br>    <span class="hljs-comment">// 添加其他需要处理的回调事件  </span><br>  &#125;,  <br>  <span class="hljs-comment">// documentServerUrl: &#x27;https://office.thatcoder.cn&#x27;, // 指定 ONLYOFFICE 服务器的网址  </span><br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="回调服务"><a href="#回调服务" class="headerlink" title="回调服务"></a>回调服务</h2><blockquote><p>回调服务是指OnlyOffice与你的服务端的通讯地址，主要用于处理文档的保存、另存为等事件。<br>这里实例用spring演示，仅供参考，逻辑部分请自行编写。<br>建议边参考官方文档看代码。<a href="https://api.onlyoffice.com/zh/editors/callback">ONLYOFFICE API 文档 - 回调处理程序</a></p></blockquote><figure class="highlight java"><figcaption><span>OfficeCallbackDemoController.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.onestack.project.office.controller;<br><br><span class="hljs-keyword">import</span> cn.hutool.json.JSONObject;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.PrintWriter;<br><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/office&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OfficeCallbackDemoController</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SAVE_DIRECTORY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/path/to/save/directory&quot;</span>; <span class="hljs-comment">// 替换为你的保存路径</span><br><br>    <span class="hljs-meta">@RequestMapping(&quot;/callback&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">callback</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> response.getWriter();<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(request.getInputStream()).useDelimiter(<span class="hljs-string">&quot;\\A&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> scanner.hasNext() ? scanner.next() : <span class="hljs-string">&quot;&quot;</span>;<br><br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>(body);<br>        System.out.println(jsonObj);<br><br>        <span class="hljs-keyword">if</span>(jsonObj.getInt(<span class="hljs-string">&quot;status&quot;</span>) == <span class="hljs-number">2</span>)<br>        &#123;<br>            System.out.println(<span class="hljs-string">&quot;Office文档可保存&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(jsonObj.getInt(<span class="hljs-string">&quot;status&quot;</span>) == <span class="hljs-number">1</span>)<br>        &#123;<br>            System.out.println(<span class="hljs-string">&quot;Office文档已连接&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(jsonObj.getInt(<span class="hljs-string">&quot;status&quot;</span>) == <span class="hljs-number">4</span>)&#123;<br>            System.out.println(<span class="hljs-string">&quot;Office文档已断开&quot;</span>);<br>        &#125;<br>        System.out.println(jsonObj);<br>        writer.write(<span class="hljs-string">&quot;&#123;\&quot;error\&quot;:0&#125;&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="社区解锁版"><a href="#社区解锁版" class="headerlink" title="社区解锁版"></a>社区解锁版</h2><h3 id="镜像地址"><a href="#镜像地址" class="headerlink" title="镜像地址"></a>镜像地址</h3><p>出自oo中文交流群，企鹅群号 186184848。</p><ul><li>国内地址1：<code>docker pull registry.cn-hangzhou.aliyuncs.com/186184848/documentserver</code></li><li>国内地址2：<code>docker pull registry.cn-hangzhou.aliyuncs.com/thatcoder-public/only-office</code></li><li>DockerHub：<code>docker pull 186184848/documentserver</code></li></ul><h3 id="修改说明"><a href="#修改说明" class="headerlink" title="修改说明"></a>修改说明</h3><ul><li>基于docker镜像制作，最新版本号: 8.0.1</li><li>关闭地址过滤，导入镜像后可以完美通过IP局域网运行（在7.4以上版本默认无法通过IP访问）</li><li>去除最大在线编辑人数限制</li><li>完美解锁手机端浏览和编辑（无需设置手机UA为电脑模式）</li><li>添加中文字体，加入了常用的十几种字体</li><li>支持http&#x2F;https快速部署（默认开启ssl非常繁琐）</li><li>优化文档打开速度（进一步优化，打开速度提升20%）</li><li>最大支持300M文档在线编辑（7.5以上新增）（默认30M）。</li><li>关闭SSL证书校验，自签证书也可以直接使用了。（7.6新增）</li></ul><h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><p>镜像包含amd64，arm64架构<br>运行镜像遇到启动不起来问题报端口错误需要加上命令：–privileged&#x3D;true<br>相关教程文档请参考：<a href="https://www.yuque.com/xiaohuochai-t5dj3/wc519f/fhw8kgrwf3l8ryy2?singleDoc#">《从零使用onlyoffice及各类网盘》</a></p><h2 id="插件扩展"><a href="#插件扩展" class="headerlink" title="插件扩展"></a>插件扩展</h2><p>未来写吧，有需要的可以参考官方文档。</p>]]></content>
    
    
    <summary type="html">OnlyOffice的使用记录，在Vue项目中编写文档。</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="业务" scheme="https://blog.thatcoder.cn/tags/%E4%B8%9A%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>PlanetScale的免费Hobby计划即将结束</title>
    <link href="https://blog.thatcoder.cn/PlanetScale%20free%20Hobby%20plan%20is%20being%20retired/"/>
    <id>https://blog.thatcoder.cn/PlanetScale%20free%20Hobby%20plan%20is%20being%20retired/</id>
    <published>2024-03-21T19:00:00.000Z</published>
    <updated>2024-03-21T19:30:06.844Z</updated>
    
    <content type="html"><![CDATA[<h2 id="如题"><a href="#如题" class="headerlink" title="如题"></a>如题</h2><p>三封邮件，十分钟一封，赶紧停下代码迁移数据库。</p><p>之前临时测试 waline 评论的数据，就部署在 PlanetScale，没想到一用就是一年。</p><p>白嫖这么久怪不好意思的。 <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_doge.png"/></span></p><p>不会有博友也是PlanetScale吧。</p><p><img src="https://upyun.thatcdn.cn/myself/typora/202403220321769.png" alt="PlanetScale的免费Hobby计划即将结通知"></p>]]></content>
    
    
    <summary type="html">白嫖党们，PlanetScale的免费Hobby计划即将结业，届时发现，白嫖之路已经走到了尽头。</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="随笔" scheme="https://blog.thatcoder.cn/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>Stellar 1.18.5 迁移到 latest</title>
    <link href="https://blog.thatcoder.cn/stellar-1.18.5-to-latest/"/>
    <id>https://blog.thatcoder.cn/stellar-1.18.5-to-latest/</id>
    <published>2024-01-07T16:00:00.000Z</published>
    <updated>2024-07-20T12:59:50.279Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>不得不说，从1.18迁移到1.23变化挺大。作者xaoxuu辛苦了。</p><h2 id="迁移工作"><a href="#迁移工作" class="headerlink" title="迁移工作"></a>迁移工作</h2><p>考虑长期使用stellar，就fork了一个分支持续跟进作者的更新。<br><img src="https://upyun.thatcdn.cn/myself/typora/202401080550812.png"></p><h2 id="变化"><a href="#变化" class="headerlink" title="变化"></a>变化</h2><p>很多细节变化吧，这里备注一下巨变。</p><h3 id="references写法改变"><a href="#references写法改变" class="headerlink" title="references写法改变"></a>references写法改变</h3><p>我wiki大量使用了参考文献功能，给出正则表达式批量替换方法</p><ul><li>查找：<code>- title: &#39;(.*?)&#39;\n    url: &#39;(.*?)&#39;</code></li><li>替换：<code>- &#39;[$1]($2)&#39;</code></li></ul><p>也不是万能的，如果标题有特殊字符违背markdown写法可能报错，但剩下几个特殊的手动改就行。</p><h3 id="页尾license"><a href="#页尾license" class="headerlink" title="页尾license"></a>页尾license</h3><figure class="highlight yaml"><figcaption><span>_stellar.config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">article:</span><br>  <span class="hljs-attr">license:</span> <span class="hljs-string">|</span><br>    <span class="hljs-string">本文为</span> [<span class="hljs-string">$</span>&#123;<span class="hljs-string">author.name</span>&#125;]<span class="hljs-string">($&#123;author.url&#125;)</span> <span class="hljs-string">撰写，采用</span> [<span class="hljs-string">CC</span> <span class="hljs-string">BY-NC-SA</span> <span class="hljs-number">4.0</span>]<span class="hljs-string">(https://creativecommons.org/licenses/by-nc-sa/4.0/)</span> <span class="hljs-string">许可协议，转载请注明出处。</span><br></code></pre></td></tr></table></figure><h3 id="作者"><a href="#作者" class="headerlink" title="作者"></a>作者</h3><figure class="highlight yaml"><figcaption><span>_data/authors.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 作者 1 （默认）</span><br><span class="hljs-attr">ThatCoder:</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;钟意&#x27;</span><br><span class="hljs-attr">avatar:</span> <span class="hljs-string">/custom/img/author.jpg</span><br><span class="hljs-attr">banner:</span> <span class="hljs-string">https://upyun.thatcdn.cn/myself/typora/202401120247887.webp</span><br><span class="hljs-attr">description:</span> <span class="hljs-string">感谢你的阅读,</span> <span class="hljs-string">让我们拥有一段对彼此都有意义的时光.</span><br></code></pre></td></tr></table></figure><h3 id="friends标签"><a href="#friends标签" class="headerlink" title="friends标签"></a>friends标签</h3><p>friends标签的分组需要单独一个yml文件<br>sites也一样</p><h3 id="wiki系统"><a href="#wiki系统" class="headerlink" title="wiki系统"></a>wiki系统</h3><p>这个一开始有点绕，我整理了一下逻辑。</p><ol><li>_data&#x2F;wiki.yml 的列表名字如 pro_name 指向 _data&#x2F;wiki&#x2F;pro_name.yml 的文件名字</li><li>_data&#x2F;wiki&#x2F;xxx.yml 文件里面的 path: &#x2F;wiki&#x2F;pro_path&#x2F; 参数指向 source&#x2F;wiki&#x2F;pro_path&#x2F; 文件夹</li><li>source&#x2F;wiki&#x2F;pro_path&#x2F; 文件夹内文件的 wiki: pro_name 闭环指向 _data&#x2F;wiki.yml 的列表名字</li></ol><ul><li>综上 _data&#x2F;wiki.yml 和 _data&#x2F;wiki&#x2F;pro_name.yml 和 文件wiki: pro_name 需要一致是 pro_name</li><li>而最终上线的项目在线 url 与  pro_name 无关，关联的是 source&#x2F;wiki&#x2F;pro_path&#x2F; 对应的 pro_path 目录名称</li></ul><h3 id="其他功能"><a href="#其他功能" class="headerlink" title="其他功能"></a>其他功能</h3><p>来不及一个一个试功能，先写到这，便把博客更新到1.23.0</p><h2 id="万能时间线重构"><a href="#万能时间线重构" class="headerlink" title="万能时间线重构"></a>万能时间线重构</h2><blockquote><p>文档待写, 测试中</p></blockquote><h3 id="联合测试"><a href="#联合测试" class="headerlink" title="联合测试"></a>联合测试</h3><div class="tag-plugin timeline timetmpl"><div class="timenode" index="0"><div class="header"><p>netease</p></div><div class="body fs14">`{ "api": "https://netease.thatapi.cn/user/event?uid=134968139&limit=10" }`</div></div><div class="timenode" index="1"><div class="header"><p>memos</p></div><div class="body fs14">`{ "api": "https://memos.thatcoder.cn/api/v1/memos?filter=creator%3D%3D%27users%2F1%27&pageSize=10" }`</div></div></div>]]></content>
    
    
    <summary type="html">迁移工作还好，就是魔改不太好搬运。</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="Stellar" scheme="https://blog.thatcoder.cn/tags/Stellar/"/>
    
  </entry>
  
  <entry>
    <title>微信读书自动阅读</title>
    <link href="https://blog.thatcoder.cn/Tencent-WxRead-Daily/"/>
    <id>https://blog.thatcoder.cn/Tencent-WxRead-Daily/</id>
    <published>2023-09-14T12:00:00.000Z</published>
    <updated>2023-09-18T15:28:08.045Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文章实现需要服务器, 无可视化界面亦可。<br>使用的Cookie获取上一篇文章有介绍, 顺手写了这篇。</p><p>每日一问: 我为什么要实现这个功能???</p><div class="tag-plugin link dis-select"><a class="link-card plain" title="微信读书Cookie续活" href="https://blog.thatcoder.cn/Tencent-WxRead-Cookies/" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">微信读书Cookie续活</span><span class="cap link footnote">https://blog.thatcoder.cn/Tencent-WxRead-Cookies/</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div><h2 id="机制分析"><a href="#机制分析" class="headerlink" title="机制分析"></a>机制分析</h2><p>网页版状态下阅读, 每分钟左右会有一个read请求, 通过回执可以判断是否阅读成功。<br>具体参数我不想耗费时间去逆向, 但是可以通过模拟浏览阅读页面来等待read响应进行read重播,进而轻易实现自动阅读。</p><h2 id="稳定性"><a href="#稳定性" class="headerlink" title="稳定性"></a>稳定性</h2><p>服务器测试了24小时, 阅读时间也是相应增加24。</p><p>有趣的是, 经测试, 每次程序运行5min, 增加的时长可能是 5min、6min、8min、11min、13min 甚至是 21min。<br>但是总时长是稳定的, 也就是说会回归一天能拉满的时间24h。</p><h2 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h2><p>虽说是浏览器模拟事件, 到了python的表演时间, 但是我采用了JS去写, 辅佐包是 <a href="https://playwright.dev/">Playwright</a> 。<br>总体是一次有趣的尝试。</p><h3 id="准备事项"><a href="#准备事项" class="headerlink" title="准备事项"></a>准备事项</h3><p>开始吧, 安装 Playwright</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 先创建一个文件夹</span><br><span class="hljs-built_in">mkdir</span> /server/auto/wxread &amp;&amp; <span class="hljs-built_in">cd</span> /server/auto/wxread<br><br><span class="hljs-comment"># 安装 playwright</span><br>npm install playwright<br>npx playwright install<br><span class="hljs-comment"># 下面这个可能需要点时间</span><br><span class="hljs-comment"># 因为有浏览器的下载</span><br>npx playwright install-deps<br><br><span class="hljs-comment"># 当然少不了 axios</span><br>npm install axios<br><br><span class="hljs-comment"># 好的, 一切准备就绪, 创建代码吧</span><br></code></pre></td></tr></table></figure><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight js"><figcaption><span>wxread.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; firefox &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;playwright&#x27;</span>);<br><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;axios&#x27;</span>);<br><br><span class="hljs-comment">// 获取命令行参数</span><br><span class="hljs-keyword">const</span> args = process.<span class="hljs-property">argv</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>);<br><span class="hljs-keyword">const</span> params = &#123;&#125;;<br>args.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">arg</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> [key, value] = arg.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>);<br>    <span class="hljs-keyword">if</span> (key &amp;&amp; value) &#123;<br>        params[key] = value;<br>    &#125;<br>&#125;);<br><br><span class="hljs-keyword">const</span> url1 = <span class="hljs-string">&#x27;https://weread.qq.com/web/reader/8f5329e0813ab7d1eg012feake4d32d5015e4da3b7fbb1fa&#x27;</span>;<br><span class="hljs-keyword">const</span> url2 = <span class="hljs-string">&#x27;https://weread.qq.com/web/book/read&#x27;</span>;<br><span class="hljs-keyword">let</span> capturedResponse = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">let</span> browser = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">const</span> scrollInterval = <span class="hljs-number">10000</span>; <span class="hljs-comment">// 上下滑动间隔时间 单位毫秒</span><br><span class="hljs-keyword">const</span> totalTime = <span class="hljs-number">400000</span>; <span class="hljs-comment">// 单次阅读时间 单位毫秒</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getXHR</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Success: 启动 Playwright 浏览器&quot;</span>);<br>    browser = <span class="hljs-keyword">await</span> firefox.<span class="hljs-title function_">launch</span>(&#123;<br>        <span class="hljs-attr">headless</span>: <span class="hljs-literal">true</span>,<br>    &#125;);<br>    <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newPage</span>();<br>    <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">setExtraHTTPHeaders</span>(&#123;<br>        <span class="hljs-attr">cookie</span>: (<span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;https://sijnzx.laf.thatcoder.cn/tencent-weread-refcookie?key=&quot;</span>+params[<span class="hljs-string">&#x27;key&#x27;</span>])).<span class="hljs-property">data</span>[<span class="hljs-string">&quot;data&quot;</span>][<span class="hljs-string">&quot;cookies&quot;</span>]<br>    &#125;);<br>    <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(url1, &#123;<br>        <span class="hljs-attr">waitUntil</span>: <span class="hljs-string">&#x27;networkidle&#x27;</span>,<br>    &#125;);<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Success: 打开内容页面&quot;</span>);<br>    page.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;response&#x27;</span>, <span class="hljs-keyword">async</span> (response) =&gt; &#123;<br>        <span class="hljs-keyword">if</span> (response.<span class="hljs-title function_">url</span>() === url2) &#123;<br>            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();<br>            <span class="hljs-keyword">if</span> (data[<span class="hljs-string">&#x27;succ&#x27;</span>] === <span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Success: 目标URL响应成功&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Error: 目标URL响应失败&quot;</span>);<br>            &#125;<br>            capturedResponse = data[<span class="hljs-string">&#x27;succ&#x27;</span>] === <span class="hljs-number">1</span> ? response : <span class="hljs-literal">null</span>;<br>            <span class="hljs-keyword">await</span> <span class="hljs-title function_">repeatXHR</span>(<span class="hljs-number">100</span>);<br>            <span class="hljs-comment">// 不要关闭浏览器</span><br>        &#125;<br>    &#125;);<br><br><span class="hljs-comment">// 定期上下滑动</span><br>    <span class="hljs-keyword">let</span> scrollCount = <span class="hljs-number">0</span>; <span class="hljs-comment">// 计数器</span><br>    <span class="hljs-keyword">let</span> scrollDirection = <span class="hljs-number">1</span>; <span class="hljs-comment">// 1表示向下滑动，-1表示向上滑动</span><br><br>    <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-keyword">await</span> page.evaluate(<span class="hljs-function">(<span class="hljs-params">scrollDirection</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">const</span> windowHeight = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;<br>            <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollBy</span>(<span class="hljs-number">0</span>, scrollDirection * windowHeight); <span class="hljs-comment">// 向上或向下滑动一个屏幕高度</span><br>        &#125;, scrollDirection);<br><br>        scrollCount++;<br><br>        <span class="hljs-comment">// 如果达到了五次滑动，切换方向并重置计数器</span><br>        <span class="hljs-keyword">if</span> (scrollCount === <span class="hljs-number">5</span>) &#123;<br>            scrollDirection *= -<span class="hljs-number">1</span>; <span class="hljs-comment">// 切换方向</span><br>            scrollCount = <span class="hljs-number">0</span>; <span class="hljs-comment">// 重置计数器</span><br>        &#125;<br>    &#125;, scrollInterval);<br><br><br>    <span class="hljs-comment">// 设置浏览器关闭定时器</span><br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Success: 关闭浏览器&quot;</span>);<br>        <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">close</span>();<br>    &#125;, totalTime);<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">repeatXHR</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">count</span>) =&gt; &#123;<br>    <span class="hljs-keyword">if</span> (!capturedResponse) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Failed: 没有捕获到响应，无法重放&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">const</span> request = capturedResponse.<span class="hljs-title function_">request</span>();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">axios</span>(&#123;<br>                <span class="hljs-attr">method</span>: request.<span class="hljs-title function_">method</span>(),<br>                <span class="hljs-attr">url</span>: request.<span class="hljs-title function_">url</span>(),<br>                <span class="hljs-attr">headers</span>: request.<span class="hljs-title function_">headers</span>(),<br>                <span class="hljs-attr">params</span>: request.<span class="hljs-property">params</span>,<br>                <span class="hljs-attr">data</span>: request.<span class="hljs-title function_">postData</span>(),<br>            &#125;);<br>            <span class="hljs-keyword">if</span> (response.<span class="hljs-property">data</span>.<span class="hljs-property">succ</span> !== <span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Failed: 重放响应 <span class="hljs-subst">$&#123;i + <span class="hljs-number">1</span>&#125;</span>: 失败, succ!==1`</span>);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed: 重放响应 <span class="hljs-subst">$&#123;i + <span class="hljs-number">1</span>&#125;</span>: 失败, <span class="hljs-subst">$&#123;error.message&#125;</span>`</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Success: 重放响应 <span class="hljs-subst">$&#123;count&#125;</span> 次完毕`</span>)<br>&#125;;<br><br>(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">getXHR</span>();<br>&#125;)();<br></code></pre></td></tr></table></figure><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>代码会启动一个无头浏览器, 所以没有可视化也不需要担心。<br>个人测试24小时, 无任何问题, 使用的内存为300MB左右, CPU占用率为0.1%左右。<br>对了, 带上key参数是我接口的鉴权, 也就是上一篇文章的参数(个人有所修改)。<br>你实现了上一篇文章的获取可以使用你的接口。保证<code>cookie</code>是有效的即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">node wxread.js key=xxxx<br><br><span class="hljs-comment"># 成功运行大概输出如下</span><br><span class="hljs-comment">#    Success: 启动 Playwright 浏览器</span><br><span class="hljs-comment">#    Success: 打开内容页面</span><br><span class="hljs-comment">#    Success: 目标URL响应成功</span><br><span class="hljs-comment">#    Success: 重放响应 100 次完毕</span><br><span class="hljs-comment">#    Success: 目标URL响应成功</span><br><span class="hljs-comment">#    Success: 重放响应 100 次完毕</span><br><span class="hljs-comment">#    Success: 浏览器关闭 (400秒后)</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">实现微信读书自动阅读, 增加阅读时长, 打卡阅读天数</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="Tencent" scheme="https://blog.thatcoder.cn/tags/Tencent/"/>
    
  </entry>
  
  <entry>
    <title>微信读书Cookies续活</title>
    <link href="https://blog.thatcoder.cn/Tencent-WxRead-Cookies/"/>
    <id>https://blog.thatcoder.cn/Tencent-WxRead-Cookies/</id>
    <published>2023-09-13T11:00:00.000Z</published>
    <updated>2023-09-18T15:28:07.961Z</updated>
    
    <content type="html"><![CDATA[<h2 id="机制分析"><a href="#机制分析" class="headerlink" title="机制分析"></a>机制分析</h2><p>很多优秀的文章分析了延期机制, 这里列举两个</p><div class="tag-plugin link dis-select"><a class="link-card plain" title="Hank's Blog 微信读书延期机制分析" href="https://zhaohongxuan.github.io/2022/05/16/how-to-relong-cookies-in-weread/" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">Hank's Blog 微信读书延期机制分析</span><span class="cap link footnote">https://zhaohongxuan.github.io/2022/05/16/how-to-relong-cookies-in-weread/</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div><div class="tag-plugin link dis-select"><a class="link-card plain" title="陈虚渊 微信读书数据内容接口逆向" href="https://blog.csdn.net/paycho/article/details/132796745" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">陈虚渊 微信读书数据内容接口逆向</span><span class="cap link footnote">https://blog.csdn.net/paycho/article/details/132796745</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div><h2 id="稳定性"><a href="#稳定性" class="headerlink" title="稳定性"></a>稳定性</h2><p>目前跑了几天, Cookies都能自动刷新保活</p><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202309132220322.png" alt="每小时自动刷新回执" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">每小时自动刷新回执</span></div></div><h2 id="主要代码"><a href="#主要代码" class="headerlink" title="主要代码"></a>主要代码</h2><p>续活我没使用代理服务器, 直接请求了</p><figure class="highlight js"><figcaption><span>refCookie</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 刷新 Cookie 的函数，模拟发送请求获取新 Cookie</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">refCookie</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">uid: string</span>) =&gt; &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">head</span>(<span class="hljs-string">&#x27;https://weread.qq.com&#x27;</span>, &#123; <span class="hljs-attr">headers</span>: <span class="hljs-title function_">globalHeaders</span>() &#125;);<br>    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> === <span class="hljs-number">200</span> || response.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;set-cookie&#x27;</span>]) &#123;<br>        globalCookies = <span class="hljs-title class_">CookieUtil</span>.<span class="hljs-title class_">WebArrayToString</span>(response.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;set-cookie&#x27;</span>], globalCookies);<br>        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">await</span> <span class="hljs-title function_">upUserCookie</span>(uid)) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span><br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>    &#125;<br>  &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h2><blockquote><p>运行在自己搭建的 Laf 云函数, 不能无脑抄。 代码虽烂 但已写注释。<br>需要临时使用我的接口可以联系我</p></blockquote><details class="tag-plugin colorful folding" ><summary><span>代码结构图</span></summary><div class="body"><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202309132103742.png" alt="这样也许清晰一点" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">这样也许清晰一点</span></div></div></div></details><figure class="highlight js"><figcaption><span>Serverless Code</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span>;<br><span class="hljs-keyword">import</span> cloud <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/cloud-sdk&quot;</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * API请求入口方法</span><br><span class="hljs-comment"> */</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">main</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">ctx: FunctionContext</span>) &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; cookies, uid, refresh &#125; = ctx.<span class="hljs-property">method</span> === <span class="hljs-string">&#x27;GET&#x27;</span> ? ctx.<span class="hljs-property">query</span> || ctx.<span class="hljs-property">params</span> : ctx.<span class="hljs-property">body</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">verifyData</span>(uid)) &#123;  <span class="hljs-comment">// 用户获取cookie请求</span><br>      <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">await</span> userServer.<span class="hljs-title function_">verifyUser</span>(uid))) &#123;<br>        !(<span class="hljs-keyword">await</span> <span class="hljs-title class_">CookiesApi</span>.<span class="hljs-title function_">verifyRefresh</span>(uid)) || (<span class="hljs-keyword">await</span> <span class="hljs-title class_">CookiesApi</span>.<span class="hljs-title function_">refCookie</span>(refresh))<br>        <span class="hljs-keyword">return</span> msgServer.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;获取Cookie成功&quot;</span>, &#123; <span class="hljs-attr">cookies</span>: globalCookies &#125;)<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> msgServer.<span class="hljs-title function_">failed</span>(<span class="hljs-string">&quot;搞咩! &quot;</span> + uid + <span class="hljs-string">&quot; 不存在!&quot;</span>);<br>      &#125;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">verifyData</span>(cookies)) &#123;   <span class="hljs-comment">// 新增用户请求</span><br>      <span class="hljs-keyword">const</span> uid = <span class="hljs-title class_">CookieUtil</span>.<span class="hljs-title class_">StringToJson</span>(cookies)[<span class="hljs-string">&#x27;wr_vid&#x27;</span>]<br>      globalCookies = cookies<br>      <span class="hljs-keyword">const</span> userInfo = (<span class="hljs-keyword">await</span> <span class="hljs-title class_">CookiesApi</span>.<span class="hljs-title function_">getUserInfo</span>(uid))<br>      <span class="hljs-keyword">if</span> (!userInfo[<span class="hljs-string">&#x27;name&#x27;</span>]) &#123;<br>        <span class="hljs-keyword">return</span> msgServer.<span class="hljs-title function_">failed</span>(<span class="hljs-string">&quot;搞咩! cookies 不能用!&quot;</span>);<br>      &#125;<br>      <span class="hljs-keyword">const</span> <span class="hljs-attr">userData</span>: <span class="hljs-title class_">WxReadUser</span> = &#123;<br>        <span class="hljs-string">&#x27;userVid&#x27;</span>: uid,<br>        <span class="hljs-string">&#x27;userInfo&#x27;</span>: userInfo,<br>        <span class="hljs-string">&#x27;cookies&#x27;</span>: globalCookies,<br>        <span class="hljs-string">&#x27;cookies_uptime&#x27;</span>: (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()).<span class="hljs-title function_">valueOf</span>(),<br>        <span class="hljs-string">&#x27;cookies_life&#x27;</span>: <span class="hljs-literal">true</span><br>      &#125;<br>      <span class="hljs-keyword">const</span> add = (<span class="hljs-keyword">await</span> userServer.<span class="hljs-title function_">addUser</span>(userData))<br>      <span class="hljs-keyword">if</span> (add.<span class="hljs-property">answer</span>) &#123;<br>        <span class="hljs-keyword">return</span> msgServer.<span class="hljs-title function_">success</span>(<br>          <span class="hljs-string">`存入cookies成功, 未来取用cookies请通过以下方式<span class="hljs-subst">$&#123;<span class="hljs-string">&#x27;\n&#x27;</span>&#125;</span>[ https://sijnzx.laf.thatcoder.cn/tencent-weread-refcookie?uid=您的userVid ]`</span>,<br>          &#123; <span class="hljs-attr">userVid</span>: uid, userInfo &#125;<br>        )<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> msgServer.<span class="hljs-title function_">error</span>()<br>      &#125;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">verifyData</span>(refresh)) &#123;   <span class="hljs-comment">// 刷新请求</span><br>      <span class="hljs-keyword">let</span> <span class="hljs-attr">req</span>: any<br>      <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">await</span> <span class="hljs-title class_">CookiesApi</span>.<span class="hljs-title function_">verifyRefresh</span>(refresh))) &#123;<br>        <span class="hljs-keyword">return</span> msgServer.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;Cookie不需要刷新&quot;</span>)<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">await</span> <span class="hljs-title class_">CookiesApi</span>.<span class="hljs-title function_">refCookie</span>(refresh)) ? msgServer.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;刷新Cookie成功&quot;</span>) : msgServer.<span class="hljs-title function_">error</span>()<br>      &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> msgServer.<span class="hljs-title function_">failed</span>(<span class="hljs-string">&quot;搞咩! 传的什么狗屁参数!&quot;</span>);<br>    &#125;<br>  &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    <span class="hljs-keyword">return</span> msgServer.<span class="hljs-title function_">error</span>()<br>  &#125;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 获取数据库访问器</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> db = cloud.<span class="hljs-title function_">database</span>().<span class="hljs-title function_">collection</span>(<span class="hljs-string">&#x27;tc_tencent_wxread&#x27;</span>);<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * cookies格式工具</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">CookieUtil</span> = &#123;<br>  <span class="hljs-title class_">StringToJson</span>: <span class="hljs-function">(<span class="hljs-params">cookiesString: string</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> cookieGroup = cookiesString.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;; &#x27;</span>)<br>    <span class="hljs-keyword">const</span> cookieJson = &#123;&#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cookieGroup.<span class="hljs-property">length</span>; i++) &#123;<br>      <span class="hljs-keyword">const</span> cookieGroupJson = cookieGroup[i].<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)<br>      cookieJson[cookieGroupJson[<span class="hljs-number">0</span>]] = cookieGroupJson.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> ? <span class="hljs-string">&#x27;&#x27;</span> : cookieGroupJson[<span class="hljs-number">1</span>]<br>    &#125;<br>    <span class="hljs-keyword">return</span> cookieJson<br>  &#125;,<br>  <span class="hljs-title class_">JsonToString</span>: <span class="hljs-function">(<span class="hljs-params">cookiesJson: object</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> keyValuePairs = [];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> cookiesJson) &#123;<br>      <span class="hljs-keyword">if</span> (cookiesJson.<span class="hljs-title function_">hasOwnProperty</span>(key)) &#123;<br>        <span class="hljs-keyword">const</span> value = cookiesJson[key];<br>        keyValuePairs.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;key&#125;</span>=<span class="hljs-subst">$&#123;value&#125;</span>`</span>);<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> keyValuePairs.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;; &#x27;</span>);<br>  &#125;,<br>  <span class="hljs-title class_">WebArrayToString</span>: <span class="hljs-function">(<span class="hljs-params">cookiesArray: <span class="hljs-built_in">Array</span>&lt;string&gt;, cookiesString: string</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> cookieJson = <span class="hljs-title class_">CookieUtil</span>.<span class="hljs-title class_">StringToJson</span>(cookiesString)<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> cookie <span class="hljs-keyword">of</span> cookiesArray) &#123;<br>      <span class="hljs-keyword">const</span> <span class="hljs-attr">refresh</span>: <span class="hljs-title class_">Array</span>&lt;string&gt; = cookie.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;; &#x27;</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)<br>      cookieJson[refresh[<span class="hljs-number">0</span>]] = refresh[<span class="hljs-number">1</span>]<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">CookieUtil</span>.<span class="hljs-title class_">JsonToString</span>(cookieJson)<br>  &#125;,<br>  <span class="hljs-title class_">StringToArray</span>: <span class="hljs-function">(<span class="hljs-params">cookiesString: string</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> cookiesString.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;; &#x27;</span>)<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 全局变量。不合理, 但是能减少云函数单文件代码量</span><br><span class="hljs-keyword">var</span> globalCookies = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">var</span> <span class="hljs-title function_">globalHeaders</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-title class_">Cookie</span>: <span class="hljs-title class_">CookieUtil</span>.<span class="hljs-title class_">StringToArray</span>(globalCookies), <span class="hljs-comment">// 传入的 Cookie 数组</span><br>    <span class="hljs-title class_">Referer</span>: <span class="hljs-string">&#x27;https://weread.qq.com/&#x27;</span>,<br>    <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="hljs-string">&#x27;*&#x27;</span>,<br>    <span class="hljs-string">&#x27;Access-Control-Allow-Methods&#x27;</span>: <span class="hljs-string">&#x27;*&#x27;</span>,<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 微信读书API方法</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">CookiesApi</span> = &#123;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 获取用户信息</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@uid</span>: 微信Cookie[&#x27;wr_vid&#x27;]</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">getUserInfo</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">uid</span>: string) =&gt; &#123;<br>    <span class="hljs-keyword">let</span> userInfo = &#123; <span class="hljs-string">&#x27;userVid&#x27;</span>: <span class="hljs-string">&quot;&quot;</span> &#125;<br>    <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;https://weread.qq.com/web/user?userVid=&#x27;</span> + uid, &#123; <span class="hljs-attr">headers</span>: <span class="hljs-title function_">globalHeaders</span>() &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;<br>      userInfo = e.<span class="hljs-property">data</span><br>    &#125;)<br>    <span class="hljs-keyword">return</span> userInfo<br>  &#125;,<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 验证Cookie是否存活</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@uid</span>: 微信Cookie[&#x27;wr_vid&#x27;]</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">verifyAlive</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">uid</span>: string) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> cookie = (<span class="hljs-keyword">await</span> userServer.<span class="hljs-title function_">getUserCookie</span>(uid))<br>    globalCookies = cookie<br>    <span class="hljs-keyword">let</span> userInfo = <span class="hljs-keyword">await</span> <span class="hljs-title class_">CookiesApi</span>.<span class="hljs-title function_">getUserInfo</span>(uid)<br>    <span class="hljs-keyword">return</span> (<span class="hljs-title class_">String</span>)(userInfo[<span class="hljs-string">&#x27;userVid&#x27;</span>]).<span class="hljs-title function_">includes</span>(uid)<br>  &#125;,<br>  <span class="hljs-comment">// 判断是否需要刷新 Cookie</span><br>  <span class="hljs-attr">verifyRefresh</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">uid</span>: string) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> time = (<span class="hljs-keyword">await</span> userServer.<span class="hljs-title function_">getUserCookieTime</span>(uid))<br>    <span class="hljs-keyword">if</span> ( !(<span class="hljs-keyword">await</span> <span class="hljs-title class_">CookiesApi</span>.<span class="hljs-title function_">verifyAlive</span>(uid)) || (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()).<span class="hljs-title function_">valueOf</span>() - time &gt;= <span class="hljs-number">3600000</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>  &#125;,<br>  <span class="hljs-comment">// 刷新 Cookie 的函数，模拟发送请求获取新 Cookie</span><br>  <span class="hljs-attr">refCookie</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">uid</span>: string) =&gt; &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">head</span>(<span class="hljs-string">&#x27;https://weread.qq.com&#x27;</span>, &#123; <span class="hljs-attr">headers</span>: <span class="hljs-title function_">globalHeaders</span>() &#125;);<br>      <span class="hljs-comment">// if (response.status === 200) &#123;</span><br>      <span class="hljs-comment">//   return true</span><br>      <span class="hljs-comment">// &#125;</span><br>      <span class="hljs-keyword">const</span> newCookies = response.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;set-cookie&#x27;</span>]<br>      <span class="hljs-keyword">if</span> (!newCookies) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>      &#125;<br>      globalCookies = <span class="hljs-title class_">CookieUtil</span>.<span class="hljs-title class_">WebArrayToString</span>(newCookies, globalCookies);<br>      <span class="hljs-keyword">return</span> (<span class="hljs-keyword">await</span> userServer.<span class="hljs-title function_">upUserCookie</span>(uid)) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span><br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 数据库服务层。 呵, JS哪来的服务层</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> userServer = &#123;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 验证数据库是否存在用户</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@uid</span>: 微信Cookie[&#x27;wr_vid&#x27;]</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@return</span>: &#123;boolean&#125;</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">verifyUser</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">uid</span>: string) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">where</span>(&#123; <span class="hljs-string">&#x27;userVid&#x27;</span>: uid &#125;).<span class="hljs-title function_">count</span>()).<span class="hljs-property">total</span> &gt; <span class="hljs-number">0</span><br>  &#125;,<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 获取用户Cookie</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@uid</span>: 微信Cookie[&#x27;wr_vid&#x27;]</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">getUserCookie</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">uid</span>: string) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> get = (<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">where</span>(&#123; <span class="hljs-string">&#x27;userVid&#x27;</span>: uid &#125;).<span class="hljs-title function_">limit</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">get</span>())<br>    <span class="hljs-keyword">return</span> get.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;cookies&#x27;</span>]<br>  &#125;,<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 获取用户CookieTime</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@uid</span>: 微信Cookie[&#x27;wr_vid&#x27;]</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">getUserCookieTime</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">uid</span>: string) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> get = (<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">where</span>(&#123; <span class="hljs-string">&#x27;userVid&#x27;</span>: uid &#125;).<span class="hljs-title function_">limit</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">get</span>())<br>    <span class="hljs-keyword">return</span> get.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;cookies_uptime&#x27;</span>]<br>  &#125;,<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 更新用户Cookie</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">upUserCookie</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">uid</span>: string) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">where</span>(&#123;<span class="hljs-string">&#x27;userVid&#x27;</span>: uid&#125;).<span class="hljs-title function_">limit</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">update</span>(&#123; <span class="hljs-attr">cookies</span>: globalCookies, <span class="hljs-attr">cookies_uptime</span>: (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()).<span class="hljs-title function_">valueOf</span>(), <span class="hljs-attr">cookies_life</span>: <span class="hljs-literal">true</span> &#125;)).<span class="hljs-property">ok</span><br>  &#125;,<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 新增数据库用户信息</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">addUser</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">userData</span>: <span class="hljs-title class_">WxReadUser</span>) =&gt; &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">add</span>: any<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">await</span> userServer.<span class="hljs-title function_">verifyUser</span>(userData.<span class="hljs-property">userVid</span>))) &#123;<br>      add = (<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">where</span>(&#123;<span class="hljs-string">&#x27;userVid&#x27;</span>: userData.<span class="hljs-property">userVid</span>&#125;).<span class="hljs-title function_">limit</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">update</span>(userData))<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      add = (<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">add</span>(userData))<br>    &#125;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">answer</span>: add.<span class="hljs-property">ok</span>, <span class="hljs-attr">id</span>: add.<span class="hljs-property">upsertId</span> &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 回执服务层</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> msgServer = &#123;<br>  <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">msg: string, data: any = &#123;&#125;</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123; <span class="hljs-attr">statusCode</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">&quot;操作成功&quot;</span>, <span class="hljs-attr">message</span>: msg, data &#125;)<br>  &#125;,<br>  <span class="hljs-attr">failed</span>: <span class="hljs-function">(<span class="hljs-params">msg: string</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123; <span class="hljs-attr">statusCode</span>: <span class="hljs-number">400</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">&quot;操作失败&quot;</span>, <span class="hljs-attr">message</span>: msg &#125;)<br>  &#125;,<br>  <span class="hljs-attr">error</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123; <span class="hljs-attr">statusCode</span>: <span class="hljs-number">500</span>, <span class="hljs-attr">event</span>: <span class="hljs-string">&quot;程序错误&quot;</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;请联系钟意, 必应搜索钟意博客。&quot;</span> &#125;)<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 微信用户对象接口</span><br><span class="hljs-comment"> */</span><br>interface <span class="hljs-title class_">WxReadUser</span> &#123;<br>  <span class="hljs-string">&#x27;userVid&#x27;</span>: string,<br>  <span class="hljs-string">&#x27;userInfo&#x27;</span>?: any,<br>  <span class="hljs-string">&#x27;cookies&#x27;</span>: string,<br>  <span class="hljs-string">&#x27;cookies_uptime&#x27;</span>?: number,<br>  <span class="hljs-string">&#x27;cookies_life&#x27;</span>?: boolean<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">verifyData</span> = (<span class="hljs-params">data: any</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (data === <span class="hljs-literal">null</span> || data === [] || data === &#123;&#125; || data === <span class="hljs-literal">undefined</span> || data === <span class="hljs-string">&#x27;&#x27;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h2><ul><li>获取自己的微信读书信息</li><li>下载微信读书的书籍</li><li>导出书单信息</li><li>带出读书笔记</li><li>自动阅读( 这个功能有什么用? )</li></ul><div class="tag-plugin link dis-select"><a class="link-card plain" title="自动阅读微信读书" href="https://blog.thatcoder.cn/Tencent-WxRead-Daily/" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">自动阅读微信读书</span><span class="cap link footnote">https://blog.thatcoder.cn/Tencent-WxRead-Daily/</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div>]]></content>
    
    
    <summary type="html">实现微信读书的Cookies在生命结束后自动刷新</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="Tencent" scheme="https://blog.thatcoder.cn/tags/Tencent/"/>
    
  </entry>
  
  <entry>
    <title>Linux 挂载磁盘</title>
    <link href="https://blog.thatcoder.cn/Linux-Add-Device/"/>
    <id>https://blog.thatcoder.cn/Linux-Add-Device/</id>
    <published>2023-09-08T11:23:00.000Z</published>
    <updated>2023-09-19T17:14:55.054Z</updated>
    
    <content type="html"><![CDATA[<h2 id="大致步骤"><a href="#大致步骤" class="headerlink" title="大致步骤"></a>大致步骤</h2><ol><li>准备挂载目录</li><li>磁盘分区</li><li>格式化分区</li><li>挂载磁盘</li></ol><h2 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h2><p>没啥好说的, 看你喜欢啥名字</p><figure class="highlight bash"><figcaption><span>创建目录</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /extra<br></code></pre></td></tr></table></figure><h2 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h2><p>先查看磁盘是否需要分区</p><figure class="highlight bash"><figcaption><span>磁盘信息</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">fdisk -l<br></code></pre></td></tr></table></figure><details class="tag-plugin colorful folding" ><summary><span>查看需要分区的 `Device Boot`</span></summary><div class="body"><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202309131910829.png" alt="fdisk -l 打印信息" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">fdisk -l 打印信息</span></div></div></div></details><figure class="highlight bash"><figcaption><span>开始分区</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 根据你的 Device Boot 更改 /dev/vda</span><br><br>fdisk /dev/vda<br><br><span class="hljs-comment"># 根据提示依次进行以下输入</span><br><span class="hljs-comment"># n、p、1、回车、回车、wq</span><br></code></pre></td></tr></table></figure><p>再次打印磁盘信息会有多一个区</p><h2 id="格式化分区"><a href="#格式化分区" class="headerlink" title="格式化分区"></a>格式化分区</h2><figure class="highlight bash"><figcaption><span>格式化分区</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 这里填多出来的那个 Device Boot</span><br><br>mkfs.ext4 /dev/vda1<br></code></pre></td></tr></table></figure><h2 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h2><p>这样修改&#x2F;etc&#x2F;fstab下次重启就不会丢失挂载信息</p><figure class="highlight bash"><figcaption><span>挂载</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># /dev/vda1 和 /extra 还是根据你的来</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/dev/vda1 /extra ext4 defaults 0 0&quot;</span> &gt;&gt; /etc/fstab<br></code></pre></td></tr></table></figure><h2 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h2><p>顺手记录几种查看磁盘UUID方法</p><figure class="highlight bash"><figcaption><span>查看UUID</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 块设备信息 树形</span><br>lsblk -o name,mountpoint,size,uuid<br><span class="hljs-comment"># 查看/etc/fstab 文件</span><br><span class="hljs-built_in">cat</span> /etc/fstab<br><span class="hljs-comment"># 块设备信息</span><br>blkid<br><span class="hljs-built_in">ls</span> -lh /dev/disk/by-uuid/<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">备份一下Linux挂载磁盘方法, 盘要满了 淦</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="Linux" scheme="https://blog.thatcoder.cn/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot集成支付宝支付的前后端相关逻辑</title>
    <link href="https://blog.thatcoder.cn/Spring-Pay-Ali/"/>
    <id>https://blog.thatcoder.cn/Spring-Pay-Ali/</id>
    <published>2023-08-20T02:00:00.000Z</published>
    <updated>2024-08-09T17:36:25.521Z</updated>
    
    <content type="html"><![CDATA[<p>从支付宝的开发者配置到项目的支付接口实际落地，记录一下Spring Boot集成支付宝支付的全过程。<br>待完善。。。</p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ol><li>本文提供支付宝沙盒环境</li><li>开发语言：Spring Boot + Kotlin + Vue （Java开发者肯定能看懂）</li><li>业务逻辑代码会部分省略，更多是文字引导思考，请结合自己的业务场景进行实现。</li></ol><h2 id="开发筹备"><a href="#开发筹备" class="headerlink" title="开发筹备"></a>开发筹备</h2><h3 id="需求参数"><a href="#需求参数" class="headerlink" title="需求参数"></a>需求参数</h3><blockquote><p>只负责对接业务 或 使用本文沙盒环境 的同学，请移步 <a href="#%E4%BE%9D%E8%B5%96%E9%85%8D%E7%BD%AE">依赖配置</a></p></blockquote><ol><li>应用ID</li><li>应用AES密钥</li><li>应用公钥</li><li>应用私钥</li><li>支付宝公钥</li><li>支付宝根证书</li></ol><h3 id="支付申请流程"><a href="#支付申请流程" class="headerlink" title="支付申请流程"></a>支付申请流程</h3><blockquote><p>以下流程按照需求参数的顺序。</p></blockquote><ol><li>登录<a href="https://open.alipay.com/develop/manage">支付宝开发者平台</a>，创建应用，进入应用详情页，左上角有 <code>应用ID</code>。</li><li>点击左边菜单栏的 <code>开发者设置</code>，点击 <code>接口内容加密方式</code> 会得到一个 <code>AES密钥</code>。</li><li>点击左边菜单栏的 <code>开发者设置</code>，点击 <code>接口加签方式</code> 选择证书模式然后走官方教程，按照教程会在本地生成得到 <code>应用公钥</code> 和 <code>应用私钥</code>。</li><li>第三步之后，再点击 <code>接口加签方式</code>，能下载得到 <code>支付宝根证书</code> 和 <code>支付宝公钥</code>。</li><li>至此得到全部参数，请保存好。最后还是在<code>开发者设置</code>中，将计划的 <code>授权回调地址</code> 填入（也就是后端项目接收支付宝平台回调支付结果的地址）。</li></ol><ul><li>还有一件事是去<a href="https://b.alipay.com/page/product-workspace/all-product">支付宝B端</a>申请开通对应的支付功能产品，比如电脑网站支付、手机网站支付、APP支付、JSAPI支付等。<br>没申请的话可以先申请再看下面的教程，节省等待审核的时间。</li></ul><h2 id="依赖配置"><a href="#依赖配置" class="headerlink" title="依赖配置"></a>依赖配置</h2><h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><blockquote><p><a href="https://central.sonatype.com/artifact/com.alipay.sdk/alipay-sdk-java/overview">依赖参考文档</a></p></blockquote><div class="tag-plugin tabs"id="tab_2"><div class="nav-tabs"><div class="tab active"><a href="#tab_2-1">Maven</a></div><div class="tab"><a href="#tab_2-2">Gradle（Kotlin）</a></div><div class="tab"><a href="#tab_2-3">Gradle</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_2-1"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;dependency&gt;<br>    &lt;groupId&gt;com.alipay.sdk&lt;/groupId&gt;<br>    &lt;artifactId&gt;alipay-sdk-java&lt;/artifactId&gt;<br>    &lt;version&gt;4.39.134.ALL&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure></div><div class="tab-pane" id="tab_2-2"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">implementation(&quot;com.alipay.sdk:alipay-sdk-java:4.39.134.ALL&quot;)<br></code></pre></td></tr></table></figure></div><div class="tab-pane" id="tab_2-3"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">implementation group: &#x27;com.alipay.sdk&#x27;, name: &#x27;alipay-sdk-java&#x27;, version: &#x27;4.39.134.ALL&#x27;<br></code></pre></td></tr></table></figure></div></div></div><h3 id="配置资源"><a href="#配置资源" class="headerlink" title="配置资源"></a>配置资源</h3><blockquote><p>我这里给出我的配置解决方案，具体请结合自己业务场景储存与使用这些资源，请各显神通。</p></blockquote><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/b9aaba6bbab7e303e5fc4c5f14b0f822.png" alt="项目资源与配置" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">项目资源与配置</span></div></div><figure class="highlight yaml"><figcaption><span>application.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">pay:</span><br>  <span class="hljs-attr">alipay:</span><br>    <span class="hljs-attr">appId:</span> <span class="hljs-string">/appId.txt</span>                        <span class="hljs-comment"># 应用id</span><br>    <span class="hljs-attr">privateKey:</span> <span class="hljs-string">/privateKey.txt</span>              <span class="hljs-comment"># 应用私钥</span><br>    <span class="hljs-attr">appCert:</span> <span class="hljs-string">/appCert.crt</span>                    <span class="hljs-comment"># 应用公钥</span><br>    <span class="hljs-attr">alipayPublicCert:</span> <span class="hljs-string">/alipayPublicCert.crt</span>  <span class="hljs-comment"># 支付宝公钥路径</span><br>    <span class="hljs-attr">rootCert:</span> <span class="hljs-string">/rootCert.crt</span>                  <span class="hljs-comment"># 支付宝根证书路径</span><br>    <span class="hljs-attr">encryptKey:</span> <span class="hljs-string">/encryptKey.txt</span>              <span class="hljs-comment"># 应用AES密钥</span><br>    <span class="hljs-attr">serverUrl:</span> <span class="hljs-string">/serverUrl.txt</span>                <span class="hljs-comment"># 支付宝网关地址 线上环境：https://openapi.alipay.com/gateway.do</span><br>    <span class="hljs-attr">notifyUrl:</span> <span class="hljs-string">xxxx</span>    <span class="hljs-comment"># 授权回调地址</span><br>    <span class="hljs-attr">returnUrl:</span> <span class="hljs-string">xxxx</span>    <span class="hljs-comment"># 支付成功后前端地址</span><br></code></pre></td></tr></table></figure><h3 id="客户端类"><a href="#客户端类" class="headerlink" title="客户端类"></a>客户端类</h3><blockquote><p>都是老司机看使用的类包名就知道干什么的，到了开发这步就不献丑解释代码。请自行设计一个支付宝配置类，然后注入到 Spring Bean 中。<br>至于我示例代码的 getAbsolutePath 方法，是Linux部署没有resources文件夹，所以用这个方法构造一个虚拟的绝对路径。</p></blockquote><blockquote><p>通过下面代码我们得到了一个支付宝支付客户端，后文会用来发起支付请求。</p></blockquote><figure class="highlight kotlin"><figcaption><span>ALiPayConfig.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> cn.thatcoder.auto.system.pay.config<br><br><span class="hljs-keyword">import</span> cn.hutool.core.io.FileUtil<br><span class="hljs-keyword">import</span> com.alipay.api.AlipayClient<br><span class="hljs-keyword">import</span> com.alipay.api.AlipayConfig<br><span class="hljs-keyword">import</span> com.alipay.api.AlipayConstants<br><span class="hljs-keyword">import</span> com.alipay.api.DefaultAlipayClient<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Value<br><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean<br><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration<br><span class="hljs-keyword">import</span> org.springframework.core.io.ResourceLoader<br><span class="hljs-keyword">import</span> java.nio.file.Files<br><span class="hljs-keyword">import</span> java.nio.file.StandardCopyOption<br><br><span class="hljs-meta">@Configuration(<span class="hljs-string">&quot;支付宝支付配置&quot;</span>)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ALiPayConfig</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> resourceLoader: ResourceLoader) &#123;<br><br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;\$&#123;pay.alipay.appId&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> appId: String<br><br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;\$&#123;pay.alipay.privateKey&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> privateKey: String<br><br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;\$&#123;pay.alipay.appCert&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> appCert: String<br><br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;\$&#123;pay.alipay.alipayPublicCert&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> alipayPublicCert: String<br><br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;\$&#123;pay.alipay.rootCert&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> rootCert: String<br><br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;\$&#123;pay.alipay.encryptKey&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> encryptKey: String<br><br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;\$&#123;pay.alipay.returnUrl&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> returnUrl: String<br><br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;\$&#123;pay.alipay.notifyUrl&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> notifyUrl: String<br><br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;\$&#123;pay.alipay.serverUrl&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> serverUrl: String<br><br>    <span class="hljs-keyword">var</span> out_no_prefix = <span class="hljs-string">&quot;TC_A_&quot;</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 支付宝支付客户端</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">alipayClient</span><span class="hljs-params">()</span></span>: AlipayClient &#123;<br>        <span class="hljs-keyword">val</span> config = AlipayConfig().apply &#123;<br>            <span class="hljs-keyword">this</span>.serverUrl = FileUtil.readUtf8String(getAbsolutePath(<span class="hljs-keyword">this</span><span class="hljs-symbol">@ALiPayConfig</span>.serverUrl))<br>            <span class="hljs-keyword">this</span>.appId = FileUtil.readUtf8String(getAbsolutePath(<span class="hljs-keyword">this</span><span class="hljs-symbol">@ALiPayConfig</span>.appId))<br>            <span class="hljs-keyword">this</span>.privateKey = FileUtil.readUtf8String(getAbsolutePath(<span class="hljs-keyword">this</span><span class="hljs-symbol">@ALiPayConfig</span>.privateKey))<br>            <span class="hljs-keyword">this</span>.appCertPath = getAbsolutePath(<span class="hljs-keyword">this</span><span class="hljs-symbol">@ALiPayConfig</span>.appCert)<br>            <span class="hljs-keyword">this</span>.format = AlipayConstants.FORMAT_JSON<br>            <span class="hljs-keyword">this</span>.charset = AlipayConstants.CHARSET_UTF8<br>            <span class="hljs-keyword">this</span>.alipayPublicCertPath = getAbsolutePath(<span class="hljs-keyword">this</span><span class="hljs-symbol">@ALiPayConfig</span>.alipayPublicCert)<br>            rootCertPath = getAbsolutePath(<span class="hljs-keyword">this</span><span class="hljs-symbol">@ALiPayConfig</span>.rootCert)<br>            signType = AlipayConstants.SIGN_TYPE_RSA2<br>            encryptKey = FileUtil.readUtf8String(getAbsolutePath(<span class="hljs-keyword">this</span><span class="hljs-symbol">@ALiPayConfig</span>.encryptKey))<br>            encryptType = AlipayConstants.ENCRYPT_TYPE_AES<br>        &#125;<br>        <span class="hljs-keyword">val</span> alipayClient = DefaultAlipayClient(config)<br>        alipayClient.let &#123;<br>            it.setMaxIdleConnections(<span class="hljs-number">10</span>) <span class="hljs-comment">// 连接池最大可缓存空闲数</span><br>            it.setKeepAliveDuration(<span class="hljs-number">10000L</span>) <span class="hljs-comment">//连接池空闲连接的存活时间</span><br>            it.setConnectTimeout(<span class="hljs-number">3000</span>) <span class="hljs-comment">//连接超时时间</span><br>            it.setReadTimeout(<span class="hljs-number">15000</span>) <span class="hljs-comment">//读取超时时间</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> alipayClient<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 构建资源文件缓存堆路径</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getAbsolutePath</span><span class="hljs-params">(localPath: <span class="hljs-type">String</span>)</span></span>: String &#123;<br>        <span class="hljs-keyword">val</span> resource =<br>            resourceLoader.getResource(<span class="hljs-string">&quot;classpath:pay/alipay<span class="hljs-subst">$&#123;localPath&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">val</span> fileName = localPath.substring(<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">val</span> tempFile = Files.createTempFile(fileName.split(<span class="hljs-string">&quot;.&quot;</span>).first(), <span class="hljs-string">&quot;.&quot;</span> + fileName.split(<span class="hljs-string">&quot;.&quot;</span>).last())<br>        Files.copy(resource.inputStream, tempFile, StandardCopyOption.REPLACE_EXISTING)<br>        <span class="hljs-keyword">return</span> tempFile.toAbsolutePath().toString()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="业务逻辑"><a href="#业务逻辑" class="headerlink" title="业务逻辑"></a>业务逻辑</h2><blockquote><p>先上支付宝时序图，后面就知道自己该干嘛。</p></blockquote><ul><li>后端：被前端唤起支付，向支付宝发起支付，给前端返回支付码，等待支付宝告知支付结果。</li><li>前端：被用户申请支付，请求后端拿支付码，渲染支付页面，等待（支付宝成功会跳转到returnUrl 或者 轮询后端支付结果）</li><li>用户：哥们你管我怎么操作，我点了支付扫码再取消支付你都管不着。诶，就是点着玩儿。</li></ul><div class="tag-plugin image"><div class="image-bg"><img src="https://gw.alipayobjects.com/os/skylark-tools/public/files/0ba3e82ad37ecf8649ee4219cfe9d16b.png%26originHeight%3D2023%26originWidth%3D2815%26size%3D526149%26status%3Ddone%26width%3D2815" alt="支付宝时序图" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">支付宝时序图</span></div></div><h2 id="后端开发"><a href="#后端开发" class="headerlink" title="后端开发"></a>后端开发</h2><ul><li>后端：被前端唤起支付，向支付宝发起支付，给前端返回支付码，等待支付宝告知支付结果。</li></ul><ol><li>被前端唤起：前端携带订单号发起请求，后端<code>ALiPayController</code> 接收请求，调用支付宝Service层生成支付码，返回给前端。所以需要 <code>ALiPayService</code> 。</li><li>向支付宝发起支付：<code>ALiPayService</code> 调用支付宝客户端 <code>alipayClient</code> 根据订单信息生成支付请求，得到支付码。所以需要<code>OrderService</code> 和 <code>ShopService</code> 。</li><li>等待支付宝告知支付结果：支付宝支付成功或失败后，支付宝会回调 <code>notifyUrl</code>，通知后端支付详情，记录到数据库。所以 <code>ALiPayController</code> 最起码需要唤起支付和支付回调两个方法，还需要<code>PayDetailService</code>。</li></ol><h3 id="商品服务"><a href="#商品服务" class="headerlink" title="商品服务"></a>商品服务</h3><blockquote><p>随便写几个服务，配合讲解支付宝支付流程。</p></blockquote><figure class="highlight kotlin"><figcaption><span>Shop.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Entity</span><br><span class="hljs-meta">@Table(name = <span class="hljs-string">&quot;shop&quot;</span>)</span><br><span class="hljs-meta">@Component(<span class="hljs-string">&quot;商品&quot;</span>)</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ShopThesis</span>&#123;<br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;id&quot;</span>)</span><br>    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span><br>    <span class="hljs-keyword">var</span> id: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span><br><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;title&quot;</span>, length = 255)</span><br>    <span class="hljs-keyword">var</span> title: String = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;desc&quot;</span>)</span><br>    <span class="hljs-keyword">var</span> desc: String = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;price&quot;</span>)</span><br>    <span class="hljs-keyword">var</span> price: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight kotlin"><figcaption><span>ShopRepository.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.jpa.repository.JpaRepository<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Repository<br><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ShopRepository</span> : <span class="hljs-type">JpaRepository</span>&lt;<span class="hljs-type">Shop, Long</span>&gt; &#123;&#125;<br></code></pre></td></tr></table></figure><h3 id="订单服务"><a href="#订单服务" class="headerlink" title="订单服务"></a>订单服务</h3><figure class="highlight kotlin"><figcaption><span>Order.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Entity</span><br><span class="hljs-meta">@Table(name = <span class="hljs-string">&quot;order&quot;</span>)</span><br><span class="hljs-meta">@Component(<span class="hljs-string">&quot;订单&quot;</span>)</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderThesis</span>&#123;<br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;id&quot;</span>)</span><br>    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span><br>    <span class="hljs-keyword">var</span> id: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span><br>    <br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;order_no&quot;</span>)</span><br>    <span class="hljs-keyword">var</span> orderNo: String = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;user_id&quot;</span>)</span><br>    <span class="hljs-keyword">var</span> userId: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span><br>    <br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;pay_id&quot;</span>)</span><br>    <span class="hljs-keyword">var</span> payId: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span><br><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;shop_id&quot;</span>)</span><br>    <span class="hljs-keyword">var</span> shopId: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span><br><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;price&quot;</span>)</span><br>    <span class="hljs-keyword">var</span> price: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span><br><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;status&quot;</span>)</span><br>    <span class="hljs-keyword">var</span> status: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight kotlin"><figcaption><span>OrderRepository.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.jpa.repository.JpaRepository<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Repository<br><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRepository</span> : <span class="hljs-type">JpaRepository</span>&lt;<span class="hljs-type">Order, Long</span>&gt; &#123;&#125;<br></code></pre></td></tr></table></figure><h3 id="流水服务"><a href="#流水服务" class="headerlink" title="流水服务"></a>流水服务</h3><figure class="highlight kotlin"><figcaption><span>PayDetail.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Entity</span><br><span class="hljs-meta">@Table(name = <span class="hljs-string">&quot;pay_detail&quot;</span>)</span><br><span class="hljs-meta">@Component(<span class="hljs-string">&quot;支付流水&quot;</span>)</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PayDetailThesis</span>&#123;<br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;id&quot;</span>)</span><br>    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span><br>    <span class="hljs-keyword">var</span> id: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span><br><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;order_id&quot;</span>)</span><br>    <span class="hljs-keyword">var</span> orderId: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span><br><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;pay_id&quot;</span>)</span><br>    <span class="hljs-keyword">var</span> payId: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span><br><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;pay_time&quot;</span>)</span><br>    <span class="hljs-keyword">var</span> payTime: LocalDateTime = LocalDateTime.now()<br><br>    <span class="hljs-meta">@Column(name = <span class="hljs-string">&quot;status&quot;</span>)</span><br>    <span class="hljs-keyword">var</span> status: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight kotlin"><figcaption><span>PayDetailRepository.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.jpa.repository.JpaRepository<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Repository<br><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PayDetailRepository</span> : <span class="hljs-type">JpaRepository</span>&lt;<span class="hljs-type">PayDetail, Long</span>&gt; &#123;&#125;<br></code></pre></td></tr></table></figure><h3 id="支付宝服务"><a href="#支付宝服务" class="headerlink" title="支付宝服务"></a>支付宝服务</h3><blockquote><p>前面分析到 <code>ALiPayController</code> 最起码需要唤起支付和支付回调两个方法，所以服务层最少也要有这两个方法。<br>官网参数比较多，这里只列出核心参数。方便读者快速测试。</p></blockquote><figure class="highlight kotlin"><figcaption><span>IALiPayService.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 支付宝支付服务接口</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IALiPayService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 发起支付，返回支付码</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nativePay</span><span class="hljs-params">(orderId: <span class="hljs-type">Long</span>)</span></span>: String<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 支付结果回调</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nativeNotify</span><span class="hljs-params">(request: <span class="hljs-type">HttpServletRequest</span>)</span></span>: <span class="hljs-built_in">Boolean</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight kotlin"><figcaption><span>ALiPayService.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 支付宝支付服务实现</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ALiPayService</span>(<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> alipayClient: AlipayClient,<br>     <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> aliPayConfig: ALiPayConfig<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> orderRepository: OrderRepository,<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> shopRepository: ShopRepository,<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> payDetailRepository: PayDetailRepository,<br>): IALiPayService &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nativePay</span><span class="hljs-params">(orderId: <span class="hljs-type">Long</span>)</span></span>: String &#123;<br>        <span class="hljs-keyword">val</span> findOrder = orderRepository.findById(orderId)<br>        <span class="hljs-comment">// 处理空订单</span><br>        <span class="hljs-keyword">if</span> (findOrder.isEmpty) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;order <span class="hljs-variable">$orderId</span> not found&quot;</span><br>        &#125;<br>        <span class="hljs-keyword">val</span> order = findOrder.<span class="hljs-keyword">get</span>()<br>        <span class="hljs-keyword">return</span> questALiPay(order)<br>    &#125;<br>    <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nativeNotify</span><span class="hljs-params">(request: <span class="hljs-type">HttpServletRequest</span>)</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>        <span class="hljs-comment">// 解析支付宝回调参数</span><br>        <span class="hljs-keyword">val</span> params = request.parameterMap<br>        <span class="hljs-keyword">val</span> notifyParams = HashMap&lt;String, String&gt;()<br>        params.forEach &#123; (k, v) -&gt;<br>            notifyParams[k] = v[<span class="hljs-number">0</span>]<br>        &#125;<br>        <span class="hljs-comment">// 验证签名</span><br>        <span class="hljs-keyword">val</span> sign = notifyParams.remove(<span class="hljs-string">&quot;sign&quot;</span>)<br>        <span class="hljs-keyword">val</span> signType = notifyParams.remove(<span class="hljs-string">&quot;sign_type&quot;</span>)<br>        <span class="hljs-keyword">val</span> alipayPublicKey = aliPayConfig.alipayPublicCert<br>        <span class="hljs-keyword">val</span> alipayPublicKeyInputStream = FileUtil.getInputStream(alipayPublicKey)<br>        <span class="hljs-keyword">val</span> alipayPublicKeyObject = CertificateFactory.getInstance(<span class="hljs-string">&quot;X.509&quot;</span>).generateCertificate(alipayPublicKeyInputStream)<br>        <span class="hljs-keyword">val</span> publicKey = alipayPublicKeyObject.publicKey<br>        <span class="hljs-keyword">val</span> verifyResult = AlipaySignature.rsaCheckV1(notifyParams, sign, publicKey, signType)<br>        <span class="hljs-keyword">if</span> (!verifyResult) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>        &#125;<br>        <span class="hljs-comment">// 处理支付结果</span><br>        <span class="hljs-keyword">val</span> tradeNo = notifyParams[<span class="hljs-string">&quot;trade_no&quot;</span>]<br>        <span class="hljs-keyword">val</span> outTradeNo = notifyParams[<span class="hljs-string">&quot;out_trade_no&quot;</span>]<br>        <span class="hljs-keyword">val</span> tradeStatus = notifyParams[<span class="hljs-string">&quot;trade_status&quot;</span>]<br>        <span class="hljs-keyword">val</span> findOrder = orderRepository.findByOrderNo(outTradeNo.removePrefix(aliPayConfig.out_no_prefix))<br>        <span class="hljs-keyword">if</span> (findOrder.isEmpty) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>        &#125;<br>        <span class="hljs-keyword">val</span> order = findOrder.<span class="hljs-keyword">get</span>()<br>        <span class="hljs-keyword">val</span> payDetail = PayDetail(<br>            orderId = order.id,<br>            payId = tradeNo.toLong(),<br>            payTime = LocalDateTime.now(),<br>            status = <span class="hljs-keyword">if</span> (tradeStatus == <span class="hljs-string">&quot;TRADE_SUCCESS&quot;</span>) <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br>        )<br>        payDetailRepository.save(payDetail)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 申请支付</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> order 订单</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 支付链接</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">questALiPay</span><span class="hljs-params">(order: <span class="hljs-type">Order</span>)</span></span>: String &#123;<br>        <span class="hljs-keyword">val</span> shop = shopRepository.findById(order.shopId)<br>        <br>        <span class="hljs-comment">// 构建业务参数 JSON 对象</span><br>        <span class="hljs-keyword">val</span> bizContent = JSONObject().apply &#123;<br>            <span class="hljs-comment">// 设置商户订单号</span><br>            <span class="hljs-keyword">set</span>(<span class="hljs-string">&quot;out_trade_no&quot;</span>, aliPayConfig.out_no_prefix + order.orderId.toString())<br>            <span class="hljs-comment">// 设置支付场景</span><br>            <span class="hljs-keyword">set</span>(<span class="hljs-string">&quot;scene&quot;</span>, <span class="hljs-string">&quot;bar_code&quot;</span>)<br>            <span class="hljs-comment">// 设置订单标题</span><br>            <span class="hljs-keyword">set</span>(<span class="hljs-string">&quot;subject&quot;</span>, shop.title)<br>            <span class="hljs-comment">// 设置订单总金额</span><br>            <span class="hljs-keyword">set</span>(<span class="hljs-string">&quot;total_amount&quot;</span>, order.price * <span class="hljs-number">0.01</span>)<br>            <span class="hljs-keyword">set</span>(<span class="hljs-string">&quot;product_code&quot;</span>, <span class="hljs-string">&quot;FAST_INSTANT_TRADE_PAY&quot;</span>)<br>            <span class="hljs-comment">// 设置订单绝对超时时间</span><br>            <span class="hljs-keyword">set</span>(<span class="hljs-string">&quot;timeout_express&quot;</span>, <span class="hljs-string">&quot;120m&quot;</span>)<br>            <span class="hljs-comment">// 设置前端支付页面模式 1 前端嵌入式 2 跳转支付宝官网</span><br>            <span class="hljs-keyword">set</span>(<span class="hljs-string">&quot;qr_pay_mode&quot;</span>, <span class="hljs-number">1</span>)<br>        &#125;<br><br>        <span class="hljs-comment">// 构建请求对象</span><br>        <span class="hljs-keyword">val</span> request = AlipayTradePagePayRequest().apply &#123;<br>            <span class="hljs-comment">// 设置业务参数</span><br>            <span class="hljs-keyword">this</span>.bizContent = JSONUtil.toJsonStr(bizContent)<br>            <span class="hljs-comment">// 设置通知回调 URL</span><br>            notifyUrl = aliPayConfig.notifyUrl<br>            <span class="hljs-comment">// 设置返回支付后前端页面的跳转URL</span><br>            returnUrl = aliPayConfig.returnUrl<br>            <span class="hljs-comment">// 设置终端类型</span><br>            terminalType = <span class="hljs-string">&quot;WEB&quot;</span><br>            <span class="hljs-comment">// 设置产品代码</span><br>            prodCode = <span class="hljs-string">&quot;FAST_INSTANT_TRADE_PAY&quot;</span><br>            <span class="hljs-comment">// 设置是否开启了AES加密</span><br>            isNeedEncrypt = <span class="hljs-literal">true</span><br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 发送请求并获取响应</span><br>            <span class="hljs-keyword">val</span> response: AlipayTradePagePayResponse = alipayClient.pageExecute(request, <span class="hljs-string">&quot;POST&quot;</span>);<br>            <span class="hljs-keyword">if</span> (response.isSuccess) &#123;<br>                <span class="hljs-comment">// 返回支付链接</span><br>                response.body.toString()<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-string">&quot;支付宝支付请求失败，原因: <span class="hljs-subst">$&#123;response.subMsg&#125;</span>&quot;</span><br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (e: AlipayApiException) &#123;<br>            <span class="hljs-string">&quot;支付宝支付请求失败，原因: <span class="hljs-subst">$&#123;e.message&#125;</span>&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="前端唤起"><a href="#前端唤起" class="headerlink" title="前端唤起"></a>前端唤起</h3><blockquote><p>被前端唤起就是一个Controller接口，前端发起请求，后端调用支付宝Service层实现生成支付码，返回给前端。<br>可以先写</p></blockquote><figure class="highlight kotlin"><figcaption><span>ALiPayController.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@RestController(<span class="hljs-string">&quot;aliPayController&quot;</span>)</span><br><span class="hljs-meta">@RequestMapping(<span class="hljs-string">&quot;/pay&quot;</span>)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ALiPayController</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> alipayService: ALiPayService) &#123;<br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/ali.pay&quot;</span>)</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">aliPay</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(<span class="hljs-string">&quot;orderId&quot;</span>)</span> orderId: <span class="hljs-type">Long</span>)</span></span>: ResponseEntity&lt;ResponseBody&gt; &#123;<br>        <span class="hljs-keyword">val</span> codeUrl = alipayService.nativePay(orderId)<br>        <span class="hljs-keyword">return</span> Response.success(<span class="hljs-string">&quot;订单申请成功&quot;</span>, mapOf(<span class="hljs-string">&quot;codeUrl&quot;</span> to codeUrl))<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="引入项目"><a href="#引入项目" class="headerlink" title="引入项目"></a>引入项目</h3><p>待写。。。</p>]]></content>
    
    
    <summary type="html">从支付宝的开发者配置到项目的支付接口实际落地，记录一下Spring Boot集成支付宝支付的全过程。</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="业务" scheme="https://blog.thatcoder.cn/tags/%E4%B8%9A%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>Stellar 提高时间线适配范围</title>
    <link href="https://blog.thatcoder.cn/Stellar-Timeline-More/"/>
    <id>https://blog.thatcoder.cn/Stellar-Timeline-More/</id>
    <published>2023-08-19T02:00:00.000Z</published>
    <updated>2024-07-21T09:19:51.531Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><strong>注意：迁移1.22.1后本文作废，已完成便于主题更新的方案，待写文档中</strong></p><p>某天想把其它app的动态放进时间线, 但每个app接口都返回不同的json数据格式, 即使同一个app不同提取项目也是不同的json数据格式,<br>便不了了之。<br>直到前几天萌生一个想法: 通过传入有效路径匹配提取对应的json数据。但是这样代码太长就不推送了, 也需要的人自己加进去(<br>不影响主题升级)</p><h2 id="目前成果"><a href="#目前成果" class="headerlink" title="目前成果"></a>目前成果</h2><ul><li>编写路径即可匹配数据</li><li>编写路径时赋予路径类型可生成对应类型组件</li><li>允许多个api聚合到一个时间线展示</li><li>有时间字段可按照时间排序</li><li>排除包含的内容、正则匹配替换内容</li></ul><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202308131428294.png" alt="聚合的时间线" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">聚合的时间线</span></div></div><h2 id="加入主题"><a href="#加入主题" class="headerlink" title="加入主题"></a>加入主题</h2><blockquote></blockquote><p>经常使用git的coder直接看提交吧 <a href="https://github.com/ThatCoders/hexo-theme-stellar/commit/96bcb51d4b878766ea0e5b98a918e7052a815f24">[add] 添加timeline功能: api自适应</a><br><strong>注意最后一个custom.js非终版, 以下方的为准</strong></p><p><strong>路径以stellar主题为根</strong></p><ol><li>文件路径: _config.yml  <strong>一处</strong></li></ol><figure class="highlight diff"><figcaption><span>_config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs diff">plugins:<br>  stellar:<br>    ......<br><span class="hljs-addition">+   custom: /js/plugins/custom.js</span><br></code></pre></td></tr></table></figure><ol start="2"><li>文件路径: layout&#x2F;_partial&#x2F;widgets&#x2F;timeline.ejs  <strong>15行一处</strong></li></ol><figure class="highlight diff"><figcaption><span>timeline.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-      [&#x27;api&#x27;, &#x27;user&#x27;, &#x27;hide&#x27;, &#x27;limit&#x27;].forEach(key =&gt; &#123;</span><br><span class="hljs-addition">+      [&#x27;api&#x27;, &#x27;user&#x27;, &#x27;hide&#x27;, &#x27;limit&#x27;, &#x27;config&#x27;].forEach(key =&gt; &#123;</span><br></code></pre></td></tr></table></figure><ol start="3"><li>文件路径: scripts&#x2F;tags&#x2F;lib&#x2F;timeline.js  <strong>38,45行两处</strong></li></ol><figure class="highlight diff"><figcaption><span>timeline.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs diff"># 38行<br><span class="hljs-deletion">-      args = ctx.args.map(args, [&#x27;api&#x27;, &#x27;user&#x27;, &#x27;type&#x27;, &#x27;limit&#x27;, &#x27;hide&#x27;)</span><br><span class="hljs-addition">+      args = ctx.args.map(args, [&#x27;api&#x27;, &#x27;user&#x27;, &#x27;type&#x27;, &#x27;limit&#x27;, &#x27;hide&#x27;, &#x27;config&#x27;])</span><br># 45行<br><span class="hljs-deletion">-      el += &#x27; &#x27; + ctx.args.joinTags(args, [&#x27;api&#x27;, &#x27;user&#x27;, &#x27;limit&#x27;, &#x27;hide&#x27;]).join(&#x27; &#x27;)</span><br><span class="hljs-addition">+      el += &#x27; &#x27; + ctx.args.joinTags(args, [&#x27;api&#x27;, &#x27;user&#x27;, &#x27;limit&#x27;, &#x27;hide&#x27;, &#x27;config&#x27;]).join(&#x27; &#x27;)</span><br></code></pre></td></tr></table></figure><ol start="4"><li>文件路径: source&#x2F;js&#x2F;plugins&#x2F;custom.js 添加一整个JS文件<div class="tag-plugin link dis-select"><a class="link-card plain" title="custom.js-持续更新" href="https://kedao.thatcoder.cn/#s/9kZW_6Eg" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">custom.js-持续更新</span><span class="cap link footnote">https://kedao.thatcoder.cn/#s/9kZW_6Eg</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div></li></ol><h2 id="食用方法"><a href="#食用方法" class="headerlink" title="食用方法"></a>食用方法</h2><p>作为一个timeline插件形式, 所以使用和正常的timeline一样, 只是多了一个config。</p><p><strong>有点抽象, 我尽能力表述清楚</strong></p><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>以下是一个基本使用格式</p><div class="tag-plugin tabs"id="tab_3"><div class="nav-tabs"><div class="tab active"><a href="#tab_3-1">简单使用</a></div><div class="tab"><a href="#tab_3-2">示例代码</a></div><div class="tab"><a href="#tab_3-3">数据代码</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_3-1"><div class="tag-plugin timeline ds-custom" api="https://blog.thatcoder.cn/custom/test/timetest1.json"></div></div><div class="tab-pane" id="tab_3-2"><figure class="highlight markdown"><figcaption><span>xxx.md</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown">&#123;% timeline api:https://blog.thatcoder.cn/custom/test/timetest1.json type:custom config:&quot;[&#123; &#x27;type&#x27;: &#x27;root&#x27;, &#x27;src&#x27;: &#x27;data&#x27; &#125;, &#123; &#x27;type&#x27;: &#x27;msg&#x27;, &#x27;src&#x27;: &#x27;content|markdown:true&#x27; &#125;, &#123; &#x27;type&#x27;: &#x27;tags&#x27;, &#x27;src&#x27;: &#x27;map:talkTags&#x27; &#125;,&#123; &#x27;type&#x27;: &#x27;timestamp&#x27;, &#x27;src&#x27;: &#x27;time时间戳&#x27; &#125;]&quot; %&#125;<br>&#123;% endtimeline %&#125;<br></code></pre></td></tr></table></figure></div><div class="tab-pane" id="tab_3-3"><figure class="highlight json"><figcaption><span>timetest1.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;timetest1&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;talkTags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;测试&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;BUG制造者&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;这是timetest1的**第一个数据**, 时间为2023-08-11&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;time时间戳&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1691740257&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;talkTags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;摆烂&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;佛祖保佑&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;永无BUG&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;这是timetest1的第二个数据, 时间为2023-06-06&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;time时间戳&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1686037857&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;talkTags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;再看一眼&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;就会爆炸&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;这是timetest1的第三个数据, 时间为2023-07-06 \n再看一眼就会爆炸, 应该排除&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;time时间戳&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1688629857&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure></div></div></div><h3 id="关于config"><a href="#关于config" class="headerlink" title="关于config"></a>关于config</h3><blockquote><p>我们现在把config单独拿出来, 它就是一个数组, 里面有每个配置对象。</p></blockquote><figure class="highlight markdown"><figcaption><span>xxx.md</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">[<br>  &#123;&#x27;type&#x27;: &#x27;组件名&#x27;, &#x27;src&#x27;:&#x27;指令:参数|指令:参数&#x27; &#125;<br>]<br></code></pre></td></tr></table></figure><p>组件名和指令细分在下文<br><strong>现在需要注意的是以下几点:</strong></p><ul><li><code>timeline</code> 不能分行, 必须一行。</li><li>config整体用双引号包裹, 里面的内容用单引号包裹, 都是英文的!</li><li>暂时就这些</li></ul><h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><blockquote><p>指令其实就是调用什么方法去处理指令附属的内容<br>指令之间是协同的 (比如使用1、2搭配拿到数据,再使用其余指令加以处理补充)<br>default比较特殊, 一般用了default就不需要使用其余的<br>主指令是1、2, 常用指令是3、4</p></blockquote><ol><li><code>filter</code> (可省略, 默认指令)</li></ol><ul><li>用途: 匹配数据的方法之一, 匹配的内容为单个</li><li>参数: 填写对应的路径, 路径指向的地方是字符串、数值之类</li><li>提示: 字符串形式的json或数值也能匹配, 请大胆写路径</li></ul><ol start="2"><li><code>map</code></li></ol><ul><li>用途: 匹配数据的方法之一, 匹配的内容为复数</li><li>参数: 填写对应的路径, 路径指向的地方是数组之类的集合</li></ul><ol start="3"><li><code>default</code> (编码)</li></ol><ul><li>用途: 放弃匹配, 使用默认值</li><li>参数: 填写组件显示的默认值</li><li>提示: 常用来补充作者名、作者头像、来源、来源icon等</li></ul><ol start="4"><li><code>base</code> (编码)</li></ol><ul><li>用途: 给匹配到的内容追加前缀</li><li>参数: 填写需要追加的前缀</li><li>提示: 常用来根据ID拼凑源链接、给图片拼凑基础URL。 后缀的话…没写!</li></ul><ol start="5"><li><code>markdown</code></li></ol><ul><li>用途: 简易的markdown转义</li><li>参数: 填写 <code>true</code></li><li>提示: Memos的内容就是markdown</li></ul><ol start="6"><li><code>exclude</code> (编码)</li></ol><ul><li>用途: 若包含内容关键字, 则放弃这条数据</li><li>参数: 填写需要匹配的跳过循环的内容</li><li>提示: 比如我网易云动态有分享黑胶礼品卡, 我就填写的黑胶</li></ul><ol start="7"><li><code>regex</code> (编码)</li></ol><ul><li>用途: 正则替换</li><li>参数: 第一个参数为正则规则, 第二个参数为替换内容(不写就是替换为空字符串)</li><li>提示: memos去标签的实现 ‘…|regex:<code>#[\d\u4e00-\u9fa5a-zA-Z]+[\s\n]</code>‘  (方便展示, 记得编码)</li><li>注意事项: 我忘了要注意什么, 但开发时候依稀记得regex第一个正则参数需要注意点什么…私密马赛</li></ul><h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><blockquote><p>组件其实就是用对应的已经准备好的div和样式去装载内容</p></blockquote><ul><li><code>root</code> (很重要, 要写在最前面)<ol><li>组件内容: 接口数据真正的主体</li><li>参数类型: 基础路径</li><li>提示: <strong>这不是组件</strong>, 是一个特殊的配置。指向数据真正的主体(一般指向的是array), 不然其它路径很长且重复</li></ol></li><li><code>author</code><ol><li>组件内容: 时间节点上显示的作者名称</li><li>参数类型: 字符串</li></ol></li><li><code>avatar</code><ol><li>组件内容: 时间节点上显示的作者头像</li><li>参数类型: 链接</li></ol></li><li><code>avatar</code><ol><li>组件内容: 时间节点上显示的时间</li><li>参数类型: 时间戳</li><li>提示: 没写多少解析,尽量是标准的时间戳或其字符串, 11位13位均可</li></ol></li><li><code>tags</code><ol><li>组件内容: 内容主体右上角的小标签</li><li>参数类型: 字符串或数组</li><li>提示: 类似话题之类的</li></ol></li><li><code>title</code><ol><li>组件内容: 内容主体上方居中的标题</li><li>参数类型: 字符串或数组</li><li>提示: 一般用不上啦</li></ol></li><li><code>msg</code><ol><li>组件内容: 内容主体内容</li><li>参数类型: 字符串</li><li>提示: 类似<code>\n</code>之类的已经解析了, 更多解析记得开启markdown</li></ol></li><li><code>quote</code><ol><li>组件内容: 内容主体msg下面的引用</li><li>参数类型: 字符串</li><li>提示: 类似于回复的原内容, 我是因为微信读书笔记有引用</li></ol></li><li><code>pics</code><ol><li>组件内容: 内容主体msg下面的图片</li><li>参数类型: 链接 (字符串或数组)</li><li>提示: 即使是数组也是显示数组的第一张图片, 不然很丑的! 预留了多张, 请设计一个方案给我.</li></ol></li><li><code>netease</code><ol><li>组件内容: 内容主体msg下面的音乐</li><li>参数类型: 网易云音乐歌曲ID</li><li>提示: QQ音乐请先打钱, 私密马赛QAQ</li></ol></li><li><code>link</code><ol><li>组件内容: 左下角的小火箭, 点击跳转动态源链接</li><li>参数类型: 链接</li><li>提示: 一般动态之类的只有ID, 记得加base补充完整</li></ol></li><li><code>origin</code><ol><li>组件内容: 右下角的文字</li><li>参数类型: 字符串</li><li>提示: 我一般用来写 ‘– Form XXX’, 已经赋予了斜体</li></ol></li><li><code>icon</code><ol><li>组件内容: 右下角的图标</li><li>参数类型: 链接</li><li>提示: 我一般用来放来源的icon, 至于你呢, 你喜欢便好</li></ol></li></ul><h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><blockquote><p>因为涉及到正则、冒号、竖杠等特殊字符, 有编码标注的地方需使用下面的编码, 在浏览器控制台即可使用</p></blockquote><ul><li><p>编码<br><code>window.btoa(window.encodeURIComponent(String.raw&#39;输入编码内容&#39;));</code> (编码里面不是单引号, 是常用来包裹代码的符号)</p></li><li><p>解码<br><code>window.decodeURIComponent(window.atob(&#39;输入解码内容&#39;))</code></p></li></ul><div class="tag-plugin copy" style="width: 100%"><label for="CodeContent">  </label><input style="width: 70%" class="copy-area" type="text"  id="CodeContent">  <button class="copy-btn" style="width:10%" onclick="encodeText('CodeContent', 'CodeContent')">编码</button>  <button class="copy-btn" style="width:10%" onclick="decodeText('CodeContent', 'CodeContent')">解码</button>  <button class="copy-btn" style="width:10%" onclick="util.copy('CodeContent', '复制成功!')">复制</button></div><script>function encodeText(inputId, resultId) {  const inputText = document.getElementById(inputId).value;  document.getElementById(resultId).value = window.btoa(window.encodeURIComponent(String.raw`${inputText}`));  util.copy(resultId, '复制成功!')}function decodeText(inputId, resultId) {  const inputText = document.getElementById(inputId).value;  document.getElementById(resultId).value = window.decodeURIComponent(window.atob(inputText));  util.copy(resultId, '复制成功!')}</script><h2 id="指令教程"><a href="#指令教程" class="headerlink" title="指令教程"></a>指令教程</h2><h3 id="匹配单个"><a href="#匹配单个" class="headerlink" title="匹配单个"></a>匹配单个</h3><p><img src="https://upyun.thatcdn.cn/myself/typora/202308132237730.png"></p><h3 id="匹配目标集合"><a href="#匹配目标集合" class="headerlink" title="匹配目标集合"></a>匹配目标集合</h3><p><img src="https://upyun.thatcdn.cn/myself/typora/202308132231381.png"></p><h3 id="没了"><a href="#没了" class="headerlink" title="没了"></a>没了</h3><p>不知道写什么, 有问题再问吧!</p><h2 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h2><blockquote><p>已经写成屎山了, 我还在乎多来几个for循环 ?<br>这里虽然是进阶, 但毫无难度, 只是可能有bug, 排了bug记得告诉我!</p></blockquote><p><strong>timelines一定要紧接在root组件后面, root没有就写在最前面。</strong></p><ul><li><code>sort</code><ol><li>用途: 全节点排序</li><li>参数: timestamp 顺序 | pmatsemit 逆序 (目前只支持时间排序)</li></ol></li><li><code>identifier</code><ol><li>用途: 集合标识符</li><li>参数: 随便一个单词</li><li>提示: 需要集合在一起的timeline的标识符是一样的</li></ol></li><li><code>num</code><ol><li>用途: 这个标识符集合的数量</li><li>参数: 数值</li><li>提示: 考虑到api请求耗时不一样, 还是加一个num为妥, 不满则等待<br><code>&#123; &#39;type&#39;: &#39;timelines&#39;, &#39;identifier&#39;: &#39;life&#39;, &#39;num&#39;: &#39;3&#39;, &#39;sort&#39;: &#39;timestamp&#39; &#125;</code></li></ol></li></ul><h2 id="代码参考"><a href="#代码参考" class="headerlink" title="代码参考"></a>代码参考</h2><p>看着json数据和对应config代码, 相信你就能明白一切, 并且大喊一声: <strong>狗屁设计!!!</strong></p><ul><li>网易接口: <a href="https://netease.thatapi.cn/user/event?uid=134968139&limit=10">https://netease.thatapi.cn/user/event?uid=134968139&amp;limit=10</a></li><li>Memos接口: <a href="https://memos.thatcoder.cn/api/v1/memos?filter=creator==%27users/1%27&pageSize=99">https://memos.thatcoder.cn/api/v1/memos?filter=creator%3D%3D%27users%2F1%27&amp;pageSize=99</a></li><li>微信读书接口: <a href="https://blog.thatcoder.cn/custom/test/ThatRead.json">https://blog.thatcoder.cn/custom/test/ThatRead.json</a>  (需要提取微信读书数据可留言)</li></ul><div class="tag-plugin link dis-select"><a class="link-card plain" title="代码参考渲染结果" href="https://blog.thatcoder.cn/邮箱模板集/#组装时间线测试" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">代码参考渲染结果</span><span class="cap link footnote">https://blog.thatcoder.cn/邮箱模板集/#组装时间线测试</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div><h3 id="网易云memos联合测试"><a href="#网易云memos联合测试" class="headerlink" title="网易云memos联合测试"></a>网易云memos联合测试</h3><p><code>timetmpl</code>里面有多个会自动组合并且自动排序, 如果能识别time的话</p><figure class="highlight markdown"><figcaption><span>参考代码</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs markdown">&#123;% timetmpl %&#125;<br>&lt;!-- node netease --&gt;<br>`<br>&#123; &quot;api&quot;: &quot;https://netease.thatapi.cn/user/event?uid=134968139&amp;limit=30&quot; &#125;<br><br>`<br>&lt;!-- node memos --&gt;<br><br>`<br>&#123; &quot;api&quot;: &quot;https://memos.thatcoder.cn/api/v1/memos?filter=creator%3D%3D%27users%2F1%27&amp;pageSize=10&quot; &#125;<br><br>`<br>&#123;% endtimetmpl %&#125;<br></code></pre></td></tr></table></figure><h3 id="memos单个测试"><a href="#memos单个测试" class="headerlink" title="memos单个测试"></a>memos单个测试</h3><figure class="highlight markdown"><figcaption><span>参考代码</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs markdown">&#123;% timetmpl %&#125;<br>&lt;!-- node memos --&gt;<br>`<br>&#123; &quot;api&quot;: &quot;https://memos.thatcoder.cn/api/v1/memos?filter=creator%3D%3D%27users%2F1%27&amp;pageSize=10&quot; &#125;<br>`<br>&#123;% endtimetmpl %&#125;<br><br>或者<br><br>&#123;% timetmpl %&#125;<br>&lt;!-- node 这里不写模板名称就得写type里 --&gt;<br>`<br>&#123; &quot;type&quot;:&quot;memos&quot;, &quot;api&quot;: &quot;https://memos.thatcoder.cn/api/v1/memos?filter=creator%3D%3D%27users%2F1%27&amp;pageSize=10&quot; &#125;<br>`<br>&#123;% endtimetmpl %&#125;<br></code></pre></td></tr></table></figure><h2 id="侧边栏使用"><a href="#侧边栏使用" class="headerlink" title="侧边栏使用"></a>侧边栏使用</h2><blockquote><p>效果是主页侧边栏的 <strong>近期动态</strong></p></blockquote><p>在 <strong>widgets.yml</strong> 写好一个组件, 就能像其它侧边栏一样引用即可</p><figure class="highlight yaml"><figcaption><span>widgets.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">life_more:</span><br>  <span class="hljs-attr">layout:</span> <span class="hljs-string">timetmpl</span><br>  <span class="hljs-attr">title:</span> <span class="hljs-string">近期动态</span><br>  <span class="hljs-attr">config:</span> <span class="hljs-string">|</span><br><span class="hljs-string">    &lt;!-- node netease --&gt;</span><br><span class="hljs-string">    `</span><br><span class="hljs-string">    &#123; &quot;api&quot;: &quot;https://netease.thatapi.cn/user/event?uid=134968139&amp;limit=10&quot; &#125;</span><br><span class="hljs-string">    `</span><br></code></pre></td></tr></table></figure><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p><strong>我再也不想写这种代码, 简直是屎山, 不 这就是屎山!</strong></p><p>虽说是屎山, 但至少能让我随意对接接口了, 不是吗。 钟意你依然是个喜欢一劳永逸的人呢。</p><p>如果多一个人使用, 这屎山又发挥了作用。</p><p>毕竟它就好比, <strong>用头起飞的鸽子</strong>。</p><p>如果你不知道我想表达什么, 不知道用头起飞的鸽子, <strong>请一定往下看</strong><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="tag-plugin quot"><p class="content" type="text"><span class="empty"></span><span class="text">再往下 default</span><span class="empty"></span></p></div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><img src="https://upyun.thatcdn.cn/myself/typora/202308132253332.png"><br><video id="postVideo" src="https://upyun.thatcdn.cn/myself/typora/202308132255836.mp4" width="100%" controls muted="false" autoplay="autoplay" loop="loop"><br></video></p><div class="tag-plugin quot"><p class="content" type="icon"><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">懂了叭🕊</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></p></div>]]></content>
    
    
    <summary type="html">企图减少个人去适配时间线api的成本</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="Stellar" scheme="https://blog.thatcoder.cn/tags/Stellar/"/>
    
  </entry>
  
  <entry>
    <title>我数据价值 2082 元的 MongoDB 被攻击</title>
    <link href="https://blog.thatcoder.cn/MongoDB%20%E8%A2%AB%E6%94%BB%E5%87%BB/"/>
    <id>https://blog.thatcoder.cn/MongoDB%20%E8%A2%AB%E6%94%BB%E5%87%BB/</id>
    <published>2023-08-05T15:00:00.000Z</published>
    <updated>2023-09-18T15:28:05.294Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一个小故事"><a href="#一个小故事" class="headerlink" title="一个小故事"></a>一个小故事</h2><div class="tag-plugin timeline"><div class="timenode" index="0"><div class="header">2023.08.05 凌晨</div><div class="body fs14"><p>随手在闲置服务器安装了一个 MongoDB<br>用于临时测试给QQ机器人添加的Key功能是否有效<br>测试完便下机睡觉<br><img src="https://upyun.thatcdn.cn/myself/typora/202308060135017.png"></p></div></div><div class="timenode" index="1"><div class="header">2023.08.05 上午十点</div><div class="body fs14"><p>在我前往另一个城市的时候, 发生了</p></div></div><div class="timenode" index="2"><div class="header">2023.08.05 晚上</div><div class="body fs14"><p>和朋友聚完回来准备完善测试再push<br>发现携带key方法挂了, 开始排查代码<br>…<br>就刚写没一点的破代码有个屁BUG<br>排查数据库的key, <strong>key没了</strong><br>…<br><strong>不!!! 是库没了!!!</strong></p></div></div></div><h2 id="生活的小插曲啦"><a href="#生活的小插曲啦" class="headerlink" title="生活的小插曲啦"></a>生活的小插曲啦</h2><ul><li><p>这是攻击者留的唯一库(代码直观展示)<br>‘您的所有数据都已备份。您必须支付0.01 比特币<br>至—博主和谐—在48小时内，您的数据将被公开披露和删除。（更多信息：转到—博主和谐—）付款后发送邮件给我们：—博主和谐—我们将提供一个链接供您下载您的数据。您的DBCODE是：—博主和谐—‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">db.getCollection(&quot;READ__ME_TO_RECOVER_YOUR_DATA&quot;).insert([ &#123;<br>_id: ObjectId(&quot;64cdcb2a0f2c98e1b7c19017&quot;),<br>content: &quot;All your data is backed up. You must pay 0.01 BTC to ---博主和谐--- In 48 hours, your data will be publicly disclosed and deleted. (more information: go to ---博主和谐---)After paying send mail to us: ---博主和谐--- and we will provide a link for you to download your data. Your DBCODE is: ---博主和谐---&quot;<br>&#125; ]);<br></code></pre></td></tr></table></figure></li><li><p>这是日志留下的痕迹</p><blockquote><p>算上东八区, 老贼, 在我上高铁时候下手, 怪不得车上没睡好</p></blockquote><p><img src="https://upyun.thatcdn.cn/myself/typora/202308060137202.png"></p></li><li><p>这是攻击者IP(当然是IP伪造欺骗)<br><img src="https://upyun.thatcdn.cn/myself/typora/202308060140232.png"></p></li><li><p>这是去给定网址的回执(已翻译)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">请注意以下几点：<br><br>我们知道您已经访问了本指南。<br>恢复您的数据的唯一方法是付款。我们不会免费或打折提供数据。<br>如果您决定不检索数据，我们可能会在在线市场上出售您的数据库，向您的用户披露<br>并要求他们付款，在在线违规论坛中披露，或删除它。<br>如果适用，我们将联系您所在国家的欧盟数据保护法机构。<br><br>如果您无法联系我们，请访问https://xxxxxxx/并下载会话信使。<br>使用以下ID添加我们，以进行流畅的对话和更好的谈判，<br>***不要忘记提及分配给您的DBCODE***：<br>xxxxxxxxxxxxxxxx<br></code></pre></td></tr></table></figure></li></ul><h2 id="结个尾"><a href="#结个尾" class="headerlink" title="结个尾"></a>结个尾</h2><p>代码虽然开源但config里面还是127.0.0.1, 应该是自动化主机端口扫描的结果(临时用数据库没给密码)</p><p>好在是临时用的服务器与数据库, 0.01比特币(2082元)算起步价了吧, 没有比我这更廉价的数据了哈哈哈</p><p><strong>大家记得做好安全措施</strong></p><p><strong>有趣的是, 我没在日志看到任何那个时间段有关数据库的备份相关操作, 哪怕是查询</strong></p>]]></content>
    
    
    <summary type="html">不加密真的会被攻击</summary>
    
    
    
    <category term="生活" scheme="https://blog.thatcoder.cn/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="随笔" scheme="https://blog.thatcoder.cn/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu 安装使用 Clash</title>
    <link href="https://blog.thatcoder.cn/Clash%20For%20Linux/"/>
    <id>https://blog.thatcoder.cn/Clash%20For%20Linux/</id>
    <published>2023-07-29T16:00:00.000Z</published>
    <updated>2023-07-29T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>适用范围建立在使用过 window IOS 下的 Clash 为基础的半安装教程</p><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol><li>取出之前设备配置</li><li>安装配置Clash</li><li>注册为系统服务</li><li>在线管理Clash</li></ol><h2 id="取出配置"><a href="#取出配置" class="headerlink" title="取出配置"></a>取出配置</h2><p>备好两个文件</p><ol><li>Country.mmdb</li><li>profiles&#x2F;xxxxxxxx.yml</li></ol><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202307301651854.png" alt="打开目录找到两个文件" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">打开目录找到两个文件</span></div></div><h2 id="安配-Clash"><a href="#安配-Clash" class="headerlink" title="安配 Clash"></a>安配 Clash</h2><h3 id="安装-Clash"><a href="#安装-Clash" class="headerlink" title="安装 Clash"></a>安装 Clash</h3><p>下载解压并命名为 clash</p><ul><li>解压<ul><li><div class="tag-plugin copy"><input class="copy-area" id="copy_1" value="gunzip xxxx.gz"><button class="copy-btn" onclick="util.copy(&quot;copy_1&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div></li></ul></li><li>重命名<ul><li><div class="tag-plugin copy"><input class="copy-area" id="copy_2" value="mv clash-linux-amd64 clash"><button class="copy-btn" onclick="util.copy(&quot;copy_2&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div></li></ul></li><li>移动到 &#x2F;usr&#x2F;local&#x2F;bin&#x2F; 目录下 (方便在任何位置调用Clash)<ul><li><div class="tag-plugin copy"><input class="copy-area" id="copy_3" value="mv clash /usr/local/bin/"><button class="copy-btn" onclick="util.copy(&quot;copy_3&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div></li></ul></li><li>查看版本<ul><li><div class="tag-plugin copy"><input class="copy-area" id="copy_4" value="uname -m"><button class="copy-btn" onclick="util.copy(&quot;copy_4&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div></li></ul></li><li><a href="https://github.com/Dreamacro/clash/releases">下载地址</a><div class="tag-plugin timeline ds-timeline" api="https://api.github.xaox.cc/repos/Dreamacro/clash/releases?per_page=1"></div></li></ul><h3 id="配置-Clash"><a href="#配置-Clash" class="headerlink" title="配置 Clash"></a>配置 Clash</h3><ol><li>首次启动<br>命令行输入clash即可, 一般会提示失败(不重要), 目的是生成配置文件</li><li>找到配置目录<div class="tag-plugin copy"><input class="copy-area" id="copy_5" value="find / -name clash"><button class="copy-btn" onclick="util.copy(&quot;copy_5&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div>一般在 &#x2F;用户&#x2F;.config&#x2F;clash&#x2F; 即 &#x2F;root&#x2F;.config&#x2F;clash<div class="tag-plugin copy"><input class="copy-area" id="copy_6" value="cd /root/.config/clash"><button class="copy-btn" onclick="util.copy(&quot;copy_6&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div></li><li>放置全球IP库<br>把之前准备的 Country.mmdb 放进去</li><li>写配置文件<br>创建一个 config.yaml</li></ol><figure class="highlight yaml"><figcaption><span>config.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># port of HTTP</span><br><span class="hljs-comment"># port: 7890  ## 解释掉该行，使用mixed-port</span><br><br><span class="hljs-comment"># port of SOCKS5</span><br><span class="hljs-comment"># socks-port: 7891 ## 解释掉该行，使用mixed-port</span><br><span class="hljs-attr">mixed-port:</span> <span class="hljs-number">52443</span> <span class="hljs-comment">## 提供统一的端口</span><br><br><span class="hljs-attr">authentication:</span> <span class="hljs-comment">## 增加配置，设置账号和密码</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;username:password&quot;</span><br><br><span class="hljs-comment"># web ui 配置</span><br><span class="hljs-attr">external-controller:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">:52444</span>  <span class="hljs-comment"># web ui 监听地址</span><br><span class="hljs-attr">secret:</span> <span class="hljs-string">&quot;xxxxxxxxxxxxx&quot;</span>  <span class="hljs-comment"># web ui 密钥</span><br><br><span class="hljs-comment"># allow-lan: false</span><br><span class="hljs-attr">allow-lan:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">## 允许局域网连接</span><br><br><span class="hljs-comment"># Rule / Global/ DIRECT (default is Rule)</span><br><span class="hljs-attr">mode:</span> <span class="hljs-string">rule</span><br><br><span class="hljs-comment"># external-ui: dashboard ## 关闭external</span><br><br><span class="hljs-comment">## 以下贴订阅的配置</span><br><br></code></pre></td></tr></table></figure><p>接着把之前准备的 &#x2F;profiles&#x2F;xxxxxxxx.yml 的文件dns开始到结尾的配置贴到 config.yaml 后面.<br>window与linux配置不同的是前者读取profiles下的列表, 后者直接读取 config.yaml.</p><h2 id="注册为系统服务"><a href="#注册为系统服务" class="headerlink" title="注册为系统服务"></a>注册为系统服务</h2><p>在&#x2F;etc&#x2F;systemd&#x2F;system目录下创建clash.service文件</p><figure class="highlight yaml"><figcaption><span>clash.service</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">Unit</span>]<br><span class="hljs-string">Description=Clash</span> <span class="hljs-string">Service</span><br><span class="hljs-string">After=network.target</span><br><br>[<span class="hljs-string">Service</span>]<br><span class="hljs-string">Type=simple</span><br><span class="hljs-string">User=root</span><br><span class="hljs-string">ExecStart=/usr/local/bin/clash</span><br><span class="hljs-string">Restart=on-failure</span><br><br>[<span class="hljs-string">Install</span>]<br><span class="hljs-string">WantedBy=multi-user.target</span><br></code></pre></td></tr></table></figure><p>以后就能直接使用熟悉的服务命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl enable clash  # 开机自启<br>systemctl start clash<br>systemctl restart clash<br>systemctl status clash<br>systemctl stop clash<br></code></pre></td></tr></table></figure><h2 id="在线管理"><a href="#在线管理" class="headerlink" title="在线管理"></a>在线管理</h2><p>有两个选择, 根据config文件的 web ui 配置, 使用在线网站管理</p><ol><li>yacd<div class="tag-plugin link dis-select"><a class="link-card plain" title="yacd" href="http://yacd.haishan.me/" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">yacd</span><span class="cap link footnote">http://yacd.haishan.me/</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div><img src="https://upyun.thatcdn.cn/myself/typora/202307301742787.png"></li></ol><p>如果你不用IP,已经反向代理使用域名并且使用Https, 也可以使用下面的https的yacd</p><div class="tag-plugin link dis-select"><a class="link-card plain" title="博主的搭建的yacd" href="https://clash.thatcoder.cn/" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">博主的搭建的yacd</span><span class="cap link footnote">https://clash.thatcoder.cn/</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div><ol start="2"><li>razord<div class="tag-plugin link dis-select"><a class="link-card plain" title="razord提供的(也许要科学上网)" href="http://clash.razord.top/" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">razord提供的(也许要科学上网)</span><span class="cap link footnote">http://clash.razord.top/</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div><img src="https://upyun.thatcdn.cn/myself/typora/202307301744235.png"></li></ol><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p><strong>注意端口自行定义与放行</strong></p>]]></content>
    
    
    <summary type="html"> Clash For Linux + Web UI 安装配置使用备忘录</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="部署" scheme="https://blog.thatcoder.cn/tags/%E9%83%A8%E7%BD%B2/"/>
    
  </entry>
  
  <entry>
    <title>《原神》私有服务器搭建</title>
    <link href="https://blog.thatcoder.cn/game/Genshin%20Impact/"/>
    <id>https://blog.thatcoder.cn/game/Genshin%20Impact/</id>
    <published>2023-07-10T10:00:00.000Z</published>
    <updated>2024-07-20T13:05:58.848Z</updated>
    
    <content type="html"><![CDATA[<h2 id="碎碎念"><a href="#碎碎念" class="headerlink" title="碎碎念"></a>碎碎念</h2><p>退坑卖号两年, 最近网上冲浪的我看到宵宫传说任务二想来过剧情, 遂想起 grasscutter(开源的原神私服项目,简称 割草机). 不得不说<br>grasscutter 相比之前已经进步很多.</p><h2 id="大致步骤"><a href="#大致步骤" class="headerlink" title="大致步骤"></a>大致步骤</h2><ol><li>安装mongodb数据库 <img src="https://upyun.thatcdn.cn/myself/typora/202307171812128.png" style="float:right;width: 180px;" /></li><li>配置cultivation</li><li>配置config (搭建在服务器或本地的区别就在这里)</li><li>下载游戏本体</li><li>启动cultivation</li></ol><ul><li>grasscutter: 相当于游戏的服务器</li><li>cultivation: 相当于游戏的代理启动器</li></ul><h2 id="下载游戏本体"><a href="#下载游戏本体" class="headerlink" title="下载游戏本体"></a>下载游戏本体</h2><p>下载游戏本体是最后一步, 放在第一步考虑的是下载太久, 但放在最后是前面都没耐心配置就没必要下载了不是吗<br>之前官服也可以, 不用额外下载. 但现版本grasscutter对应的是3.7版本资源, 官服已经迈入3.8, 所以需要下载3.7版本的国际服.</p><div class="tag-plugin link dis-select"><a class="link-card plain" title="国际服3.7" href="https://d3ln624mszu7ty.cloudfront.net/client_app/download/pc_zip/20230513200104_2odHBzbUAP5IOIvE/GenshinImpact_3.7.0.zip" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">国际服3.7</span><span class="cap link footnote">https://d3ln624mszu7ty.cloudfront.net/client_app/download/pc_zip/20230513200104_2odHBzbUAP5IOIvE/GenshinImpact_3.7.0.zip</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div><h2 id="安装mongodb"><a href="#安装mongodb" class="headerlink" title="安装mongodb"></a>安装mongodb</h2><p>官网自行解决</p><div class="tag-plugin link dis-select"><a class="link-card rich" title="MongoDB社区" href="https://www.mongodb.com/try/download/community" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon,desc"><div class="top"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div><span class="cap link footnote">https://www.mongodb.com/try/download/community</span></div><div class="bottom"><span class="title">MongoDB社区</span><span class="cap desc footnote"></span></div></a></div><h2 id="配置cultivation"><a href="#配置cultivation" class="headerlink" title="配置cultivation"></a>配置cultivation</h2><h3 id="下载cultivation"><a href="#下载cultivation" class="headerlink" title="下载cultivation"></a>下载cultivation</h3><p><strong>下载后缀msi的包</strong></p><div class="tag-plugin link dis-select"><a class="link-card plain" title="cultivation最新版" href="https://github.com/Grasscutters/Cultivation/releases/latest" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">cultivation最新版</span><span class="cap link footnote">https://github.com/Grasscutters/Cultivation/releases/latest</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div><h3 id="配置cultivation-1"><a href="#配置cultivation-1" class="headerlink" title="配置cultivation"></a>配置cultivation</h3><h4 id="下载grasscutter-本地运行"><a href="#下载grasscutter-本地运行" class="headerlink" title="下载grasscutter(本地运行)"></a>下载grasscutter(本地运行)</h4><ol><li>大约要下载400MB左右, 下载出错可以关掉重新来.<div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202307171725483.png" alt="下载一体化" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">下载一体化</span></div></div></li><li>点击设置<br><img src="https://upyun.thatcdn.cn/myself/typora/202307171729304.png" alt="1"><br><img src="https://upyun.thatcdn.cn/myself/typora/202307171731397.png" alt="2"></li></ol><h4 id="下载grasscutter-服务器运行"><a href="#下载grasscutter-服务器运行" class="headerlink" title="下载grasscutter(服务器运行)"></a>下载grasscutter(服务器运行)</h4><p>服务器跑通自行研究, 其实可以本地编译完上传到服务器运行, 缺少resource文件夹可以走上一步本地运行的方式下载到资源. 路径大概在<br><strong>C:\Users\Administrator\AppData\Roaming\cultivation\grasscutter\resources.zip</strong></p><div class="tag-plugin link dis-select"><a class="link-card plain" title="Grasscutter最新版" href="https://github.com/Grasscutters/Grasscutter/releases/latest" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">Grasscutter最新版</span><span class="cap link footnote">https://github.com/Grasscutters/Grasscutter/releases/latest</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div><p>Windows</p><figure class="highlight shell"><figcaption><span>Windows</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone --recurse-submodules https://github.com/Grasscutters/Grasscutter.git<br>cd Grasscutter<br>.\gradlew.bat # 设置开发环境<br>.\gradlew jar # 编译<br></code></pre></td></tr></table></figure><p>Linux（GNU）</p><figure class="highlight shell"><figcaption><span>Linux</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone --recurse-submodules https://github.com/Grasscutters/Grasscutter.git<br>cd Grasscutter<br>chmod +x gradlew<br>./gradlew jar # 编译<br></code></pre></td></tr></table></figure><p>你可以在项目的根目录找到输出的jar。</p><p>还有, 尊贵的Coder, Grasscutter是一个Gradle的Java项目, 您可以自定义服务器内容(目前能运营的私服就是这么干的)<br><img src="https://upyun.thatcdn.cn/myself/typora/202307171900229.png" alt="自定义java"></p><h2 id="配置config"><a href="#配置config" class="headerlink" title="配置config"></a>配置config</h2><p>如果是在自己电脑当服务器,自己一个人玩, 就不需要配置, 请跳过这步。</p><p>因为是一体化下载的grasscutter, 所以路径大概在 <strong>C:<br>\Users\Administrator\AppData\Roaming\cultivation\grasscutter\config.json</strong><br>需要修改几个参数</p><figure class="highlight json"><figcaption><span>config.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;bindAddress&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span> <span class="hljs-comment">//有两个, 都改成 0.0.0.0</span><br><span class="hljs-attr">&quot;accessAddress&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span>  <span class="hljs-comment">//有两个, 都改成服务器IP或者能解析到IP的域名</span><br><span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">443</span>  <span class="hljs-comment">//有两个, 不想撞443的话改成你想要的端口, 记得端口开放</span><br></code></pre></td></tr></table></figure><h2 id="启动cultivation"><a href="#启动cultivation" class="headerlink" title="启动cultivation"></a>启动cultivation</h2><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202307171741788.png" alt="启动游戏" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">启动游戏</span></div></div><h2 id="免责声明"><a href="#免责声明" class="headerlink" title="免责声明"></a>免责声明</h2><p>开此博客纯属积累相关经验记录，而且我需要有记录实证。所有记录的内容均未<br>经专业人士证实，请大家在查看时自行甄别，切勿随意传播。若有违背，本人不承担任何责任!<br>有问题找<a href="https://github.com/Grasscutters">grasscutters</a>咩! 我只负责和万叶喝茶!<br>最后祝原神越做越好, 米哈游生意兴隆!</p><p><img src="https://upyun.thatcdn.cn/myself/typora/202307171810163.gif"></p><h2 id="问题归纳"><a href="#问题归纳" class="headerlink" title="问题归纳"></a>问题归纳</h2><blockquote><p>Q: 启动grasscutter报错缺失resource资源?<br>A: 下载放到grasscutter的文件夹 <a href="https://gitlab.com/YuukiPS/GC-Resources">https://gitlab.com/YuukiPS/GC-Resources</a></p></blockquote><blockquote><p>Q: 我能当原神服务器上帝咩?<br>A: 你要的这里都有, 甚至自定义圣遗物 自定义技能. <a href="https://github.com/jie65535/GrasscutterCommandGenerator">https://github.com/jie65535/GrasscutterCommandGenerator</a></p></blockquote><blockquote><p>Q: 还有其它问题来频道交流<br>A: 点击链接加入频道【钟意博客】：<a href="https://pd.qq.com/s/6h7wytr8a">https://pd.qq.com/s/6h7wytr8a</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;碎碎念&quot;&gt;&lt;a href=&quot;#碎碎念&quot; class=&quot;headerlink&quot; title=&quot;碎碎念&quot;&gt;&lt;/a&gt;碎碎念&lt;/h2&gt;&lt;p&gt;退坑卖号两年, 最近网上冲浪的我看到宵宫传说任务二想来过剧情, 遂想起 grasscutter(开源的原神私服项目,简称 割草机).</summary>
      
    
    
    
    <category term="第九艺术" scheme="https://blog.thatcoder.cn/categories/%E7%AC%AC%E4%B9%9D%E8%89%BA%E6%9C%AF/"/>
    
    
    <category term="Game" scheme="https://blog.thatcoder.cn/tags/Game/"/>
    
  </entry>
  
  <entry>
    <title>《SKY·光遇》</title>
    <link href="https://blog.thatcoder.cn/game/sky/"/>
    <id>https://blog.thatcoder.cn/game/sky/</id>
    <published>2023-06-21T16:00:00.000Z</published>
    <updated>2023-09-18T15:28:08.114Z</updated>
    
    <content type="html"><![CDATA[<p><strong>谨以此文记录光遇</strong></p><span id="more"></span><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306220233849.png" data-fancybox="true"/></div></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" style="width:100%;" height=86 src="//music.163.com/outchain/player?type=2&id=1890669278&auto=0&height=66"></iframe><div class="tag-plugin quot"><h2 class="content" id="开端" type="icon"><a href="#开端" class="headerlink" title="开端"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">开端</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></h2></div><p>寒冬, 大一上学年的收尾。<br>寒冬, 世界级瘟疫的开端。<br>落叶捎来讯息, 美好的大学生活埋葬在疫情之下, 比覆雪更严实。</p><p>暖春, 好在阴霾里裂开的间隙, 一束光影悄然降临, 光遇。</p><div class="tag-plugin quot"><h2 class="content" id="初遇" type="icon"><a href="#初遇" class="headerlink" title="初遇"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">初遇</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></h2></div><p>第一次听说光遇是年前室友询问我, 怎样在国内玩光遇。我研究了一下当时只有国际服, 发现单纯游玩可以但涉及更新需要手机有谷歌套件,<br>否则更新有丢失账号的风险, 室友嫌麻烦就此作罢。我也没多少兴趣便继续投入到 Rockstar Games 的游戏《Grand Theft Auto V》和《Red<br>Dead Redemption 2》。</p><p>第二次便是入坑。 疫情下游戏荒时期, 2020.03.05日无意间看到《纪念碑谷》, 便想起陈星汉,<br>进而想起光遇。这便是快乐与遗憾的开始。很符合当天的节气: 惊蛰。</p><p>抛开游戏货币蜡烛, 回想起第一周目的游戏体验, 就像是《星际拓荒》般纯粹、干净且美好。但与太空探索的震撼与孤寂不同的是,<br>一周目碰到了几个指引我的”大佬”, 或许是加拿大人, 亦或是日本人、国人, 谁知道呢。唯一能确定的是过客, 因为没解锁聊天, 甚至没加好友。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306220013163.jpg" alt="一周目通关" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">一周目通关</span></div></div><div class="tag-plugin quot"><h2 class="content" id="友人" type="icon"><a href="#友人" class="headerlink" title="友人"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">友人</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></h2></div><blockquote><p>这是个主打社交的游戏, 遇到数十位性情相投的固玩直接拉满游戏体验。在疫情下大家似乎一天25小时高强度在线, 只可惜一个房间只能8人。</p></blockquote><p>第一个正式好友是”阳菜”, 一位同年级团支书。也许她刚看完《天气之子》。</p><p>第二位是”秋刀鱼”, 带我度过了新手时期。</p><p>第三位是现实高中室友LQ, 游戏里叫”朔风”, 陪我到一起淡游。</p><p>后来加了一位up的群, 认识了很多伙伴, 也在群里一起负责游戏攻略管理。有同年级吐槽光遇乐器不是88键的音乐生”病病”(<br>测试服好搭档), 同年级爱画画和找游戏bug的”小昭”, 后来好像当兵去了的”小新”, 开内衣工厂的”Atlantis.峰”, 弹琴很厉害的”婷婷”,<br>古灵精怪的”鱼鱼”(感谢给我占卜)…后面的再去回忆, 只剩下昵称…”乌拉”、”飞哥”、”小奕”、”姜妤”、”雾”、”yaa”、”陈君泽”(<br>唯一一个游戏上真名的)、”久”、”诺诺”、一些全家一起玩光遇的家庭…还有一些昵称都回忆不起, 尤其是外国友人(笑死, 太长了根本记不住,<br>甚至有些国家不是用英文)</p><p>有些印象深刻的记忆碎片: 对线台独分子(其实少部分是台独); 凌晨五点时日本妹子说”窗外的阳光有点刺眼, 我已经一个月没出门”(<br>一小时时差); 很多祝我国战胜疫情的外国玩家(虽然后来成了我们祝福他们); 疫情只能在游戏见面的爸妈和孩子(亲子玩家);<br>发黄黑脸表情就能互相确认身份的国人玩家……</p><p><strong>游戏中后期无趣且重复, 辛有他们带来欢乐与音乐, 以此可抵疫情漫长。</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306220055405.jpg" alt="日常音乐会" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">日常音乐会</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306220051913.jpg" alt="日常跑图" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">日常跑图</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306220054285.jpg" alt="所剩不多的截图" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">所剩不多的截图</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306220055918.jpg" alt="召唤神狗" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">召唤神狗</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306220226348.jpg" alt="这两张插图诠释了光遇内核" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">这两张插图诠释了光遇内核</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306220226558.jpg" alt="这两张插图诠释了光遇内核" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">这两张插图诠释了光遇内核</span></div></div><div class="tag-plugin quot"><h2 class="content" id="羁绊" type="icon"><a href="#羁绊" class="headerlink" title="羁绊"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">羁绊</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></h2></div><p>那段时间家庭情况不好, 经济亦如此。因光遇国际服充值不便, 遂干光遇代氪两个月的收入也帮助我度过这段岁月。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306220041602.jpg" alt="在咸鱼代氪" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">在咸鱼代氪</span></div></div><p>光遇也让我第一次尝试游戏二创, 不过是音乐方面, 很高兴通过二创能与一些玩家有所共鸣, 同时有些收入。当然现在无法满足催更的玩家了,<br>毕竟离开光遇太久。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306220046854.jpg" alt="QQ音乐" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">QQ音乐</span></div></div><div class="tag-plugin quot"><h2 class="content" id="国服" type="icon"><a href="#国服" class="headerlink" title="国服"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">国服</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></h2></div><p>2020.07.09光遇国服开启, 安利给了两个堂妹和同学珞。 陪她们玩的差不多我也就撤了, 国服体验不太纯粹, 就不展开吐槽啦。当然也碰到些难忘的人。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306220156550.jpg" alt="国服记忆" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">国服记忆</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306220159574.jpg" alt="国服记忆" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">国服记忆</span></div></div><p>好像我GTA5的游轮喷漆是 SKY-20200709</p><div class="tag-plugin quot"><h2 class="content" id="存档" type="icon"><a href="#存档" class="headerlink" title="存档"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">存档</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></h2></div><p>删除上万张相册之前, 我居然备份了这个视频在网易云音乐。</p><iframe src="//player.bilibili.com/player.html?aid=997616076&page=1&high_quality=1&danmaku=0&autoplay=0" allowfullscreen="allowfullscreen" width="100%" height="500" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"></iframe><div class="tag-plugin quot"><h2 class="content" id="尾声" type="icon"><a href="#尾声" class="headerlink" title="尾声"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">尾声</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></h2></div><p>频频落笔却一直不知如何写, 就像我想不起什么时候退游的。<br>很遗憾没好好告别, 也许正是想写下此篇的原因。<br>故事开头总是这样，适逢其会，猝不及防。 故事的结局总是这样，花开两朵，天各一方。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306220200184.jpg" alt="售出时间2020.08.13" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">售出时间2020.08.13</span></div></div><p>关于光遇. 想起什么会再回来补充。<br>感谢陈星汉团队与光遇友人。</p><p><span style="float:right">——幼稚鬼</span></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;谨以此文记录光遇&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="第九艺术" scheme="https://blog.thatcoder.cn/categories/%E7%AC%AC%E4%B9%9D%E8%89%BA%E6%9C%AF/"/>
    
    
    <category term="Game" scheme="https://blog.thatcoder.cn/tags/Game/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu UOS统信 双显卡外接屏显示问题</title>
    <link href="https://blog.thatcoder.cn/UOS-Nvidia/"/>
    <id>https://blog.thatcoder.cn/UOS-Nvidia/</id>
    <published>2023-06-04T10:00:00.000Z</published>
    <updated>2023-12-30T20:17:08.316Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>23年农历年初把电脑双系统的Ubuntu换成统信UOS。安装方法是官网的<a href="https://www.7uos.com/uos-azq.html">安装工具</a>。<br>安装过程异常顺利, 但完成后遇到显示屏只亮笔记本的, 原因显卡只使用了核显(知道原因还是能救的)。并尝试如下补救方法:</p><ol><li>走原Ubuntu安装N卡驱动流程只亮了外接屏幕, 笔记本屏幕黑屏! <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_annoyed.png"/></span></li><li>加入官方微信群交流, 工作人员建议尝试UOS软件商店的驱动工具, 还是只亮笔记本的! <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_spit_blodd.png"/></span></li></ol><p>最后在第一种方法的基础上手动添加<strong>xorg.conf文件</strong>得已解决。适用基于Ubuntu与其分支系统。</p><h2 id="xorg-conf"><a href="#xorg-conf" class="headerlink" title="xorg.conf"></a>xorg.conf</h2><blockquote><p>xorg.conf文件是Linux中用来配置X Window系统的配置文件，它通常存储在&#x2F;etc&#x2F;X11&#x2F;目录下。它的主要目的是控制您的图形卡及其连接显示器的设置和选项。<br>PS: Ubuntu系统中在目录&#x2F;etc&#x2F;X11下默认已经没有了文件xorg.conf，为了方便调整显示器的分辨率，可以通过重新生文件xorg.conf来达到目的</p></blockquote><p>如下是我的xorg.conf配置, 仅作参考</p><figure class="highlight plaintext"><figcaption><span>xorg.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs editorconfig"># 定义了布局信息，包含一个名为“layout”的标识符<br># 并设置为使用&quot;NVIDIA&quot;作为屏幕0，同时“intel”处于非活动状态。<br>Section &quot;ServerLayout&quot;<br>    Identifier &quot;layout&quot;<br>    Screen 0 &quot;nvidia&quot;<br>    Inactive &quot;intel&quot;<br>EndSection<br><br># 定义了&quot;NVIDIA&quot;设备、标识符、驱动程序和总线ID等信息<br>Section &quot;Device&quot;<br>    Identifier &quot;nvidia&quot;<br>    Driver &quot;nvidia&quot;<br>    BusID  &quot;PCI:1:0:0&quot;<br>EndSection<br><br># 将&quot;NVIDIA&quot;设备和标识符链接到一起<br>Section &quot;Screen&quot;<br>    Identifier &quot;nvidia&quot;<br>    Device &quot;nvidia&quot;<br>    Option  &quot;AccelMethod&quot;  &quot;sna&quot;<br>    Option &quot;TearFree&quot; &quot;True&quot;<br>    Option &quot;Tiling&quot;   &quot;True&quot;<br>    Option &quot;SwapbuffersWait&quot; &quot;True&quot;<br>EndSection<br><br># 定义了&quot;Intel&quot;设备，并将驱动程序设置为modesetting<br>Section &quot;Device&quot;<br>    Identifier &quot;intel&quot;<br>    Driver &quot;modesetting&quot;<br>    BusID  &quot;PCI:0:2:0&quot;<br>    Option &quot;AllowEmptyInitialConfiguration&quot; &quot;Yes&quot;<br>EndSection<br><br># 将&quot;Intel&quot;设备和标识符链接到一起<br>Section &quot;Screen&quot;<br>    Identifier &quot;intel&quot;<br>    Device &quot;intel&quot;<br>EndSection    <br><br>Section &quot;Files&quot;<br>EndSection<br></code></pre></td></tr></table></figure><p>其中BusID等信息可以通过命令获取, BusID就是开头的诸如 <code>1:0</code>,<code>0:2</code> 之类的</p><div class="tag-plugin copy"><input class="copy-area" id="copy_9" value="lspci -vnn | grep NVIDIA"><button class="copy-btn" onclick="util.copy(&quot;copy_9&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>同时这个配置能直接操作输出信息等, 修改不当易黑屏, 慎用!</p><h2 id="何算成功"><a href="#何算成功" class="headerlink" title="何算成功"></a>何算成功</h2><p>成功配置输出后会使用N卡, 打印N卡信息即可复查</p><ol><li><p>N卡信息 设置面板有读取信息常为成功。命令: <code>nvidia-settings</code><br><img src="https://upyun.thatcdn.cn/myself/typora/202306042319139.png"></p></li><li><p>GPU信息 GPU有使用率定为成功。命令: <code>nvidia-smi</code><br><img src="https://upyun.thatcdn.cn/myself/typora/202306042321245.png"></p></li></ol><h2 id="尾声"><a href="#尾声" class="headerlink" title="尾声"></a>尾声</h2><p>这篇本打算当时写完, 但解决问题后愉快的使用系统去了, 昨天看了一眼UOS发送给Window的文件夹有上面两张图片才想起。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_zhoumei.png"/></span></p>]]></content>
    
    
    <summary type="html">解决基于Ubuntu系统的双显卡双显示屏的异常问题</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="Linux" scheme="https://blog.thatcoder.cn/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Flomo浮墨数据迁移至Memos</title>
    <link href="https://blog.thatcoder.cn/FlomoToMemos/"/>
    <id>https://blog.thatcoder.cn/FlomoToMemos/</id>
    <published>2023-05-11T11:23:00.000Z</published>
    <updated>2024-02-10T14:51:19.706Z</updated>
    
    <content type="html"><![CDATA[<h2 id="碎碎念"><a href="#碎碎念" class="headerlink" title="碎碎念"></a>碎碎念</h2><blockquote><p>以前喜欢捣腾笔记软件, 然在两年前遇到 <a href="https://flomoapp.com/">Flomo</a> (一款功能相当简约毫不起眼的APP)。<br>一年后我发现我使用它的频率是所有笔记APP里最高的! (最长是<code>Obsidian</code>)</p><p>然后被 <a href="https://cubox.pro/">Cubox</a> 取代, 诚然也有可能是 <code>Flomo</code> 过期我没续费。</p><p>今年初看到memos项目, 便萌生了继续使用<code>Flomo</code>(用<code>memos</code>代替)。因为 <code>Cubox</code> 更多的是琐碎时间浏览到需要的资料或者感兴趣的资料,<br>就转发到 <code>Cubox</code> 里面, 抽空再整理 <code>Cubox</code> 即可。<code>Cubox</code> 不太适合记录突发奇想、文摘、待办事项、感悟等内容。</p><p>这篇便是实现年初的想法, 把flomo全部数据转到memos! 开工!</p></blockquote><ul><li>2023.8.18修改适配Memos的0.14版本</li><li>2023.8.18修改支持创建时间一致</li><li>2024.2.10修改适配Memos的0.19版本<ul><li>但是这次不支持时间同步,设置的时间参数不被memos接收</li></ul></li></ul><h2 id="迁移思路"><a href="#迁移思路" class="headerlink" title="迁移思路"></a>迁移思路</h2><blockquote><p>实现挺简单的, 但在git没看到完整的轮子, 便自己完善</p></blockquote><ol><li>将flomo浮墨导出的数据转成json文件  (这步其实有一个轮子<a href="https://github.com/Alwayfeels/flomoParse">flomoParse</a><br>,但让使用的人不用折腾两个不同语言项目就一起写成了python代码)</li><li>读取json文件将内容和附件图片等通过API上传到自己的memos</li></ol><h2 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h2><p>实现在这里就不赘述, 代码比较明了。中途倒是遇到一个 python 实现 <code>multipart/form-data; boundary=&#123;boundary&#125;</code> 切片上传(<br>直接上传整个图片文件会限制大小)的小问题 有空记录一下。</p><figure class="highlight python"><figcaption><span>multipart切片</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">upFile</span>(<span class="hljs-params">filePath</span>):<br>    boundary = <span class="hljs-string">&#x27;----ThatCoder.cn&#x27;</span>  <span class="hljs-comment"># 切片标识符</span><br>    fileName = filePath.split(<span class="hljs-string">&#x27;/&#x27;</span>)[-<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;flomo/&quot;</span> + filePath, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:  <span class="hljs-comment"># 读取二进制文件内容</span><br>        file_data = f.read()<br>    <span class="hljs-comment"># payload的encode()一个也不能删!!!</span><br>    payload = <span class="hljs-string">f&#x27;--<span class="hljs-subst">&#123;boundary&#125;</span>\r\nContent-Disposition: form-data; name=&quot;file&quot;;&#x27;</span>.encode()<br>    payload += <span class="hljs-string">f&#x27;filename=&quot;<span class="hljs-subst">&#123;fileName&#125;</span>&quot;\r\nContent-Type: <span class="hljs-subst">&#123;getType(fileName)&#125;</span>\r\n\r\n&#x27;</span>.encode()<br>    payload += file_data<br>    payload += <span class="hljs-string">f&#x27;\r\n--<span class="hljs-subst">&#123;boundary&#125;</span>--&#x27;</span>.encode()<br>    headers = Headers<br>    headers[<span class="hljs-string">&#x27;Content-Length&#x27;</span>] = <span class="hljs-built_in">str</span>(os.path.getsize(<span class="hljs-string">&quot;flomo/&quot;</span> + filePath))<br>    headers[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] = <span class="hljs-string">f&#x27;multipart/form-data; boundary=<span class="hljs-subst">&#123;boundary&#125;</span>&#x27;</span><br>    response = requests.post(ApiBlob, headers=headers, data=payload)  <span class="hljs-comment"># files参数上传方案 requests_toolbelt包</span><br>    <span class="hljs-keyword">return</span> response.json()<br></code></pre></td></tr></table></figure><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>项目README有图文讲解, 本篇用来防止提问的人(大概率没有)找不到地方。<br>项目地址: <a href="https://github.com/ThatCoders/FlomoToMemos">FlomoToMemos</a></p><p>PS: 注意对应memos版本的分支</p><h2 id="浮墨浅谈"><a href="#浮墨浅谈" class="headerlink" title="浮墨浅谈"></a>浮墨浅谈</h2><div class="tag-plugin swiper fancybox" id="swiper-api" effect="cards"><div class="swiper-wrapper"><div class="swiper-slide"><img no-lazy src="https://upyun.thatcdn.cn/myself/typora/202305120118826.jpg" alt="少楠"></div><div class="swiper-slide"><img no-lazy src="https://upyun.thatcdn.cn/myself/typora/202305120118565.jpg" alt="Flomo共建群"></div></div><div class="swiper-pagination"></div><div class="swiper-button-prev blur"></div><div class="swiper-button-next blur"></div></div><br>昔者时光溢畅，余悠然自得，好炼煉微型软件。遇上浮墨，其简洁明了，且颜值甚高，遂投身其共修群聊。见开发者努力谋取，且妙趣横生，群友问题皆一一回复，群谈也和蔼可亲。证明喜欢一项产品，一部分为赏识开发团队之风采与行事方式。惟后来，再无后续之因缘。(GPT)]]></content>
    
    
    <summary type="html">将Flomo浮墨导出的数据内容和附件图片等通过API上传到memos</summary>
    
    
    
    <category term="堆栈" scheme="https://blog.thatcoder.cn/categories/%E5%A0%86%E6%A0%88/"/>
    
    
    <category term="Memos" scheme="https://blog.thatcoder.cn/tags/Memos/"/>
    
  </entry>
  
  <entry>
    <title>《星际拓荒》</title>
    <link href="https://blog.thatcoder.cn/game/Outer%20Wilds/"/>
    <id>https://blog.thatcoder.cn/game/Outer%20Wilds/</id>
    <published>2023-03-23T10:00:00.000Z</published>
    <updated>2023-12-30T20:26:32.179Z</updated>
    
    <content type="html"><![CDATA[<div class="tag-plugin quot"><h1 class="content" id="Little Nightmares" type="text"><a href="#Little Nightmares" class="headerlink" title="Little Nightmares"></a><span class="empty"></span><span class="text">Little Nightmares</span><span class="empty"></span></h1></div><div class="GameTags"><a class="tag-plugin colorful hashtag" color="green"><svg t="1701408144765" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4228" width="200" height="200"><path d="M426.6 64.8c34.8 5.8 58.4 38.8 52.6 73.6l-19.6 117.6h190.2l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6s58.4 38.8 52.6 73.6l-19.4 117.6H896c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-42.6 256H832c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.6-117.4h-190.4l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.4-117.8H128c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l42.6-256H192c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6z m11.6 319.2l-42.6 256h190.2l42.6-256h-190.2z" p-id="4229"></path></svg><span>7+</span></a>&nbsp;<a class="tag-plugin colorful hashtag" color="yellow"><svg t="1701408144765" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4228" width="200" height="200"><path d="M426.6 64.8c34.8 5.8 58.4 38.8 52.6 73.6l-19.6 117.6h190.2l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6s58.4 38.8 52.6 73.6l-19.4 117.6H896c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-42.6 256H832c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.6-117.4h-190.4l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.4-117.8H128c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l42.6-256H192c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6z m11.6 319.2l-42.6 256h190.2l42.6-256h-190.2z" p-id="4229"></path></svg><span>太空</span></a>&nbsp;<a class="tag-plugin colorful hashtag" color="yellow"><svg t="1701408144765" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4228" width="200" height="200"><path d="M426.6 64.8c34.8 5.8 58.4 38.8 52.6 73.6l-19.6 117.6h190.2l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6s58.4 38.8 52.6 73.6l-19.4 117.6H896c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-42.6 256H832c35.4 0 64 28.6 64 64s-28.6 64-64 64h-137.8l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.6-117.4h-190.4l-23 138.6c-5.8 34.8-38.8 58.4-73.6 52.6s-58.4-38.8-52.6-73.6l19.4-117.8H128c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l42.6-256H192c-35.4 0-64-28.6-64-64s28.6-64 64-64h137.8l23-138.6c5.8-34.8 38.8-58.4 73.6-52.6z m11.6 319.2l-42.6 256h190.2l42.6-256h-190.2z" p-id="4229"></path></svg><span>解密</span></a></div><div class="tag-plugin image"><div class="image-bg"><img src="https://upyun.thatcdn.cn/myself/typora/202306180122037.jpg" alt="游戏封面与音乐" data-fancybox="true"/></div><div class="image-meta"><span class="image-caption center">游戏封面与音乐</span></div></div><iframe style="width: 100%" frameborder="no" border="0" marginwidth="0" marginheight="0" height=86 src="//music.163.com/outchain/player?type=2&id=1903408778&auto=1&height=66"></iframe><div class="tag-plugin quot"><h2 class="content" id="前言" type="icon"><a href="#前言" class="headerlink" title="前言"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">前言</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></h2></div>我知道这是一款很神奇的游戏, 但玩后我还是想说: 真TMD牛逼! 这才是第九艺术! <div class="tag-plugin quot"><h2 class="content" id="游戏发展史" type="icon"><a href="#游戏发展史" class="headerlink" title="游戏发展史"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">游戏发展史</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></h2></div><div class="tag-plugin timeline"><div class="timenode" index="0"><div class="header">2012年</div><div class="body fs14"><div class="tag-plugin tabs"id="tab_21"><div class="nav-tabs"><div class="tab active"><a href="#tab_21-1">一个硕士的学生项目</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_21-1"><p>南加州大学Alex通过游戏展示海森堡提出的<a href="https://www.zhihu.com/topic/19612088/intro">不确定性原理</a></p></div></div></div></div></div><div class="timenode" index="1"><div class="header">2013年</div><div class="body fs14"><div class="tag-plugin tabs"id="tab_22"><div class="nav-tabs"><div class="tab active"><a href="#tab_22-1">初次会面</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_22-1"><p>在demo day冈政伟一见钟情星际拓荒demo, 但Alex去了微软</p></div></div></div></div></div><div class="timenode" index="2"><div class="header">2014年</div><div class="body fs14"><div class="tag-plugin tabs"id="tab_23"><div class="nav-tabs"><div class="tab active"><a href="#tab_23-1">Alex回归</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_23-1"><p>Alex加入Mobius</p></div></div></div></div></div><div class="timenode" index="3"><div class="header">2015年</div><div class="body fs14"><div class="tag-plugin tabs"id="tab_24"><div class="nav-tabs"><div class="tab active"><a href="#tab_24-1">公开Alpha版本</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_24-1"><p>获麦克纳利大奖, 3万刀, fig众筹</p></div></div></div></div></div><div class="timenode" index="4"><div class="header">2019年05月30日</div><div class="body fs14"><div class="tag-plugin tabs"id="tab_25"><div class="nav-tabs"><div class="tab active"><a href="#tab_25-1">游戏发行</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_25-1"><p>感谢马丁的美术</p></div></div></div></div></div></div><div class="tag-plugin quot"><h2 class="content" id="游戏介绍" type="icon"><a href="#游戏介绍" class="headerlink" title="游戏介绍"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">游戏介绍</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></h2></div><p>任何剧情的介绍都是在浪费这款游戏, 如果您没有 晕3D、深海恐惧症, 并且有一颗探索宇宙的心。</p><p><strong>答案在最危险的太空中等着您。</strong></p><div class="tag-plugin quot"><h2 class="content" id="尾声" type="icon"><a href="#尾声" class="headerlink" title="尾声"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">尾声</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></h2></div><p>拨开很多游戏光鲜亮丽的美术外衣, 本质是从这个地图位置到另一个地图位置击杀一个单位完成一个问号的过程, 亦或是纯数值游戏。</p><p>而《星际拓荒》让我回到了游戏最开始的纯粹, 没有数值没有升级没有装备没有金币没有地图问号。 甚至问NPC我该干嘛 他会回答:”<br>你是去月球还是碎空星，还是去木炉星的另一侧都无所谓。对我来说都一样。快去吧，好好玩儿!”, 我猜他还想补一句: “<br>别打扰老子烤棉花!”</p><p>很想分享游戏途中的一些惊奇, 但非常影响初玩者体验, 作罢!</p><p>如果你要游玩, 我想转告你: <strong>“这里充满了恐惧与孤独，但是一点浪漫即可将其全部驱散。”</strong></p><div class="tag-plugin quot"><h2 class="content" id="下载地址" type="icon"><a href="#下载地址" class="headerlink" title="下载地址"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">下载地址</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></h2></div><div class="tag-plugin tabs" align="center"id="tab_26"><div class="nav-tabs"><div class="tab active"><a href="#tab_26-1">密码栏</a></div><div class="tab"><a href="#tab_26-2">下载栏</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_26-1"><p><mark class="tag-plugin colorful mark" color="warning">云盘密码</mark><div class="tag-plugin copy"><input class="copy-area" id="copy_14" value="dq0c"><button class="copy-btn" onclick="util.copy(&quot;copy_14&quot;,&quot;复制成功&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div></p></div><div class="tab-pane" id="tab_26-2"><div class="tag-plugin link dis-select"><a class="link-card plain" title="星际拓荒" href="https://cloud.189.cn/web/share?code=VV3uAbNfUj2u" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">星际拓荒</span><span class="cap link footnote">https://cloud.189.cn/web/share?code=VV3uAbNfUj2u</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div></div></div></div><div class="tag-plugin quot"><p class="content" type="icon"><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e092ff.png" /><span class="text">有能力一定入正喔!</span><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e0ab55.png" /></p></div><div class="tag-plugin link dis-select"><a class="link-card plain" title="星际拓荒-steam正版" href="https://store.steampowered.com/app/753640/Outer_Wilds/" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">星际拓荒-steam正版</span><span class="cap link footnote">https://store.steampowered.com/app/753640/Outer_Wilds/</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/link/8f277b4ee0ecd.svg"></div></div></a></div>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;tag-plugin quot&quot;&gt;&lt;h1 class=&quot;content&quot; id=&quot;Little Nightmares&quot; type=&quot;text&quot;&gt;&lt;a href=&quot;#Little Nightmares&quot; class=&quot;headerlink&quot; title=&quot;L</summary>
      
    
    
    
    <category term="第九艺术" scheme="https://blog.thatcoder.cn/categories/%E7%AC%AC%E4%B9%9D%E8%89%BA%E6%9C%AF/"/>
    
    
    <category term="Game" scheme="https://blog.thatcoder.cn/tags/Game/"/>
    
  </entry>
  
  <entry>
    <title>您名下已备案网站目前涉及违法信息</title>
    <link href="https://blog.thatcoder.cn/%E6%82%A8%E5%90%8D%E4%B8%8B%E5%B7%B2%E5%A4%87%E6%A1%88%E7%BD%91%E7%AB%99%E7%9B%AE%E5%89%8D%E6%B6%89%E5%8F%8A%E8%BF%9D%E6%B3%95%E4%BF%A1%E6%81%AF/"/>
    <id>https://blog.thatcoder.cn/%E6%82%A8%E5%90%8D%E4%B8%8B%E5%B7%B2%E5%A4%87%E6%A1%88%E7%BD%91%E7%AB%99%E7%9B%AE%E5%89%8D%E6%B6%89%E5%8F%8A%E8%BF%9D%E6%B3%95%E4%BF%A1%E6%81%AF/</id>
    <published>2023-03-04T08:00:00.000Z</published>
    <updated>2023-09-18T15:28:14.959Z</updated>
    
    <content type="html"><![CDATA[<h2 id="故事的开始"><a href="#故事的开始" class="headerlink" title="故事的开始"></a>故事的开始</h2><ul><li>2号写单写的有点晚, 次日九点在睡梦中被电话惊醒, 一看是天翼就给他挂了继续睡 (已经忘记服务器就在天翼 <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_face_cry.png"/></span> )</li><li>3号下午收到一封邮件说这件事<br><img src="https://upyun.thatcdn.cn/myself/typora/202303041724446.png"></li><li>3号晚上发现这封邮件时我的服务器已经被封了端口 80 和 443 <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_annoyed.png"/></span></li></ul><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><ol><li>按邮件查找相应内容并删除 <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_spit_blodd.png"/></span></li><li>删除完致电邮件里的联系方式并告诉客服原因与IP</li><li>等待客服审核对应内容与回电 (客服声音真好听 <span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_doge.png"/></span> )</li></ol><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>懒得排查了, 那个服务器坐等过期.<br>可能是wordpress主题的原因, 有些链接被攻击成了成人网站, 导致我站包含链接网站.</p><p>总之碰到类似情况不要慌, 按邮件做即可.</p>]]></content>
    
    
    <summary type="html">有些链接被攻击成违法网站, 导致我站包含链接网站.</summary>
    
    
    
    <category term="生活" scheme="https://blog.thatcoder.cn/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="随笔" scheme="https://blog.thatcoder.cn/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>邮件样式模板集</title>
    <link href="https://blog.thatcoder.cn/%E9%82%AE%E7%AE%B1%E6%A8%A1%E6%9D%BF%E9%9B%86/"/>
    <id>https://blog.thatcoder.cn/%E9%82%AE%E7%AE%B1%E6%A8%A1%E6%9D%BF%E9%9B%86/</id>
    <published>2023-02-16T05:03:31.000Z</published>
    <updated>2024-07-20T12:59:50.251Z</updated>
    
    <content type="html"><![CDATA[<h2 id="薇尔莉特"><a href="#薇尔莉特" class="headerlink" title="薇尔莉特"></a>薇尔莉特</h2><blockquote><p><strong>动漫来源出自</strong>: <a href="https://www.bilibili.com/bangumi/media/md8892/"><strong>紫罗兰永恒花园</strong></a><br><strong>邮件模板作者</strong>: 旧版作者未知, 我是在<a href="https://akilar.top/posts/e2d3c450/">Akilar</a>看到的改版.</p></blockquote><figure class="highlight html"><figcaption><span>薇尔莉特</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">base</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;scrollbar&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;</span><span class="language-css">::-webkit-scrollbar &#123;</span><br><span class="language-css">        <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span> <span class="hljs-meta">!important</span></span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><br><span class="language-css">    pre &#123;</span><br><span class="language-css">        <span class="hljs-attribute">white-space</span>: pre-wrap <span class="hljs-meta">!important</span>;</span><br><span class="language-css">        <span class="hljs-attribute">word-wrap</span>: break-word <span class="hljs-meta">!important</span>;</span><br><span class="language-css">        *<span class="hljs-attribute">white-space</span>: normal <span class="hljs-meta">!important</span></span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><br><span class="language-css">    pre &#123;</span><br><span class="language-css">        <span class="hljs-attribute">white-space</span>: pre-wrap <span class="hljs-meta">!important</span>;</span><br><span class="language-css">        <span class="hljs-attribute">word-wrap</span>: break-word <span class="hljs-meta">!important</span>;</span><br><span class="language-css">        *<span class="hljs-attribute">white-space</span>: normal <span class="hljs-meta">!important</span></span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-id">#letter</span> <span class="hljs-selector-tag">img</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">max-width</span>: <span class="hljs-number">300px</span></span><br><span class="language-css">    &#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;from-wrapstyle&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"><span class="hljs-selector-id">#form-wrap</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">overflow</span>: hidden;</span><br><span class="language-css">        <span class="hljs-attribute">height</span>: <span class="hljs-number">447px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">position</span>: relative;</span><br><span class="language-css">        <span class="hljs-attribute">top</span>: <span class="hljs-number">0px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">transition</span>: all <span class="hljs-number">1s</span> ease-in-out .<span class="hljs-number">3s</span>;</span><br><span class="language-css">        <span class="hljs-attribute">z-index</span>: <span class="hljs-number">0</span></span><br><span class="language-css">    &#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;from-wraphoverstyle&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"><span class="hljs-selector-id">#form-wrap</span><span class="hljs-selector-pseudo">:hover</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">height</span>: <span class="hljs-number">1300px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">top</span>: -<span class="hljs-number">200px</span></span><br><span class="language-css">    &#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 530px;margin: 20px auto 0;height: 1000px;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;form-wrap&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://upyun.thatcdn.cn/public/web/email_template/head_before.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;before&quot;</span></span><br><span class="hljs-tag">                             <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;position: absolute;bottom: 126px;left: 0px;background-repeat: no-repeat;width: 530px;height: 317px;z-index:-100&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;position: relative;overflow: visible;height: 1500px;width: 500px;margin: 0px auto;transition: all 1s ease-in-out .3s;padding-top:200px;&quot;</span></span><br><span class="hljs-tag">        &lt;<span class="hljs-attr">form</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background: white;width: 95%;max-width: 800px;margin: auto auto;border-radius: 5px;border: 1px solid;overflow: hidden;-webkit-box-shadow: 0px 0px 20px 0px rgba(0, 0, 0, 0.12);box-shadow: 0px 0px 20px 0px rgba(0, 0, 0, 0.18);&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:100%;overflow: hidden;&quot;</span></span><br><span class="hljs-tag">                     <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://upyun.thatcdn.cn/public/web/email_template/head_wely.jpg&quot;</span>/&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding: 5px 20px;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration: none; color: rgb(246, 214, 175);&quot;</span>&gt;</span>&#123;&#123; parent.nick &#125;&#125;，见信安：<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;letter&quot;</span></span><br><span class="hljs-tag">                         <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;overflow:auto;height:300px;width:100%;display:block;word-break: break-all;word-wrap: break-word;&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display: inline-block;&quot;</span>&gt;</span>您在<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration: none;color: rgb(246, 214, 175)&quot;</span></span><br><span class="hljs-tag">                                                                 <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span></span><br><span class="hljs-tag">                                                                 <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123;site.url&#125;&#125;&quot;</span>&gt;</span>⟬&#123;&#123; site.name &#125;&#125;⟭<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>上发表的评论:<br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;parentC&quot;</span></span><br><span class="hljs-tag">                             <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-bottom: #ddd 1px solid;border-left: #ddd 1px solid;padding-bottom: 20px;background-color: #eee;margin: 15px 0px;padding-left: 20px;padding-right: 20px;border-top: #ddd 1px solid;border-right: #ddd 1px solid;padding-top: 20px;font-family: &#x27;Arial&#x27;, &#x27;Microsoft YaHei&#x27; , &#x27;黑体&#x27; , &#x27;宋体&#x27; , sans-serif;&quot;</span>&gt;</span><br>                            &#123;&#123; parent.comment &#125;&#125;<br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>收到了来自&#123;&#123; self.nick &#125;&#125;的回复：<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selfC&quot;</span></span><br><span class="hljs-tag">                             <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-bottom: #ddd 1px solid;border-left: #ddd 1px solid;padding-bottom: 20px;background-color: #eee;margin: 15px 0px;padding-left: 20px;padding-right: 20px;border-top: #ddd 1px solid;border-right: #ddd 1px solid;padding-top: 20px;font-family: &#x27;Arial&#x27;, &#x27;Microsoft YaHei&#x27; , &#x27;黑体&#x27; , &#x27;宋体&#x27; , sans-serif;&quot;</span>&gt;</span><br>                            &#123;&#123; self.comment &#125;&#125;<br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: center;margin-top: 40px;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span></span><br><span class="hljs-tag">                            <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://upyun.thatcdn.cn/public/web/email_template/footer_bilibili.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;hr&quot;</span></span><br><span class="hljs-tag">                            <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:100%; margin:5px auto 5px auto; display: block;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span></span><br><span class="hljs-tag">                            <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-transform: uppercase;text-decoration: none;font-size: 14px;border: 2px solid #6c7575;color: #2f3333;padding: 10px;display: inline-block;margin: 10px auto 0;background-color: rgb(246, 214, 175);&quot;</span></span><br><span class="hljs-tag">                            <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123;site.postUrl&#125;&#125;&quot;</span>&gt;</span>&#123;&#123; parent.nick &#125;&#125;｜请您点击签收~<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size: 12px;text-align: center;color: #999;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>薇尔莉特·伊芙加登<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>自动书记人偶竭诚为您服务！<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>©2020-2023<span class="hljs-tag">&lt;<span class="hljs-name">a</span></span><br><span class="hljs-tag">                            <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none; color:rgb(246, 214, 175)&quot;</span></span><br><span class="hljs-tag">                            <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123;site.url&#125;&#125;&quot;</span>&gt;</span>&#123;&#123; site.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://upyun.thatcdn.cn/public/web/email_template/head_after.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;after&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;      position: absolute;bottom: -2px;left: 0;background-repeat: no-repeat;width: 530px;height: 259px;z-index:100&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="简洁渐变"><a href="#简洁渐变" class="headerlink" title="简洁渐变"></a>简洁渐变</h2><blockquote><p><strong>邮箱模板作者</strong>: 未知, 以前PHP站点扒的.</p></blockquote><figure class="highlight html"><figcaption><span>简洁渐变</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-radius: 10px 10px 10px 10px;font-size:14px;color: #555555;width: 666px;font-family:&#x27;Century Gothic&#x27;,&#x27;Trebuchet MS&#x27;,&#x27;Hiragino Sans GB&#x27;,微软雅黑,&#x27;Microsoft Yahei&#x27;,Tahoma,Helvetica,Arial,&#x27;SimSun&#x27;,sans-serif;margin:50px auto;border:1px solid #eee;max-width:100%;background: #ffffff repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 1px 5px rgba(0, 0, 0, 0.15);&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:100%;background:#49BDAD;color:#ffffff;border-radius: 10px 10px 0 0;background-image: -moz-linear-gradient(0deg, rgb(67, 198, 184), rgb(255, 209, 244));background-image: -webkit-linear-gradient(0deg, rgb(67, 198, 184), rgb(255, 209, 244));height: 66px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size:15px;word-break:break-all;padding: 23px 32px;margin:0;background-color: hsla(0,0%,100%,.4);border-radius: 10px 10px 0 0;&quot;</span>&gt;</span>您在<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none;color: #ffffff;&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123;site.url&#125;&#125;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>&#123;&#123;site.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>上的留言有新评论啦！<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin:40px auto;width:90%&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123;self.nick&#125;&#125; 回复说：<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background: #fafafa repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);margin:20px 0px;padding:15px;border-radius:5px;font-size:14px;color:#555555;&quot;</span>&gt;</span>&#123;&#123;self.comment | safe&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>您可以点击<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none; color:#12addb&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123;site.postUrl&#125;&#125;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>查看回复的完整內容<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>。<span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:link</span>&#123;<span class="hljs-attribute">text-decoration</span>:none&#125;<span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:visited</span>&#123;<span class="hljs-attribute">text-decoration</span>:none&#125;<span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span>&#123;<span class="hljs-attribute">text-decoration</span>:none&#125;<span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:active</span>&#123;<span class="hljs-attribute">text-decoration</span>:none&#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>`;<br>mailSubject: &#x27;&#123;&#123;parent.nick | safe&#125;&#125;，『&#123;&#123;site.name | safe&#125;&#125;』上的评论收到了回复&#x27;,<br>    mailTemplate: `<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-radius: 10px 10px 10px 10px;font-size:14px;color: #555555;width: 666px;font-family:&#x27;Century Gothic&#x27;,&#x27;Trebuchet MS&#x27;,&#x27;Hiragino Sans GB&#x27;,微软雅黑,&#x27;Microsoft Yahei&#x27;,Tahoma,Helvetica,Arial,&#x27;SimSun&#x27;,sans-serif;margin:50px auto;border:1px solid #eee;max-width:100%;background: #ffffff repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 1px 5px rgba(0, 0, 0, 0.15);&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:100%;background:#49BDAD;color:#ffffff;border-radius: 10px 10px 0 0;background-image: -moz-linear-gradient(0deg, rgb(67, 198, 184), rgb(255, 209, 244));background-image: -webkit-linear-gradient(0deg, rgb(67, 198, 184), rgb(255, 209, 244));height: 66px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size:15px;word-break:break-all;padding: 23px 32px;margin:0;background-color: hsla(0,0%,100%,.4);border-radius: 10px 10px 0 0;&quot;</span>&gt;</span>您在<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none;color: #ffffff;&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123;site.url&#125;&#125;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>&#123;&#123;site.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>上的留言有新回复啦！<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin:40px auto;width:90%&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hi, &#123;&#123;parent.nick&#125;&#125;，您曾在文章上发表评论：<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background: #fafafa repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);margin:20px 0px;padding:15px;border-radius:5px;font-size:14px;color:#555555;&quot;</span>&gt;</span>&#123;&#123;self.comment | safe&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>&#123;&#123;self.nick&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> 给您的回复如下：<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background: #fafafa repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);margin:20px 0px;padding:15px;border-radius:5px;font-size:14px;color:#555555;&quot;</span>&gt;</span>&#123;&#123;self.comment | safe&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>您可以点击<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none; color:#12addb&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123;site.postUrl&#125;&#125;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>查看回复的完整內容<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>，欢迎再次光临<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none; color:#12addb&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123;site.url&#125;&#125;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>&#123;&#123;site.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>。<span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size:12px;color:#b7adad&quot;</span>&gt;</span>本邮件为系统自动发送，请勿直接回复邮件哦，可到博文内容回复。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:link</span>&#123;<span class="hljs-attribute">text-decoration</span>:none&#125;<span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:visited</span>&#123;<span class="hljs-attribute">text-decoration</span>:none&#125;<span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span>&#123;<span class="hljs-attribute">text-decoration</span>:none&#125;<span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:active</span>&#123;<span class="hljs-attribute">text-decoration</span>:none&#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="简洁头图"><a href="#简洁头图" class="headerlink" title="简洁头图"></a>简洁头图</h2><blockquote><p><strong>邮件模板作者</strong>: SaraKale根据上面改的.</p></blockquote><figure class="highlight html"><figcaption><span>简洁头图</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background-image: url(https://npm.elemecdn.com/sarakale-assets@v1/Article/email/bg.jpg);;padding:20px 0px 20px;margin:0px;background-color:#ded8ca;width:100%;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background: url(https://npm.elemecdn.com/sarakale-assets@v1/Article/email/leisi-714x62.png) repeat-y scroll top;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-radius: 10px 10px 10px 10px;font-size:14px;color: #555555;width: 666px;font-family:&#x27;Century Gothic&#x27;,&#x27;Trebuchet MS&#x27;,&#x27;Hiragino Sans GB&#x27;,微软雅黑,&#x27;Microsoft Yahei&#x27;,Tahoma,Helvetica,Arial,&#x27;SimSun&#x27;,sans-serif;margin:50px auto;border:1px solid #eee;max-width:100%;background: #ffe8dd61;box-shadow: 0 1px 5px rgba(0, 0, 0, 0.15);margin:auto&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;headerimg no-lightbox entered loaded&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://npm.elemecdn.com/sarakale-assets@v1/bg/bg3.jpg&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:100%;overflow:hidden;pointer-events:none&quot;</span> <span class="hljs-attr">data-ll-status</span>=<span class="hljs-string">&quot;loaded&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:100%;color:#9d2850;border-radius: 10px 10px 0 0;background-image: -moz-linear-gradient(0deg, rgb(67, 198, 184), rgb(255, 209, 244));height: 66px;background: url(https://npm.elemecdn.com/sarakale-assets@v1/Article/email/line034_666x66.png) left top no-repeat;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size:16px;font-weight: bold;text-align:center;word-break:break-all;padding: 23px 32px;margin:0;border-radius: 10px 10px 0 0;&quot;</span>&gt;</span>您在<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none;color: #9d2850;&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123;site.url&#125;&#125;&quot;</span><span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>&#123;&#123;site.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>上的文章有了新的评论<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin:40px auto;width:90%;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>&#123;&#123;self.nick&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> 回复说：<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background: #fafafa repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);margin:20px 0px;padding:15px;border-radius:5px;font-size:15px;color:#555555;&quot;</span>&gt;</span>&#123;&#123;self.comment | safe&#125;&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>您可以点击<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none; color:#cf5c83&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123;site.postUrl&#125;&#125;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>查看回复的完整內容<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>`,<br>  mailSubject: &#x27;&#123;&#123;parent.nick&#125;&#125;，您在『&#123;&#123;site.name&#125;&#125;』上发表的评论收到了来自 &#123;&#123;self.nick&#125;&#125; 的回复&#x27;,<br>  mailTemplate: `<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background-image:url(https://npm.elemecdn.com/sarakale-assets@v1/Article/email/bg.jpg);;padding:20px 0px 20px;margin:0px;background-color:#ded8ca;width:100%;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background:url(https://npm.elemecdn.com/sarakale-assets@v1/Article/email/leisi-714x62.png) repeat-y scroll top;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-radius:10px 10px 10px 10px;font-size:14px;color:#555555;width:666px;font-family:&#x27;Century Gothic&#x27;,&#x27;Trebuchet MS&#x27;,&#x27;Hiragino Sans GB&#x27;,微软雅黑,&#x27;Microsoft Yahei&#x27;,Tahoma,Helvetica,Arial,&#x27;SimSun&#x27;,sans-serif;margin:50px auto;border:1px solid #eee;max-width:100%;background:#ffe8dd61;box-shadow:0 1px 5px rgba(0,0,0,0.15);margin:auto&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;headerimg no-lightbox entered loaded&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://npm.elemecdn.com/sarakale-assets@v1/bg/bg3.jpg&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:100%;overflow:hidden;pointer-events:none&quot;</span> <span class="hljs-attr">data-ll-status</span>=<span class="hljs-string">&quot;loaded&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:100%;border-radius:10px 10px 0 0;background-image:-moz-linear-gradient(0deg,rgb(67,198,184),rgb(255,209,244));height:66px;background:url(https://npm.elemecdn.com/sarakale-assets@v1/Article/email/line034_666x66.png) left top no-repeat;color:#9d2850;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size:16px;font-weight: bold;text-align:center;word-break:break-all;padding:23px 32px;margin:0;border-radius:10px 10px 0 0;&quot;</span>&gt;</span>您在<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none;color:#9d2850;&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123;site.url&#125;&#125;&quot;</span>&gt;</span>『&#123;&#123;site.name | safe&#125;&#125;』<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>上的留言有新回复啦！<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin:40px auto;width:90%;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hi，&#123;&#123;parent.nick&#125;&#125;，您曾在文章上发表评论：<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background:#fafafa repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow:0 2px 5px rgba(0,0,0,0.15);margin:20px 0px;padding:15px;border-radius:5px;font-size:15px;color:#555555;&quot;</span>&gt;</span>&#123;&#123;parent.comment | safe&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>&#123;&#123;self.nick&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> 给您的回复如下：<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background:#fafafa repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow:0 2px 5px rgba(0,0,0,0.15);margin:20px 0px;padding:15px;border-radius:5px;font-size:15px;color:#555555;&quot;</span>&gt;</span>&#123;&#123;self.comment | safe&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>您可以点击<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none;color:#cf5c83&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123;site.postUrl&#125;&#125;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span> 查看回复的完整內容 <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>，欢迎再次光临<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none;color:#cf5c83&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123;site.url&#125;&#125;&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span> &#123;&#123;site.name&#125;&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>。<br><span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size:14px;color:#b7adad&quot;</span>&gt;</span>本邮件为系统自动发送，请勿直接回复邮件哦，可到博文内容回复。<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>https://sarakale.top/blog<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="组装时间线测试"><a href="#组装时间线测试" class="headerlink" title="组装时间线测试"></a>组装时间线测试</h2><h3 id="网易云memos微信读书联合测试"><a href="#网易云memos微信读书联合测试" class="headerlink" title="网易云memos微信读书联合测试"></a>网易云memos微信读书联合测试</h3><div class="tag-plugin timeline ds-custom" api="https://netease.thatapi.cn/user/event?uid=134968139&limit=10"></div><div class="tag-plugin timeline ds-custom" api="https://memos.thatcoder.cn/api/v1/memos?filter=creator%3D%3D%27users%2F1%27&pageSize=10"></div><div class="tag-plugin timeline ds-custom" api="https://blog.thatcoder.cn/custom/test/ThatRead.json"></div><h3 id="memos单个测试"><a href="#memos单个测试" class="headerlink" title="memos单个测试"></a>memos单个测试</h3><p>标识符不同应该不会混淆进去</p><div class="tag-plugin timeline ds-custom" api="https://memos.thatcoder.cn/api/v1/memos?filter=creator%3D%3D%27users%2F1%27&pageSize=10"></div>]]></content>
    
    
    <summary type="html">散落在互联网各个角落的邮箱邮件样式模板...</summary>
    
    
    
    <category term="分享" scheme="https://blog.thatcoder.cn/categories/%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="邮件" scheme="https://blog.thatcoder.cn/tags/%E9%82%AE%E4%BB%B6/"/>
    
  </entry>
  
</feed>
