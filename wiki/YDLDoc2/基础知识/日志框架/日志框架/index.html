
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.33.1" theme-name="Stellar" theme-version="1.33.1">
  <link rel="canonical" href="https://blog.thatcoder.cn/wiki/YDLDoc2/基础知识/日志框架/日志框架">
  
  <meta name="generator" content="Hexo 7.3.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  <title>YDLDoc2：日志框架 - 钟意博客</title>

  
    <meta name="description" content="提示课程视频教程链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1434y1o73nopen in new window# 第一章 日志的概念# 一、概述​ 日志文件是用于记录系统操作事件的文件集合，可分为事件日志和消息日志。具有处理历史数据、诊断问题的追踪以及理解系统的活动等重要作用。​ 在计算机中，日志文件是记录在操作系统或其他软件运行中发生的事件或在通信软件的不同用户">
<meta property="og:type" content="website">
<meta property="og:title" content="日志框架">
<meta property="og:url" content="https://blog.thatcoder.cn/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/">
<meta property="og:site_name" content="钟意博客">
<meta property="og:description" content="提示课程视频教程链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1434y1o73nopen in new window# 第一章 日志的概念# 一、概述​ 日志文件是用于记录系统操作事件的文件集合，可分为事件日志和消息日志。具有处理历史数据、诊断问题的追踪以及理解系统的活动等重要作用。​ 在计算机中，日志文件是记录在操作系统或其他软件运行中发生的事件或在通信软件的不同用户">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.thatcoder.cn/favicon.ico">
<meta property="article:published_time" content="2025-07-21T12:21:47.838Z">
<meta property="article:modified_time" content="2025-07-21T12:21:47.838Z">
<meta property="article:author" content="钟意">
<meta property="article:tag" content="那个码农">
<meta property="article:tag" content="码农钟意">
<meta property="article:tag" content="钟意的博客">
<meta property="article:tag" content="钟意博客">
<meta property="article:tag" content="That Coder">
<meta property="article:tag" content="thatcoder">
<meta property="article:tag" content="源柒拾柒雅舍">
<meta property="article:tag" content="源WebGary">
<meta property="article:tag" content="giligili.work">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.thatcoder.cn/favicon.ico">
  
  

  <meta name="keywords" content="那个码农,码农钟意,钟意的博客,钟意博客,That Coder,thatcoder,源柒拾柒雅舍,源WebGary,giligili.work">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="钟意博客" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.33.1">


  
    <link rel="shortcut icon" href="/favicon.ico">
  

  
    
<link rel="stylesheet" href="/custom/css/ZYCode.css">

  

  <script type="application/ld+json">{"@context":"https://schema.org","@type":"Website","@id":"https://blog.thatcoder.cn/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/","author":{"@type":"Person","name":"钟意","sameAs":[],"image":"/favicon.ico"},"name":"日志框架","description":"提示课程视频教程链接：https://www.bilibili.com/video/BV1434y1o73nopen in new window# 第一章 日志的概念# 一、概述​ 日志文件是用于记录系统操作事件的文件集合，可分为事件日志和消息日志。具有处理历史数据、诊断问题的追踪以及理解系统的活动等重要作用。​ 在计算机中，日志文件是记录在操作系统或其他软件运行中发生的事件或在通信软件的不...","url":"https://blog.thatcoder.cn/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/","keywords":["那个码农","码农钟意","钟意的博客","钟意博客","That Coder","thatcoder","源柒拾柒雅舍","源WebGary","giligili.work"]}</script>
  <link rel="Shortcut Icon" href="/favicon.ico" type="image/x-icon" /><link rel='stylesheet' href='https://public.thatcdn.cn/font/old_song/result.css' /><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="/custom/css/ZYTimetmpl.css" /><meta itemprop="name" content="钟意博客"><meta itemprop="author" content="钟意"><meta itemprop="description" content="笔名钟意, 记录代码与生活."><meta name="sogou_site_verification" content="spLj7Zz5dI" /><meta itemprop="image" content="https://upyun.thatcdn.cn/hexo/stellar/image/shot.webp"><link rel="stylesheet" href="/custom/css/ZYGlobal.css"><link rel="stylesheet" href="/custom/css/ZYWaline.css"><link rel="stylesheet" href="/custom/css/ZYPage.css"><script type="text/javascript" src="/custom/js/header.js"></script><!-- Clarity tracking code for https://blog.thatcoder.cn/ -->
<script>    (function(c,l,a,r,i,t,y){        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i+"?ref=bwt";        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);    })(window, document, "clarity", "script", "fi1zg7i5q5");</script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H6GM3XZWV7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-H6GM3XZWV7');
</script>
<!-- BaiDu-ZhanZhang
<meta name="baidu-site-verification" content="codeva-8tnFVr706d" />
<!-- BaiDu-Tongji -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?233765a020502d5d6a92d4fe306d36c2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>
<body>



<div class="l_body s:aa content tech " id="start" layout="page" type="tech" ><aside class="l_left"><div class="sidebg"></div><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><div class="icon"><img no-lazy class="icon" src="/custom/img/ydl.png" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></div><a class="title" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot"><div class="main">YDLDoc2</div><div class="sub normal cap">关于YDLDoc的笔记</div><div class="sub hover cap" style="opacity:0"> 不对之处请指出</div></a></div></header>

<div class="nav-area">

<nav class="menu dis-select"><a class="nav-item" title="博客" href="/"><span>博客</span></a><a class="nav-item active" title="笔记" href="/wiki/"><span>笔记</span></a><a class="nav-item" title="便签" href="/notes/"><span>便签</span></a><a class="nav-item" title="社交" href="/links/"><span>社交</span></a></nav>
</div>
<div class="widgets">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" data-filter="/wiki/YDLDoc2/" placeholder="在 YDLDoc2 中搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<widget class="widget-wrapper doc-tree post-list"><div class="widget-body fs14"><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot/#start"><span class="toc-text">SpringBoot</span></a><a class="link" href="/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/maven%E5%85%A5%E9%97%A8/maven%E5%85%A5%E9%97%A8/"><span class="toc-text">maven入门</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/SpringSecurity/SpringSecurity/"><span class="toc-text">SpringSecurity</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/jpa/jpa/"><span class="toc-text">jpa</span></a><a class="link" href="/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%9F%BA%E7%A1%80%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%9F%BA%E7%A1%80%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="toc-text">基础设计模式</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/mybatisplus/mybatisplus/"><span class="toc-text">mybatisplus</span></a><a class="link active" href="/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/"><span class="toc-text">日志框架</span><svg class="active-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M21 11.098v4.993c0 3.096 0 4.645-.734 5.321c-.35.323-.792.526-1.263.58c-.987.113-2.14-.907-4.445-2.946c-1.02-.901-1.529-1.352-2.118-1.47a2.225 2.225 0 0 0-.88 0c-.59.118-1.099.569-2.118 1.47c-2.305 2.039-3.458 3.059-4.445 2.945a2.238 2.238 0 0 1-1.263-.579C3 20.736 3 19.188 3 16.091v-4.994C3 6.81 3 4.666 4.318 3.333C5.636 2 7.758 2 12 2c4.243 0 6.364 0 7.682 1.332C21 4.665 21 6.81 21 11.098" opacity=".5"/><path fill="currentColor" d="M9 5.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5z"/></svg></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/redis/redis/"><span class="toc-text">redis</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/ssm%E9%A1%B9%E7%9B%AE/ssm%E9%A1%B9%E7%9B%AE/"><span class="toc-text">ssm项目</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/mybatis/mybatis/"><span class="toc-text">mybatis</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/spring/spring/"><span class="toc-text">spring</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/springmvc/springmvc/"><span class="toc-text">springmvc</span></a></div></widget>

<widget class="widget-wrapper post-card"><div class="widget-header dis-select"><span class="name">更多：开发</span></div><div class="widget-body"><a class="item wiki" href="/wiki/YDLDoc1/javase/nio/nio/"><span class="title">元动力摘录 - JAVA阶段一</span><span class="excerpt">钟意关于YDLDoc的笔记</span></a><a class="item wiki" href="/wiki/YDLDoc3/ELK%E5%85%A5%E9%97%A8/elk%E5%85%A5%E9%97%A8/elk%E5%85%A5%E9%97%A8/"><span class="title">元动力摘录 - JAVA阶段三</span><span class="excerpt">钟意关于YDLDoc的笔记</span></a><a class="item wiki" href="/wiki/YDLDoc4/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E7%9F%AD%E4%BF%A1%E9%80%9A%E9%81%93/%E7%9F%AD%E4%BF%A1%E9%80%9A%E9%81%93/"><span class="title">元动力摘录 - JAVA项目阶段</span><span class="excerpt">钟意关于YDLDoc的笔记</span></a><a class="item wiki" href="/wiki/YuDaoBoot/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E5%9B%BE%E6%96%87/%E5%85%AC%E4%BC%97%E5%8F%B7%E5%9B%BE%E6%96%87/"><span class="title">艿艿若依Boot - 开发指南</span><span class="excerpt">关于艿艿若依Boot的文档</span></a><a class="item wiki" href="/wiki/YuDaoCloud/%E5%89%8D%E7%AB%AF%E6%89%8B%E5%86%8C%20Vue%203/Icon%20%E5%9B%BE%E6%A0%87/Icon%20%E5%9B%BE%E6%A0%87/"><span class="title">艿艿若依Cloud - 开发指南</span><span class="excerpt">关于艿艿若依Cloud的文档</span></a><a class="item wiki" href="/wiki/Laf/start/start/"><span class="title">Laf - 开箱即用的 serverless</span><span class="excerpt">钟意关于Laf的笔记</span></a><a class="item wiki" href="/wiki/MySql/basics/select/"><span class="title">MySql - 关系型数据库管理系统</span><span class="excerpt">钟意关于关系型数据库MySql的笔记</span></a><a class="item wiki" href="/wiki/SpringCloud/start/"><span class="title">SpringCloud - JAVA系分布式微服务架构</span><span class="excerpt">钟意关于SpringCloud的笔记</span></a></div></widget>

<widget class="widget-wrapper recent post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/wiki/forgejo/cache/"><span class="title"><strong>forgejo</strong><span class="dot"></span>Forgejo Redis缓存</span></a><a class="item title" href="/wiki/forgejo/s3/"><span class="title"><strong>forgejo</strong><span class="dot"></span>Forgejo S3存储桶</span></a><a class="item title" href="/wiki/forgejo/start/"><span class="title"><strong>forgejo</strong><span class="dot"></span>Forgejo 容器部署</span></a><a class="item title" href="/wiki/forgejo/ssh/"><span class="title"><strong>forgejo</strong><span class="dot"></span>Forgejo SSH端口修改</span></a><a class="item title" href="/notes/"><span class="title"><strong>便签</strong><span class="dot"></span>钟意的便签</span></a><a class="item title" href="/notes/develop/"><span class="title"><strong>开发速查</strong><span class="dot"></span>开发助手</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" style="grid-column: span 3;height:32px;padding: 0;" href="https://space.bilibili.com/1664687779" target="_blank" rel="external nofollow noopener noreferrer"><img height="32px" src="https://upyun.thatcdn.cn/public/img/icon/bilibili-banner.jpg"/></a><a class="social" style="grid-column: span 3;height:32px;padding: 0;" href="https://muselink.cc/naive" target="_blank" rel="external nofollow noopener noreferrer"><img height="32px" src="https://upyun.thatcdn.cn/public/img/icon/wechat-banner.jpg"/></a><a class="social" style="grid-column: span 3;height:32px;padding: 0;" href="https://github.com/ThatCoders" target="_blank" rel="external nofollow noopener noreferrer"><img height="32px" src="https://upyun.thatcdn.cn/public/img/icon/github-banner.jpg"/></a><a class="social" href="javascript:ThemeChange('dark');" rel="noopener noreferrer"><img id="ThemeM" src="https://upyun.thatcdn.cn/public/img/icon/Moon.png"/></a><a class="social" href="javascript:ThemeChange('light');" rel="noopener noreferrer"><img id="ThemeL" src="https://upyun.thatcdn.cn/public/img/icon/Sun.png"/></a><a class="social" href="javascript:ThemeChange('auto');" rel="noopener noreferrer"><img id="ThemeAI" src="https://upyun.thatcdn.cn/public/img/icon/AI.png"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
    <div class="content">
      <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" id="menu" href="/wiki/">文档</a><span class="sep"></span><a class="cap breadcrumb" id="proj" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot/">YDLDoc2</a></div>
<div class="flex-row" id="post-meta"><span class="text created">更新于：<time datetime="2025-07-21T12:21:47.838Z">2025-07-21</time></span></div></div><div class="right"><div class="flex-row" id="post-meta" style="justify-content: flex-end;">
            <span class="text updated" id="busuanzi_value_page_pv"></span><span class="text updated"> 阅</span>
            <span class="sep updated"></span>
            <span class="text">21.3k 字</span>
            <span class="sep"></span>
            <span class="text">98 分</span>
        </div></div></div>
      
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>日志框架</span></h1>
        
      </div>
    </div>
    
    </div>
    </div><article class="md-text content"><div class="theme-hope-content"><div class="hint-container tip"><p class="hint-container-title">提示</p><p>课程视频教程链接：<a href="https://www.bilibili.com/video/BV1434y1o73n" rel="noopener noreferrer" target="_blank">https://www.bilibili.com/video/BV1434y1o73n<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><h2 id="第一章-日志的概念" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第一章-日志的概念">#</a> 第一章 日志的概念</h2><h3 id="一、概述" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、概述">#</a> 一、概述</h3><p>​ 日志文件是用于记录系统操作事件的文件集合，可分为事件日志和消息日志。具有处理历史数据、诊断问题的追踪以及理解系统的活动等重要作用。</p><p>​ 在计算机中，日志文件是记录在操作系统或其他软件运行中发生的事件或在通信软件的不同用户之间的消息的文件。记录是保持日志的行为。在最简单的情况下，消息被写入单个日志文件。</p><h3 id="二、日志的作用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、日志的作用">#</a> 二、日志的作用</h3><ul><li><p>调试</p><p>在Java项目调试时，查看栈信息可以方便地知道当前程序的运行状态，输出的日志便于记录程序在之前的运行结果。如果你大量使用System.out或者System.err，这是一种最方便最有效的方法，但显得不够专业。</p></li><li><p>错误定位</p><p>不要以为项目能正确跑起来就可以高枕无忧，项目在运行一段时候后，可能由于数据问题，网络问题，内存问题等出现异常。这时日志可以帮助开发或者运维人员快速定位错误位置，提出解决方案。</p></li><li><p>数据分析</p><p>大数据的兴起，使得大量的日志分析成为可能，ELK也让日志分析门槛降低了很多。日志中蕴含了大量的用户数据，包括点击行为，兴趣偏好等，用户画像对于公司下一步的战略方向有一定指引作用。</p></li></ul><h3 id="三、接触过的日志" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、接触过的日志">#</a> 三、接触过的日志</h3><p>最简单的日志输出方式，我们每天都在使用：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(<span class="hljs-string">&quot;这个数的结果是：&quot;</span>+ num);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>以及错误日志：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">System.err.println(<span class="hljs-string">&quot;此处发生了异常&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>此类代码在程序的执行过程中没有什么实质的作用，但是却能打印一些中间变量，辅助我们调试和错误的排查。</p><p>日志系统我们也见过：</p><p>在tomcat中</p><figure><img alt="image-20211021105443307" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021105443307-a3ff32dd.png" tabindex="0"/><figcaption>image-20211021105443307</figcaption></figure><p>当我们的程序无法启动或者运行过程中产生问题，会有所记录，比如我的catalina.log中查看，发现确实有错误信息，这能帮我们迅速定位：</p><figure><img alt="image-20211021105553886" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021105553886-9a0eb0bf.png" tabindex="0"/><figcaption>image-20211021105553886</figcaption></figure><p>而我们的System.err只能做到控制台打印日志，所以我们需要更强大日志框架来处理：</p><h3 id="四、主流日志框架" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、主流日志框架">#</a> 四、主流日志框架</h3><ul><li><p>日志实现（具体干活的）：JUL（java util logging）、logback、log4j、log4j2</p></li><li><p>日志门面（指定规则的）：JCL（Jakarta Commons Logging）、slf4j（ Simple Logging Facade for Java）</p></li></ul><h2 id="第二章-jul日志框架" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第二章-jul日志框架">#</a> 第二章 JUL日志框架</h2><p>JUL全称Java util Logging是java原生的日志框架，使用时不需要另外引用第三方类库，相对其他日志框 架使用方便，学习简单，能够在小型应用中灵活使用。</p><p>在JUL中有以下组件，我们先做了解，慢慢学习：</p><ul><li>Loggers：被称为记录器，应用程序通过获取Logger对象，调用其API来来发布日志信息。Logger 通常时应用程序访问日志系统的入口程序。</li><li>Appenders：也被称为Handlers，每个Logger都会关联一组Handlers，Logger会将日志交给关联 Handlers处理，由Handlers负责将日志做记录。Handlers在此是一个抽象，其具体的实现决定了 日志记录的位置可以是控制台、文件、网络上的其他日志服务或操作系统日志等。</li><li>Layouts：也被称为Formatters，它负责对日志事件中的数据进行转换和格式化。Layouts决定了 数据在一条日志记录中的最终形式。</li><li>Level：每条日志消息都有一个关联的日志级别。该级别粗略指导了日志消息的重要性和紧迫，我 可以将Level和Loggers，Appenders做关联以便于我们过滤消息。</li><li>Filters：过滤器，根据需要定制哪些信息会被记录，哪些信息会被放过。</li></ul><p><strong>总结一下就是：</strong></p><p>​ 用户使用Logger来进行日志记录，Logger持有若干个Handler，日志的输出操作是由Handler完成的。 在Handler在输出日志前，会经过Filter的过滤，判断哪些日志级别过滤放行哪些拦截，Handler会将日志内容输出到指定位置（日志文件、控制台等）。Handler在输出日志时会使用Layout，将输出内容进行排版。</p><h3 id="一、入门案例" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、入门案例">#</a> 一、入门案例</h3><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-string">&quot;myLogger&quot;</span>);<br>    logger.info(<span class="hljs-string">&quot;信息&quot;</span>);<br>    logger.warning(<span class="hljs-string">&quot;警告信息&quot;</span>);<br>    logger.severe(<span class="hljs-string">&quot;严重信息&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img alt="image-20211021111645121" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021111645121-964a89ab.png" tabindex="0"/><figcaption>image-20211021111645121</figcaption></figure><h3 id="二、日志的级别" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、日志的级别">#</a> 二、日志的级别</h3><p>​ jul中定义的日志级别，从上述例子中我们也看到使用info和warning打印出的日志有不同的前缀，通过给日志设置不同的级别可以清晰的从日志中区分出哪些是基本信息，哪些是调试信息，哪些是严重的异常。</p><p>（1）java.util.logging.Level中定义了日志的级别：</p><ol><li>SEVERE（最高值）</li><li>WARNING</li><li>INFO （默认级别）</li><li>CONFIG</li><li>FINE</li><li>FINER</li><li>FINEST（最低值）</li></ol><p>再例如：我们查看tomcat的日志，能明显的看到不同级别的日志，其实tomcat默认使用的就是JUL：</p><figure><img alt="image-20211021112420933" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021112420933-acbc908d.png" tabindex="0"/><figcaption>image-20211021112420933</figcaption></figure><p>还有两个特殊的级别：</p><ul><li>OFF，可用来关闭日志记录。</li><li>ALL，启用所有消息的日志记录。</li></ul><p>虽然我们测试了7个日志级别，</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogger</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(LoggerTest.class.getName());<br>    logger.severe(<span class="hljs-string">&quot;severe&quot;</span>);<br>    logger.warning(<span class="hljs-string">&quot;warning&quot;</span>);<br>    logger.info(<span class="hljs-string">&quot;info&quot;</span>);<br>    logger.config(<span class="hljs-string">&quot;config&quot;</span>);<br>    logger.fine(<span class="hljs-string">&quot;fine&quot;</span>);<br>    logger.finer(<span class="hljs-string">&quot;finer&quot;</span>);<br>    logger.finest(<span class="hljs-string">&quot;finest&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们发现能够打印的只有三行，这是为什么呢？</p><figure><img alt="image-20211021112943297" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021112943297-146bb073.png" tabindex="0"/><figcaption>image-20211021112943297</figcaption></figure><p>我们找一下这个文件，下图是jdk11的日志配置文件：</p><figure><img alt="image-20211021113111605" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021113111605-8c77f1ae.png" tabindex="0"/><figcaption>image-20211021113111605</figcaption></figure><p>或者在jdk1.8中：</p><figure><img alt="image-20211021113311661" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021113311661-8a239252.png" tabindex="0"/><figcaption>image-20211021113311661</figcaption></figure><figure><img alt="image-20211021113415090" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021113415090-8c59f8f9.png" tabindex="0"/><figcaption>image-20211021113415090</figcaption></figure><p>就可以看到系统默认在控制台打印的日志级别了，系统配置我们暂且不动，一会我们独立创建配置文件完成修改。</p><p>但是我们可以简单的看看这个日志配置了哪些内容：</p><div class="language-properties line-numbers-mode" data-ext="properties"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight properties"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">.level</span>= <span class="hljs-string">INFO</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">############################################################</span><br><span class="hljs-comment"># Handler specific properties.</span><br><span class="hljs-comment"># Describes specific configuration info for Handlers.</span><br><span class="hljs-comment">############################################################</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># default file output is in user&#x27;s home directory.</span><br><span class="hljs-attr">java.util.logging.FileHandler.pattern</span> = <span class="hljs-string">%h/java%u.log</span><br><span class="hljs-attr">java.util.logging.FileHandler.limit</span> = <span class="hljs-string">50000</span><br><span class="hljs-attr">java.util.logging.FileHandler.count</span> = <span class="hljs-string">1</span><br><span class="hljs-comment"># Default number of locks FileHandler can obtain synchronously.</span><br><span class="hljs-comment"># This specifies maximum number of attempts to obtain lock file by FileHandler</span><br><span class="hljs-comment"># implemented by incrementing the unique field %u as per FileHandler API documentation.</span><br><span class="hljs-attr">java.util.logging.FileHandler.maxLocks</span> = <span class="hljs-string">100</span><br><span class="hljs-attr">java.util.logging.FileHandler.formatter</span> = <span class="hljs-string">java.util.logging.XMLFormatter</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Limit the message that are printed on the console to INFO and above.</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.level</span> = <span class="hljs-string">INFO</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.formatter</span> = <span class="hljs-string">java.util.logging.SimpleFormatter</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 在日志中我们发现了，貌似可以给这个日志对象添加各种handler就是处理器，比如ConsoleHandler专门处理控制台日志，FileHandler貌似可以处理文件，同时我们确实发现了他有这么一个方法：</p><figure><img alt="image-20211021114314901" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021114314901-e1fd4727.png" tabindex="0"/><figcaption>image-20211021114314901</figcaption></figure><h3 id="三、日志配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、日志配置">#</a> 三、日志配置</h3><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogConfig</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// 1.创建日志记录器对象</span><br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-string">&quot;com.ydlclass.log.JULTest&quot;</span>);<br>    <span class="hljs-comment">// 一、自定义日志级别</span><br>    <span class="hljs-comment">// a.关闭系统默认配置</span><br>    logger.setUseParentHandlers(<span class="hljs-literal">false</span>);<br>    <span class="hljs-comment">// b.创建handler对象</span><br>    <span class="hljs-type">ConsoleHandler</span> <span class="hljs-variable">consoleHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleHandler</span>();<br>    <span class="hljs-comment">// c.创建formatter对象</span><br>    <span class="hljs-type">SimpleFormatter</span> <span class="hljs-variable">simpleFormatter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleFormatter</span>();<br>    <span class="hljs-comment">// d.进行关联</span><br>    consoleHandler.setFormatter(simpleFormatter);<br>    logger.addHandler(consoleHandler);<br>    <span class="hljs-comment">// e.设置日志级别</span><br>    logger.setLevel(Level.ALL);<br>    consoleHandler.setLevel(Level.ALL);<br>    <span class="hljs-comment">// 二、输出到日志文件</span><br>    <span class="hljs-type">FileHandler</span> <span class="hljs-variable">fileHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>(<span class="hljs-string">&quot;d:/logs/jul.log&quot;</span>);<br>    fileHandler.setFormatter(simpleFormatter);<br>    logger.addHandler(fileHandler);<br>    <span class="hljs-comment">// 2.日志记录输出</span><br>    logger.severe(<span class="hljs-string">&quot;severe&quot;</span>);<br>    logger.warning(<span class="hljs-string">&quot;warning&quot;</span>);<br>    logger.info(<span class="hljs-string">&quot;info&quot;</span>);<br>    logger.config(<span class="hljs-string">&quot;config&quot;</span>);<br>    logger.fine(<span class="hljs-string">&quot;fine&quot;</span>);<br>    logger.finer(<span class="hljs-string">&quot;finer&quot;</span>);<br>    logger.finest(<span class="hljs-string">&quot;finest&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再次查看结果：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs text">10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig<br>严重: severe<br>10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig<br>警告: warning<br>10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig<br>信息: info<br>10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig<br>配置: config<br>10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig<br>详细: fine<br>10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig<br>较详细: finer<br>10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig<br>非常详细: finest<br><br>Process finished with exit code 0<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>文件中也输出了正确的结果：</p><figure><img alt="image-20211021115105181" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021115105181-2de920a7.png" tabindex="0"/><figcaption>image-20211021115105181</figcaption></figure><h3 id="四、-logger之间的父子关系" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、-logger之间的父子关系">#</a> 四、 Logger之间的父子关系</h3><p>​ JUL中Logger之间存在父子关系，这种父子关系通过树状结构存储，JUL在初始化时会创建一个顶层 RootLogger作为所有Logger父Logger，存储上作为树状结构的根节点。并父子关系通过名称来关联。默认子Logger会继承父Logger的属性。</p><figure><img alt="image-20211021123800692" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021123800692-5d6e86a9.png" tabindex="0"/><figcaption>image-20211021123800692</figcaption></figure><p>所有的logger实例都是由LoggerManager统一管理，不妨我们点进getLogger方法：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Logger <span class="hljs-title function_">demandLogger</span><span class="hljs-params">(String name, String resourceBundleName, Class&amp;lt;?&amp;gt; caller)</span> &#123;<br>    <span class="hljs-type">LogManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> LogManager.getLogManager();<br>    <span class="hljs-keyword">if</span> (!SystemLoggerHelper.disableCallerCheck) &#123;<br>        <span class="hljs-keyword">if</span> (isSystem(caller.getModule())) &#123;<br>            <span class="hljs-keyword">return</span> manager.demandSystemLogger(name, resourceBundleName, caller);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> manager.demandLogger(name, resourceBundleName, caller);<br>    <span class="hljs-comment">// ends up calling new Logger(name, resourceBundleName, caller)</span><br>    <span class="hljs-comment">// iff the logger doesn&#x27;t exist already</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以看到LogManager是单例的：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LogManager <span class="hljs-title function_">getLogManager</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (manager != <span class="hljs-literal">null</span>) &#123;<br>        manager.ensureLogManagerInitialized();<br>    &#125;<br>    <span class="hljs-keyword">return</span> manager;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogParent</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger1</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-string">&quot;com.ydlclass.service&quot;</span>);<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger2</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-string">&quot;com.ydlclass&quot;</span>);<br>    System.out.println(<span class="hljs-string">&quot;logger1 = &quot;</span> + logger1);<br>    System.out.println(<span class="hljs-string">&quot;logger1.getParent() = &quot;</span> + logger1.getParent());<br>    System.out.println(<span class="hljs-string">&quot;logger2 = &quot;</span> + logger2);<br>    System.out.println(<span class="hljs-string">&quot;logger2.getParent() = &quot;</span> + logger2.getParent());<br>    System.out.println(logger1.getParent() == logger2);<br>&#125;<br><br>结果：<br>logger1 = java.util.logging.Logger@2b4bac49<br>logger1.getParent() = java.util.logging.Logger<span class="hljs-meta">@fd07cbb</span><br>logger2 = java.util.logging.Logger<span class="hljs-meta">@fd07cbb</span><br>logger2.getParent() = java.util.logging.LogManager$RootLogger@3571b748<br><span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogParent</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger1</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-string">&quot;com.ydlclass.service&quot;</span>);<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger2</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-string">&quot;com.ydlclass&quot;</span>);<br>    <span class="hljs-comment">// 一、对logger2进行独立的配置</span><br>    <span class="hljs-comment">// 1.关闭系统默认配置</span><br>    logger2.setUseParentHandlers(<span class="hljs-literal">false</span>);<br>    <span class="hljs-comment">// 2.创建handler对象</span><br>    <span class="hljs-type">ConsoleHandler</span> <span class="hljs-variable">consoleHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleHandler</span>();<br>    <span class="hljs-comment">// 3.创建formatter对象</span><br>    <span class="hljs-type">SimpleFormatter</span> <span class="hljs-variable">simpleFormatter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleFormatter</span>();<br>    <span class="hljs-comment">// 4.进行关联</span><br>    consoleHandler.setFormatter(simpleFormatter);<br>    logger2.addHandler(consoleHandler);<br>    <span class="hljs-comment">// 5.设置日志级别</span><br>    logger2.setLevel(Level.ALL);<br>    consoleHandler.setLevel(Level.ALL);<br>    <span class="hljs-comment">// 测试logger1是否被logger2影响</span><br>    logger1.severe(<span class="hljs-string">&quot;severe&quot;</span>);<br>    logger1.warning(<span class="hljs-string">&quot;warning&quot;</span>);<br>    logger1.info(<span class="hljs-string">&quot;info&quot;</span>);<br>    logger1.config(<span class="hljs-string">&quot;config&quot;</span>);<br>    logger1.fine(<span class="hljs-string">&quot;fine&quot;</span>);<br>    logger1.finer(<span class="hljs-string">&quot;finer&quot;</span>);<br>    logger1.finest(<span class="hljs-string">&quot;finest&quot;</span>);<br>&#125;<br><br><br> <span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>严重: severe<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>警告: warning<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>信息: info<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>配置: config<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>详细: fine<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>较详细: finer<br><span class="hljs-number">10</span>月 <span class="hljs-number">21</span>, <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">45</span>:<span class="hljs-number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent<br>非常详细: finest<br><br>Process finished with exit code <span class="hljs-number">0</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="五、日志格式化" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#五、日志格式化">#</a> 五、日志格式化</h3><p>我们可以独立的实现日志格式化的Formatter，而不使用SimpleFormatter，我们可以做如下处理，最后返回的结果我们可以随意拼写：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Formatter</span> <span class="hljs-variable">myFormatter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Formatter</span>()&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(LogRecord record)</span> &#123;<br>        <span class="hljs-keyword">return</span> record.getLoggerName()+<span class="hljs-string">&quot;.&quot;</span> +record.getSourceMethodName() + <span class="hljs-string">&quot; &quot;</span> + LocalDateTime.ofInstant(record.getInstant(), ZoneId.systemDefault())+<span class="hljs-string">&quot;\r\n&quot;</span><br>            +record.getLevel()+<span class="hljs-string">&quot;: &quot;</span> +record.getMessage() + <span class="hljs-string">&quot;\r\n&quot;</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果为：</p><figure><img alt="image-20211021131248992" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021131248992-5b512b7e.png" tabindex="0"/><figcaption>image-20211021131248992</figcaption></figure><p>当然我们参考一下SimpleFormatter的该方法的实现：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// format string for printing the log record</span><br><span class="hljs-keyword">static</span> String <span class="hljs-title function_">getLoggingProperty</span><span class="hljs-params">(String name)</span> &#123;<br>    <span class="hljs-keyword">return</span> LogManager.getLogManager().getProperty(name);<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">format</span> <span class="hljs-operator">=</span><br>    SurrogateLogger.getSimpleFormat(SimpleFormatter::getLoggingProperty);<br><br><span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">zdt</span> <span class="hljs-operator">=</span> ZonedDateTime.ofInstant(<br>    record.getInstant(), ZoneId.systemDefault());<br><span class="hljs-keyword">return</span> String.format(format,<br>                     zdt,<br>                     source,<br>                     record.getLoggerName(),<br>                     record.getLevel().getLocalizedLevelName(),<br>                     message,<br>                     throwable);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个写法貌似比我们的写法高级一点，所以我们必须好好学一下String的format方法了。</p><h4 id="_1、string的format方法" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、string的format方法">#</a> 1、String的format方法</h4><p>String类的format()方法用于创建格式化的字符串以及连接多个字符串对象。</p><p>format()方法有两种重载形式：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(String format, Object... args)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Formatter</span>().format(format, args).toString();<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(Locale l, String format, Object... args)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Formatter</span>(l).format(format, args).toString();<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个方法中我们可以定义字符串模板，然后使用类似填空的方式将模板格式化成我们想要的结果字符串：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">java</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;hello %s&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>得到的结果就是hello world，我们可以把第一个参数当做模板， %s当做填空题，后边的可变参数当做答案。</p><h4 id="_2、常用的转换符" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、常用的转换符">#</a> 2、常用的转换符</h4><p>当然不同数据类型需要不同转换符完成字符串的转换，以下是不同类型的转化符列表：</p><table><thead><tr><th style="text-align:left;">转换符</th><th style="text-align:left;">详细说明</th><th style="text-align:left;">示例</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>%s</strong></td><td style="text-align:left;"><strong>字符串类型</strong></td><td style="text-align:left;"><strong>“喜欢请收藏”</strong></td></tr><tr><td style="text-align:left;">%c</td><td style="text-align:left;">字符类型</td><td style="text-align:left;">‘m’</td></tr><tr><td style="text-align:left;">%b</td><td style="text-align:left;">布尔类型</td><td style="text-align:left;">true</td></tr><tr><td style="text-align:left;"><strong>%d</strong></td><td style="text-align:left;"><strong>整数类型（十进制）</strong></td><td style="text-align:left;"><strong>88</strong></td></tr><tr><td style="text-align:left;">%x</td><td style="text-align:left;">整数类型（十六进制）</td><td style="text-align:left;">FF</td></tr><tr><td style="text-align:left;">%o</td><td style="text-align:left;">整数类型（八进制）</td><td style="text-align:left;">77</td></tr><tr><td style="text-align:left;"><strong>%f</strong></td><td style="text-align:left;"><strong>浮点类型</strong></td><td style="text-align:left;"><strong>8.888</strong></td></tr><tr><td style="text-align:left;">%a</td><td style="text-align:left;">十六进制浮点类型</td><td style="text-align:left;">FF.35AE</td></tr><tr><td style="text-align:left;">%e</td><td style="text-align:left;">指数类型</td><td style="text-align:left;">9.38e+5</td></tr><tr><td style="text-align:left;"><strong>%n</strong></td><td style="text-align:left;">换行符</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">%tx</td><td style="text-align:left;">日期与时间类型（x代表不同的日期与时间转换符)</td><td style="text-align:left;">后边详细说</td></tr></tbody></table><p>小例子：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.printf(<span class="hljs-string">&quot;过年了，%s今年%d岁了，今天收了%f元的压岁钱!&quot;</span>,<br>                <span class="hljs-string">&quot;小明&quot;</span>,<span class="hljs-number">5</span>,<span class="hljs-number">88.88</span>);<br><br>结果：<br>    过年了，小明今年<span class="hljs-number">5</span>岁了，今天收了<span class="hljs-number">88.880000</span>元的压岁钱!<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这要比拼写字符串简单多了。</p><h4 id="_3、特殊符号" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、特殊符号">#</a> 3、特殊符号</h4><p>接下来我们看几个特殊字符的常用搭配，可以实现一些高级功能：</p><table><thead><tr><th style="text-align:left;">标志</th><th style="text-align:left;">说明</th><th style="text-align:left;">示例</th><th style="text-align:left;">结果</th></tr></thead><tbody><tr><td style="text-align:left;">+</td><td style="text-align:left;">为正数或者负数添加符号，因为一般整数不会主动加符号</td><td style="text-align:left;">(“%+d”,15)</td><td style="text-align:left;">+15</td></tr><tr><td style="text-align:left;">0</td><td style="text-align:left;">数字前面补0，用于对齐</td><td style="text-align:left;">(“%04d”, 99)</td><td style="text-align:left;">0099</td></tr><tr><td style="text-align:left;">空格</td><td style="text-align:left;">在整数之前添加指定数量的空格</td><td style="text-align:left;">(“%4d”, 99)</td><td style="text-align:left;">99</td></tr><tr><td style="text-align:left;">,</td><td style="text-align:left;">以“,”对数字分组(常用显示金额)</td><td style="text-align:left;">(“%,f”, 9999.99)</td><td style="text-align:left;">9,999.990000</td></tr><tr><td style="text-align:left;">(</td><td style="text-align:left;">使用括号包含负数</td><td style="text-align:left;">(“%(f”, -99.99)</td><td style="text-align:left;">(99.990000)</td></tr></tbody></table><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">System.out.printf(&quot;过年了，%s今年%03d岁了，今天收了%,f元的压岁钱!&quot;,<br>                &quot;小明&quot;,5,8888.88);<br>                结果<br>        过年了，小明今年005岁了，今天收了8,888.880000元的压岁钱!        <br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>默认情况下，我们的可变参数是安装顺序依次替换，但是我想重复利用可变参数那该怎么处理呢？</p><p>我们可以采用 在转换符中加<code>数字$</code>完成匹配：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">System.out.printf(&quot;%1$s %1$s %1$s&quot;,&quot;小明&quot;);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>其中1<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>就代表第一个参数，那么</mtext><mn>2</mn></mrow><annotation encoding="application/x-tex">就代表第一个参数，那么2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord cjk_fallback">就代表第一个参数，那么</span><span class="mord">2</span></span></span></span>就代表第二个参数了：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">小明 小明 小明<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><h4 id="_4、日期处理" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、日期处理">#</a> 4、日期处理</h4><p>第一个例子中有说到 %tx x代表日期转换符 我也顺便列举下日期转换符</p><table><thead><tr><th style="text-align:left;">标志</th><th style="text-align:left;">说明</th><th style="text-align:left;">示例</th></tr></thead><tbody><tr><td style="text-align:left;">c</td><td style="text-align:left;">包括全部日期和时间信息</td><td style="text-align:left;">周四 10月 21 14:52:10 GMT+08:00 2021</td></tr><tr><td style="text-align:left;">F</td><td style="text-align:left;">“年-月-日”格式</td><td style="text-align:left;">2021-10-21</td></tr><tr><td style="text-align:left;">D</td><td style="text-align:left;">“月/日/年”格式</td><td style="text-align:left;">10/21/21</td></tr><tr><td style="text-align:left;">r</td><td style="text-align:left;">“HH:MM:SS PM”格式（12时制）</td><td style="text-align:left;">02:53:20 下午</td></tr><tr><td style="text-align:left;">T</td><td style="text-align:left;">“HH:MM:SS”格式（24时制）</td><td style="text-align:left;">14:53:39</td></tr><tr><td style="text-align:left;">R</td><td style="text-align:left;">“HH:MM”格式（24时制）</td><td style="text-align:left;">14:53</td></tr><tr><td style="text-align:left;">b</td><td style="text-align:left;">月份本地化</td><td style="text-align:left;">10月</td></tr><tr><td style="text-align:left;">y</td><td style="text-align:left;">两位的年</td><td style="text-align:left;">21</td></tr><tr><td style="text-align:left;">Y</td><td style="text-align:left;">四位的年</td><td style="text-align:left;">2021</td></tr><tr><td style="text-align:left;">m</td><td style="text-align:left;">月</td><td style="text-align:left;">10</td></tr><tr><td style="text-align:left;">d</td><td style="text-align:left;">日</td><td style="text-align:left;">21</td></tr><tr><td style="text-align:left;">H</td><td style="text-align:left;">24小时制的时</td><td style="text-align:left;">14</td></tr><tr><td style="text-align:left;">l</td><td style="text-align:left;">12小时制的时</td><td style="text-align:left;">2</td></tr><tr><td style="text-align:left;">M</td><td style="text-align:left;">分</td><td style="text-align:left;">57</td></tr><tr><td style="text-align:left;">S</td><td style="text-align:left;">秒</td><td style="text-align:left;">46</td></tr><tr><td style="text-align:left;">s</td><td style="text-align:left;">秒为单位的时间戳</td><td style="text-align:left;">1634799527</td></tr><tr><td style="text-align:left;">p</td><td style="text-align:left;">上午还是下午</td><td style="text-align:left;">下午</td></tr></tbody></table><p>我们可以使用以下三个类去进行格式化，其中可能存在不支持的情况，比如LocalDateTime不支持c：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">System.out.printf(&quot;%tc&quot;,new Date());<br>System.out.printf(&quot;%tc&quot;,ZonedDateTime.now());<br>System.out.printf(&quot;%tF&quot;,LocalDateTime.now());<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时我们使用debug查看，默认情况下的fomat，我们不妨来读一读：</p><figure><img alt="image-20211021131531722" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021131531722-c04db0d5.png" tabindex="0"/><figcaption>image-20211021131531722</figcaption></figure><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">10月 21, 2021 2:23:42 下午 com.ydlclass.entity.LoggerTest testLogParent<br>警告: warning<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="六、配置文件" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#六、配置文件">#</a> 六、配置文件</h3><p>我们不妨看看一个文件处理器的源码是怎么读配置项的：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">LogManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> LogManager.getLogManager();<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">cname</span> <span class="hljs-operator">=</span> getClass().getName();<br><br>        pattern = manager.getStringProperty(cname + <span class="hljs-string">&quot;.pattern&quot;</span>, <span class="hljs-string">&quot;%h/java%u.log&quot;</span>);<br>        limit = manager.getLongProperty(cname + <span class="hljs-string">&quot;.limit&quot;</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (limit &amp;lt; <span class="hljs-number">0</span>) &#123;<br>            limit = <span class="hljs-number">0</span>;<br>        &#125;<br>        count = manager.getIntProperty(cname + <span class="hljs-string">&quot;.count&quot;</span>, <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">if</span> (count &amp;lt;= <span class="hljs-number">0</span>) &#123;<br>            count = <span class="hljs-number">1</span>;<br>        &#125;<br>        append = manager.getBooleanProperty(cname + <span class="hljs-string">&quot;.append&quot;</span>, <span class="hljs-literal">false</span>);<br>        setLevel(manager.getLevelProperty(cname + <span class="hljs-string">&quot;.level&quot;</span>, Level.ALL));<br>        setFilter(manager.getFilterProperty(cname + <span class="hljs-string">&quot;.filter&quot;</span>, <span class="hljs-literal">null</span>));<br>        setFormatter(manager.getFormatterProperty(cname + <span class="hljs-string">&quot;.formatter&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLFormatter</span>()));<br>        <span class="hljs-comment">// Initialize maxLocks from the logging.properties file.</span><br>        <span class="hljs-comment">// If invalid/no property is provided 100 will be used as a default value.</span><br>        maxLocks = manager.getIntProperty(cname + <span class="hljs-string">&quot;.maxLocks&quot;</span>, MAX_LOCKS);<br>        <span class="hljs-keyword">if</span>(maxLocks &amp;lt;= <span class="hljs-number">0</span>) &#123;<br>            maxLocks = MAX_LOCKS;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            setEncoding(manager.getStringProperty(cname +<span class="hljs-string">&quot;.encoding&quot;</span>, <span class="hljs-literal">null</span>));<br>        &#125; <span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                setEncoding(<span class="hljs-literal">null</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception ex2) &#123;<br>                <span class="hljs-comment">// doing a setEncoding with null should always work.</span><br>                <span class="hljs-comment">// assert false;</span><br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以从以下源码中看到配置项：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StreamHandler</span> &#123;<br>    <span class="hljs-keyword">private</span> MeteredStream meter;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> append;<br>    <span class="hljs-comment">// 限制文件大小</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> limit;       <span class="hljs-comment">// zero =&amp;gt; no limit.</span><br>    <span class="hljs-comment">// 控制日志文件的数量</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> count;<br>    <span class="hljs-comment">// 日志文件的格式化方式</span><br>    <span class="hljs-keyword">private</span> String pattern;<br>    <span class="hljs-keyword">private</span> String lockFileName;<br>    <span class="hljs-keyword">private</span> FileChannel lockFileChannel;<br>    <span class="hljs-keyword">private</span> File files[];<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_LOCKS</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>    <span class="hljs-comment">// 可以理解为同时可以有多少个线程打开文件，源码中有介绍</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">maxLocks</span> <span class="hljs-operator">=</span> MAX_LOCKS;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Set&amp;lt;String&amp;gt; locks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&amp;lt;&amp;gt;();<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们已经知道系统默认的配置文件的位置，那我们能不能自定义呢？当然可以了，我们从jdk中赋值一个配置文件过来：</p><div class="language-properties line-numbers-mode" data-ext="properties"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight properties"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">.level</span>= <span class="hljs-string">INFO</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># default file output is in user&#x27;s home directory.</span><br><span class="hljs-attr">java.util.logging.FileHandler.pattern</span> = <span class="hljs-string">%h/java%u.log</span><br><span class="hljs-attr">java.util.logging.FileHandler.limit</span> = <span class="hljs-string">50000</span><br><span class="hljs-attr">java.util.logging.FileHandler.count</span> = <span class="hljs-string">1</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Default number of locks FileHandler can obtain synchronously.</span><br><span class="hljs-comment"># This specifies maximum number of attempts to obtain lock file by FileHandler</span><br><span class="hljs-comment"># implemented by incrementing the unique field %u as per FileHandler API documentation.</span><br><span class="hljs-attr">java.util.logging.FileHandler.maxLocks</span> = <span class="hljs-string">100</span><br><span class="hljs-attr">java.util.logging.FileHandler.formatter</span> = <span class="hljs-string">java.util.logging.XMLFormatter</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Limit the message that are printed on the console to INFO and above.</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.level</span> = <span class="hljs-string">INFO</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.formatter</span> = <span class="hljs-string">java.util.logging.SimpleFormatter</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># java.util.logging.SimpleFormatter.format=%4$s: %5$s [%1$tc]%n</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">pattern = manager.getStringProperty(cname + &quot;.pattern&quot;, &quot;%h/java%u.log&quot;);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> File <span class="hljs-title function_">generate</span><span class="hljs-params">(String pat, <span class="hljs-type">int</span> count, <span class="hljs-type">int</span> generation, <span class="hljs-type">int</span> unique)</span><br>            <span class="hljs-keyword">throws</span> IOException<br>&#123;<br>    <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(pat);<br>    <span class="hljs-type">Path</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">sawg</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">sawu</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">word</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>    <span class="hljs-type">Path</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">for</span> (Path elem : path) &#123;<br>        <span class="hljs-keyword">if</span> (prev != <span class="hljs-literal">null</span>) &#123;<br>            prev = prev.resolveSibling(word.toString());<br>            result = result == <span class="hljs-literal">null</span> ? prev : result.resolve(prev);<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">pattern</span> <span class="hljs-operator">=</span> elem.toString();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">ix</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        word.setLength(<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">while</span> (ix &amp;lt; pattern.length()) &#123;<br>            <span class="hljs-type">char</span> <span class="hljs-variable">ch</span> <span class="hljs-operator">=</span> pattern.charAt(ix);<br>            ix++;<br>            <span class="hljs-type">char</span> <span class="hljs-variable">ch2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">if</span> (ix &amp;lt; pattern.length()) &#123;<br>                ch2 = Character.toLowerCase(pattern.charAt(ix));<br>            &#125;<br>            <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">&#x27;%&#x27;</span>) &#123;<br>                <span class="hljs-keyword">if</span> (ch2 == <span class="hljs-string">&#x27;t&#x27;</span>) &#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">tmpDir</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;java.io.tmpdir&quot;</span>);<br>                    <span class="hljs-keyword">if</span> (tmpDir == <span class="hljs-literal">null</span>) &#123;<br>                        tmpDir = System.getProperty(<span class="hljs-string">&quot;user.home&quot;</span>);<br>                    &#125;<br>                    result = Paths.get(tmpDir);<br>                    ix++;<br>                    word.setLength(<span class="hljs-number">0</span>);<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ch2 == <span class="hljs-string">&#x27;h&#x27;</span>) &#123;<br>                    result = Paths.get(System.getProperty(<span class="hljs-string">&quot;user.home&quot;</span>));<br>                    <span class="hljs-keyword">if</span> (jdk.internal.misc.VM.isSetUID()) &#123;<br>                        <span class="hljs-comment">// Ok, we are in a set UID program.  For safety&#x27;s sake</span><br>                        <span class="hljs-comment">// we disallow attempts to open files relative to %h.</span><br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>(<span class="hljs-string">&quot;can&#x27;t use %h in set UID program&quot;</span>);<br>                    &#125;<br>                    ix++;<br>                    word.setLength(<span class="hljs-number">0</span>);<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ch2 == <span class="hljs-string">&#x27;g&#x27;</span>) &#123;<br>                    word = word.append(generation);<br>                    sawg = <span class="hljs-literal">true</span>;<br>                    ix++;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ch2 == <span class="hljs-string">&#x27;u&#x27;</span>) &#123;<br>                    word = word.append(unique);<br>                    sawu = <span class="hljs-literal">true</span>;<br>                    ix++;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ch2 == <span class="hljs-string">&#x27;%&#x27;</span>) &#123;<br>                    word = word.append(<span class="hljs-string">&#x27;%&#x27;</span>);<br>                    ix++;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br>            &#125;<br>            word = word.append(ch);<br>        &#125;<br>        prev = elem;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (count &amp;gt; <span class="hljs-number">1</span> &amp;amp;&amp;amp; !sawg) &#123;<br>        word = word.append(<span class="hljs-string">&#x27;.&#x27;</span>).append(generation);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (unique &amp;gt; <span class="hljs-number">0</span> &amp;amp;&amp;amp; !sawu) &#123;<br>        word = word.append(<span class="hljs-string">&#x27;.&#x27;</span>).append(unique);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (word.length() &amp;gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> word.toString();<br>        <span class="hljs-type">Path</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> prev == <span class="hljs-literal">null</span> ? Paths.get(n) : prev.resolveSibling(n);<br>        result = result == <span class="hljs-literal">null</span> ? p : result.resolve(p);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span>) &#123;<br>        result = Paths.get(<span class="hljs-string">&quot;&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (path.getRoot() == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> result.toFile();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> path.getRoot().resolve(result).toFile();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">System.out.println(System.getProperty(&quot;user.home&quot;) );<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>C:\Users\zn\java0.log</p><p>我们将拷贝的文件稍作修改：</p><div class="language-properties line-numbers-mode" data-ext="properties"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight properties"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">.level</span>= <span class="hljs-string">INFO</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># default file output is in user&#x27;s home directory.</span><br><span class="hljs-attr">java.util.logging.FileHandler.pattern</span> = <span class="hljs-string">D:/log/java%u.log</span><br><span class="hljs-attr">java.util.logging.FileHandler.limit</span> = <span class="hljs-string">50000</span><br><span class="hljs-attr">java.util.logging.FileHandler.count</span> = <span class="hljs-string">1</span><br><span class="hljs-attr">java.util.logging.FileHandler.maxLocks</span> = <span class="hljs-string">100</span><br><span class="hljs-attr">java.util.logging.FileHandler.formatter</span> = <span class="hljs-string">java.util.logging.XMLFormatter</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Limit the message that are printed on the console to INFO and above.</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.level</span> = <span class="hljs-string">INFO</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.formatter</span> = <span class="hljs-string">java.util.logging.SimpleFormatter</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># java.util.logging.SimpleFormatter.format=%4$s: %5$s [%1$tc]%n</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProperties</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// 读取自定义配置文件</span><br>    <span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span><br>        JULTest.class.getClassLoader().getResourceAsStream(<span class="hljs-string">&quot;logging.properties&quot;</span>);<br>    <span class="hljs-comment">// 获取日志管理器对象</span><br>    <span class="hljs-type">LogManager</span> <span class="hljs-variable">logManager</span> <span class="hljs-operator">=</span> LogManager.getLogManager();<br>    <span class="hljs-comment">// 通过日志管理器加载配置文件</span><br>    logManager.readConfiguration(in);<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(<span class="hljs-string">&quot;com.ydlclass.log.JULTest&quot;</span>);<br>    logger.severe(<span class="hljs-string">&quot;severe&quot;</span>);<br>    logger.warning(<span class="hljs-string">&quot;warning&quot;</span>);<br>    logger.info(<span class="hljs-string">&quot;info&quot;</span>);<br>    logger.config(<span class="hljs-string">&quot;config&quot;</span>);<br>    logger.fine(<span class="hljs-string">&quot;fine&quot;</span>);<br>    logger.finer(<span class="hljs-string">&quot;finer&quot;</span>);<br>    logger.finest(<span class="hljs-string">&quot;finest&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置文件：</p><div class="language-properties line-numbers-mode" data-ext="properties"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight properties"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">handlers</span>= <span class="hljs-string">java.util.logging.ConsoleHandler,java.util.logging.FileHandler</span><br><span class="hljs-attr">.level</span>= <span class="hljs-string">INFO</span><br><br><span class="hljs-attr">java.util.logging.FileHandler.pattern</span> = <span class="hljs-string">D:/logs/java%u.log</span><br><span class="hljs-attr">java.util.logging.FileHandler.limit</span> = <span class="hljs-string">50000</span><br><span class="hljs-attr">java.util.logging.FileHandler.count</span> = <span class="hljs-string">1</span><br><span class="hljs-attr">java.util.logging.FileHandler.maxLocks</span> = <span class="hljs-string">100</span><br><span class="hljs-attr">java.util.logging.FileHandler.formatter</span> = <span class="hljs-string">java.util.logging.XMLFormatter</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Limit the message that are printed on the console to INFO and above.</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.level</span> = <span class="hljs-string">INFO</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.formatter</span> = <span class="hljs-string">java.util.logging.SimpleFormatter</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img alt="image-20211021161011899" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021161011899-61d59d16.png" tabindex="0"/><figcaption>image-20211021161011899</figcaption></figure><p>文件中也出现了：</p><figure><img alt="image-20211021161036728" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021161036728-94ce60b8.png" tabindex="0"/><figcaption>image-20211021161036728</figcaption></figure><p>打开日志发现是xml，因为这里用的就是XMLFormatter：</p><figure><img alt="image-20211021161646767" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021161646767-03a8129f.png" tabindex="0"/><figcaption>image-20211021161646767</figcaption></figure><p>上边我们配置了两个handler给根Logger，我们还可以给其他的Logger做独立的配置：</p><div class="language-properties line-numbers-mode" data-ext="properties"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight properties"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">handlers</span> = <span class="hljs-string">java.util.logging.ConsoleHandler</span><br><span class="hljs-attr">.level</span> = <span class="hljs-string">INFO</span><br><span class="hljs-comment"># 对这个logger独立配置</span><br><span class="hljs-attr">com.ydlclass.handlers</span> = <span class="hljs-string">java.util.logging.FileHandler</span><br><span class="hljs-attr">com.ydlclass.level</span> = <span class="hljs-string">ALL</span><br><span class="hljs-attr">com.ydlclass.useParentHandlers</span> = <span class="hljs-string">false</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 修改了名字</span><br><span class="hljs-attr">java.util.logging.FileHandler.pattern</span> = <span class="hljs-string">D:/logs/ydl-java%u.log</span><br><span class="hljs-attr">java.util.logging.FileHandler.limit</span> = <span class="hljs-string">50000</span><br><span class="hljs-attr">java.util.logging.FileHandler.count</span> = <span class="hljs-string">1</span><br><span class="hljs-attr">java.util.logging.FileHandler.maxLocks</span> = <span class="hljs-string">100</span><br><span class="hljs-attr">java.util.logging.FileHandler.formatter</span> = <span class="hljs-string">java.util.logging.SimpleFormatter</span><br><span class="hljs-comment"># 文件使用追加方式</span><br><span class="hljs-attr">java.util.logging.FileHandler.append</span> = <span class="hljs-string">true</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># Limit the message that are printed on the console to INFO and above.</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.level</span> = <span class="hljs-string">INFO</span><br><span class="hljs-attr">java.util.logging.ConsoleHandler.formatter</span> = <span class="hljs-string">java.util.logging.SimpleFormatter</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 修改日志格式</span><br><span class="hljs-attr">java.util.logging.SimpleFormatter.format</span>=<span class="hljs-string">%4$s: %5$s [%1$tc]%n</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行发现控制台没有内容，文件中有了，说明没有问题OK了：</p><figure><img alt="image-20211021161557198" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021161557198-13d982f4.png" tabindex="0"/><figcaption>image-20211021161557198</figcaption></figure><p>日志出现以下内容：</p><figure><img alt="image-20211021161911691" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021161911691-70526a4f.png" tabindex="0"/><figcaption>image-20211021161911691</figcaption></figure><h2 id="第三章-log4j-日志框架" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第三章-log4j-日志框架">#</a> 第三章 LOG4J 日志框架</h2><p>​ Log4j是Apache下的一款开源的日志框架。 官方网站： <a href="http://logging.apache.org/log4j/1.2/%EF%BC%8C%E8%BF%99%E6%98%AF%E4%B8%80%E6%AC%BE%E6%AF%94%E8%BE%83%E8%80%81%E7%9A%84%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%EF%BC%8C%E7%9B%AE%E5%89%8D%E6%96%B0%E7%9A%84log4j2%E5%81%9A%E4%BA%86%E5%BE%88%E5%A4%A7%E7%9A%84%E6%94%B9%E5%8A%A8%EF%BC%8C%E4%BB%BB%E7%84%B6%E6%9C%89%E4%B8%80%E4%BA%9B%E9%A1%B9%E7%9B%AE%E5%9C%A8%E4%BD%BF%E7%94%A8log4j%E3%80%82" rel="noopener noreferrer" target="_blank">http://logging.apache.org/log4j/1.2/，这是一款比较老的日志框架，目前新的log4j2做了很大的改动，任然有一些项目在使用log4j。<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="一、入门案例-1" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、入门案例-1">#</a> 一、入门案例</h3><ol><li>建立maven工程</li><li>添加依赖</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>log4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>log4j<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.2.17<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>junit<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>junit<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>4.13.2<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>build<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>plugins<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>plugin<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.apache.maven.plugins<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>maven-compiler-plugin<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>3.8.1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>configuration<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>source<span class="hljs-symbol">&amp;gt;</span>$&#123;maven.compiler.source&#125;<span class="hljs-symbol">&amp;lt;</span>/source<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>target<span class="hljs-symbol">&amp;gt;</span>$&#123;maven.compiler.target&#125;<span class="hljs-symbol">&amp;lt;</span>/target<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>encoding<span class="hljs-symbol">&amp;gt;</span>UTF-8<span class="hljs-symbol">&amp;lt;</span>/encoding<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>/configuration<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/plugin<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/plugins<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/build<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>java代码</li></ol><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogger</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(Log4jTest.class);<br>    <span class="hljs-comment">// 日志记录输出</span><br>    logger.info(<span class="hljs-string">&quot;hello log4j&quot;</span>);<br>    <span class="hljs-comment">// 日志级别</span><br>    logger.fatal(<span class="hljs-string">&quot;fatal&quot;</span>); <span class="hljs-comment">// 严重错误，一般会造成系统崩溃和终止运行</span><br>    logger.error(<span class="hljs-string">&quot;error&quot;</span>); <span class="hljs-comment">// 错误信息，但不会影响系统运行</span><br>    logger.warn(<span class="hljs-string">&quot;warn&quot;</span>); <span class="hljs-comment">// 警告信息，可能会发生问题</span><br>    logger.info(<span class="hljs-string">&quot;info&quot;</span>); <span class="hljs-comment">// 程序运行信息，数据库的连接、网络、IO操作等</span><br>    logger.debug(<span class="hljs-string">&quot;debug&quot;</span>); <span class="hljs-comment">// 调试信息，一般在开发阶段使用，记录程序的变量、参数等</span><br>    logger.trace(<span class="hljs-string">&quot;trace&quot;</span>); <span class="hljs-comment">// 追踪信息，记录程序的所有流程信息</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>发现会有一些警告，JUL可以直接在控制台输出是因为他有默认的配置文件，而这个独立的第三方的日志框架却没有配置文件：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">log4j:WARN No appenders could be found for logger (com.ydlclass.entity.Log4jTest).<br>log4j:WARN Please initialize the log4j system properly.<br>log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们在执行代码之前，加上以下代码，他会初始化一个默认配置：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">BasicConfigurator.configure();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>结果：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text">0 [main] INFO com.ydlclass.entity.Log4jTest  - hello log4j<br>1 [main] FATAL com.ydlclass.entity.Log4jTest  - fatal<br>1 [main] ERROR com.ydlclass.entity.Log4jTest  - error<br>1 [main] WARN com.ydlclass.entity.Log4jTest  - warn<br>1 [main] INFO com.ydlclass.entity.Log4jTest  - info<br>1 [main] DEBUG com.ydlclass.entity.Log4jTest  - debug<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从源码看，这一行代码给我们的RootLogger加入一个控制台的输出源，就和jul中的handler一样：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> Logger.getRootLogger();<br>    root.addAppender(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleAppender</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PatternLayout</span>(<span class="hljs-string">&quot;%r [%t] %p %c %x - %m%n&quot;</span>)));<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>log4j定义了以下的日志的级别，和JUL的略有不同：</p><ol><li>fatal 指出每个严重的错误事件将会导致应用程序的退出。</li><li>error 指出虽然发生错误事件，但仍然不影响系统的继续运行。</li><li>warn 表明会出现潜在的错误情形。</li><li>info 一般和在粗粒度级别上，强调应用程序的运行全程。</li><li>debug 一般用于细粒度级别上，对调试应用程序非常有帮助。</li><li>trace 是程序追踪，可以用于输出程序运行中的变量，显示执行的流程。</li></ol><p>和JUL一样：还有两个特殊的级别：OFF，可用来关闭日志记录。 ALL，启用所有消息的日志记录。</p><p>一般情况下，我们只使用4个级别，优先级从高到低为 ERROR &gt; WARN &gt; INFO &gt; DEBUG。</p><h3 id="二、组件讲解" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、组件讲解">#</a> 二、组件讲解</h3><p>​ Log4J 主要由 Loggers (日志记录器)、Appenders（输出端）和 Layout（日志格式化器）组成。其中 Loggers 控制日志的输出级别与日志是否输出；Appenders 指定日志的输出方式（输出到控制台、文件 等）；Layout 控制日志信息的输出格式。</p><h4 id="_1、loggers" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、loggers">#</a> 1、Loggers</h4><p>日志记录器：负责收集处理日志记录，实例的命名就是类“XX”的full quailied name（类的全限定名）， Logger的名字大小写敏感，其命名有继承机制：例如：name为com.ydlclass.service的logger会继承 name为com.ydlclass的logger，和JUL一致。</p><p>Log4J中有一个特殊的logger叫做“root”，他是所有logger的根，也就意味着其他所有的logger都会直接 或者间接地继承自root。root logger可以用Logger.getRootLogger()方法获取。 JUL是不是也有一个名为<code>.</code>的根。</p><h4 id="_2、appenders" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、appenders">#</a> 2、Appenders</h4><p>Appender和JUL的Handler很像，用来指定日志输出到哪个地方，可以同时指定日志的输出目的地。Log4j 常用的输出目的地 有以下几种：</p><table><thead><tr><th>输出端类型</th><th>作用</th></tr></thead><tbody><tr><td>ConsoleAppender</td><td>将日志输出到控制台</td></tr><tr><td>FileAppender</td><td>将日志输出到文件中</td></tr><tr><td>DailyRollingFileAppender</td><td>将日志输出到一个日志文件，并且每天输出到一个新的文件</td></tr><tr><td>RollingFileAppender</td><td>将日志信息输出到一个日志文件，并且指定文件的尺寸，当文件大 小达到指定尺寸时，会自动把文件改名，同时产生一个新的文件</td></tr><tr><td>JDBCAppender</td><td>把日志信息保存到数据库中</td></tr></tbody></table><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 配置一个控制台输出源</span><br><span class="hljs-type">ConsoleAppender</span> <span class="hljs-variable">consoleAppender</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleAppender</span>();<br>consoleAppender.setName(<span class="hljs-string">&quot;ydl&quot;</span>);<br>consoleAppender.setWriter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PrintWriter</span>(System.out));<br>logger.addAppender(consoleAppender);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3、layouts" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、layouts">#</a> 3、Layouts</h4><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Layout</span> <span class="hljs-variable">layout</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Layout</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(LoggingEvent loggingEvent)</span> &#123;<br>        <span class="hljs-keyword">return</span> loggingEvent.getLoggerName() + <span class="hljs-string">&quot; &quot;</span><br>            +loggingEvent.getMessage() + <span class="hljs-string">&quot;\r\n&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">ignoresThrowable</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">activateOptions</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有一些默认的实现类：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">Layout layout = new SimpleLayout();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><figure><img alt="image-20211021174447092" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021174447092-80a06256.png" tabindex="0"/><figcaption>image-20211021174447092</figcaption></figure><p>他的实现太简单了：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(LoggingEvent event)</span> &#123;<br>    sbuf.setLength(<span class="hljs-number">0</span>);<br>    sbuf.append(event.getLevel().toString());<br>    sbuf.append(<span class="hljs-string">&quot; - &quot;</span>);<br>    sbuf.append(event.getRenderedMessage());<br>    sbuf.append(LINE_SEP);<br>    <span class="hljs-keyword">return</span> sbuf.toString();<br>  &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 还有一个比较常用的Layout，就是PatternLayout这个实现类，能够根据特定的占位符进行转化，和JUL很像，但是又不一样，我们庖丁解牛研究一番，首先看他的构造器，构造器中如果传入一个pattern字符串，他会根据这个pattern创建一个链表，这个链表具体干什么咱们慢慢往后看：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">PatternLayout</span><span class="hljs-params">(String pattern)</span> &#123;<br>    <span class="hljs-built_in">this</span>.pattern = pattern;<br>    head = createPatternParser((pattern == <span class="hljs-literal">null</span>) ? DEFAULT_CONVERSION_PATTERN :<br>                               pattern).parse();<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将步骤拆解开来看，首先创建了一个解析器：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> PatternParser <span class="hljs-title function_">createPatternParser</span><span class="hljs-params">(String pattern)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PatternParser</span>(pattern);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看parse方法，这个方法比较复杂我们简化来看：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> PatternConverter <span class="hljs-title function_">parse</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">char</span> c;<br>    i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(i &amp;lt; patternLength) &#123;<br>        ...此次省略了很多代码，但是可以从这个核心看出来<br>        c = pattern.charAt(i++);<br>        finalizeConverter(c);<br>    &#125;<br>    <span class="hljs-keyword">return</span> head;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而finalizeConverter做的工作大家就能看的很清楚了：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finalizeConverter</span><span class="hljs-params">(<span class="hljs-type">char</span> c)</span> &#123;<br>    <span class="hljs-type">PatternConverter</span> <span class="hljs-variable">pc</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">switch</span>(c) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;c&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CategoryPatternConverter</span>(formattingInfo,<br>                    extractPrecisionOption());<br>      <span class="hljs-comment">//LogLog.debug(&quot;CATEGORY converter.&quot;);</span><br>      <span class="hljs-comment">//formattingInfo.dump();</span><br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-comment">//处理类名的转化器</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;C&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassNamePatternConverter</span>(formattingInfo,<br>                     extractPrecisionOption());<br>      <span class="hljs-comment">//LogLog.debug(&quot;CLASS_NAME converter.&quot;);</span><br>      <span class="hljs-comment">//formattingInfo.dump();</span><br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>     <span class="hljs-comment">//处理时间的转化器</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;d&#x27;</span>:<br>      <span class="hljs-type">String</span> <span class="hljs-variable">dateFormatStr</span> <span class="hljs-operator">=</span> AbsoluteTimeDateFormat.ISO8601_DATE_FORMAT;<br>      DateFormat df;<br>        ... <br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatePatternConverter</span>(formattingInfo, df);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-comment">//输出日志时间发生的位置，包括类名、线程、及在代码中的行数</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;F&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocationPatternConverter</span>(formattingInfo,<br>                    FILE_LOCATION_CONVERTER);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;l&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocationPatternConverter</span>(formattingInfo,<br>                    FULL_LOCATION_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;L&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocationPatternConverter</span>(formattingInfo,<br>                    LINE_LOCATION_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;m&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicPatternConverter</span>(formattingInfo, MESSAGE_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;M&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocationPatternConverter</span>(formattingInfo,<br>                    METHOD_LOCATION_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicPatternConverter</span>(formattingInfo, LEVEL_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;r&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicPatternConverter</span>(formattingInfo,<br>                     RELATIVE_TIME_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;t&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicPatternConverter</span>(formattingInfo, THREAD_CONVERTER);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;x&#x27;</span>:<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicPatternConverter</span>(formattingInfo, NDC_CONVERTER);<br>      <span class="hljs-comment">//LogLog.debug(&quot;NDC converter.&quot;);</span><br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;X&#x27;</span>:<br>      <span class="hljs-type">String</span> <span class="hljs-variable">xOpt</span> <span class="hljs-operator">=</span> extractOption();<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MDCPatternConverter</span>(formattingInfo, xOpt);<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>      LogLog.error(<span class="hljs-string">&quot;Unexpected char [&quot;</span> +c+<span class="hljs-string">&quot;] at position &quot;</span>+i<br>           +<span class="hljs-string">&quot; in conversion patterrn.&quot;</span>);<br>      pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LiteralPatternConverter</span>(currentLiteral.toString());<br>      currentLiteral.setLength(<span class="hljs-number">0</span>);<br>    &#125;<br><br>    addConverter(pc);<br>  &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下边就是一个典型的链表结构的构建了：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addConverter</span><span class="hljs-params">(PatternConverter pc)</span> &#123;<br>    currentLiteral.setLength(<span class="hljs-number">0</span>);<br>    <span class="hljs-comment">// Add the pattern converter to the list.</span><br>    addToList(pc);<br>    <span class="hljs-comment">// Next pattern is assumed to be a literal.</span><br>    state = LITERAL_STATE;<br>    <span class="hljs-comment">// Reset formatting info</span><br>    formattingInfo.reset();<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span>  <span class="hljs-title function_">addToList</span><span class="hljs-params">(PatternConverter pc)</span> &#123;<br>    <span class="hljs-keyword">if</span>(head == <span class="hljs-literal">null</span>) &#123;<br>        head = tail = pc;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        tail.next = pc;<br>        tail = pc;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 构建完转化器链表之后，就是循环这个链表，一次处理对应的占位符了，他的核心的格式化的方法也是format方法，在format方法中是通过一个转化器链来完成转化的：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(LoggingEvent event)</span> &#123;<br>    <span class="hljs-comment">// 在format方法中是通过一个转化器链来完成转化的</span><br>    <span class="hljs-type">PatternConverter</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> head;<br><br>    <span class="hljs-keyword">while</span>(c != <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-comment">// 这一句是核心，第一个参数是一个StringBuilder，第二个参数LoggingEvent</span><br>      c.format(sbuf, event);<br>      c = c.next;<br>    &#125;<br>    <span class="hljs-keyword">return</span> sbuf.toString();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 这里就是通过一个pattern字符串，这个字符串可能张这个样子（%-d{yyyy-MM-dd HH:mm:ss} [%t:%r] -[%p] %m%n），使用createPatternParser().parse()方法构建一个处理器的链表，这个每个处理器处理一个占位符比如（%d）。</p><p>进入c.format()方法，我们会进入一个抽象类PatternConverter中的format方法，里边的核心就是如下代码：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">format</span><span class="hljs-params">(StringBuffer sbuf, LoggingEvent e)</span> &#123;<br>    <span class="hljs-comment">// 核心就是这一句</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> convert(e);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>log4j 其实采用类似 C 语言的 printf 函数的打印格式格式化日志信息，源码已经看过了，具体的占位符及其含义如下：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs text">%m 输出代码中指定的日志信息<br>%p 输出日志级别，及 DEBUG、INFO 等<br>%n 换行符（Windows平台的换行符为 &quot;\n&quot;，Unix 平台为 &quot;\n&quot;）<br>%r 输出自应用启动到输出该 log 信息耗费的毫秒数<br>%c 输出打印语句所属的类的全名<br>%t 输出产生该日志的线程全名<br>%d 输出服务器当前时间，默认为 ISO8601，也可以指定格式，如：%d&#123;yyyy年MM月dd日HH:mm:ss&#125;<br>%l 输出日志时间发生的位置，包括类名、线程、及在代码中的行数。如：Test.main(Test.java:10)<br>%F 输出日志消息产生时所在的文件名称<br>%L 输出代码中的行号<br>%% 输出一个 &quot;%&quot; 字符<br>* 可以在 % 与字符之间加上修饰符来控制最小宽度、最大宽度和文本的对其方式。如：<br>%5c 输出category名称，最小宽度是5，category&amp;lt;5，默认的情况下右对齐<br>%-5c 输出category名称，最小宽度是5，category&amp;lt;5，&quot;-&quot;号指定左对齐,会有空格<br>%.5c 输出category名称，最大宽度是5，category&amp;gt;5，就会将左边多出的字符截掉，&amp;lt;5不会有空格<br>%20.30c category名称&amp;lt;20补空格，并且右对齐，&amp;gt;30字符，就从左边交远销出的字符截掉<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>举一个例子：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">%-d&#123;yyyy-MM-dd HH:mm:ss&#125; [%t:%r] -[%p] %m%n<br>打印：日期 [线程:毫秒数] - [日志级别] - 日志信息 换行<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>尝试写一个：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLog</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">// 获取一个logger</span><br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(TestLog4j.class);<br>    <span class="hljs-comment">// 创建一个layout</span><br>    <span class="hljs-type">Layout</span> <span class="hljs-variable">layout</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PatternLayout</span>(<span class="hljs-string">&quot;%-d&#123;yyyy-MM-dd HH:mm:ss&#125; [%t:%r] -[%p] %m%n&quot;</span>);<br>    <span class="hljs-comment">// 创建一个输出源</span><br>    <span class="hljs-type">ConsoleAppender</span> <span class="hljs-variable">appender</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleAppender</span>();<br>    appender.setLayout(layout);<br>    appender.setWriter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PrintWriter</span>(System.out));<br>    logger.addAppender(appender);<br>    logger.warn(<span class="hljs-string">&quot;warning&quot;</span>);<br>&#125;<br><br>结果：<br><span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">21</span> <span class="hljs-number">21</span>:<span class="hljs-number">31</span>:<span class="hljs-number">05</span> [main:<span class="hljs-number">0</span>] -[WARN] warning<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置一个jdbcAppender</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">JDBCAppender</span> <span class="hljs-variable">jdbcAppender</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JDBCAppender</span>();<br>jdbcAppender.setDriver(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>jdbcAppender.setURL(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/ydlclass?characterEncoding=utf8&amp;amp;useSSL=false&amp;amp;serverTimezone=UTC&quot;</span>);<br>jdbcAppender.setUser(<span class="hljs-string">&quot;root&quot;</span>);<br>jdbcAppender.setPassword(<span class="hljs-string">&quot;root&quot;</span>);<br>jdbcAppender.setSql(<span class="hljs-string">&quot;INSERT INTO log(project_name,create_date,level,category,file_name,thread_name,line,all_category,message) values(&#x27;ydlclass&#x27;,&#x27;%d&#123;yyyy-MM-ddHH:mm:ss&#125;&#x27;,&#x27;%p&#x27;,&#x27;%c&#x27;,&#x27;%F&#x27;,&#x27;%t&#x27;,&#x27;%L&#x27;,&#x27;%l&#x27;,&#x27;%m&#x27;)&quot;</span>);<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>数据表</p><div class="language-sql line-numbers-mode" data-ext="sql"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight sql"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `log` (<br>    `log_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT,<br>    `project_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;目项名&#x27;</span>,<br>    `create_date` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>    `level` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;优先级&#x27;</span>,<br>    `category` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;所在类的全名&#x27;</span>,<br>    `file_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;输出日志消息产生时所在的文件名称 &#x27;</span>,<br>    `thread_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;日志事件的线程名&#x27;</span>,<br>    `line` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;号行&#x27;</span>,<br>    `all_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;日志事件的发生位置&#x27;</span>,<br>    `message` <span class="hljs-type">varchar</span>(<span class="hljs-number">4000</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;输出代码中指定的消息&#x27;</span>,<br>    <span class="hljs-keyword">PRIMARY KEY</span> (`log_id`)<br>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>依赖</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">&amp;lt;dependency&amp;gt;<br>    &amp;lt;groupId&amp;gt;mysql&amp;lt;/groupId&amp;gt;<br>    &amp;lt;artifactId&amp;gt;mysql-connector-java&amp;lt;/artifactId&amp;gt;<br>    &amp;lt;version&amp;gt;8.0.22&amp;lt;/version&amp;gt;<br>&amp;lt;/dependency&amp;gt;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="三、配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、配置">#</a> 三、配置</h3><p>log4j不仅仅可以在控制台，文件文件中输出日志，甚至可以在数据库中，我们先使用配置的方式完成日志的输入：</p><div class="language-properties line-numbers-mode" data-ext="properties"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight properties"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#指定日志的输出级别与输出端</span><br><span class="hljs-attr">log4j.rootLogger</span>=<span class="hljs-string">INFO,Console,ydl</span><br><span class="hljs-comment"># 控制台输出配置</span><br><span class="hljs-attr">log4j.appender.Console</span>=<span class="hljs-string">org.apache.log4j.ConsoleAppender</span><br><span class="hljs-attr">log4j.appender.Console.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-attr">log4j.appender.Console.layout.ConversionPattern</span>=<span class="hljs-string">%d [%t] %-5p [%c] - %m%n</span><br><span class="hljs-comment"># 文件输出配置</span><br><span class="hljs-attr">log4j.appender.ydl</span> = <span class="hljs-string">org.apache.log4j.DailyRollingFileAppender</span><br><span class="hljs-comment">#指定日志的输出路径</span><br><span class="hljs-attr">log4j.appender.ydl.File</span> = <span class="hljs-string">D:/logs/ydl.log</span><br><span class="hljs-attr">log4j.appender.ydl.Append</span> = <span class="hljs-string">true</span><br><span class="hljs-comment">#使用自定义日志格式化器</span><br><span class="hljs-attr">log4j.appender.ydl.layout</span> = <span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-comment">#指定日志的输出格式</span><br><span class="hljs-attr">log4j.appender.ydl.layout.ConversionPattern</span> = <span class="hljs-string">%-d&#123;yyyy-MM-dd HH:mm:ss&#125; [%t:%r] -[%p] %m%n</span><br><span class="hljs-comment">#指定日志的文件编码</span><br><span class="hljs-attr">log4j.appender.ydl.encoding</span>=<span class="hljs-string">UTF-8</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有了这个配置文件我们些代码就简单了一些：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testConfig</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">// 获取一个logger</span><br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(TestLog4j.class);<br>    logger.warn(<span class="hljs-string">&quot;warning&quot;</span>);<br>&#125;<br><br>结果：<br>    <span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">21</span> <span class="hljs-number">21</span>:<span class="hljs-number">37</span>:<span class="hljs-number">06</span>,<span class="hljs-number">705</span> [main] WARN  [com.ydlclass.TestLog4j] - warning<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>文件也有了：</p><figure><img alt="image-20211021213817159" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021213817159-f1e0ce56.png" tabindex="0"/><figcaption>image-20211021213817159</figcaption></figure><p>内容：</p><figure><img alt="image-20211021213845319" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021213845319-dcc33aa3.png" tabindex="0"/><figcaption>image-20211021213845319</figcaption></figure><p>我们查看了可是确实没有问题。</p><p>​ 当然日志配置文件是什么时候读取的呢？每一个logger都是LogManager创建的，而LogManager有一个静态代码块帮助我们解析配置文件，细节就不需要了解了：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogManager</span> &#123;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@deprecated</span> This variable is for internal use only. It will</span><br><span class="hljs-comment">   * become package protected in future versions.</span><br><span class="hljs-comment">   * */</span><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_CONFIGURATION_FILE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;log4j.properties&quot;</span>;<br><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_XML_CONFIGURATION_FILE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;log4j.xml&quot;</span>;  <br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@deprecated</span> This variable is for internal use only. It will</span><br><span class="hljs-comment">   * become private in future versions.</span><br><span class="hljs-comment">   * */</span><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">public</span> String DEFAULT_CONFIGURATION_KEY=<span class="hljs-string">&quot;log4j.configuration&quot;</span>;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@deprecated</span> This variable is for internal use only. It will</span><br><span class="hljs-comment">   * become private in future versions.</span><br><span class="hljs-comment">   * */</span><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">public</span> String CONFIGURATOR_CLASS_KEY=<span class="hljs-string">&quot;log4j.configuratorClass&quot;</span>;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@deprecated</span> This variable is for internal use only. It will</span><br><span class="hljs-comment">  * become private in future versions.</span><br><span class="hljs-comment">  */</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_INIT_OVERRIDE_KEY</span> <span class="hljs-operator">=</span> <br>                                                 <span class="hljs-string">&quot;log4j.defaultInitOverride&quot;</span>;<br><br><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">private</span> <span class="hljs-type">Object</span> <span class="hljs-variable">guard</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">private</span> RepositorySelector repositorySelector;<br><br>  <span class="hljs-keyword">static</span> &#123;<br>      <span class="hljs-comment">// By default we use a DefaultRepositorySelector which always returns &#x27;h&#x27;.</span><br>      <span class="hljs-type">Hierarchy</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hierarchy</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RootLogger</span>((Level) Level.DEBUG));<br>      repositorySelector = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRepositorySelector</span>(h);<br><br>      <span class="hljs-comment">/** Search for the properties file log4j.properties in the CLASSPATH.  */</span><br>      <span class="hljs-type">String</span> <span class="hljs-variable">override</span> <span class="hljs-operator">=</span>OptionConverter.getSystemProperty(DEFAULT_INIT_OVERRIDE_KEY,<br>                                                         <span class="hljs-literal">null</span>);<br><br>      <span class="hljs-comment">// if there is no default init override, then get the resource</span><br>      <span class="hljs-comment">// specified by the user or the default config file.</span><br>      <span class="hljs-keyword">if</span>(override == <span class="hljs-literal">null</span> || <span class="hljs-string">&quot;false&quot;</span>.equalsIgnoreCase(override)) &#123;<br><br>          <span class="hljs-type">String</span> <span class="hljs-variable">configurationOptionStr</span> <span class="hljs-operator">=</span> OptionConverter.getSystemProperty(<br>              DEFAULT_CONFIGURATION_KEY, <br>              <span class="hljs-literal">null</span>);<br><br>          <span class="hljs-type">String</span> <span class="hljs-variable">configuratorClassName</span> <span class="hljs-operator">=</span> OptionConverter.getSystemProperty(<br>              CONFIGURATOR_CLASS_KEY, <br>              <span class="hljs-literal">null</span>);<br><br>          <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>          <span class="hljs-comment">// if the user has not specified the log4j.configuration</span><br>          <span class="hljs-comment">// property, we search first for the file &quot;log4j.xml&quot; and then</span><br>          <span class="hljs-comment">// &quot;log4j.properties&quot;</span><br>          <span class="hljs-keyword">if</span>(configurationOptionStr == <span class="hljs-literal">null</span>) &#123;   <br>              url = Loader.getResource(DEFAULT_XML_CONFIGURATION_FILE);<br>              <span class="hljs-keyword">if</span>(url == <span class="hljs-literal">null</span>) &#123;<br>                  url = Loader.getResource(DEFAULT_CONFIGURATION_FILE);<br>              &#125;<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>              <span class="hljs-keyword">try</span> &#123;<br>                  url = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(configurationOptionStr);<br>              &#125; <span class="hljs-keyword">catch</span> (MalformedURLException ex) &#123;<br>                  <span class="hljs-comment">// so, resource is not a URL:</span><br>                  <span class="hljs-comment">// attempt to get the resource from the class path</span><br>                  url = Loader.getResource(configurationOptionStr); <br>              &#125;  <br>          &#125;<br><br>          <span class="hljs-comment">// If we have a non-null url, then delegate the rest of the</span><br>          <span class="hljs-comment">// configuration to the OptionConverter.selectAndConfigure</span><br>          <span class="hljs-comment">// method.</span><br>          <span class="hljs-keyword">if</span>(url != <span class="hljs-literal">null</span>) &#123;<br>              LogLog.debug(<span class="hljs-string">&quot;Using URL [&quot;</span>+url+<span class="hljs-string">&quot;] for automatic log4j configuration.&quot;</span>);<br>              <span class="hljs-keyword">try</span> &#123;<br>                  OptionConverter.selectAndConfigure(url, configuratorClassName,<br>                                                     LogManager.getLoggerRepository());<br>              &#125; <span class="hljs-keyword">catch</span> (NoClassDefFoundError e) &#123;<br>                  LogLog.warn(<span class="hljs-string">&quot;Error during default initialization&quot;</span>, e);<br>              &#125;<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>              LogLog.debug(<span class="hljs-string">&quot;Could not find resource: [&quot;</span>+configurationOptionStr+<span class="hljs-string">&quot;].&quot;</span>);<br>          &#125;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>          LogLog.debug(<span class="hljs-string">&quot;Default initialization of overridden by &quot;</span> + <br>                       DEFAULT_INIT_OVERRIDE_KEY + <span class="hljs-string">&quot;property.&quot;</span>); <br>      &#125;  <br>  &#125; <br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>还有更有意思的，我们可以直接添加一个数据源，讲日志输出到数据库中，就是一个和数据库链接的输出源而已：</p><p>加入一个数据库的日志输出源：</p><div class="language-properties line-numbers-mode" data-ext="properties"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight properties"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#mysql</span><br><span class="hljs-attr">log4j.appender.logDB</span>=<span class="hljs-string">org.apache.log4j.jdbc.JDBCAppender</span><br><span class="hljs-attr">log4j.appender.logDB.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-attr">log4j.appender.logDB.Driver</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br><span class="hljs-attr">log4j.appender.logDB.URL</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/ssm</span><br><span class="hljs-attr">log4j.appender.logDB.User</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">log4j.appender.logDB.Password</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">log4j.appender.logDB.Sql</span>=<span class="hljs-string">INSERT INTO log(project_name,create_date,level,category,file_name,thread_name,line,all_category,message) values(&#x27;ydlclass&#x27;,&#x27;%d&#123;yyyy-MM-ddHH:mm:ss&#125;&#x27;,&#x27;%p&#x27;,&#x27;%c&#x27;,&#x27;%F&#x27;,&#x27;%t&#x27;,&#x27;%L&#x27;,&#x27;%l&#x27;,&#x27;%m&#x27;)</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要</p><div class="language-sql line-numbers-mode" data-ext="sql"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight sql"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `log` (<br>    `log_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT,<br>    `project_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;目项名&#x27;</span>,<br>    `create_date` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>    `level` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;优先级&#x27;</span>,<br>    `category` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;所在类的全名&#x27;</span>,<br>    `file_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;输出日志消息产生时所在的文件名称 &#x27;</span>,<br>    `thread_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;日志事件的线程名&#x27;</span>,<br>    `line` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;号行&#x27;</span>,<br>    `all_category` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;日志事件的发生位置&#x27;</span>,<br>    `message` <span class="hljs-type">varchar</span>(<span class="hljs-number">4000</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;输出代码中指定的消息&#x27;</span>,<br>    <span class="hljs-keyword">PRIMARY KEY</span> (`log_id`)<br>);<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>pom中添加驱动：</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>mysql<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>mysql-connector-java<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>8.0.22<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再次执行：</p><p>发现除了控制台，文件，数据库中也有了日志了：</p><figure><img alt="image-20211021215028322" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021215028322-46a6267d.png" tabindex="0"/><figcaption>image-20211021215028322</figcaption></figure><h3 id="四、自定义logger" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、自定义logger">#</a> 四、自定义Logger</h3><div class="language-properties line-numbers-mode" data-ext="properties"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight properties"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># RootLogger配置</span><br><span class="hljs-attr">log4j.rootLogger</span> = <span class="hljs-string">trace,console</span><br><span class="hljs-comment"># 自定义Logger</span><br><span class="hljs-attr">log4j.logger.com.ydlclass</span>= <span class="hljs-string">WARN,logDB</span><br><span class="hljs-attr">log4j.logger.org.apache</span> = <span class="hljs-string">error</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由此我们发现，我们可以很灵活的自定义，组装不同logger的实现，接下来我们写代码测试：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDefineLogger</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger1</span> <span class="hljs-operator">=</span> Logger.getLogger(Log4jTest.class);<br>    logger1.fatal(<span class="hljs-string">&quot;fatal&quot;</span>); <span class="hljs-comment">// 严重错误，一般会造成系统崩溃和终止运行</span><br>    logger1.error(<span class="hljs-string">&quot;error&quot;</span>); <span class="hljs-comment">// 错误信息，但不会影响系统运行</span><br>    logger1.warn(<span class="hljs-string">&quot;warn&quot;</span>); <span class="hljs-comment">// 警告信息，可能会发生问题</span><br>    logger1.info(<span class="hljs-string">&quot;info&quot;</span>); <span class="hljs-comment">// 程序运行信息，数据库的连接、网络、IO操作等</span><br>    logger1.debug(<span class="hljs-string">&quot;debug&quot;</span>); <span class="hljs-comment">// 调试信息，一般在开发阶段使用，记录程序的变量、参数等</span><br>    logger1.trace(<span class="hljs-string">&quot;trace&quot;</span>); <span class="hljs-comment">// 追踪信息，记录程序的所有流程信息</span><br>    <span class="hljs-comment">// 自定义 org.apache</span><br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger2</span> <span class="hljs-operator">=</span> Logger.getLogger(Logger.class);<br>    logger2.fatal(<span class="hljs-string">&quot;fatal logger2&quot;</span>); <span class="hljs-comment">// 严重错误，一般会造成系统崩溃和终止运行</span><br>    logger2.error(<span class="hljs-string">&quot;error logger2&quot;</span>); <span class="hljs-comment">// 错误信息，但不会影响系统运行</span><br>    logger2.warn(<span class="hljs-string">&quot;warn logger2&quot;</span>); <span class="hljs-comment">// 警告信息，可能会发生问题</span><br>    logger2.info(<span class="hljs-string">&quot;info logger2&quot;</span>); <span class="hljs-comment">// 程序运行信息，数据库的连接、网络、IO操作等</span><br>    logger2.debug(<span class="hljs-string">&quot;debug logger2&quot;</span>); <span class="hljs-comment">// 调试信息，一般在开发阶段使用，记录程序的变量、参数等</span><br>    logger2.trace(<span class="hljs-string">&quot;trace logger2&quot;</span>); <span class="hljs-comment">// 追踪信息，记录程序的所有流程信息</span><br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们发现logger1的日志级别成了warn，并且在数据库中有了日志，logger2级别成了error，他们其实都继承了根logger的一些属性。</p><h2 id="第四章-日志门面" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第四章-日志门面">#</a> 第四章 日志门面</h2><p>​ 当我们的系统变的复杂的之后，难免会集成其他的系统，不同的系统之间可能会使用不同的日志系统。那么在一个系统中，我们的日志框架可能会出现多个，会出现混乱，而且随着时间的发展，可能会出现新的效率更高的日志系统，如果我们想切换代价会非常的大。如果我们的日志系统能和jdbc一样，有一套自己的规范，其他实现均按照规范去实现，就能很灵活的使用日志框架了。</p><p>​ 日志门面就是为了解决这个问题而出现的一种技术，日志门面是规范，其他的实现按照规范实现各自的日志框架即可，我们程序员基于日志门面编程即可。举个例子：日志门面就好比菜单，日志实现就好比厨师，我们去餐馆吃饭按照菜单点菜即可，厨师是谁其实不重要，但是有一个符合我口味的厨师当然会更好。</p><p>常见的日志门面： JCL、slf4j</p><p>常见的日志实现： JUL、log4j、logback、log4j2</p><p>日志框架出现的历史顺序：</p><p>log4j --&gt;JUL--&gt;JCL--&gt; slf4j --&gt; logback --&gt; log4j2</p><figure><img alt="image-20211021221729341" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021221729341-6c15169d.png" tabindex="0"/><figcaption>image-20211021221729341</figcaption></figure><h3 id="一、slf4j日志门面" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、slf4j日志门面">#</a> 一、SLF4J日志门面</h3><p>​ 简单日志门面(Simple Logging Facade For Java) SLF4J主要是为了给Java日志访问提供一套标准、规范的API框架，其主要意义在于提供接口，具体的实现可以交由其他日志框架，例如log4j和logback等。 当然slf4j自己也提供了功能较为简单的实现，但是一般很少用到。对于一般的Java项目而言，日志框架 会选择slf4j-api作为门面，配上具体的实现框架（log4j、logback等），中间使用桥接器完成桥接。官方网站： <a href="https://www.slf4j.org/" rel="noopener noreferrer" target="_blank">https://www.slf4j.org/<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>SLF4J是目前市面上最流行的日志门面。现在的项目中，基本上都是使用SLF4J作为我们的日志系统。</p><p>SLF4J日志门面主要提供两大功能：</p><ol><li>日志框架的绑定</li><li>日志框架的桥接</li></ol><h4 id="_1、阿里日志规约" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、阿里日志规约">#</a> 1、阿里日志规约</h4><ol><li>应用中不可直接使用日志系统（Log4j、Logback）中的API，而应依赖使用日志框架SLF4J中的API。使用门面模式的日志框架，有利于维护和各个类的日志处理方法统一。</li><li>日志文件推荐至少保存15天，因为有些异常具备以“周”为频次发生的特点。</li><li>应用中的扩展日志（如打点、临时监控、访问日志等）命名方式：appName_logType_logName.log。logType为日志类型，推荐分类有stats/monitor/visit 等；</li><li>logName为日志描述。这种命名的好处：通过文件名就可以知道日志文件属于哪个应用，哪种类型，有什么目的，这也有利于归类查找。</li><li>对trace/debug/info级别的日志输出，必须使用条件输出形式或者占位符的方式。</li><li>避免重复打印日志，否则会浪费磁盘空间。务必在日志配置文件中设置additivity=false。</li><li>异常信息应该包括两类：案发现场信息和异常堆栈信息。如果不处理，那么通过关键字向上抛出。</li><li>谨慎地记录日志。生产环境禁止输出debug日志；有选择地输出info日志；如果使用warn记录刚上线时的业务行为信息，一定要注意日志输出量的问题，避免吧服务器磁盘撑爆，并及时删除这些观察日志。</li><li>可以使用warn日志级别记录用户输入参数错误的情况，避免当用户投诉时无所适从。</li></ol><h4 id="_2、slf4j实战" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、slf4j实战">#</a> 2、SLF4J实战</h4><p>（1）添加依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!--slf4j core 使用slf4j必須添加--<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-api<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.7.27<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!--slf4j 自带的简单日志实现 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-simple<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.7.27<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）编写代码</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestSlf4j</span> &#123;<br><br>    <span class="hljs-comment">// 声明日志对象</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOGGER</span> <span class="hljs-operator">=</span><br>            LoggerFactory.getLogger(TestSlf4j.class);<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSlfSimple</span><span class="hljs-params">()</span>  &#123;<br>        <span class="hljs-comment">//打印日志信息</span><br>        LOGGER.error(<span class="hljs-string">&quot;error&quot;</span>);<br>        LOGGER.warn(<span class="hljs-string">&quot;warn&quot;</span>);<br>        LOGGER.info(<span class="hljs-string">&quot;info&quot;</span>);<br>        LOGGER.debug(<span class="hljs-string">&quot;debug&quot;</span>);<br>        LOGGER.trace(<span class="hljs-string">&quot;trace&quot;</span>);<br>        <span class="hljs-comment">// 使用占位符输出日志信息</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;lucy&quot;</span>;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;<br>        LOGGER.info(<span class="hljs-string">&quot;&#123;&#125;今年&#123;&#125;岁了！&quot;</span>, name, age);<br>        <span class="hljs-comment">// 将系统异常信息写入日志</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> / <span class="hljs-number">0</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-comment">// e.printStackTrace();</span><br>            LOGGER.info(<span class="hljs-string">&quot;出现异常：&quot;</span>, e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>slf4j支持占位符：</p><h4 id="_3、绑定其他日志的实现-binding" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、绑定其他日志的实现-binding">#</a> 3、绑定其他日志的实现（Binding）</h4><p>如前所述，SLF4J支持各种日志框架。SLF4J发行版附带了几个称为“SLF4J绑定”的jar文件，每个绑定对应一个受支持的框架。</p><p><strong>使用slf4j的日志绑定流程:</strong></p><ol><li><p>添加slf4j-api的依赖</p></li><li><p>使用slf4j的API在项目中进行统一的日志记录</p></li><li><p>绑定具体的日志实现框架</p><p>a. 绑定已经实现了slf4j的日志框架,直接添加对应依赖</p><p>b. 绑定没有实现slf4j的日志框架,先添加日志的适配器,再添加实现类的依赖</p></li><li><p>slf4j有且仅有一个日志实现框架的绑定（如果出现多个默认使用第一个依赖日志实现）</p></li></ol><p>绑定jul的实现</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-api<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.7.27<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-jdk14<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.7.25<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>绑定log4j的实现</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!--slf4j core 使用slf4j必須添加--<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-api<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.7.27<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!-- log4j--<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-log4j12<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.7.27<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>log4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>log4j<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.2.17<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 要切换日志框架，只需替换类路径上的slf4j绑定。例如，要从java.util.logging切换到log4j，只需将 slf4j-jdk14-1.7.27.jar替换为slf4j-log4j12-1.7.27.jar即可。</p><p>​ SLF4J不依赖于任何特殊的类装载。实际上，每个SLF4J绑定在编译时都是硬连线的， 以使用一个且只有 一个特定的日志记录框架。例如，slf4j-log4j12-1.7.27.jar绑定在编译时绑定以使用log4j。</p><h4 id="_4、桥接旧的日志框架-bridging" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、桥接旧的日志框架-bridging">#</a> 4、桥接旧的日志框架（Bridging）</h4><p>​ 通常，您依赖的某些组件依赖于SLF4J以外的日志记录API。您也可以假设这些组件在不久的将来不会切换到SLF4J。为了解决这种情况，SLF4J附带了几个桥接模块，这些模块将对log4j，JCL和 java.util.logging API的调用重定向，就好像它们是对SLF4J API一样。</p><p>​ 就是你还用log4j的api写代码，但是具体的实现给你抽离了，我们依赖了一个中间层，这个层其实是用旧的api操作slf4j，而不是操作具体的实现。</p><p>桥接解决的是项目中日志的遗留问题，当系统中存在之前的日志API，可以通过桥接转换到slf4j的实现</p><ol><li>先去除之前老的日志框架的依赖，必须去掉。</li><li>添加SLF4J提供的桥接组件，这个组件就是模仿之前老的日志写了一套相同的api，只不过这个api是在调用slf4j的api。</li><li>为项目添加SLF4J的具体实现。</li></ol><p>迁移的方式：</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- 桥接的组件 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>log4j-over-slf4j<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.7.27<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-api<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.7.27<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-simple<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.7.27<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SLF4J提供的桥接器：</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- log4j--<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>log4j-over-slf4j<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.7.27<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!-- jul --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>jul-to-slf4j<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.7.27<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!--jcl --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>jcl-over-slf4j<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.7.27<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意问题：</p><ol><li>jcl-over-slf4j.jar和 slf4j-jcl.jar不能同时部署。前一个jar文件将导致JCL将日志系统的选择委托给 SLF4J，后一个jar文件将导致SLF4J将日志系统的选择委托给JCL，从而导致无限循环。</li><li>log4j-over-slf4j.jar和slf4j-log4j12.jar不能同时出现</li><li>jul-to-slf4j.jar和slf4j-jdk14.jar不能同时出现</li><li>所有的桥接都只对Logger日志记录器对象有效，如果程序中调用了内部的配置类或者是 Appender,Filter等对象，将无法产生效果。</li></ol><h4 id="_5、slf4j原理解析" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5、slf4j原理解析">#</a> 5、SLF4J原理解析</h4><ol><li>SLF4J通过LoggerFactory加载日志具体的实现对象。</li><li>LoggerFactory在初始化的过程中，会通过performInitialization()方法绑定具体的日志实现。</li><li>在绑定具体实现的时候，通过类加载器，加载org/slf4j/impl/StaticLoggerBinder.class</li><li>所以，只要是一个日志实现框架，在org.slf4j.impl包中提供一个自己的StaticLoggerBinder类，在其中提供具体日志实现的LoggerFactory就可以被SLF4J所加载</li></ol><p>在slf4j中创建logger的方法是：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Logger <span class="hljs-title function_">getLogger</span><span class="hljs-params">(String name)</span> &#123;<br>    <span class="hljs-type">ILoggerFactory</span> <span class="hljs-variable">iLoggerFactory</span> <span class="hljs-operator">=</span> getILoggerFactory();<br>    <span class="hljs-keyword">return</span> iLoggerFactory.getLogger(name);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>继续进入查看，核心就是performInitialization();：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ILoggerFactory <span class="hljs-title function_">getILoggerFactory</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (INITIALIZATION_STATE == UNINITIALIZED) &#123;<br>        <span class="hljs-keyword">synchronized</span> (LoggerFactory.class) &#123;<br>            <span class="hljs-keyword">if</span> (INITIALIZATION_STATE == UNINITIALIZED) &#123;<br>                INITIALIZATION_STATE = ONGOING_INITIALIZATION;<br>                performInitialization();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>继续进入查看，核心就是bind()，这个方法应该就能绑定日志实现了：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performInitialization</span><span class="hljs-params">()</span> &#123;<br>        bind();<br>        <span class="hljs-keyword">if</span> (INITIALIZATION_STATE == SUCCESSFUL_INITIALIZATION) &#123;<br>            versionSanityCheck();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>来到这里，看看绑定的方法：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bind</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ...<br>            <span class="hljs-comment">// 以下内容就绑定成功了</span><br>            StaticLoggerBinder.getSingleton();<br>            INITIALIZATION_STATE = SUCCESSFUL_INITIALIZATION;<br>            reportActualBinding(staticLoggerBinderPathSet);<br>            fixSubstituteLoggers();<br>            replayEvents();<br>            <span class="hljs-comment">// release all resources in SUBST_FACTORY</span><br>            SUBST_FACTORY.clear();<br>        &#125; <span class="hljs-keyword">catch</span> (NoClassDefFoundError ncde) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> ncde.getMessage();<br>            <span class="hljs-keyword">if</span> (messageContainsOrgSlf4jImplStaticLoggerBinder(msg)) &#123;<br>                INITIALIZATION_STATE = NOP_FALLBACK_INITIALIZATION;<br>                Util.report(<span class="hljs-string">&quot;Failed to load class \&quot;org.slf4j.impl.StaticLoggerBinder\&quot;.&quot;</span>);<br>                Util.report(<span class="hljs-string">&quot;Defaulting to no-operation (NOP) logger implementation&quot;</span>);<br>                Util.report(<span class="hljs-string">&quot;See &quot;</span> + NO_STATICLOGGERBINDER_URL + <span class="hljs-string">&quot; for further details.&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                failedBinding(ncde);<br>                <span class="hljs-keyword">throw</span> ncde;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (java.lang.NoSuchMethodError nsme) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> nsme.getMessage();<br>            <span class="hljs-keyword">if</span> (msg != <span class="hljs-literal">null</span> &amp;amp;&amp;amp; msg.contains(<span class="hljs-string">&quot;org.slf4j.impl.StaticLoggerBinder.getSingleton()&quot;</span>)) &#123;<br>                INITIALIZATION_STATE = FAILED_INITIALIZATION;<br>                Util.report(<span class="hljs-string">&quot;slf4j-api 1.6.x (or later) is incompatible with this binding.&quot;</span>);<br>                Util.report(<span class="hljs-string">&quot;Your binding is version 1.5.5 or earlier.&quot;</span>);<br>                Util.report(<span class="hljs-string">&quot;Upgrade your binding to version 1.6.x.&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">throw</span> nsme;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            failedBinding(e);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;Unexpected initialization failure&quot;</span>, e);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每一个日志实现的中间包都有一个StaticLoggerBinder：</p><figure><img alt="image-20211021233331749" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021233331749-82120764.png" tabindex="0"/><figcaption>image-20211021233331749</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticLoggerBinder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">LoggerFactoryBinder</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * The unique instance of this class.</span><br><span class="hljs-comment">     * </span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">StaticLoggerBinder</span> <span class="hljs-variable">SINGLETON</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StaticLoggerBinder</span>();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Return the singleton of this class.</span><br><span class="hljs-comment">     * </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> the StaticLoggerBinder singleton</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> StaticLoggerBinder <span class="hljs-title function_">getSingleton</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> SINGLETON;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Declare the version of the SLF4J API this implementation is compiled against. </span><br><span class="hljs-comment">     * The value of this field is modified with each major release. </span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">// to avoid constant folding by the compiler, this field must *not* be final</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">REQUESTED_API_VERSION</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;1.6.99&quot;</span>; <span class="hljs-comment">// !final</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">loggerFactoryClassStr</span> <span class="hljs-operator">=</span> Log4jLoggerFactory.class.getName();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * The ILoggerFactory instance returned by the &#123;<span class="hljs-doctag">@link</span> #getLoggerFactory&#125;</span><br><span class="hljs-comment">     * method should always be the same object</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ILoggerFactory loggerFactory;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">StaticLoggerBinder</span><span class="hljs-params">()</span> &#123;<br>        loggerFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Log4jLoggerFactory</span>();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-meta">@SuppressWarnings(&quot;unused&quot;)</span><br>            <span class="hljs-type">Level</span> <span class="hljs-variable">level</span> <span class="hljs-operator">=</span> Level.TRACE;<br>        &#125; <span class="hljs-keyword">catch</span> (NoSuchFieldError nsfe) &#123;<br>            Util.report(<span class="hljs-string">&quot;This version of SLF4J requires log4j version 1.2.12 or later. See also http://www.slf4j.org/codes.html#log4j_version&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> ILoggerFactory <span class="hljs-title function_">getLoggerFactory</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> loggerFactory;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getLoggerFactoryClassStr</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> loggerFactoryClassStr;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二、jcl-日志门面" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、jcl-日志门面">#</a> 二、JCL 日志门面</h3><p>​ 全称为Jakarta Commons Logging，是Apache提供的一个通用日志API。 改日志门面的使用并不是很广泛。</p><p>​ 它是为 "所有的Java日志实现"提供一个统一的接口，它自身也提供一个日志的实现，但是功能非常常弱 （SimpleLog）。所以一般不会单独使用它。他允许开发人员使用不同的具体日志实现工具: Log4j, Jdk 自带的日志（JUL)</p><p>JCL 有两个基本的抽象类：Log(基本记录器)和LogFactory(负责创建Log实例)。</p><h4 id="_1、jcl入门" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、jcl入门">#</a> 1、JCL入门</h4><ol><li><p>建立maven工程</p></li><li><p>添加依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>commons-logging<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>commons-logging<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.2<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>入门代码</p></li></ol><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JULTest</span> &#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testQuick</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// 创建日志对象</span><br>        <span class="hljs-type">Log</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LogFactory.getLog(JULTest.class);<br>        <span class="hljs-comment">// 日志记录输出</span><br>        log.fatal(<span class="hljs-string">&quot;fatal&quot;</span>);<br>        log.error(<span class="hljs-string">&quot;error&quot;</span>);<br>        log.warn(<span class="hljs-string">&quot;warn&quot;</span>);<br>        log.info(<span class="hljs-string">&quot;info&quot;</span>);<br>        log.debug(<span class="hljs-string">&quot;debug&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>我们为什么要使用日志门面：</strong></p><ol><li>面向接口开发，不再依赖具体的实现类。减少代码的耦合</li><li>项目通过导入不同的日志实现类，可以灵活的切换日志框架</li><li>统一API，方便开发者学习和使用</li><li>统一配置便于项目日志的管理</li></ol><h4 id="_2、jcl原理" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、jcl原理">#</a> 2、JCL原理</h4><figure><img alt="image-20211021231249663" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021231249663-5e859d81.png" tabindex="0"/><figcaption>image-20211021231249663</figcaption></figure><ol><li>通过LogFactory动态加载Log实现类</li></ol><figure><img alt="image-20211020173040622" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211020173040622-50e7df1f.png" tabindex="0"/><figcaption>image-20211020173040622</figcaption></figure><ol start="2"><li>日志门面支持的日志实现数组</li></ol><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] classesToDiscover =<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;org.apache.commons.logging.impl.Log4JLogger&quot;</span>,<br>                 <span class="hljs-string">&quot;org.apache.commons.logging.impl.Jdk14Logger&quot;</span>,<br>                 <span class="hljs-string">&quot;org.apache.commons.logging.impl.Jdk13LumberjackLogger&quot;</span>,<br>                 <span class="hljs-string">&quot;org.apache.commons.logging.impl.SimpleLog&quot;</span>&#125;;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>获取具体的日志实现</li></ol><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &amp;lt; classesToDiscover.length &amp;amp;&amp;amp; result == <span class="hljs-literal">null</span>; ++i) &#123;<br>    result = <span class="hljs-built_in">this</span>.createLogFromClass(classesToDiscover[i], logCategory,<br>                                     <span class="hljs-literal">true</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3、日志生态图" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、日志生态图">#</a> 3、日志生态图：</h4><figure><img alt="image-20211031103502365" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211031103502365-06f774c0.png" tabindex="0"/><figcaption>image-20211031103502365</figcaption></figure><p>历史插曲：现在聊聊历史：<a href="https://segmentfault.com/a/1190000021121882?utm_source=tag-newest" rel="noopener noreferrer" target="_blank">https://segmentfault.com/a/1190000021121882?utm_source=tag-newest<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="第五章-logback的使用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第五章-logback的使用">#</a> 第五章 Logback的使用</h2><p>Logback是由log4j创始人设计的另一个开源日志组件，性能比log4j要好。</p><p>官方网站：<a href="https://logback.qos.ch/index.html" rel="noopener noreferrer" target="_blank">https://logback.qos.ch/index.html<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>Logback主要分为三个模块：</p><ul><li><p>logback-core：其它两个模块的基础模块</p></li><li><p>logback-classic：它是log4j的一个改良版本，同时它完整实现了slf4j API</p></li><li><p>logback-access：访问模块与Servlet容器集成提供通过Http来访问日志的功能 后续的日志代码都是通过SLF4J日志门面搭建日志系统，所以在代码是没有区别，主要是通过修改配置文件和pom.xml依赖</p></li></ul><h3 id="一、logback入门" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、logback入门">#</a> 一、logback入门</h3><ol><li>添加依赖</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>ch.qos.logback<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>logback-classic<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.2.3<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>java代码</li></ol><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestLogback</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(TestLog4j.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogback</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//打印日志信息</span><br>        logger.error(<span class="hljs-string">&quot;error&quot;</span>);<br>        logger.warn(<span class="hljs-string">&quot;warn&quot;</span>);<br>        logger.info(<span class="hljs-string">&quot;info&quot;</span>);<br>        logger.debug(<span class="hljs-string">&quot;debug&quot;</span>);<br>        logger.trace(<span class="hljs-string">&quot;trace&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其实我们发现即使项目中没有引入slf4j我们这里也是用的slf4j门面进行编程。</p><p>1、</p><figure><img alt="image-20211022094203520" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211022094203520-a45a4bf3.png" tabindex="0"/><figcaption>image-20211022094203520</figcaption></figure><p>2、从logback'的pom依赖中我们看到slf4j，依赖会进行传递</p><figure><img alt="image-20211022094404297" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211022094404297-f7046835.png" tabindex="0"/><figcaption>image-20211022094404297</figcaption></figure><h3 id="二、源码解析" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、源码解析">#</a> 二、源码解析</h3><h4 id="_1、spi机制" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、spi机制">#</a> 1、spi机制</h4><p>SPI全称Service Provider Interface，是Java提供的一套用来被第三方实现或者扩展的API，它可以用来启用框架扩展和替换组件。他是一种服务发现机制。它通过在ClassPath路径下的META-INF/services文件夹查找文件，自动加载文件里所定义的类。</p><p>主要是使用，java.util包下的ServiceLoader实现：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &amp;lt;S&amp;gt; ServiceLoader&amp;lt;S&amp;gt; load(Class&amp;lt;S&amp;gt; service, ClassLoader loader)<br>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceLoader</span>&amp;lt;&amp;gt;(service, loader);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、源码解析" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、源码解析">#</a> 2、源码解析</h4><p>源码看一下启动过程：</p><p>1、我们从日志工厂的常见看起，这里是slf4j的实现：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(TestLog4j.class);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>核心方法只有一句：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Logger <span class="hljs-title function_">getLogger</span><span class="hljs-params">(Class&amp;lt;?&amp;gt; clazz)</span> &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> getLogger(clazz.getName());<br>    ...中间的逻辑判断省略掉<br>    <span class="hljs-keyword">return</span> logger;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看一下getLogger方法，这里是先获取日志工厂，在从工厂中提取日志对象，我们不考虑日志对象，主要看看日志工厂的环境怎么初始化的：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Logger <span class="hljs-title function_">getLogger</span><span class="hljs-params">(String name)</span> &#123;<br>    <span class="hljs-type">ILoggerFactory</span> <span class="hljs-variable">iLoggerFactory</span> <span class="hljs-operator">=</span> getILoggerFactory();<br>    <span class="hljs-keyword">return</span> iLoggerFactory.getLogger(name);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>日志工厂的创建方法：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ILoggerFactory <span class="hljs-title function_">getILoggerFactory</span><span class="hljs-params">()</span> &#123;<br>    ...去掉其他的代码，从这一行看。<br>    <span class="hljs-keyword">return</span> StaticLoggerBinder.getSingleton().getLoggerFactory();<br><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里就进入了，StaticLoggerBinder这个对象，这是日志实现用来和slf4j进行绑定的类，从此就进入日志实现中了。</p><p>StaticLoggerBinder.getSingleton()这里看到出来是一个单例，来到这个类当中，我们看到，直接返回了defaultLoggerContext</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">public ILoggerFactory getLoggerFactory() &#123;<br>        if (!initialized) &#123;<br>            return defaultLoggerContext;<br>        &#125;<br>... 省略其他<br><br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这是个日志上下文，一定保存了我们的环境，配置内容一定在这个里边，那么哪里初始化他了呢，我们能想到的就是静态代码块了：</p><p>我们发现这个类中还真有：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> &#123;<br>    SINGLETON.init();<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们看到init()方法中，有一个autoConfig()，感觉就像在自动配置：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ContextInitializer</span>(defaultLoggerContext).autoConfig();<br>        &#125; <span class="hljs-keyword">catch</span> (JoranException je) &#123;<br>            Util.report(<span class="hljs-string">&quot;Failed to auto configure default logger context&quot;</span>, je);<br>        &#125;<br>        ...其他省略<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>默认配置：ContextInitializer类是初始化的关键：</p><p>自动配置是这么玩的，先找配置文件</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">autoConfig</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> JoranException &#123;<br>        StatusListenerConfigHelper.installIfAsked(loggerContext);<br>        <span class="hljs-comment">// 这就是去找配置文件</span><br>        <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> findURLOfDefaultConfigurationFile(<span class="hljs-literal">true</span>);<br>        <span class="hljs-keyword">if</span> (url != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// 解析配置</span><br>            configureByResource(url);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// 没有找到文件，就去使用spi机制找一个配置类，这个配置类是在web中用的</span><br>            <span class="hljs-type">Configurator</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> EnvUtil.loadFromServiceLoader(Configurator.class);<br>            <span class="hljs-keyword">if</span> (c != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    c.setContext(loggerContext);<br>                    c.configure(loggerContext);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogbackException</span>(String.format(<span class="hljs-string">&quot;Failed to initialize Configurator: %s using ServiceLoader&quot;</span>, c != <span class="hljs-literal">null</span> ? c.getClass()<br>                                    .getCanonicalName() : <span class="hljs-string">&quot;null&quot;</span>), e);<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// 如果没有找到，就做基本的配置</span><br>                <span class="hljs-type">BasicConfigurator</span> <span class="hljs-variable">basicConfigurator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicConfigurator</span>();<br>                basicConfigurator.setContext(loggerContext);<br>                basicConfigurator.configure(loggerContext);<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>寻找配置文件的过程：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">GROOVY_AUTOCONFIG_FILE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;logback.groovy&quot;</span>;<br><span class="hljs-keyword">final</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">AUTOCONFIG_FILE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;logback.xml&quot;</span>;<br><span class="hljs-keyword">final</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">TEST_AUTOCONFIG_FILE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;logback-test.xml&quot;</span>;<br><br><span class="hljs-keyword">public</span> URL <span class="hljs-title function_">findURLOfDefaultConfigurationFile</span><span class="hljs-params">(<span class="hljs-type">boolean</span> updateStatus)</span> &#123;<br>    <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">myClassLoader</span> <span class="hljs-operator">=</span> Loader.getClassLoaderOfObject(<span class="hljs-built_in">this</span>);<br>    <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> findConfigFileURLFromSystemProperties(myClassLoader, updateStatus);<br>    <span class="hljs-keyword">if</span> (url != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> url;<br>    &#125;<br><br>    url = getResource(TEST_AUTOCONFIG_FILE, myClassLoader, updateStatus);<br>    <span class="hljs-keyword">if</span> (url != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> url;<br>    &#125;<br><br>    url = getResource(GROOVY_AUTOCONFIG_FILE, myClassLoader, updateStatus);<br>    <span class="hljs-keyword">if</span> (url != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> url;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> getResource(AUTOCONFIG_FILE, myClassLoader, updateStatus);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureByResource</span><span class="hljs-params">(URL url)</span> <span class="hljs-keyword">throws</span> JoranException &#123;<br>       <span class="hljs-keyword">if</span> (url == <span class="hljs-literal">null</span>) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;URL argument cannot be null&quot;</span>);<br>       &#125;<br>       <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">urlString</span> <span class="hljs-operator">=</span> url.toString();<br>       <span class="hljs-keyword">if</span> (urlString.endsWith(<span class="hljs-string">&quot;groovy&quot;</span>)) &#123;<br>           <span class="hljs-keyword">if</span> (EnvUtil.isGroovyAvailable()) &#123;<br>               <span class="hljs-comment">// avoid directly referring to GafferConfigurator so as to avoid</span><br>               <span class="hljs-comment">// loading groovy.lang.GroovyObject . See also http://jira.qos.ch/browse/LBCLASSIC-214</span><br>               GafferUtil.runGafferConfiguratorOn(loggerContext, <span class="hljs-built_in">this</span>, url);<br>           &#125; <span class="hljs-keyword">else</span> &#123;<br>               <span class="hljs-type">StatusManager</span> <span class="hljs-variable">sm</span> <span class="hljs-operator">=</span> loggerContext.getStatusManager();<br>               sm.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorStatus</span>(<span class="hljs-string">&quot;Groovy classes are not available on the class path. ABORTING INITIALIZATION.&quot;</span>, loggerContext));<br>           &#125;<br>       &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (urlString.endsWith(<span class="hljs-string">&quot;xml&quot;</span>)) &#123;<br>           <span class="hljs-type">JoranConfigurator</span> <span class="hljs-variable">configurator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JoranConfigurator</span>();<br>           configurator.setContext(loggerContext);<br>           configurator.doConfigure(url);<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogbackException</span>(<span class="hljs-string">&quot;Unexpected filename extension of file [&quot;</span> + url.toString() + <span class="hljs-string">&quot;]. Should be either .groovy or .xml&quot;</span>);<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>基础配置的代码：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicConfigurator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ContextAwareBase</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Configurator</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BasicConfigurator</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(LoggerContext lc)</span> &#123;<br>        addInfo(<span class="hljs-string">&quot;Setting up default configuration.&quot;</span>);<br><br>        ConsoleAppender&amp;lt;ILoggingEvent&amp;gt; ca = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleAppender</span>&amp;lt;ILoggingEvent&amp;gt;();<br>        ca.setContext(lc);<br>        ca.setName(<span class="hljs-string">&quot;console&quot;</span>);<br>        LayoutWrappingEncoder&amp;lt;ILoggingEvent&amp;gt; encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LayoutWrappingEncoder</span>&amp;lt;ILoggingEvent&amp;gt;();<br>        encoder.setContext(lc);<br><br><br>        <span class="hljs-comment">// same as </span><br>        <span class="hljs-comment">// PatternLayout layout = new PatternLayout();</span><br>        <span class="hljs-comment">// layout.setPattern(&quot;%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;);</span><br>        <span class="hljs-type">TTLLLayout</span> <span class="hljs-variable">layout</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TTLLLayout</span>();<br><br>        layout.setContext(lc);<br>        layout.start();<br>        encoder.setLayout(layout);<br><br>        ca.setEncoder(encoder);<br>        ca.start();<br><br>        <span class="hljs-type">Logger</span> <span class="hljs-variable">rootLogger</span> <span class="hljs-operator">=</span> lc.getLogger(Logger.ROOT_LOGGER_NAME);<br>        rootLogger.addAppender(ca);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们先不说配置的事情，从源码中我们可以看出有几种配置，因为有了</p><p>我们先模仿BasicConfigurator写一个类，只做略微的改动：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfigurator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ContextAwareBase</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Configurator</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyConfigurator</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(LoggerContext lc)</span> &#123;<br>        addInfo(<span class="hljs-string">&quot;Setting up default configuration.&quot;</span>);<br><br>        ConsoleAppender&amp;lt;ILoggingEvent&amp;gt; ca = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleAppender</span>&amp;lt;ILoggingEvent&amp;gt;();<br>        ca.setContext(lc);<br>        ca.setName(<span class="hljs-string">&quot;console&quot;</span>);<br>        LayoutWrappingEncoder&amp;lt;ILoggingEvent&amp;gt; encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LayoutWrappingEncoder</span>&amp;lt;ILoggingEvent&amp;gt;();<br>        encoder.setContext(lc);<br><br><br>        <span class="hljs-comment">// same as</span><br>        <span class="hljs-comment">// PatternLayout layout = new PatternLayout();</span><br>        <span class="hljs-comment">// layout.setPattern(&quot;%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;);</span><br>        <span class="hljs-type">PatternLayout</span> <span class="hljs-variable">layout</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PatternLayout</span>();<br>        layout.setPattern(<span class="hljs-string">&quot;%d&#123;HH:mm:ss&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;</span>);<br><br>        layout.setContext(lc);<br>        layout.start();<br>        encoder.setLayout(layout);<br><br>        ca.setEncoder(encoder);<br>        ca.start();<br><br>        <span class="hljs-type">Logger</span> <span class="hljs-variable">rootLogger</span> <span class="hljs-operator">=</span> lc.getLogger(Logger.ROOT_LOGGER_NAME);<br>        rootLogger.addAppender(ca);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在resource中新建META-INF目录，下边在新建services文件夹，再新建一个名字我<code>ch.qos.logback.classic.spi.Configurator</code>的文件，</p><p>内容是：com.ydlclass.MyConfigurator</p><figure><img alt="image-20211022111350444" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211022111350444-a7af7dc8.png" tabindex="0"/><figcaption>image-20211022111350444</figcaption></figure><h3 id="三、三大组件" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、三大组件">#</a> 三、三大组件</h3><p>1、appender，输出源，一个日志可以后好几个输出源</p><p>2、encoder，一个appender有一个encoder，负责将一个event事件转换成一组byte数组，并将转换后的字节数据输出到文件中。</p><p>Encoder负责把事件转换为字节数组，并把字节数组写到合适的输出流。因此，encoder可以控制在什么时候、把什么样的字节数组写入到其拥有者维护的输出流中。Encoder接口有两个实现类，LayoutWrappingEncoder与PatternLayoutEncoder。</p><p>注意：在logback 0.9.19 版之前没有 encoder。</p><p>在之前的版本里，多数 appender 依靠 layout 来把事件转换成字符串并用 java.io.Writer 把字符串输出。在之前的版本里，用户需要在 FileAppender里嵌入一个 PatternLayout。</p><p>3、layout，格式化数据将event事件转化为字符串，解析的过程</p><p>4、filter 过滤器</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">LevelFilter levelFilter = new LevelFilter();<br>        levelFilter.setOnMatch(FilterReply.DENY);<br>        levelFilter.setLevel(Level.WARN);<br>        levelFilter.start();<br>        ca.addFilter(levelFilter);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>%-5level</li><li>%d{yyyy-MM-dd HH:mm:ss.SSS}日期</li><li>%c类的完整名称</li><li>%M为method</li><li>%L为行号</li><li>%thread线程名称</li><li>%m或者%msg为信息</li><li>%n换行</li></ol><p>能看到logback的格式化信息</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PatternLayout</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PatternLayoutBase</span>&amp;lt;ILoggingEvent&amp;gt; &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&amp;lt;String, String&amp;gt; defaultConverterMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&amp;lt;String, String&amp;gt;();<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">HEADER_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;#logback.classic pattern: &quot;</span>;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        defaultConverterMap.putAll(Parser.DEFAULT_COMPOSITE_CONVERTER_MAP);<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;d&quot;</span>, DateConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;date&quot;</span>, DateConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;r&quot;</span>, RelativeTimeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;relative&quot;</span>, RelativeTimeConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;level&quot;</span>, LevelConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;le&quot;</span>, LevelConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;p&quot;</span>, LevelConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;t&quot;</span>, ThreadConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;thread&quot;</span>, ThreadConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;lo&quot;</span>, LoggerConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;logger&quot;</span>, LoggerConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;c&quot;</span>, LoggerConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;m&quot;</span>, MessageConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;msg&quot;</span>, MessageConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;message&quot;</span>, MessageConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;C&quot;</span>, ClassOfCallerConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;class&quot;</span>, ClassOfCallerConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;M&quot;</span>, MethodOfCallerConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;method&quot;</span>, MethodOfCallerConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;L&quot;</span>, LineOfCallerConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;line&quot;</span>, LineOfCallerConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;F&quot;</span>, FileOfCallerConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;file&quot;</span>, FileOfCallerConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;X&quot;</span>, MDCConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;mdc&quot;</span>, MDCConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;ex&quot;</span>, ThrowableProxyConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;exception&quot;</span>, ThrowableProxyConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;rEx&quot;</span>, RootCauseFirstThrowableProxyConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;rootException&quot;</span>, RootCauseFirstThrowableProxyConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;throwable&quot;</span>, ThrowableProxyConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;xEx&quot;</span>, ExtendedThrowableProxyConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;xException&quot;</span>, ExtendedThrowableProxyConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;xThrowable&quot;</span>, ExtendedThrowableProxyConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;nopex&quot;</span>, NopThrowableInformationConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;nopexception&quot;</span>, NopThrowableInformationConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;cn&quot;</span>, ContextNameConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;contextName&quot;</span>, ContextNameConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;caller&quot;</span>, CallerDataConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;marker&quot;</span>, MarkerConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;property&quot;</span>, PropertyConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;n&quot;</span>, LineSeparatorConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;black&quot;</span>, BlackCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;red&quot;</span>, RedCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;green&quot;</span>, GreenCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;yellow&quot;</span>, YellowCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;blue&quot;</span>, BlueCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;magenta&quot;</span>, MagentaCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;cyan&quot;</span>, CyanCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;white&quot;</span>, WhiteCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;gray&quot;</span>, GrayCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;boldRed&quot;</span>, BoldRedCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;boldGreen&quot;</span>, BoldGreenCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;boldYellow&quot;</span>, BoldYellowCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;boldBlue&quot;</span>, BoldBlueCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;boldMagenta&quot;</span>, BoldMagentaCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;boldCyan&quot;</span>, BoldCyanCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;boldWhite&quot;</span>, BoldWhiteCompositeConverter.class.getName());<br>        defaultConverterMap.put(<span class="hljs-string">&quot;highlight&quot;</span>, HighlightingCompositeConverter.class.getName());<br><br>        defaultConverterMap.put(<span class="hljs-string">&quot;lsn&quot;</span>, LocalSequenceNumberConverter.class.getName());<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PatternLayout</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.postCompileProcessor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EnsureExceptionHandling</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Map&amp;lt;String, String&amp;gt; getDefaultConverterMap() &#123;<br>        <span class="hljs-keyword">return</span> defaultConverterMap;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">doLayout</span><span class="hljs-params">(ILoggingEvent event)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!isStarted()) &#123;<br>            <span class="hljs-keyword">return</span> CoreConstants.EMPTY_STRING;<br>        &#125;<br>        <span class="hljs-keyword">return</span> writeLoopOnConverters(event);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> String <span class="hljs-title function_">getPresentationHeaderPrefix</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> HEADER_PREFIX;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">OutputStreamAppender<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs text">protected void subAppend(E event) &#123;<br>        if (!isStarted()) &#123;<br>            return;<br>        &#125;<br>        try &#123;<br>            // this step avoids LBCLASSIC-139<br>            if (event instanceof DeferredProcessingAware) &#123;<br>                ((DeferredProcessingAware) event).prepareForDeferredProcessing();<br>            &#125;<br>            // the synchronization prevents the OutputStream from being closed while we<br>            // are writing. It also prevents multiple threads from entering the same<br>            // converter. Converters assume that they are in a synchronized block.<br>            // lock.lock();<br><br>            byte[] byteArray = this.encoder.encode(event);<br>            writeBytes(byteArray);<br><br>        &#125; catch (IOException ioe) &#123;<br>            // as soon as an exception occurs, move to non-started state<br>            // and add a single ErrorStatus to the SM.<br>            this.started = false;<br>            addStatus(new ErrorStatus(&quot;IO failure in appender&quot;, this, ioe));<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">public byte[] encode(E event) &#123;<br>        String txt = layout.doLayout(event);<br>        return convertToBytes(txt);<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildLoggingEventAndAppend</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String localFQCN, <span class="hljs-keyword">final</span> Marker marker, <span class="hljs-keyword">final</span> Level level, <span class="hljs-keyword">final</span> String msg, <span class="hljs-keyword">final</span> Object[] params,</span><br><span class="hljs-params">                                        <span class="hljs-keyword">final</span> Throwable t)</span> &#123;<br>    <span class="hljs-type">LoggingEvent</span> <span class="hljs-variable">le</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingEvent</span>(localFQCN, <span class="hljs-built_in">this</span>, level, msg, t, params);<br>    le.setMarker(marker);<br>    callAppenders(le);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="四、logback配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、logback配置">#</a> 四、logback配置</h3><p>Let us begin by discussing the initialization steps that logback follows to try to configure itself:</p><ol><li><p>Logback tries to find a file called <em>logback-test.xml</em> <a href="http://logback.qos.ch/faq.html#configFileLocation" rel="noopener noreferrer" target="_blank">in the classpath<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></li><li><p>If no such file is found, logback tries to find a file called <em>logback.groovy</em> <a href="http://logback.qos.ch/faq.html#configFileLocation" rel="noopener noreferrer" target="_blank">in the classpath<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></li><li><p>If no such file is found, it checks for the file <em>logback.xml</em> <a href="http://logback.qos.ch/faq.html#configFileLocation" rel="noopener noreferrer" target="_blank">in the classpath<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>..</p></li><li><p>If no such file is found, <a href="http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html" rel="noopener noreferrer" target="_blank">service-provider loading facility<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (introduced in JDK 1.6) is used to resolve the implementation of <a href="http://logback.qos.ch/xref/ch/qos/logback/classic/spi/Configurator.html" rel="noopener noreferrer" target="_blank"><code>com.qos.logback.classic.spi.Configurator</code><span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> interface by looking up the file <em>META-INF\services\ch.qos.logback.classic.spi.Configurator</em> in the class path. Its contents should specify the fully qualified class name of the desired <code>Configurator</code> implementation.</p></li><li><p>If none of the above succeeds, logback configures itself automatically using the <a href="http://logback.qos.ch/xref/ch/qos/logback/classic/BasicConfigurator.html" rel="noopener noreferrer" target="_blank"><code>BasicConfigurator</code><span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> which will cause logging output to be directed to the console.</p></li><li><p>基本配置信息</p></li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>configuration<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度<br>    %msg：日志消息，%n是换行符--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;pattern&quot; value=&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %c [%thread]<br>                                    %-5level %msg%n&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--<br>        Appender: 设置日志信息的去向,常用的有以下几个<br>        ch.qos.logback.core.ConsoleAppender (控制台)<br>        ch.qos.logback.core.rolling.RollingFileAppender (文件大小到达指定尺寸的时候产生一个新文件)<br>        ch.qos.logback.core.FileAppender (文件)<br>        --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--输出流对象 默认 System.out 改为 System.err--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>target<span class="hljs-symbol">&amp;gt;</span>System.err<span class="hljs-symbol">&amp;lt;</span>/target<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--日志格式配置--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>pattern<span class="hljs-symbol">&amp;gt;</span>$&#123;pattern&#125;<span class="hljs-symbol">&amp;lt;</span>/pattern<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/encoder<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/appender<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--<br>  用来设置某一个包或者具体的某一个类的日志打印级别、以及指定<span class="hljs-symbol">&amp;lt;</span>appender<span class="hljs-symbol">&amp;gt;</span>。<br>                    <span class="hljs-symbol">&amp;lt;</span>loger<span class="hljs-symbol">&amp;gt;</span>仅有一个name属性，一个可选的level和一个可选的addtivity属性<br>                    name:<br>        用来指定受此logger约束的某一个包或者具体的某一个类。<br>            level:<br>        用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和<br>            OFF，<br>            如果未设置此属性，那么当前logger将会继承上级的级别。<br>            additivity:<br>        是否向上级loger传递打印信息。默认是true。<br>            <span class="hljs-symbol">&amp;lt;</span>logger<span class="hljs-symbol">&amp;gt;</span>可以包含零个或多个<span class="hljs-symbol">&amp;lt;</span>appender-ref<span class="hljs-symbol">&amp;gt;</span>元素，标识这个appender将会添加到这个<br>            logger<br>            --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--<br>            也是<span class="hljs-symbol">&amp;lt;</span>logger<span class="hljs-symbol">&amp;gt;</span>元素，但是它是根logger。默认debug<br>            level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL<br>                和 OFF，<br>                <span class="hljs-symbol">&amp;lt;</span>root<span class="hljs-symbol">&amp;gt;</span>可以包含零个或多个<span class="hljs-symbol">&amp;lt;</span>appender-ref<span class="hljs-symbol">&amp;gt;</span>元素，标识这个appender将会添加到这个<br>                logger。<br>        --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>root level=&quot;ALL&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>appender-ref ref=&quot;console&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/root<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/configuration<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>FileAppender配置</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>configuration<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 自定义属性 可以通过$&#123;name&#125;进行引用--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;pattern&quot; value=&quot;[%-5level] %d&#123;yyyy-MM-dd HH:mm:ss&#125; %c %M<br>                                    %L [%thread] %m %n&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--<br>    日志输出格式：<br>    %d&#123;pattern&#125;日期<br>    %m或者%msg为信息<br>    %M为method<br>    %L为行号<br>    %c类的完整名称<br>    %thread线程名称<br>    %n换行<br>    %-5level<br>    --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 日志文件存放目录 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;log_dir&quot; value=&quot;d:/logs&quot;<span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--控制台输出appender对象--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--输出流对象 默认 System.out 改为 System.err--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>target<span class="hljs-symbol">&amp;gt;</span>System.err<span class="hljs-symbol">&amp;lt;</span>/target<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--日志格式配置--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>encoder<br>                 class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>pattern<span class="hljs-symbol">&amp;gt;</span>$&#123;pattern&#125;<span class="hljs-symbol">&amp;lt;</span>/pattern<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/encoder<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/appender<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--日志文件输出appender对象--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>appender name=&quot;file&quot; class=&quot;ch.qos.logback.core.FileAppender&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--日志格式配置--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>pattern<span class="hljs-symbol">&amp;gt;</span>$&#123;pattern&#125;<span class="hljs-symbol">&amp;lt;</span>/pattern<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/encoder<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--日志输出路径--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>file<span class="hljs-symbol">&amp;gt;</span>$&#123;log_dir&#125;/logback.log<span class="hljs-symbol">&amp;lt;</span>/file<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/appender<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 生成html格式appender对象 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>appender name=&quot;htmlFile&quot; class=&quot;ch.qos.logback.core.FileAppender&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--日志格式配置--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>encoder class=&quot;ch.qos.logback.core.encoder.LayoutWrappingEncoder&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>layout class=&quot;ch.qos.logback.classic.html.HTMLLayout&quot;<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>pattern<span class="hljs-symbol">&amp;gt;</span>%level%d&#123;yyyy-MM-dd HH:mm:ss&#125;%c%M%L%thread%m<span class="hljs-symbol">&amp;lt;</span>/pattern<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>/layout<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/encoder<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--日志输出路径--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>file<span class="hljs-symbol">&amp;gt;</span>$&#123;log_dir&#125;/logback.html<span class="hljs-symbol">&amp;lt;</span>/file<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/appender<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--RootLogger对象--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>root level=&quot;all&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>appender-ref ref=&quot;console&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>appender-ref ref=&quot;file&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>appender-ref ref=&quot;htmlFile&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/root<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/configuration<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>RollingFileAppender配置</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>configuration<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 自定义属性 可以通过$&#123;name&#125;进行引用--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;pattern&quot; value=&quot;[%-5level] %d&#123;yyyy-MM-dd HH:mm:ss&#125; %c %M<br>                                    %L [%thread] %m %n&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--<br>    日志输出格式：<br>    %d&#123;pattern&#125;日期<br>    %m或者%msg为信息<br>    %M为method<br>    %L为行号<br>    %c类的完整名称<br>    %thread线程名称<br>    %n换行<br>    %-5level<br>    --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 日志文件存放目录 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;log_dir&quot; value=&quot;d:/logs&quot;<span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--控制台输出appender对象--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--输出流对象 默认 System.out 改为 System.err--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>target<span class="hljs-symbol">&amp;gt;</span>System.err<span class="hljs-symbol">&amp;lt;</span>/target<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--日志格式配置--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>encoder<br>                 class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>pattern<span class="hljs-symbol">&amp;gt;</span>$&#123;pattern&#125;<span class="hljs-symbol">&amp;lt;</span>/pattern<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/encoder<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/appender<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 日志文件拆分和归档的appender对象--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>appender name=&quot;rollFile&quot;<br>              class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--日志格式配置--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>encoder<br>                 class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>pattern<span class="hljs-symbol">&amp;gt;</span>$&#123;pattern&#125;<span class="hljs-symbol">&amp;lt;</span>/pattern<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/encoder<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--日志输出路径--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>file<span class="hljs-symbol">&amp;gt;</span>$&#123;log_dir&#125;/roll_logback.log<span class="hljs-symbol">&amp;lt;</span>/file<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--指定日志文件拆分和压缩规则--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>rollingPolicy class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>!--通过指定压缩文件名称，来确定分割文件方式--<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>fileNamePattern<span class="hljs-symbol">&amp;gt;</span>$&#123;log_dir&#125;/rolling.%d&#123;yyyy-MMdd&#125;.log%i.gz<span class="hljs-symbol">&amp;lt;</span>/fileNamePattern<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>!--文件拆分大小--<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>maxFileSize<span class="hljs-symbol">&amp;gt;</span>1MB<span class="hljs-symbol">&amp;lt;</span>/maxFileSize<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/rollingPolicy<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/appender<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--RootLogger对象--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>root level=&quot;all&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>appender-ref ref=&quot;console&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>appender-ref ref=&quot;rollFile&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/root<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/configuration<span class="hljs-symbol">&amp;gt;</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>Filter和异步日志配置</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>configuration<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 自定义属性 可以通过$&#123;name&#125;进行引用--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;pattern&quot; value=&quot;[%-5level] %d&#123;yyyy-MM-dd HH:mm:ss&#125; %c %M<br>                                    %L [%thread] %m %n&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--<br>    日志输出格式：<br>    %d&#123;pattern&#125;日期<br>    %m或者%msg为信息<br>    %M为method<br>    %L为行号<br>    %c类的完整名称<br>    %thread线程名称<br>    %n换行<br>    %-5level<br>    --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 日志文件存放目录 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;log_dir&quot; value=&quot;d:/logs/&quot;<span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--控制台输出appender对象--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--输出流对象 默认 System.out 改为 System.err--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>target<span class="hljs-symbol">&amp;gt;</span>System.err<span class="hljs-symbol">&amp;lt;</span>/target<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--日志格式配置--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>encoder<br>                 class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>pattern<span class="hljs-symbol">&amp;gt;</span>$&#123;pattern&#125;<span class="hljs-symbol">&amp;lt;</span>/pattern<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/encoder<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/appender<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 日志文件拆分和归档的appender对象--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>appender name=&quot;rollFile&quot;<br>              class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--日志格式配置--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>encoder<br>                 class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>pattern<span class="hljs-symbol">&amp;gt;</span>$&#123;pattern&#125;<span class="hljs-symbol">&amp;lt;</span>/pattern<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/encoder<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--日志输出路径--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>file<span class="hljs-symbol">&amp;gt;</span>$&#123;log_dir&#125;roll_logback.log<span class="hljs-symbol">&amp;lt;</span>/file<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--指定日志文件拆分和压缩规则--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>rollingPolicy<br>                       class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>!--通过指定压缩文件名称，来确定分割文件方式--<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>fileNamePattern<span class="hljs-symbol">&amp;gt;</span>$&#123;log_dir&#125;rolling.%d&#123;yyyy-MMdd&#125;.log%i.gz<span class="hljs-symbol">&amp;lt;</span>/fileNamePattern<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>!--文件拆分大小--<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>maxFileSize<span class="hljs-symbol">&amp;gt;</span>1MB<span class="hljs-symbol">&amp;lt;</span>/maxFileSize<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/rollingPolicy<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--filter配置--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>!--设置拦截日志级别--<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>level<span class="hljs-symbol">&amp;gt;</span>error<span class="hljs-symbol">&amp;lt;</span>/level<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>onMatch<span class="hljs-symbol">&amp;gt;</span>ACCEPT<span class="hljs-symbol">&amp;lt;</span>/onMatch<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>onMismatch<span class="hljs-symbol">&amp;gt;</span>DENY<span class="hljs-symbol">&amp;lt;</span>/onMismatch<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/filter<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/appender<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--异步日志--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>appender name=&quot;async&quot; class=&quot;ch.qos.logback.classic.AsyncAppender&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>appender-ref ref=&quot;rollFile&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/appender<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--RootLogger对象--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>root level=&quot;all&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>appender-ref ref=&quot;console&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>appender-ref ref=&quot;async&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/root<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!--自定义logger additivity表示是否从 rootLogger继承配置--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>logger name=&quot;com.ydlclass&quot; level=&quot;debug&quot; additivity=&quot;false&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>appender-ref ref=&quot;console&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/logger<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/configuration<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="五、logback-access的使用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#五、logback-access的使用">#</a> 五、logback-access的使用</h3><p>在server.xml里的&lt;host&gt;标签下加上</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot;  directory=&quot;logs&quot; prefix=&quot;localhost_access_log.&quot; suffix=&quot;.txt&quot;  pattern=&quot;common&quot; resolveHosts=&quot;false&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>就可以了，下面咱们逐一分析各个参数。</p><table><thead><tr><th>className</th><th>想配置访问日志？这就必须得写成这样。</th></tr></thead><tbody><tr><td>directory</td><td>这个东西是日志文件放置的目录，在tomcat下面有个logs文件夹，那里面是专门放置日志文件的，当然你也可以修改，我就给改成了D:\</td></tr><tr><td>prefix</td><td>这个是日志文件的名称前缀，我的日志名称为localhost_access_log.2007-09-22.txt，前面的前缀就是这个localhost_access_log</td></tr><tr><td>suffix</td><td>这就是后缀名啦，可以改成别的</td></tr><tr><td>pattern</td><td>这个是最主要的参数了，具体的咱们下面讲，这个参数的内容比较丰富。</td></tr><tr><td>resolveHosts</td><td>如果这个值是true的话，tomcat会将这个服务器IP地址通过DNS转换为主机名，如果是false，就直接写服务器IP地址啦</td></tr></tbody></table><p>To use logback-access with Tomcat, after downloading the logback distribution, place the files <em>logback-core-1.3.0-alpha10.jar</em> and <em>logback-access-1.3.0-alpha10.jar</em> under $TOMCAT_HOME/lib/ directory, where $TOMCAT_HOME is the folder where you have installed Tomcat.</p><p>logback-access模块与Servlet容器（如Tomcat和Jetty）集成，以提供HTTP访问日志功能。我们可以使 用logback-access模块来替换tomcat的访问日志。</p><ol><li><p>将logback-access.jar与logback-core.jar复制到$TOMCAT_HOME/lib/目录下</p></li><li><p>修改$TOMCAT_HOME/conf/server.xml中的Host元素中添加：</p></li></ol><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&amp;lt;Valve className=<span class="hljs-string">&quot;ch.qos.logback.access.tomcat.LogbackValve&quot;</span>/&amp;gt;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><ol start="3"><li>logback默认会在$TOMCAT_HOME/conf下查找文件 logback-access.xml</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>configuration<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- always a good activate OnConsoleStatusListener --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>statusListener<br>                    class=&quot;ch.qos.logback.core.status.OnConsoleStatusListener&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;LOG_DIR&quot; value=&quot;$&#123;catalina.base&#125;/logs&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>appender name=&quot;FILE&quot;<br>              class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>file<span class="hljs-symbol">&amp;gt;</span>$&#123;LOG_DIR&#125;/access.log<span class="hljs-symbol">&amp;lt;</span>/file<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>rollingPolicy<br>                       class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>fileNamePattern<span class="hljs-symbol">&amp;gt;</span>access.%d&#123;yyyy-MM-dd&#125;.log.zip<span class="hljs-symbol">&amp;lt;</span>/fileNamePattern<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/rollingPolicy<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>encoder<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>!-- 访问日志的格式 --<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>pattern<span class="hljs-symbol">&amp;gt;</span>combined<span class="hljs-symbol">&amp;lt;</span>/pattern<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/encoder<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/appender<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>appender-ref ref=&quot;FILE&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/configuration<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">%h %l %u %user %date &quot;%r&quot; %s %b<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>官方配置： <a href="https://logback.qos.ch/access.html#configuration" rel="noopener noreferrer" target="_blank">https://logback.qos.ch/access.html#configuration<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img alt="image-20211026105800183" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211026105800183-ab8ebe30.png" tabindex="0"/><figcaption>image-20211026105800183</figcaption></figure><figure><img alt="image-20211026105525146" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211026105525146-c644841e.png" tabindex="0"/><figcaption>image-20211026105525146</figcaption></figure><h2 id="第六章-log4j2的使用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第六章-log4j2的使用">#</a> 第六章 log4j2的使用</h2><p>Apache Log4j2是对Log4j的升级版，参考了logback的一些优秀的设计，并且修复了一些问题，因此带来了一些重大的提升，主要有：</p><ul><li><p>异常处理，在logback中，Appender中的异常不会被应用感知到，但是在log4j2中，提供了一些异常处理机制。</p></li><li><p>性能提升， log4j2相较于log4j 和logback都具有很明显的性能提升，后面会有官方测试的数据。</p></li><li><p>自动重载配置，参考了logback的设计，当然会提供自动刷新参数配置，最实用的就是我们在生产 上可以动态的修改日志的级别而不需要重启应用。</p></li></ul><p>官网： <a href="https://logging.apache.org/log4j/2.x/" rel="noopener noreferrer" target="_blank">https://logging.apache.org/log4j/2.x/<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="一、log4j2入门" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、log4j2入门">#</a> 一、Log4j2入门</h3><p>​ 目前已经有三个门面了，其实不管是哪里都是江湖，都想写一个门面，一统江湖，所以log42出了提供日志实现以外，也拥有一套自己的独立的门面。</p><p>​ 目前市面上最主流的日志门面就是SLF4J，虽然Log4j2也是日志门面，因为它的日志实现功能非常强大，性能优越。所以大家一般还是将Log4j2看作是日志的实现，Slf4j + Log4j2应该是未来的大势所趋。</p><h4 id="_1、使用log4j-api做门面" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、使用log4j-api做门面">#</a> 1、使用log4j-api做门面</h4><p>（1）添加依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- Log4j2 门面API--<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.apache.logging.log4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>log4j-api<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>2.14.1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!-- Log4j2 日志实现 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.apache.logging.log4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>log4j-core<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>2.14.1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）JAVA代码</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestLog4j2</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOGGER</span> <span class="hljs-operator">=</span> LogManager.getLogger(TestLog4j2.class);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLog</span><span class="hljs-params">()</span>&#123;<br>        LOGGER.fatal(<span class="hljs-string">&quot;fatal&quot;</span>);<br>        LOGGER.error(<span class="hljs-string">&quot;error&quot;</span>);<br>        LOGGER.warn(<span class="hljs-string">&quot;warn&quot;</span>);<br>        LOGGER.info(<span class="hljs-string">&quot;info&quot;</span>);<br>        LOGGER.debug(<span class="hljs-string">&quot;debug&quot;</span>);<br>        LOGGER.trace(<span class="hljs-string">&quot;trace&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果：</p><figure><img alt="image-20211025151930142" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211025151930142-628fd044.png" tabindex="0"/><figcaption>image-20211025151930142</figcaption></figure><h4 id="_2、使用slf4j做门面" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、使用slf4j做门面">#</a> 2、使用slf4j做门面</h4><p>使用slf4j作为日志的门面，使用log4j2作为日志的实现。</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- Log4j2 门面API--<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.apache.logging.log4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>log4j-api<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>2.14.1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!-- Log4j2 日志实现 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.apache.logging.log4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>log4j-core<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>2.14.1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!--使用slf4j作为日志的门面,使用log4j2来记录日志 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-api<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.7.30<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!--为slf4j绑定日志实现 log4j2的适配器 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.apache.logging.log4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>log4j-slf4j-impl<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>2.12.1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> org.slf4j.<span class="hljs-type">Logger</span> <span class="hljs-variable">LOG</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(TestLog4j2.class);<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSlf4j</span><span class="hljs-params">()</span>&#123;<br>    LOG.error(<span class="hljs-string">&quot;error&quot;</span>);<br>    LOG.warn(<span class="hljs-string">&quot;warn&quot;</span>);<br>    LOG.debug(<span class="hljs-string">&quot;debug&quot;</span>);<br>    LOG.info(<span class="hljs-string">&quot;info&quot;</span>);<br>    LOG.trace(<span class="hljs-string">&quot;trace&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果：</p><figure><img alt="image-20211025152411946" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211025152411946-d567ba08.png" tabindex="0"/><figcaption>image-20211025152411946</figcaption></figure><p>我们看到log4j2的默认日志级别好像是error。</p><h3 id="二、log4j2配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、log4j2配置">#</a> 二、Log4j2配置</h3><h4 id="_1、默认配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、默认配置">#</a> 1、默认配置：</h4><p>DefaultConfiguration类中提供的默认配置将设置，</p><p>通过debug可以在LoggerContext类中发现</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">Configuration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultConfiguration</span>();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>可以看到默认的root日志的layout</p><figure><img alt="image-20211025170516097" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211025170516097-5ab25742.png" tabindex="0"/><figcaption>image-20211025170516097</figcaption></figure><p>我们也能看到他的日志级别：</p><figure><img alt="image-20211025170538643" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211025170538643-e0e00836.png" tabindex="0"/><figcaption>image-20211025170538643</figcaption></figure><p>我们能从默认配置类中看到一些默认的配置：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setToDefault</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// LOG4J2-1176 facilitate memory leak investigation</span><br>    setName(DefaultConfiguration.DEFAULT_NAME + <span class="hljs-string">&quot;@&quot;</span> + Integer.toHexString(hashCode()));<br>    <span class="hljs-keyword">final</span> Layout&amp;lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Serializable</span>&amp;gt; layout = PatternLayout.newBuilder()<br>        .withPattern(DefaultConfiguration.DEFAULT_PATTERN)<br>        .withConfiguration(<span class="hljs-built_in">this</span>)<br>        .build();<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Appender</span> <span class="hljs-variable">appender</span> <span class="hljs-operator">=</span> ConsoleAppender.createDefaultAppenderForLayout(layout);<br>    appender.start();<br>    addAppender(appender);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">LoggerConfig</span> <span class="hljs-variable">rootLoggerConfig</span> <span class="hljs-operator">=</span> getRootLogger();<br>    rootLoggerConfig.addAppender(appender, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Level</span> <span class="hljs-variable">defaultLevel</span> <span class="hljs-operator">=</span> Level.ERROR;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">levelName</span> <span class="hljs-operator">=</span> PropertiesUtil.getProperties().getStringProperty(DefaultConfiguration.DEFAULT_LEVEL,<br>                                                                              defaultLevel.name());<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Level</span> <span class="hljs-variable">level</span> <span class="hljs-operator">=</span> Level.valueOf(levelName);<br>    rootLoggerConfig.setLevel(level != <span class="hljs-literal">null</span> ? level : defaultLevel);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>5 自定义配置文件位置</p><p>log4j2默认在classpath下查找配置文件，可以修改配置文件的位置。在非web项目中：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;D:/log4j2.xml&quot;</span>);<br>    <span class="hljs-type">BufferedInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(file));<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">ConfigurationSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigurationSource</span>(in);<br>    Configurator.initialize(<span class="hljs-literal">null</span>, source);<br><br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LogManager.getLogger(<span class="hljs-string">&quot;mylog&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果是web项目，在web.xml中添加</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>context-param<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>param-name<span class="hljs-symbol">&amp;gt;</span>log4jConfiguration<span class="hljs-symbol">&amp;lt;</span>/param-name<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>param-value<span class="hljs-symbol">&amp;gt;</span>/WEB-INF/conf/log4j2.xml<span class="hljs-symbol">&amp;lt;</span>/param-value<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/context-param<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>listener<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>listener-class<span class="hljs-symbol">&amp;gt;</span>org.apache.logging.log4j.web.Log4jServletContextListener<span class="hljs-symbol">&amp;lt;</span>/listener-class<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/listener<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>log4j2默认加载classpath下的 log4j2.xml 文件中的配置。事实上log4j2可以通过 XML、JSON、YAML 或properties格式进行配置：</p><p><a href="https://logging.apache.org/log4j/2.x/manual/configuration.html" rel="noopener noreferrer" target="_blank">https://logging.apache.org/log4j/2.x/manual/configuration.html<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>如果找不到配置文件，Log4j 将提供默认配置。DefaultConfiguration 类中提供的默认配置将设置：</p><ul><li><p>%d{HH:mm:ss.SSS} ，表示输出到毫秒的时间</p></li><li><p>%t，输出当前线程名称</p></li><li><p>%-5level，输出日志级别，-5表示左对齐并且固定输出5个字符，如果不足在右边补0</p></li><li><p>%logger，输出logger名称，因为Root Logger没有名称，所以没有输出</p></li><li><p>%msg，日志文本</p></li><li><p>%n，换行</p></li></ul><p>其他常用的占位符有：</p><ul><li><p>%F，输出所在的类文件名，如Client.java</p></li><li><p>%L，输出行号</p></li><li><p>%M，输出所在方法名</p></li><li><p>%l，输出语句所在的行数, 包括类名、方法名、文件名、行数</p></li></ul><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reconfigure</span><span class="hljs-params">(<span class="hljs-keyword">final</span> URI configURI)</span> &#123;<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">externalContext</span> <span class="hljs-operator">=</span> externalMap.get(EXTERNAL_CONTEXT_KEY);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">cl</span> <span class="hljs-operator">=</span> ClassLoader.class.isInstance(externalContext) ? (ClassLoader) externalContext : <span class="hljs-literal">null</span>;<br>    LOGGER.debug(<span class="hljs-string">&quot;Reconfiguration started for context[name=&#123;&#125;] at URI &#123;&#125; (&#123;&#125;) with optional ClassLoader: &#123;&#125;&quot;</span>,<br>                 contextName, configURI, <span class="hljs-built_in">this</span>, cl);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Configuration</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> ConfigurationFactory.getInstance().getConfiguration(<span class="hljs-built_in">this</span>, contextName, configURI, cl);<br>    <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>        LOGGER.error(<span class="hljs-string">&quot;Reconfiguration failed: No configuration found for &#x27;&#123;&#125;&#x27; at &#x27;&#123;&#125;&#x27; in &#x27;&#123;&#125;&#x27;&quot;</span>, contextName, configURI, cl);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        setConfiguration(instance);<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">             * instance.start(); Configuration old = setConfiguration(instance); updateLoggers(); if (old != null) &#123;</span><br><span class="hljs-comment">             * old.stop(); &#125;</span><br><span class="hljs-comment">             */</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">location</span> <span class="hljs-operator">=</span> configuration == <span class="hljs-literal">null</span> ? <span class="hljs-string">&quot;?&quot;</span> : String.valueOf(configuration.getConfigurationSource());<br>        LOGGER.debug(<span class="hljs-string">&quot;Reconfiguration complete for context[name=&#123;&#125;] at URI &#123;&#125; (&#123;&#125;) with optional ClassLoader: &#123;&#125;&quot;</span>,<br>                     contextName, location, <span class="hljs-built_in">this</span>, cl);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">ConfigurationFactory<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> ConfigurationFactory factory : getFactories()) &#123;<br>    <span class="hljs-keyword">final</span> String[] types = factory.getSupportedTypes();<br>    <span class="hljs-keyword">if</span> (types != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> String type : types) &#123;<br>            <span class="hljs-keyword">if</span> (type.equals(ALL_TYPES)) &#123;<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">Configuration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> factory.getConfiguration(loggerContext, name, configLocation);<br>                <span class="hljs-keyword">if</span> (config != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-keyword">return</span> config;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img alt="image-20211025180117043" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211025180117043-7c5baa95.png" tabindex="0"/><figcaption>image-20211025180117043</figcaption></figure><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>Configuration status=&quot;warn&quot; monitorInterval=&quot;5&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>properties<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;LOG_HOME&quot;<span class="hljs-symbol">&amp;gt;</span>D:/logs<span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/properties<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>Appenders<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>PatternLayout pattern=&quot;%d&#123;HH:mm:ss.SSS&#125; [%t] [%-5level] %c&#123;36&#125;:%L -<br>                                    -- %m%n&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/Console<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>File name=&quot;file&quot; fileName=&quot;$&#123;LOG_HOME&#125;/myfile.log&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>PatternLayout pattern=&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l<br>                                    %c&#123;36&#125; - %m%n&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/File<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>RandomAccessFile name=&quot;accessFile&quot; fileName=&quot;$&#123;LOG_HOME&#125;/myAcclog.log&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>PatternLayout pattern=&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l<br>                                    %c&#123;36&#125; - %m%n&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/RandomAccessFile<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>RollingFile name=&quot;rollingFile&quot; fileName=&quot;$&#123;LOG_HOME&#125;/myrollog.log&quot;<br>                     filePattern=&quot;D:/logs/$$&#123;date:yyyy-MM-dd&#125;/myrollog-%d&#123;yyyyMM-dd-HH-mm&#125;-%i.log&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>ThresholdFilter level=&quot;debug&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot; /<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>PatternLayout pattern=&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l<br>                                    %c&#123;36&#125; - %msg%n&quot; /<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>Policies<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>OnStartupTriggeringPolicy /<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>SizeBasedTriggeringPolicy size=&quot;10 MB&quot; /<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>TimeBasedTriggeringPolicy /<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>/Policies<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>DefaultRolloverStrategy max=&quot;30&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/RollingFile<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>RollingRandomAccessFile name=&quot;MyFile&quot;<br>            fileName=&quot;$&#123;LOG_HOME&#125;/$&#123;FILE_NAME&#125;.log&quot;<br>            filePattern=&quot;$&#123;LOG_HOME&#125;/$$&#123;date:yyyy-MM&#125;/$&#123;FILE_NAME&#125;-%d&#123;yyyy-MM-dd HH-mm&#125;-%i.log&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>PatternLayout<br>                pattern=&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n&quot; /<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>Policies<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>TimeBasedTriggeringPolicy interval=&quot;1&quot; /<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>SizeBasedTriggeringPolicy size=&quot;10 MB&quot; /<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>/Policies<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>DefaultRolloverStrategy max=&quot;20&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/RollingRandomAccessFile<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/Appenders<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>Loggers<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>Logger name=&quot;mylog&quot; level=&quot;trace&quot; additivity=&quot;false&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>AppenderRef ref=&quot;MyFile&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/Logger<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>Root level=&quot;error&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>AppenderRef ref=&quot;Console&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/Root<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/Loggers<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/Configuration<span class="hljs-symbol">&amp;gt;</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意根节点增加了一个monitorInterval属性，含义是每隔300秒重新读取配置文件，可以不重启应用的情况下修改配置，还是很好用的功能。</p><p>RollingRandomAccessFile的属性：</p><ul><li>fileName 指定当前日志文件的位置和文件名称</li><li>filePattern 指定当发生Rolling时，文件的转移和重命名规则</li><li>SizeBasedTriggeringPolicy 指定当文件体积大于size指定的值时，触发Rolling</li><li>DefaultRolloverStrategy 指定最多保存的文件个数</li><li>TimeBasedTriggeringPolicy 这个配置需要和filePattern结合使用，</li><li>注意filePattern中配置的文件重命名规则是${FILE_NAME}-%d{yyyy-MM-dd HH-mm}-%i，最小的时间粒度是mm，即分钟。</li><li>TimeBasedTriggeringPolicy指定的size是1，结合起来就是每1分钟生成一个新文件。如果改成%d{yyyy-MM-dd HH}，最小粒度为小时，则每一个小时生成一个文件。</li></ul><h3 id="三、log4j2异步日志" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、log4j2异步日志">#</a> 三、Log4j2异步日志</h3><p><strong>异步日志</strong></p><p>log4j2最大的特点就是异步日志，其性能的提升主要也是从异步日志中受益，我们来看看如何使用 log4j2的异步日志。</p><ul><li><strong>同步日志</strong></li></ul><figure><img alt="image-20211026112840360" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211026112840360-88b0fa4c.png" tabindex="0"/><figcaption>image-20211026112840360</figcaption></figure><ul><li><strong>异步日志</strong></li></ul><figure><img alt="image-20211026114244785" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211026114244785-b53e7ae9.png" tabindex="0"/><figcaption>image-20211026114244785</figcaption></figure><figure><img alt="image-20211026113622616" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211026113622616-f880b79c.png" tabindex="0"/><figcaption>image-20211026113622616</figcaption></figure><p>Log4j2提供了两种实现日志的方式，一个是通过AsyncAppender，一个是通过AsyncLogger，分别对应 前面我们说的Appender组件和Logger组件。</p><p>注意：配置异步日志需要添加依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!--异步日志依赖--<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>com.lmax<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>disruptor<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>3.3.4<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>AsyncAppender方式</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>Configuration status=&quot;warn&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>properties<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;LOG_HOME&quot;<span class="hljs-symbol">&amp;gt;</span>D:/logs<span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/properties<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>Appenders<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>File name=&quot;file&quot; fileName=&quot;$&#123;LOG_HOME&#125;/myfile.log&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>PatternLayout<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>Pattern<span class="hljs-symbol">&amp;gt;</span>%d %p %c&#123;1.&#125; [%t] %m%n<span class="hljs-symbol">&amp;lt;</span>/Pattern<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>/PatternLayout<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/File<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>Async name=&quot;Async&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>AppenderRef ref=&quot;file&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/Async<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/Appenders<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>Loggers<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>Root level=&quot;error&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>AppenderRef ref=&quot;Async&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/Root<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/Loggers<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/Configuration<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>AsyncLogger方式</li></ol><p>AsyncLogger才是log4j2 的重头戏，也是官方推荐的异步方式。它可以使得调用Logger.log返回的 更快。你可以有两种选择：全局异步和混合异步。</p><ul><li><strong>全局异步</strong>就是，所有的日志都异步的记录，在配置文件上不用做任何改动，只需要添加一个 log4j2.component.properties 配置；</li></ul><div class="language-properties line-numbers-mode" data-ext="properties"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight properties"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">Log4jContextSelector</span>=<span class="hljs-string">org.apache.logging.log4j.core.async.AsyncLoggerContextSelector</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>混合异步</strong>就是，你可以在应用中同时使用同步日志和异步日志，这使得日志的配置方式更加灵活。</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>Configuration status=&quot;WARN&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>properties<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;LOG_HOME&quot;<span class="hljs-symbol">&amp;gt;</span>D:/logs<span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/properties<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>Appenders<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>File name=&quot;file&quot; fileName=&quot;$&#123;LOG_HOME&#125;/myfile.log&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>PatternLayout<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>Pattern<span class="hljs-symbol">&amp;gt;</span>%d %p %c&#123;1.&#125; [%t] %m%n<span class="hljs-symbol">&amp;lt;</span>/Pattern<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>/PatternLayout<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/File<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>Async name=&quot;Async&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>AppenderRef ref=&quot;file&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/Async<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/Appenders<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>Loggers<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>AsyncLogger name=&quot;com.ydlclass&quot; level=&quot;trace&quot;<br>                     includeLocation=&quot;false&quot; additivity=&quot;false&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>AppenderRef ref=&quot;file&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/AsyncLogger<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>Root level=&quot;info&quot; includeLocation=&quot;true&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>AppenderRef ref=&quot;file&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/Root<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/Loggers<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/Configuration<span class="hljs-symbol">&amp;gt;</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如上配置： com.ydlclass 日志是异步的，root日志是同步的。</p><p>使用异步日志需要注意的问题：</p><ol><li>如果使用异步日志，AsyncAppender、AsyncLogger和全局日志，不要同时出现。性能会和 AsyncAppender一致，降至最低。</li><li>设置includeLocation=false ，打印位置信息会急剧降低异步日志的性能，比同步日志还要慢。</li></ol><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &amp;lt; <span class="hljs-number">1000000</span>; i++) &#123;<br>    LOGGER.fatal(<span class="hljs-string">&quot;fatal&quot;</span>);<br><br>&#125;<br><span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>System.out.println(end - start);<br><br><br><span class="hljs-number">2970</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Log4j2的性能</p><p>log4j官网对其性能进行大肆宣扬，但是网上也有专业认识进行测试，log4j在大量日志的情况下有一定的优势，他确实是日后的选择。但是也不必纠结。</p><figure><img alt="image-20211021234601896" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/image-20211021234601896-e6e4f2f3.png" tabindex="0"/><figcaption>image-20211021234601896</figcaption></figure><p><a href="http://logging.apache.org/log4j/2.x/performance.html#asyncLogging" rel="noopener noreferrer" target="_blank">Log4j – Performance (apache.org)<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="第七章-怎么打日志" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第七章-怎么打日志">#</a> 第七章：怎么打日志</h2><blockquote><p>基本格式</p></blockquote><p>必须使用参数化信息的方式:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">logger.debug(<span class="hljs-string">&quot;Processing trade with id:[&#123;&#125;] and symbol : [&#123;&#125;] &quot;</span>, id, symbol);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>不要进行字符串拼接,那样会产生很多String对象，占用空间，影响性能。反例(不要这么做):</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">logger.debug(<span class="hljs-string">&quot;Processing trade with id: &quot;</span> + id + <span class="hljs-string">&quot; symbol: &quot;</span> + symbol);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>使用[]进行参数变量隔离，如有参数变量，应该写成如下写法:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">logger.debug(<span class="hljs-string">&quot;Processing trade with id:[&#123;&#125;] and symbol : [&#123;&#125;] &quot;</span>, id, symbol);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>这样的格式写法，可读性更好，对于排查问题更有帮助。不同级别的使用</p><blockquote><p>ERROR，影响到程序正常运行、当前请求正常运行的异常情况:</p></blockquote><ul><li><p>打开配置文件失败</p></li><li><p>所有第三方对接的异常(包括第三方返回错误码)</p></li><li><p>所有影响功能使用的异常，包括:SQLException和除了业务异常之外的所有异常(RuntimeException和Exception)</p></li><li><p>不应该出现的情况，比如要使用阿里云传图片，但是未响应</p></li><li><p>如果有Throwable信息，需要记录完成的堆栈信息:</p></li></ul><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">log.error(&quot;获取用户[&#123;&#125;]的用户信息时出错&quot;,userName,e);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>说明，如果进行了抛出异常操作，请不要记录error日志，由最终处理方进行处理：</p><p>反例(不要这么做):</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span>&#123;<br>    ....<br>&#125;<span class="hljs-keyword">catch</span>(Exception ex)&#123;<br>    String errorMessage=String.format(<span class="hljs-string">&quot;Error while reading information of user [%s]&quot;</span>,userName);<br>    logger.error(errorMessage,ex);<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceException</span>(errorMessage,ex);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>WARN，不应该出现但是不影响程序、当前请求正常运行的异常情况:</p></blockquote><ol><li><p>有容错机制的时候出现的错误情况</p></li><li><p>找不到配置文件，但是系统能自动创建配置文件</p></li><li><p>即将接近临界值的时候，例如：缓存池占用达到警告线，业务异常的记录，比如:用户锁定异常</p></li></ol><blockquote><p>INFO，系统运行信息</p></blockquote><ol><li><p>Service方法中对于系统/业务状态的变更</p></li><li><p>主要逻辑中的分步骤：1，初始化什么 2、加载什么</p></li><li><p>外部接口部分</p></li><li><p>客户端请求参数(REST/WS)</p></li><li><p>调用第三方时的调用参数和调用结果</p></li><li><p>对于复杂的业务逻辑，需要进行日志打点，以及埋点记录，比如电商系统中的下订单逻辑，以及OrderAction操作(业务状态变更)。</p></li><li><p>调用其他第三方服务时，所有的出参和入参是必须要记录的(因为你很难追溯第三方模块发生的问题)</p></li></ol><p>说明 并不是所有的service都进行出入口打点记录,单一、简单service是没有意义的(job除外,job需要记录开始和结束,)。反例(不要这么做):</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> List <span class="hljs-title function_">listByBaseType</span><span class="hljs-params">(Integer baseTypeId)</span> &#123;<br>    log.info(<span class="hljs-string">&quot;开始查询基地&quot;</span>);<br>    BaseExample ex=<span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseExample</span>();<br>    BaseExample.<span class="hljs-type">Criteria</span> <span class="hljs-variable">ctr</span> <span class="hljs-operator">=</span> ex.createCriteria();<br>    ctr.andIsDeleteEqualTo(IsDelete.USE.getValue());<br>    Optionals.doIfPresent(baseTypeId, ctr::andBaseTypeIdEqualTo);<br>    log.info(<span class="hljs-string">&quot;查询基地结束&quot;</span>);<br>    <span class="hljs-keyword">return</span> baseRepository.selectByExample(ex);<br><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>DEBUG，可以填写所有的想知道的相关信息(但不代表可以随便写，debug信息要有意义,最好有相关参数)</p></blockquote><p>生产环境需要关闭DEBUG信息</p><p>如果在生产情况下需要开启DEBUG,需要使用开关进行管理，不能一直开启。</p><p>说明 如果代码中出现以下代码，可以进行优化:</p><p>//1. 获取用户基本薪资</p><p>//2. 获取用户休假情况</p><p>//3. 计算用户应得薪资</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">logger.debug(<span class="hljs-string">&quot;开始获取员工[&#123;&#125;] [&#123;&#125;]年基本薪资&quot;</span>,employee,year);<br>logger.debug(<span class="hljs-string">&quot;获取员工[&#123;&#125;] [&#123;&#125;]年的基本薪资为[&#123;&#125;]&quot;</span>,employee,year,basicSalary);<br>logger.debug(<span class="hljs-string">&quot;开始获取员工[&#123;&#125;] [&#123;&#125;]年[&#123;&#125;]月休假情况&quot;</span>,employee,year,month);<br>logger.debug(<span class="hljs-string">&quot;员工[&#123;&#125;][&#123;&#125;]年[&#123;&#125;]月年假/病假/事假为[&#123;&#125;]/[&#123;&#125;]/[&#123;&#125;]&quot;</span>,employee,year,month,annualLeaveDays,sickLeaveDays,noPayLeaveDays);<br>logger.debug(<span class="hljs-string">&quot;开始计算员工[&#123;&#125;][&#123;&#125;]年[&#123;&#125;]月应得薪资&quot;</span>,employee,year,month);<br>logger.debug(<span class="hljs-string">&quot;员工[&#123;&#125;] [&#123;&#125;]年[&#123;&#125;]月应得薪资为[&#123;&#125;]&quot;</span>,employee,year,month,actualSalary);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>TRACE，特别详细的系统运行完成信息，业务代码中，不要使用.(除非有特殊用意，否则请使用DEBUG级别替代)</p></blockquote><p>规范示例说明</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createUserAndBindMobile</span><span class="hljs-params">(<span class="hljs-meta">@NotBlank</span> String mobile, <span class="hljs-meta">@NotNull</span> User user)</span> <span class="hljs-keyword">throws</span> CreateConflictException&#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">debug</span> <span class="hljs-operator">=</span> log.isDebugEnabled();<br>    <span class="hljs-keyword">if</span>(debug)&#123;<br>        log.debug(<span class="hljs-string">&quot;开始创建用户并绑定手机号. args[mobile=[&#123;&#125;],user=[&#123;&#125;]]&quot;</span>, mobile, LogObjects.toString(user));<br>    &#125;<br>    <span class="hljs-keyword">try</span> &#123;<br>        user.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        user.setUpdateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        userRepository.insertSelective(user);<br>        <span class="hljs-keyword">if</span>(debug)&#123;<br>            log.debug(<span class="hljs-string">&quot;创建用户信息成功. insertedUser=[&#123;&#125;]&quot;</span>,LogObjects.toString(user));<br>        &#125;<br>        <span class="hljs-type">UserMobileRelationship</span> <span class="hljs-variable">relationship</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserMobileRelationship</span>();<br>        relationship.setMobile(mobile);<br>        relationship.setOpenId(user.getOpenId());<br>        relationship.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        relationship.setUpdateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        userMobileRelationshipRepository.insertOnDuplicateKey(relationship);<br>        <span class="hljs-keyword">if</span>(debug)&#123;<br>            log.debug(<span class="hljs-string">&quot;绑定手机成功. relationship=[&#123;&#125;]&quot;</span>,LogObjects.toString(relationship));<br>        &#125;<br>        log.info(<span class="hljs-string">&quot;创建用户并绑定手机号. userId=[&#123;&#125;],openId=[&#123;&#125;],mobile[&#123;&#125;]&quot;</span>,user.getId(),user.getOpenId(),mobile);       <span class="hljs-comment">// 如果考虑安全，手机号记得脱敏</span><br>    &#125;<span class="hljs-keyword">catch</span>(DuplicateKeyException e)&#123;<br>        log.info(<span class="hljs-string">&quot;创建用户并绑定手机号失败,已存在相同的用户. openId=[&#123;&#125;],mobile=[&#123;&#125;]&quot;</span>,user.getOpenId(),mobile);<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreateConflictException</span>(<span class="hljs-string">&quot;创建用户发生冲突, openid=[%s]&quot;</span>,user.getOpenId());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></article>
<div class="article-footer">

</div>

<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">回顾上一篇</div><a href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/mybatisplus/mybatisplus/">mybatisplus</a></div><div class="item" id="next"><div class="note">接下来阅读</div><a href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/redis/redis/">redis</a></div></section></div>


  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>快来参与讨论吧~</p>

    </section>
    <section class='body cmt-body waline'>
      

<div id="waline_container" class="waline_thread"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>

    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p style="text-align:center" >
本站由 <a style="font-weight: bold;" href="/author/ThatCoder/">钟意</a> 使用 <a style="font-weight: bold;" target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.33.1">Stellar 1.33.1</a> 主题创建。
<br>
由 <a style="font-weight: bold;" target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral">又拍云</a> 提供CDN加速/云存储服务
<br>
由 <a style="font-weight: bold;" target="_blank" rel="noopener" href="https://vercel.com/">vercel</a>、<a style="font-weight: bold;" target="_blank" rel="noopener" href="https://www.netlify.com/">netlify</a>、<a style="font-weight: bold;" target="_blank" rel="noopener" href="https://www.cloudflare.com/">cloudflare</a> 提供托管服务
<br>
<a href="https://beian.miit.gov.cn/" target="_blank">湘ICP备2023019799号-1</a>
<br>
<!--不蒜子计数器-->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!--添加一个访问量-->
<span>总访问 <span id="busuanzi_value_site_pv" style="font-weight: bold;"></span> 次 
<!--本页访问 <span id="busuanzi_value_page_pv" style="font-weight: bold;"></span> 次</span>-->
<div id="siteruntime"></div>
</p>
<script>
function siteTime(){
    window.setTimeout("siteTime()", 1000);
    var seconds = 1000
    var minutes = seconds * 60
    var hours = minutes * 60
    var days = hours * 24
    var years = days * 365
    var today = new Date()
    var todayYear = today.getFullYear()
    var todayMonth = today.getMonth()
    var todayDate = today.getDate()
    var todayHour = today.getHours()
    var todayMinute = today.getMinutes()
    var todaySecond = today.getSeconds()
    var t1 = Date.UTC(2020,4,30,08,00,00)
    var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond)
    var diff = t2-t1
    var diffYears = Math.floor(diff/years)
    var diffDays = Math.floor((diff/days)-diffYears*365)
    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours)
    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes)
    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds)
    document.getElementById("siteruntime").innerHTML="<p style=\"text-align:center\">小破站已颠沛流离 "+diffYears+" 年 "+diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒</p>"
}
siteTime();
</script>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="auto"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E6%97%A5%E5%BF%97%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-text"> 第一章 日志的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="toc-text"> 一、概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%97%A5%E5%BF%97%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-text"> 二、日志的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%8E%A5%E8%A7%A6%E8%BF%87%E7%9A%84%E6%97%A5%E5%BF%97"><span class="toc-text"> 三、接触过的日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%B8%BB%E6%B5%81%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="toc-text"> 四、主流日志框架</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-jul%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="toc-text"> 第二章 JUL日志框架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-text"> 一、入门案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%97%A5%E5%BF%97%E7%9A%84%E7%BA%A7%E5%88%AB"><span class="toc-text"> 二、日志的级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="toc-text"> 三、日志配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81-logger%E4%B9%8B%E9%97%B4%E7%9A%84%E7%88%B6%E5%AD%90%E5%85%B3%E7%B3%BB"><span class="toc-text"> 四、 Logger之间的父子关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-text"> 五、日志格式化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81string%E7%9A%84format%E6%96%B9%E6%B3%95"><span class="toc-text"> 1、String的format方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E5%B8%B8%E7%94%A8%E7%9A%84%E8%BD%AC%E6%8D%A2%E7%AC%A6"><span class="toc-text"> 2、常用的转换符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7"><span class="toc-text"> 3、特殊符号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E6%97%A5%E6%9C%9F%E5%A4%84%E7%90%86"><span class="toc-text"> 4、日期处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text"> 六、配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-log4j-%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="toc-text"> 第三章 LOG4J 日志框架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B-1"><span class="toc-text"> 一、入门案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%BB%84%E4%BB%B6%E8%AE%B2%E8%A7%A3"><span class="toc-text"> 二、组件讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81loggers"><span class="toc-text"> 1、Loggers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81appenders"><span class="toc-text"> 2、Appenders</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81layouts"><span class="toc-text"> 3、Layouts</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AE"><span class="toc-text"> 三、配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89logger"><span class="toc-text"> 四、自定义Logger</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E6%97%A5%E5%BF%97%E9%97%A8%E9%9D%A2"><span class="toc-text"> 第四章 日志门面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81slf4j%E6%97%A5%E5%BF%97%E9%97%A8%E9%9D%A2"><span class="toc-text"> 一、SLF4J日志门面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E9%98%BF%E9%87%8C%E6%97%A5%E5%BF%97%E8%A7%84%E7%BA%A6"><span class="toc-text"> 1、阿里日志规约</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81slf4j%E5%AE%9E%E6%88%98"><span class="toc-text"> 2、SLF4J实战</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E7%BB%91%E5%AE%9A%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97%E7%9A%84%E5%AE%9E%E7%8E%B0-binding"><span class="toc-text"> 3、绑定其他日志的实现（Binding）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E6%A1%A5%E6%8E%A5%E6%97%A7%E7%9A%84%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6-bridging"><span class="toc-text"> 4、桥接旧的日志框架（Bridging）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_5%E3%80%81slf4j%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="toc-text"> 5、SLF4J原理解析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81jcl-%E6%97%A5%E5%BF%97%E9%97%A8%E9%9D%A2"><span class="toc-text"> 二、JCL 日志门面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81jcl%E5%85%A5%E9%97%A8"><span class="toc-text"> 1、JCL入门</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81jcl%E5%8E%9F%E7%90%86"><span class="toc-text"> 2、JCL原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E6%97%A5%E5%BF%97%E7%94%9F%E6%80%81%E5%9B%BE"><span class="toc-text"> 3、日志生态图：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-logback%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text"> 第五章 Logback的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81logback%E5%85%A5%E9%97%A8"><span class="toc-text"> 一、logback入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-text"> 二、源码解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81spi%E6%9C%BA%E5%88%B6"><span class="toc-text"> 1、spi机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-text"> 2、源码解析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%B8%89%E5%A4%A7%E7%BB%84%E4%BB%B6"><span class="toc-text"> 三、三大组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81logback%E9%85%8D%E7%BD%AE"><span class="toc-text"> 四、logback配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81logback-access%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text"> 五、logback-access的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-log4j2%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text"> 第六章 log4j2的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81log4j2%E5%85%A5%E9%97%A8"><span class="toc-text"> 一、Log4j2入门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E4%BD%BF%E7%94%A8log4j-api%E5%81%9A%E9%97%A8%E9%9D%A2"><span class="toc-text"> 1、使用log4j-api做门面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E4%BD%BF%E7%94%A8slf4j%E5%81%9A%E9%97%A8%E9%9D%A2"><span class="toc-text"> 2、使用slf4j做门面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81log4j2%E9%85%8D%E7%BD%AE"><span class="toc-text"> 二、Log4j2配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE"><span class="toc-text"> 1、默认配置：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81log4j2%E5%BC%82%E6%AD%A5%E6%97%A5%E5%BF%97"><span class="toc-text"> 三、Log4j2异步日志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-%E6%80%8E%E4%B9%88%E6%89%93%E6%97%A5%E5%BF%97"><span class="toc-text"> 第七章：怎么打日志</span></a></li></ol></div><div class="widget-footer"><a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ --><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/><path d="M7 3.338A9.95 9.95 0 0 1 12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12c0-1.821.487-3.53 1.338-5"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ --><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M8 10.5h8M8 14h5.5M17 3.338A9.95 9.95 0 0 0 12 2C6.477 2 2 6.477 2 12c0 1.6.376 3.112 1.043 4.453c.178.356.237.763.134 1.148l-.595 2.226a1.3 1.3 0 0 0 1.591 1.592l2.226-.596a1.63 1.63 0 0 1 1.149.133A9.96 9.96 0 0 0 12 22c5.523 0 10-4.477 10-10c0-1.821-.487-3.53-1.338-5"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">


<script type="text/javascript">
  window.canonical = {"closeEnable":true,"closeText":"关闭提示","originalHost":"blog.thatcoder.cn","officialHosts":["localhost","en.blog.thatcoder.cn","hexo.thatcoder.cn","thatcoder.vercel.app","thatcoder.netlify.app","cn-coder.vercel.app","thatcoders.github.io","thatcoder.pages.dev","cncoder.pages.dev"],"encoded":"YmxvZy50aGF0Y29kZXIuY24="};
  window.canonical["param"] = {"permalink":"https://blog.thatcoder.cn/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6","checklink":"/js/plugins/video.js"};
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
    tag_plugins: {
      chat: Object.assign({"api":"https://siteinfo.listentothewind.cn/api/v1"}),
    }
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"post, page, docs","path":"/search.json","content":true,"skip_search":null,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
    loading: `https://api.iconify.design/eos-icons:three-dots-loading.svg?color=%231cd0fd`,
  };
  const deps = {
    jquery: `https://gcore.jsdelivr.net/npm/jquery@3.7/dist/jquery.min.js`,
    marked: `https://gcore.jsdelivr.net/npm/marked@13.0/lib/marked.umd.min.js`,
    lazyload: `/%5Bobject%20Object%5D`
  }
  

</script>

<script type="text/javascript">
  
  function RunItem() {
    this.list = []; // 存放回调函数
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = () => {
          utils.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) => {
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index, 1);
        }
      }
    }
    // 构造一个可以run的对象
    function Item(fn, name) {
      // 函数名称
      this.name = name || fn.name;
      // run方法
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }

  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')) {
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function () {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },

    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      const maxRetry = 3;
      let retryCount = 0;

      return new Promise((resolve, reject) => {
        const load = () => {
          utils.onLoading?.(el);

          let timedOut = false;
          const timeout = setTimeout(() => {
            timedOut = true;
            console.warn('[request] 超时:', url);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject('请求超时');
            } else {
              setTimeout(load, 1000);
            }
          }, 5000);

          fetch(url).then(resp => {
            if (timedOut) return;
            clearTimeout(timeout);

            if (!resp.ok) throw new Error('响应失败');
            return resp;
          }).then(data => {
            if (timedOut) return;
            utils.onLoadSuccess?.(el);
            callback(data);
            resolve(data);
          }).catch(err => {
            clearTimeout(timeout);
            console.warn('[request] 错误:', err);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject(err);
            } else {
              setTimeout(load, 1000);
            }
          });
        };

        load();
      });
    },
    requestWithoutLoading: (url, options = {}, maxRetry = 2, timeout = 5000) => {
      return new Promise((resolve, reject) => {
        let retryCount = 0;

        const tryRequest = () => {
          let timedOut = false;
          const timer = setTimeout(() => {
            timedOut = true;
            if (++retryCount > maxRetry) reject('timeout');
            else tryRequest();
          }, timeout);

          fetch(url, options)
            .then(resp => {
              clearTimeout(timer);
              if (!resp.ok) throw new Error('bad response');
              resolve(resp);
            })
            .catch(err => {
              clearTimeout(timer);
              if (++retryCount > maxRetry) reject(err);
              else setTimeout(tryRequest, 500);
            });
        };

        tryRequest();
      });
    },
    /********************** requestAnimationFrame ********************************/
    // 1、requestAnimationFrame 会把每一帧中的所有 DOM 操作集中起来，在一次重绘或回流中就完成，并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率，一般来说，这个频率为每秒60帧。
    // 2、在隐藏或不可见的元素中，requestAnimationFrame 将不会进行重绘或回流，这当然就意味着更少的的 cpu，gpu 和内存使用量。
    requestAnimationFrame: (fn) => {
      if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
      }
      window.requestAnimationFrame(fn)
    },
    dark: {},
  };

  // utils.dark.mode 当前模式 dark or light
  // utils.dark.toggle() 暗黑模式触发器
  // utils.dark.push(callBack[,"callBackName"]) 传入触发器回调函数
  utils.dark.method = {
    toggle: new RunItem(),
  };
  utils.dark = Object.assign(utils.dark, {
    push: utils.dark.method.toggle.push,
  });
</script>
<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>

<script async src="https://gcore.jsdelivr.net/npm/vanilla-lazyload@19.1/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
    callback_loaded: (el) => {
      el.classList.add('loaded');
      const wrapper = el.closest('.lazy-box');
      const icon = wrapper?.querySelector('.lazy-icon');
      if (icon) icon.remove();
    }
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });

  window.wrapLazyloadImages = (container) => {
    if (typeof container === 'string') {
      container = document.querySelector(container);
    }
    if (!container) return;
    
    const images = container.querySelectorAll('img');
    images.forEach((img) => {
      if (img.classList.contains('lazy')) return;

      const src = img.getAttribute('src');
      if (!src) return;

      const wrapper = document.createElement('div');
      wrapper.className = 'lazy-box';

      const newImg = img.cloneNode();
      newImg.removeAttribute('src');
      newImg.setAttribute('data-src', src);
      newImg.classList.add('lazy');

      const icon = document.createElement('div');
      icon.className = 'lazy-icon';
      if (def.loading) {
        icon.style.backgroundImage = `url("${def.loading}")`;
      }

      wrapper.appendChild(newImg);
      wrapper.appendChild(icon);

      img.replaceWith(wrapper);
    });

    // 通知 LazyLoad 更新
    if (window.lazyLoadInstance?.update) {
      window.lazyLoadInstance.update();
    }
  }
  
</script>

<!-- required -->
<script src="/js/main.js?v=1.33.1" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    // applyThemeToGiscus(theme)
  }

  // FIXME: 这会导致无法使用 preferred_color_scheme 以外的主题
  const applyThemeToGiscus = (theme) => {
    // theme = theme === 'auto' ? 'preferred_color_scheme' : theme
    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)
    utils.dark.mode = newTheme === 'auto' ? (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light") : newTheme;
    utils.dark.method.toggle.start();

    const messages = {
      light: `切换到浅色模式`,
      dark: `切换到深色模式`,
      auto: `切换到跟随系统配色`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    } else {
      utils.dark.mode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }
    utils.dark.method.toggle.start();
  })()
</script>


<!-- optional -->

  <script type="module">
  import { init } from 'https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline.js';

  const el = document.getElementById('waline_container');
  util.viewportLazyload(el, load_waline, false);

  function load_waline(){
    if (!el) return;

    utils.css('https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline.css');
    utils.css('https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline-meta.css');

    const path = el.getAttribute('comment_id') ?? decodeURI(window.location.pathname);
    const waline = init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline.js","css":"https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline.css","meta_css":"https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline-meta.css","serverURL":"https://waline.thatapi.cn/","commentCount":true,"pageview":false,"search":false,"locale":{"placeholder":"  遇事不决, 可问春风..."},"emoji":["https://upyun.thatcdn.cn/public/web/emojis/bilibili","https://upyun.thatcdn.cn/public/web/emojis/qq","https://upyun.thatcdn.cn/public/web/emojis/tieba","https://upyun.thatcdn.cn/public/web/emojis/weibo"],"reaction":["https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_thumbsup.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_cute.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_sunglasses.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_crazy.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_trollface.png"],"meta":["nick","mail","link"],"imageUploader":{"fileName":"file","tokenName":"Authorization","api":"https://lsky.thatcoder.cn/api/v1/upload","token":"Bearer 6|x9vHGJGHAnjqbO0PGEE5vM7r9S9hdqFA9bmdESdm","resp":"data.links.url"}}, {
      el: '#waline_container',
      path: path,
      
        imageUploader: function(file) {
          const headers = new Headers();
          headers.set('Accept', 'application/json');
          
            headers.set('Authorization', 'Bearer 6|x9vHGJGHAnjqbO0PGEE5vM7r9S9hdqFA9bmdESdm')
          
          const formData = new FormData();
          formData.append('file', file);
          return fetch('https://lsky.thatcoder.cn/api/v1/upload',{
            method: 'POST',
            body: formData,
            headers: headers
            }).then((resp) => resp.json())
              .then((resp) => resp.data.links.url)
        },
      
    }));
  }
</script>




<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"rating":{"js":"/js/services/rating.js","api":"https://star-vote.xaox.cc/api/rating"},"vote":{"js":"/js/services/vote.js","api":"https://star-vote.xaox.cc/api/vote"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"friends_and_posts":{"js":"/js/services/friends_and_posts.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"},"voice":{"js":"/js/plugins/voice.js"},"video":{"js":"/js/plugins/video.js"},"download-file":{"js":"/js/plugins/download-file.js"},"twikoo":{"js":"/js/services/twikoo_latest_comment.js"},"waline":{"js":"/js/services/waline_latest_comment.js"},"artalk":{"js":"/js/services/artalk_latest_comment.js"},"giscus":{"js":"/js/services/giscus_latest_comment.js"},"contributors":{"edit_this_page":{"_posts/":null,"wiki/stellar/":"https://github.com/xaoxuu/hexo-theme-stellar-docs/blob/main/"},"js":"/js/services/contributors.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else if (id == 'voice') {
        ctx.voiceAudios = document.querySelectorAll('.voice>audio');
        if (ctx.voiceAudios?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            createVoiceDom(ctx.voiceAudios);
          });
        }
      } else if (id == 'video') {
        ctx.videos = document.querySelectorAll('.video>video');
        if (ctx.videos?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            videoEvents(ctx.videos);
          });
        }
      } else if (id == 'download-file') {
        ctx.files = document.querySelectorAll('.file');
        if (ctx.files?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            downloadFileEvent(ctx.files);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }

    // chat iphone time
    let phoneTimes = document.querySelectorAll('.chat .status-bar .time');

    if (phoneTimes.length > 0) {
      NowTime();
      var date = new Date();
      var sec = date.getSeconds();
      var firstAdjustInterval = setInterval(firstAdjustTime, 1000 * (60 - sec));
    }

    function firstAdjustTime() {
      NowTime();
      clearInterval(firstAdjustInterval);
      setInterval(NowTime, 1000 * 60);
    }

    function NowTime() {
      for (let i = 0; i < phoneTimes.length; ++i) {
        var timeSpan = phoneTimes[i];
        var date = new Date();
        var hour = date.getHours();
        var min = date.getMinutes();
        timeSpan.innerHTML = check(hour) + ":" + check(min);
      }
    };

    function check(val) {
      if (val < 10) {
        return ("0" + val);
      }
      return (val);
    }

    // chat quote
    const chat_quote_obverser = new IntersectionObserver((entries, observer) => {
      entries.filter((entry) => { return entry.isIntersecting }).sort((a, b) => a.intersectionRect.y !== b.intersectionRect.y ? a.intersectionRect.y - b.intersectionRect.y : a.intersectionRect.x - b.intersectionRect.x).forEach((entry, index) => {
          observer.unobserve(entry.target);
          setTimeout(() => {
            entry.target.classList.add('quote-blink');
            setTimeout(() => {
              entry.target.classList.remove('quote-blink');
            }, 1000);
          }, Math.max(100, 16) * (index + 1));
        });
    });

    var chatQuotes = document.querySelectorAll(".chat .talk .quote");
    chatQuotes.forEach((quote) => {
      quote.addEventListener('click', function () {
        var chatCellDom = document.getElementById("quote-" + quote.getAttribute("quotedCellTag"));
        if (chatCellDom) {
          var chatDiv = chatCellDom.parentElement;
          var mid = chatDiv.clientHeight / 2;
          var offsetTop = chatCellDom.offsetTop;
          if (offsetTop > mid - chatCellDom.clientHeight / 2) {
            chatDiv.scrollTo({
              top: chatCellDom.offsetTop - mid + chatCellDom.clientHeight / 2,
              behavior: "smooth"
            });
          } else {
            chatDiv.scrollTo({
              top: 0,
              behavior: "smooth"
            });
          }
          chat_quote_obverser.observe(chatCellDom);
        }
      });
    });
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://gcore.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script>
  ctx.fancybox = {
    selector: `.swiper-slide img, .md-text.content p>img, .md-text.content li img , .wl-content img, waline_container .vcontent img, .timeline .body .image img,  .timeline .gallery img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error), .with-fancybox .atk-content img:not([atk-emoticon])';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const memos = document.getElementsByClassName('ds-memos');
    if (memos != undefined && memos.length > 0) {
      needFancybox = true;
    }
    const fancybox = document.getElementsByClassName('with-fancybox');
    if (fancybox != undefined && fancybox.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>




<!-- inject -->
<script type="text/javascript" src="/custom/js/ZYUtil.js"></script><script type="text/javascript" src="/custom/js/ZYDark.js"></script><script type="text/javascript" src="/custom/js/ZYCategory.js"></script><script type="text/javascript" src="/custom/js/ZYCode.js"></script><script type="text/javascript" src="/custom/js/timetmpl.js"></script>
</div></body></html>
