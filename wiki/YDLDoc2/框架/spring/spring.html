
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.1.1">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>YDLDoc2：spring - 那个码农</title>

  
    <meta name="description" content="# Spring教程提示课程视频教程链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1ZF411B7Wuopen in new window# 第一章 概述# 一、Why Spring?（为什么使用spring）官网是这么解释的：1、Spring is everywhereSpring框架的足够灵活受到世界各地开发人员的信任。 无论是流媒体电视、在线购物、还是无数其他创新的">
<meta property="og:type" content="website">
<meta property="og:title" content="spring">
<meta property="og:url" content="https://blog.thatcoder.cn/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/spring/spring.html">
<meta property="og:site_name" content="那个码农">
<meta property="og:description" content="# Spring教程提示课程视频教程链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1ZF411B7Wuopen in new window# 第一章 概述# 一、Why Spring?（为什么使用spring）官网是这么解释的：1、Spring is everywhereSpring框架的足够灵活受到世界各地开发人员的信任。 无论是流媒体电视、在线购物、还是无数其他创新的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20221212154252950-daf7bb3d.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211128102816659-b5c945d9.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/singleton-517d1f2f.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/prototype-a17423f2.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211215174653618-8f4cf0ff.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211201212643242-f2c29555.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206130611410-3b9ed4d4.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206155835362-973942fb.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160019905-eba06d20.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160040279-4d86c19f.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160056790-0c9563ec.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160112474-06016645.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160242492-70637337.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160309143-8a1c0052.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160256390-ff41f6f4.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160329137-8f97bcea.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160712945-4010a6b1.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211207174813931-9bb8faab.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211207184848931-935d9190.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/tx_prop_required-67e4b03c.png">
<meta property="og:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/tx_prop_requires_new-6ba58064.png">
<meta property="article:published_time" content="2023-12-16T19:23:12.354Z">
<meta property="article:modified_time" content="2023-12-16T19:23:12.354Z">
<meta property="article:author" content="钟意">
<meta property="article:tag" content="那个码农">
<meta property="article:tag" content="码农钟意">
<meta property="article:tag" content="钟意的博客">
<meta property="article:tag" content="钟意博客">
<meta property="article:tag" content="That Coder">
<meta property="article:tag" content="thatcoder">
<meta property="article:tag" content="源柒拾柒雅舍">
<meta property="article:tag" content="源WebGary">
<meta property="article:tag" content="giligili.work">
<meta property="article:tag" content="seclusion.work">
<meta property="article:tag" content="GalGame">
<meta property="article:tag" content="Hexo Stellar">
<meta property="article:tag" content="江西木村拓哉">
<meta property="article:tag" content="江西吴彦祖">
<meta property="article:tag" content="江西胡歌">
<meta property="article:tag" content="龙南木村拓哉">
<meta property="article:tag" content="龙南吴彦祖">
<meta property="article:tag" content="龙南胡歌">
<meta property="article:tag" content="九江职业技术学院">
<meta property="article:tag" content="南昌交通学院">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20221212154252950-daf7bb3d.png">
  
  
  
  <meta name="keywords" content="那个码农,码农钟意,钟意的博客,钟意博客,That Coder,thatcoder,源柒拾柒雅舍,源WebGary,giligili.work,seclusion.work,GalGame,Hexo Stellar,江西木村拓哉,江西吴彦祖,江西胡歌,龙南木村拓哉,龙南吴彦祖,龙南胡歌,九江职业技术学院,南昌交通学院">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="那个码农" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="https://upyun.thatcdn.cn/hexo/stellar/image/favicon.webp">
  

  
    
<link rel="stylesheet" href="/custom/css/ZYCode.css">

  

  <link rel="Shortcut Icon" href="/favicon.ico" type="image/x-icon" /><link rel="stylesheet" href="https://upyun.thatcdn.cn/public/font/lxgw/result.css" /><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="/custom/css/ZYTimetmpl.css" /><meta itemprop="name" content="钟意博客"><meta itemprop="description" content="笔名钟意, 记录代码与生活."><meta itemprop="image" content="https://upyun.thatcdn.cn/hexo/stellar/image/shot.webp"><link rel="stylesheet" href="/custom/css/ZYGlobal.css"><link rel="stylesheet" href="/custom/css/ZYWaline.css"><link rel="stylesheet" href="/custom/css/ZYPage.css"><script type="text/javascript" src="/custom/js/header.js"></script><!-- Clarity tracking code for https://blog.thatcoder.cn/ -->
<script>    (function(c,l,a,r,i,t,y){        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i+"?ref=bwt";        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);    })(window, document, "clarity", "script", "fi1zg7i5q5");</script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H6GM3XZWV7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-H6GM3XZWV7');
</script>
<!-- BaiDu-ZhanZhang
<meta name="baidu-site-verification" content="codeva-8tnFVr706d" />
<!-- BaiDu-Tongji -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?233765a020502d5d6a92d4fe306d36c2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>
<body>



<div class="l_body s:aa content tech " id="start" layout="wiki" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><div class="icon"><img no-lazy class="icon" src="/custom/img/ydl.png" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></div><a class="title" href="/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/maven%E5%85%A5%E9%97%A8/maven%E5%85%A5%E9%97%A8.html"><div class="main" ff="title">YDLDoc2</div><div class="sub normal cap">关于YDLDoc的笔记</div><div class="sub hover cap" style="opacity:0"> 不对之处请指出</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" data-filter="/wiki/YDLDoc2/" placeholder="在 YDLDoc2 中搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item" title="博客" href="/"><span>博客</span></a><a class="nav-item active" title="笔记" href="/wiki/"><span>笔记</span></a><a class="nav-item" title="便签" href="/notes/"><span>便签</span></a><a class="nav-item" title="社交" href="/links/"><span>社交</span></a></nav>
</div>
<div class="widgets">

<widget class="widget-wrapper post-list"><div class="widget-body fs14"><a class="link" href="/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/maven%E5%85%A5%E9%97%A8/maven%E5%85%A5%E9%97%A8.html#start"><span class="toc-text">maven入门</span></a><a class="link" href="/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%9F%BA%E7%A1%80%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%9F%BA%E7%A1%80%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html"><span class="toc-text">基础设计模式</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot.html"><span class="toc-text">SpringBoot</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/jpa/jpa.html"><span class="toc-text">jpa</span></a><a class="link" href="/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6.html"><span class="toc-text">日志框架</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/mybatis/mybatis.html"><span class="toc-text">mybatis</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/SpringSecurity/SpringSecurity.html"><span class="toc-text">SpringSecurity</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/redis/redis.html"><span class="toc-text">redis</span></a><a class="link active" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/spring/spring.html"><span class="toc-text">spring</span><svg class="active-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M21 11.098v4.993c0 3.096 0 4.645-.734 5.321c-.35.323-.792.526-1.263.58c-.987.113-2.14-.907-4.445-2.946c-1.02-.901-1.529-1.352-2.118-1.47a2.225 2.225 0 0 0-.88 0c-.59.118-1.099.569-2.118 1.47c-2.305 2.039-3.458 3.059-4.445 2.945a2.238 2.238 0 0 1-1.263-.579C3 20.736 3 19.188 3 16.091v-4.994C3 6.81 3 4.666 4.318 3.333C5.636 2 7.758 2 12 2c4.243 0 6.364 0 7.682 1.332C21 4.665 21 6.81 21 11.098" opacity=".5"/><path fill="currentColor" d="M9 5.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5z"/></svg></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/springmvc/springmvc.html"><span class="toc-text">springmvc</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/ssm%E9%A1%B9%E7%9B%AE/ssm%E9%A1%B9%E7%9B%AE.html"><span class="toc-text">ssm项目</span></a><a class="link" href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/mybatisplus/mybatisplus.html"><span class="toc-text">mybatisplus</span></a></div></widget>

<widget class="widget-wrapper post-card"><div class="widget-header dis-select"><span class="name">更多：开发</span></div><div class="widget-body"><a class="item wiki" href="/wiki/YDLDoc4/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E7%9F%AD%E4%BF%A1%E9%80%9A%E9%81%93/%E7%9F%AD%E4%BF%A1%E9%80%9A%E9%81%93.html"><span class="title">元动力摘录 - JAVA项目阶段</span><span class="excerpt">钟意关于YDLDoc的笔记</span></a><a class="item wiki" href="/wiki/YDLDoc1/web/bom/bom.html"><span class="title">元动力摘录 - JAVA阶段一</span><span class="excerpt">钟意关于YDLDoc的笔记</span></a><a class="item wiki" href="/wiki/YDLDoc3/ELK%E5%85%A5%E9%97%A8/elk%E5%85%A5%E9%97%A8/elk%E5%85%A5%E9%97%A8.html"><span class="title">元动力摘录 - JAVA阶段三</span><span class="excerpt">钟意关于YDLDoc的笔记</span></a><a class="item wiki" href="/wiki/YuDaoCloud/%E5%89%8D%E7%AB%AF%E6%89%8B%E5%86%8C%20Vue%202/%E5%AD%97%E5%85%B8%E6%95%B0%E6%8D%AE/%E5%AD%97%E5%85%B8%E6%95%B0%E6%8D%AE.html"><span class="title">艿艿若依Cloud - 开发指南</span><span class="excerpt">关于艿艿若依Cloud的文档</span></a><a class="item wiki" href="/wiki/YuDaoBoot/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5.html"><span class="title">艿艿若依Boot - 开发指南</span><span class="excerpt">关于艿艿若依Boot的文档</span></a><a class="item wiki" href="/wiki/Laf/start/start.html"><span class="title">Laf - 开箱即用的 serverless</span><span class="excerpt">钟意关于Laf的笔记</span></a><a class="item wiki" href="/wiki/SpringCloud/start.html"><span class="title">SpringCloud - JAVA系分布式微服务架构</span><span class="excerpt">钟意关于SpringCloud的笔记</span></a><a class="item wiki" href="/wiki/MySql/basics/select.html"><span class="title">MySql - 关系型数据库管理系统</span><span class="excerpt">钟意关于关系型数据库MySql的笔记</span></a></div></widget>

<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/share/game/%E5%B0%8F%E5%B0%8F%E6%A2%A6%E9%AD%87.html"><span class="title"><strong>share</strong><span class="dot"></span>小小梦魇</span></a><a class="item title" href="/share/code/start-sky.html"><span class="title"><strong>share</strong><span class="dot"></span>Clash</span></a><a class="item title" href="/notes/"><span class="title"><strong>便签</strong><span class="dot"></span>钟意的便签</span></a><a class="item title" href="/notes/develop/"><span class="title"><strong>开发速查</strong><span class="dot"></span>开发助手</span></a><a class="item title" href="/notes/follow/stellar.html"><span class="title"><strong>便签</strong><span class="dot"></span>Stellar提交记录</span></a><a class="item title" href="/notes/develop/linux/ubuntu.html"><span class="title"><strong>开发速查</strong><span class="dot"></span>Ubuntu命令</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" style="grid-column: span 3;height:32px;padding: 0;" href="https://space.bilibili.com/1664687779" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" height="32px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-banner.jpg"/></a><a class="social" style="grid-column: span 3;height:32px;padding: 0;" href="https://muselink.cc/naive" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" height="32px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/wechat-banner.jpg"/></a><a class="social" style="grid-column: span 3;height:32px;padding: 0;" href="https://github.com/ThatCoders" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" height="32px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-banner.jpg"/></a><a class="social" href="javascript:ThemeChange('dark');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/Moon.png"/></a><a class="social" href="javascript:ThemeChange('light');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/Sun.png"/></a><a class="social" href="javascript:ThemeChange('auto');" rel="noopener noreferrer"><img class="lazy" id="ThemeAI" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/AI.png"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
    <div class="content">
      <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" id="menu" href="/wiki">文档</a><span class="sep"></span><a class="cap breadcrumb" id="proj" href="/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/maven%E5%85%A5%E9%97%A8/maven%E5%85%A5%E9%97%A8.html">YDLDoc2</a></div>
<div class="flex-row" id="post-meta"><span class="text created">更新于：<time datetime="2023-12-16T19:23:12.354Z">2023-12-17</time></span></div></div></div>
      
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>spring</span></h1>
        
      </div>
    </div>
    
    </div>
    </div><article class="md-text content"><div class="theme-hope-content"><h1 id="spring教程" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#spring教程">#</a> Spring教程</h1><div class="hint-container tip"><p class="hint-container-title">提示</p><p>课程视频教程链接：<a href="https://www.bilibili.com/video/BV1ZF411B7Wu" rel="noopener noreferrer" target="_blank">https://www.bilibili.com/video/BV1ZF411B7Wu<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><h2 id="第一章-概述" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第一章-概述">#</a> 第一章 概述</h2><h3 id="一、why-spring-为什么使用spring" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、why-spring-为什么使用spring">#</a> 一、Why Spring?（为什么使用spring）</h3><p>官网是这么解释的：</p><p><strong>1、Spring is everywhere</strong></p><p>Spring框架的足够灵活受到世界各地开发人员的信任。 无论是流媒体电视、在线购物、还是无数其他创新的解决方案，Spring每天都为数百万终端用户提供愉快的体验。 Spring也有来自所有科技巨头的贡献，包括阿里巴巴、亚马逊、谷歌、微软等。</p><p><strong>2、Spring is flexible</strong></p><p>Spring灵活而全面的扩展能力和第三方库让开发人员可以构建几乎任何可以想象到的应用程序。 Spring框架的【控制反转(IoC)】和【依赖注入(DI)】特性为一系列广泛的特性和功能提供了基础。 无论您是在为web构建安全的、响应式的、基于云的微服务，还是为企业构建复杂的流数据流，Spring都有工具可以提供帮助。</p><p><strong>3、Spring is productive</strong></p><p>Spring Boot（这是我们以后要学习的框架）改变了您处理Java编程任务的方式，从根本上简化了您的体验。 Spring Boot结合了应用程序上下文和自动配置的嵌入式web服务器等必要条件，使microservice开发变得轻而易举。 为了更快，您可以将Spring Boot与Spring Cloud丰富的支持库、服务器、模式和模板组合在一起，以创纪录的时间将整个基于微服务的架构安全地部署到云中。</p><p><strong>4、Spring is fast</strong></p><p>我们的工程师非常关心性能。 在Spring中，默认情况下，您会注意到快速启动、快速关闭和优化执行。 Spring项目也越来越多地支持reactive(nonblocking)编程模型，以获得更高的效率。 开发人员的生产力是Spring的超级力量。 Spring Boot帮助开发人员轻松地构建应用程序，而且比其他竞争方式要轻松得多。</p><p><strong>5、Spring is secure</strong></p><p>Spring在处理安全问题方面十分可靠。 Spring代码的贡献者与安全专业人员一起修补和测试任何报告的漏洞。 第三方依赖关系也被密切监控，并定期发布更新，以帮助您的数据和应用程序尽可能安全。 此外，Spring Security使您更容易集成行业标准的安全方案，并交付可靠的默认安全解决方案。</p><p><strong>6、Spring is supportive</strong></p><p><a href="https://spring.io/community" rel="noopener noreferrer" target="_blank">Spring社区<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>是一个庞大的、全球性的、多样化的社区，涵盖了所有年龄和能力的人，从完全的初学者到经验丰富的专业人士。 无论你处在人生的哪个阶段，你都能找到帮助你进入下一个阶段的支持和资源。</p><h3 id="二、spring-的特性" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、spring-的特性">#</a> 二、Spring 的特性</h3><ul><li><p><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html" rel="noopener noreferrer" target="_blank">Core technologies<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: dependency injection， events， resources， i18n， validation， data binding， type conversion， SpEL， AOP.</p><p>核心技术：包括依赖注入、事件模型、资源处理、国际化、数据绑定和验证、类型转化、spring表达式、面向切面编程。核心技术是一切的关键，后边衍生的多个特性都是依托于核心技术。</p></li><li><p><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/testing.html" rel="noopener noreferrer" target="_blank">Testing<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: mock objects， TestContext framework， Spring MVC Test.</p><p>整合单元测试。</p></li><li><p><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/data-access.html" rel="noopener noreferrer" target="_blank">Data Access<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: <strong>transactions</strong>， DAO support， JDBC， ORM， Marshalling XML.</p><p>数据访问，有独立的持久层api（jdbctemplate），我们主要学习他的事务管理。</p></li><li><p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html" rel="noopener noreferrer" target="_blank">Spring MVC<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html" rel="noopener noreferrer" target="_blank">Spring WebFlux<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> web frameworks.</p></li><li><p><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/integration.html" rel="noopener noreferrer" target="_blank">Integration<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: remoting， JMS， JCA， JMX， email， tasks， scheduling， cache.</p><p>整合其他的第三方组件。</p></li><li><p><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/languages.html" rel="noopener noreferrer" target="_blank">Languages<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: Kotlin， Groovy， dynamic languages.</p></li></ul><h3 id="三、版本关系" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、版本关系">#</a> 三、版本关系</h3><p>目前市场上常用的版本为5.x和6.x，6.x的GA版本（正式发行的稳定通用版）发行时间是2022年11月份，所以只有这个时间点之后的新项目才有可能选用spring6.x作为项目的基础框架选型。<code>Spring6.0</code>已迁移到 <code>Jakarta EE 9+</code>（在 <code>jakarta</code> 命名空间中取代了以前基于 <code>javax</code> 的 <code>EE API</code>），这个知识我们在学习tomcat的时候学习过。</p><table><thead><tr><th>spring框架的版本</th><th>jdk版本</th><th>Jakarta EE</th><th>Servlet</th><th>tomcat版本</th><th>发布时间</th></tr></thead><tbody><tr><td>Spring Framework 6.x</td><td>JDK17</td><td>Jakarta EE 9</td><td>Servlet 5.0+</td><td>tomcat10</td><td>2022年</td></tr><tr><td>Spring Framework 5.x</td><td>JDK 8/11</td><td>Java EE 7/8</td><td>Servlet 3.1/4.0</td><td>Tomcat 8/9</td><td>2018年</td></tr></tbody></table><p><strong>注意：在学习和使用上5.x和6.x几乎没有什么区别。</strong></p><h2 id="第二章-ioc-容器" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第二章-ioc-容器">#</a> 第二章 IOC 容器</h2><p>我们在学习本章知识之前首先需要了解一些常见的名词：</p><p><strong>小知识</strong>：众所周知，java是一种咖啡的名字，而咖啡是由咖啡豆制作而成的，在制作咖啡的时候我们需要将咖啡豆放入咖啡机，此时咖啡机就是一个容器，咖啡豆就是原料，也叫bean。</p><figure><img class="lazy" alt="image-20221212154252950" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20221212154252950-daf7bb3d.png" tabindex="0"/><figcaption>image-20221212154252950</figcaption></figure><p><strong>容器</strong>：可以管理对象的生命周期、对象与对象之间的依赖关系。</p><p><strong>POJO</strong>:（Plain Old Java Object）这种叫法是Martin Fowler、Rebecca Parsons和Josh MacKenzie在2000年的一次演讲的时候提出来的。按照Martin Fowler的解释是“Plain Old Java Object”，从字面上翻译为“纯洁老式的Java对象”，但大家都使用“简单java对象”来称呼它。POJO的内在含义是指：那些没有继承任何类、也没有实现任何接口，更没有被其它框架侵入的java对象。不允许有业务方法，也不能携带connection之类的方法，实际就是普通JavaBeans。</p><p><strong>JavaBean</strong>：JavaBean是一种JAVA语言写成的可重用组件。JavaBean符合一定规范编写的Java类，不是一种技术，而是一种规范。大家针对这种规范，总结了很多开发技巧、工具函数。符合这种规范的类，可以被其它的程序员或者框架使用。它的方法命名，构造及行为必须符合特定的约定：</p><p>1、所有属性为private。</p><p>2、这个类必须有一个公共的缺省构造函数。即是提供无参数的构造器。</p><p>3、这个类的属性使用getter和setter来访问，其他方法遵从标准命名规范。</p><p>4、这个类应是可序列化的。实现serializable接口。</p><p>因为这些要求主要是靠约定而不是靠实现接口，所以许多开发者把JavaBean看作遵从特定命名约定POJO。</p><p><strong>SpringBean</strong>：SpringBean是受Spring管理的对象，所有能受Spring容器管理的对象都可以成SpringBean。Spring中的bean，是通过配置文件、javaconfig等的设置，由Spring自动实例化，用完后自动销毁的对象。</p><p><strong>EntityBean</strong>：Entity Bean是域模型对象，用于实现O/R映射，负责将数据库中的表记录映射为内存中的Entity对象，事实上，创建一个Entity Bean对象相当于新建一条记录，删除一个 Entity Bean会同时从数据库中删除对应记录，修改一个Entity Bean时，容器会自动将Entity Bean的状态和数据库同步。</p><p><strong>注</strong>：POJO与Java Bean的区别</p><table><thead><tr><th>POJO</th><th>JAVABean</th></tr></thead><tbody><tr><td>除了Java语言强加的限制外，它没有其他特殊限制。</td><td>这是一个特殊的POJO，它有一些限制。</td></tr><tr><td>它没有对成员提供太多控制。</td><td>它提供对成员的完全控制。</td></tr><tr><td>它可以实现Serializable接口。</td><td>它应该实现可序列化的接口。</td></tr><tr><td>可以通过字段名称访问字段。</td><td>字段只能由getter和setter访问。</td></tr><tr><td>字段可以具有任何可见性。</td><td>字段只有私人可见性。</td></tr><tr><td>可能/可能没有no-arg构造函数。</td><td>它必须具有无参数构造函数。</td></tr><tr><td>当您不想限制成员并让用户完全访问您的实体时使用它</td><td>当您要向用户提供您的实体，但仅向实体的一部分提供服务时，将使用它。</td></tr></tbody></table><p><strong>注</strong>：SpringBean和JavaBean的区别：</p><p>1、用处不同：传统javabean更多地作为值传递参数，而spring中的bean用处几乎无处不在，任何组件都可以被称为bean。</p><p>2、生命周期不同：传统javabean作为值对象传递，不接受任何容器管理其生命周期；spring中的bean有spring管理其生命周期行为。</p><h3 id="一、概述" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、概述">#</a> 一、概述</h3><blockquote><p>编写spring代码，我们需要创建一个maven工程，并加入以下依赖：</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- Spring的核心组件 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-core<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>5.2.18.RELEASE<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!-- SpringIoC(依赖注入)的基础实现 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-beans<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>5.2.18.RELEASE<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!--Spring提供在基础IoC功能上的扩展服务，此外还提供许多企业级服务的支持，如邮件服务、任务调度、JNDI定位、EJB集成、远程访问、缓存以及各种视图层框架的封装等 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-context<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>5.2.18.RELEASE<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注：如果使用了jdk17，也可以使用spring的6.x版本，但是要注意，多个spring相关的依赖版本必须一致。</p><p>依赖如下：</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- Spring的核心组件 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-core<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>6.0.2<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!-- SpringIoC(依赖注入)的基础实现 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-beans<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>6.0.2<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!--Spring提供在基础IoC功能上的扩展服务，此外还提供许多企业级服务的支持，如邮件服务、任务调度、JNDI定位、EJB集成、远程访问、缓存以及各种视图层框架的封装等 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-context<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>6.0.2<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>本章介绍了Spring框架实现控制反转(IoC)的原理， IoC也称为依赖注入(DI)。</p></blockquote><p><code>org.springframework.beans</code>和<code>org.springframework.context</code>包是Spring框架的IoC容器的基础。其中BeanFactory接口提供了容器的基本功能，而ApplicationContext添加了更多特定于企业的功能。ApplicationContext是BeanFactory的一个完整超集。</p><p>【beanFactory】和【ApplicationContext】接口展示如下：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">public interface BeanFactory &#123;&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApplicationContext</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">EnvironmentCapable</span>， ListableBeanFactory， HierarchicalBeanFactory， MessageSource， ApplicationEventPublisher， ResourcePatternResolver &#123;&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>【BeanFactory接口】提供了一种高级的配置机制，能够管理任何类型的对象。 ApplicationContext是BeanFactory的子接口。 它对BeanFactory进行了补充:</p><ol><li>更容易与Spring的AOP特性集成 。</li><li>【MessageSource接口】用于消息资源处理(用于国际化) ，解析消息的能力，支持国际化。</li><li>【ApplicationEventPublisher接口】事件发布，向注册侦听器发布事件的能力。</li><li>应用程序层特定的上下文，如WebApplicationContext用于web应用程序。</li><li>【ResourceLoader接口】拥有以通用方式加载文件资源的能力。</li></ol><p>我们可以阅读以下内容，并在后面的学习中认真思考：</p><p>1、由Spring IoC容器【管理】的构成【应用程序主干的对象】称为【bean】。</p><p>2、bean是由Spring IoC容器实例化、组装和管理的对象。</p><p>3、bean及其之间的依赖关系反映在容器使用的【配置元数据】中，元数据可以是配置文件，也可以使用Java注解或代码申明。</p><p>4、 容器通过读取【配置元数据】获得关于要实例化、配置和组装哪些对象的指令。 配置元数据以XML、Java注解或Java代码表示。元数据表达了【组成应用程序的对象】以及这些对象之间丰富的【相互依赖关系】。</p><h3 id="二、配置元数据" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、配置元数据">#</a> 二、配置元数据</h3><p>构建【Spring IoC容器】可以通过【配置文件】的形式提供元数据。</p><p>这个【配置元数据】说的是：作为应用程序开发人员，您要告诉Spring容器如何去【实例化、配置和组装】应用程序中的对象。 【元数据】传统上以简单而直观的XML格式提供，本章的大部分内容都使用这种格式来传达Spring IoC容器的关键概念和特性。</p><p>下面的示例展示了基于xml的配置元数据的基本结构:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;...&quot; class=&quot;...&quot;<span class="hljs-symbol">&amp;gt;</span>  <br>        <span class="hljs-symbol">&amp;lt;</span>!-- collaborators and configuration for this bean go here --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;...&quot; class=&quot;...&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- collaborators and configuration for this bean go here --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- more bean definitions go here --<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>' id '属性是标识单个beanDifination的字符串。</p></li><li><p>' class '属性定义bean的类型，并使用完全限定的类名。</p></li></ul><h3 id="三、实例化一个容器" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、实例化一个容器">#</a> 三、实例化一个容器</h3><p><code>ApplicationContext </code>的构造函数可以是【xml文件的位置路径】的字符串，它允许容器从各种外部资源（如本地文件系统、Java的 ' CLASSPATH '等）加载配置元数据。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;services.xml&quot;</span>， <span class="hljs-string">&quot;daos.xml&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>下面的示例展示了服务层对象（services.xml）的配置文件:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- services --<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;petStore&quot; class=&quot;org.springframework.samples.jpetstore.services.PetStoreServiceImpl&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;itemDao&quot; ref=&quot;itemDao&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- additional collaborators and configuration for this bean go here --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- more bean definitions for services go here --<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面的例子展示了数据访问对象（dao.xml ）的配置文件:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;accountDao&quot;<br>        class=&quot;org.springframework.samples.jpetstore.dao.jpa.JpaAccountDao&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- additional collaborators and configuration for this bean go here --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;itemDao&quot; class=&quot;org.springframework.samples.jpetstore.dao.jpa.JpaItemDao&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- additional collaborators and configuration for this bean go here --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- more bean definitions for data access objects go here --<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="四、使用容器" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、使用容器">#</a> 四、使用容器</h3><p>【ApplicationContext】是一个高级工厂的接口，它维护了一个bean的注册列表，保存了容器产生的所有bean对象。 通过使用方法<code>T getBean(String name， Class&lt;T&gt; requiredType) </code>，您可以检索bean的实例。</p><p>【ApplicationContext】允许你读取和访问bean，如下面的示例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// create and configure beans</span><br><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;services.xml&quot;</span>， <span class="hljs-string">&quot;daos.xml&quot;</span>);<br><br><span class="hljs-comment">// retrieve configured instance，这里使用bean的标识符活class对象检索bean的实例。</span><br><span class="hljs-type">PetStoreService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> context.getBean(<span class="hljs-string">&quot;petStore&quot;</span>， PetStoreService.class);<br><br><span class="hljs-comment">// use configured instance</span><br>List&amp;lt;String&amp;gt; userList = service.getUsernameList();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="五、bean的概述" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#五、bean的概述">#</a> 五、Bean的概述</h3><p>Spring IoC容器管理一个或多个bean。 这些bean是使用您提供给容器的配置元数据创建的（例如，以XML<code>&lt;bean/&gt;</code>定义的形式）。</p><p>在容器本身中，这些定义好的【bean的元数据（描述bean的数据）】被表示为【BeanDefinition】对象，其中包含但不限于以下元数据：</p><ul><li>全限定类名：通常是被定义的bean的实际【实现类】。</li><li>Bean的行为配置元素：它声明Bean在容器中应该存在哪些行为（作用范围、生命周期回调等等）。</li><li>bean所需的其他bean的引用（成员变量）：这些引用也称为【协作者】或【依赖项】。</li></ul><p>接下来我们对其一一进行讲解：</p><h4 id="_1、bean的命名" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、bean的命名">#</a> 1、bean的命名</h4><p>每个bean都有【一个或多个】标识符。 这些标识符在spring容器（ioc容器）中必须是唯一的。 bean通常只有一个标识符。 但是，如果需要多个，则可以考虑使用别名。</p><p>在【基于xml】的配置元数据中，可以使用' id '属性、' name '属性或两者同时使用，来指定bean的标识符。 ' id '属性允许您指定一个id，通常，这些名称是字母数字（'myBean'， 'someService'等），但它们也可以包含特殊字符。 如果想为bean引入其他别名（一个或者多个都可以），还可以在' name '属性中指定它们，由逗号('，')、分号(';')或空格分隔。</p><p>您甚至不需要为bean提供' name '或' id '。 如果您没有显式地提供' name '或' id '，容器将为该bean生成唯一的名称。 但是，如果您想通过名称引用该bean，则必须通过使用' ref '元素来提供名称。 xml中默认的名字是【类的全限定名称#数字】,如（com.ydlclass.dao.UserDao#1）。</p><p>【bean命名约定】</p><p>在命名bean时，bean名称以小写字母开头，并从那里开始采用驼峰式大小写。 这类名称的例子包括' accountManager '、' accountService '、' userDao '、' loginController '等等。</p><p>一致地命名bean可以使您的配置更容易阅读和理解。</p><h4 id="_2、bean的别名" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、bean的别名">#</a> 2、bean的别名</h4><p>在bean的定义中，您可以为bean提供多个名称，方法是使用' id '属性指定的最多一个名称和' name '属性中任意数量的其他名称的组合。 这些名称可以是相同bean的等效别名，在某些情况下很有用，例如允许应用程序中的每个组件使用特定于该组件本身的bean名称来引用公共依赖项。 举一个简单的例子，一个人在家叫【狗蛋】，在公司叫【小刘】。</p><p>然而，在实际定义bean的地方指定所有别名并不一定能满足所有需求，有时需要为别处定义的bean（比如引入的jar包）引入别名。 这种情况在大型系统中很常见，其中配置在每个子系统之间被分割，每个子系统都有自己的一组对象定义。 在基于xml的配置元数据中，可以使用<code>&lt;alias/&gt;</code>元素来实现这一点。 下面的例子展示了如何做到这一点:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>alias name=&quot;fromName&quot; alias=&quot;toName&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>在这种情况下，一个名为【fromName】的bean被定义了一个新的别名【toName】。</p><p>例如，子系统A的配置元数据可以以【subsystemA-dataSource】的名称引用数据源。 子系统B的配置元数据可以以【subsystemB-dataSource 】的名称引用数据源。 当编写使用这两个子系统的主应用程序时，主应用程序以【myApp-dataSource】的名称引用数据源。 要使这三个名称都指向同一个对象，您可以向配置元数据添加以下别名定义:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>alias name=&quot;myApp-dataSource&quot; alias=&quot;subsystemA-dataSource&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>alias name=&quot;myApp-dataSource&quot; alias=&quot;subsystemB-dataSource&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，每个组件和主应用程序都可以通过唯一的名称来引用dataSource，并且保证不会与任何其他定义（有效地创建了一个名称空间）发生冲突，但它们引用的是相同的bean。</p><h4 id="_3、实例化bean" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、实例化bean">#</a> 3、实例化bean</h4><p><strong>beanDifination</strong>本质上是描述了一个bean是如何被创建的。 当被请求时，容器会查看指定bean的定义，并使用由该beanDifination封装的配置元数据来创建（或获取）实际对象。</p><p>如果使用基于xml配置的元数据，则要在<code>&lt;bean/&gt;</code>元素的【class】属性中指定实例化的对象的类型。 这个' class '属性（在内部是' BeanDefinition '实例上的' class '属性，一个bean的配置加载到内存会形成一个BeanDefinition事例）通常是强制性的。 你可以通过以下两种方式使用Class属性:</p><ol><li>在容器中，如果是通过【反射调用其构造函数】直接创建bean，则要指定bean的类型，这有点类似于使用“new”操作符的Java代码。</li><li>这个类同样可以是用于创建对象的“静态”工厂方法的实际类，在这种情况下，容器调用该类上的【静态工厂方法来创建bean】。 调用静态工厂方法返回的对象类型可能是同一个类，也可能完全是另一个类，这要看你的工厂方法的具体实现。</li></ol><h5 id="_1-使用构造函数实例化" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1-使用构造函数实例化">#</a> （1）使用构造函数实例化</h5><p>当您通过构造函数方法创建bean时，所有普通类都可以被Spring使用并与Spring兼容。 也就是说，正在开发的类不需要实现任何特定的接口，也不需要以特定的方式编码。 只需指定bean类就足够了。 但是，这种情况下您可能需要一个默认（无参）构造函数。</p><p>其实就是spring通过class全限定名使用反射进行构造实例。</p><blockquote><p>使用基于xml的配置元数据，您可以使用如下方法，指定您的bean类:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;exampleBean&quot; class=&quot;examples.ExampleBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>bean name=&quot;anotherExample&quot; class=&quot;examples.ExampleBeanTwo&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-使用静态工厂方法实例化" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2-使用静态工厂方法实例化">#</a> （2）使用静态工厂方法实例化</h5><p>在使用【静态工厂方法】创建的bean时，使用【class】属性指定包含【一个静态工厂方法】的类，并使用名为【factory-method】的属性指定工厂方法本身的名称。 我们应该能够调用这个方法并返回一个对象实例。</p><blockquote><p>下面的beanDifination指定通过调用工厂方法创建bean：</p></blockquote><p>在这个例子中，<code>createInstance()</code>方法必须是一个静态方法，下面的示例演示如何指定工厂方法:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;clientService&quot; class=&quot;examples.ClientService&quot; factory-method=&quot;createInstance&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><blockquote><p>下面的示例显示了一个具有静态工厂方法的类：</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClientService</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">ClientService</span> <span class="hljs-variable">clientService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientService</span>();<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">ClientService</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ClientService <span class="hljs-title function_">createInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> clientService;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-使用实例工厂方法实例化" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3-使用实例工厂方法实例化">#</a> （3）使用实例工厂方法实例化</h5><p>该方法类似于通过（静态工厂方法）实例化所需的bean，容器同样可以使用【实例工厂方法】调用【非静态方法】创建一个新的bean。 要使用这种机制，请将【class】属性保留为空，并在【factory-bean】属性中指定当前容器中包含要调用的实例方法的bean的名称。 使用“factory-method”属性设置工厂方法本身的名称。</p><blockquote><p>下面的示例演示如何配置这样的bean:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- the factory bean， which contains a method called createInstance() --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;serviceLocator&quot; class=&quot;examples.DefaultServiceLocator&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- inject any dependencies required by this locator bean --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>!-- the bean to be created via the factory bean --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;clientService&quot; factory-bean=&quot;serviceLocator&quot; factory-method=&quot;createClientServiceInstance&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>下面的例子显示了相应的类:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultServiceLocator</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">ClientService</span> <span class="hljs-variable">clientService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientServiceImpl</span>();<br><br>    <span class="hljs-keyword">public</span> ClientService <span class="hljs-title function_">createClientServiceInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> clientService;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>一个工厂类也可以包含多个工厂方法，如下例所示:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;serviceLocator&quot; class=&quot;examples.DefaultServiceLocator&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- inject any dependencies required by this locator bean --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;clientService&quot; factory-bean=&quot;serviceLocator&quot; factory-method=&quot;createClientServiceInstance&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;accountService&quot; factory-bean=&quot;serviceLocator&quot; factory-method=&quot;createAccountServiceInstance&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面的例子显示了相应的类:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultServiceLocator</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">ClientService</span> <span class="hljs-variable">clientService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientServiceImpl</span>();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AccountService</span> <span class="hljs-variable">accountService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountServiceImpl</span>();<br><br>    <span class="hljs-keyword">public</span> ClientService <span class="hljs-title function_">createClientServiceInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> clientService;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> AccountService <span class="hljs-title function_">createAccountServiceInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> accountService;<br>    &#125;<br>&#125;  <br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注：其实我们这样明白一点，静态工厂方法可以直接调用，实例工厂方法需要容器【先构建好实例】再进行调用。</p><h3 id="六、依赖注入-dependency-injection" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#六、依赖注入-dependency-injection">#</a> 六、依赖注入 Dependency Injection</h3><p>依赖注入（DI）是一个【过程】（目前可以理解为给成员变量赋值的过程），在此过程中，对象仅通过【构造函数参数】、【工厂方法参数】等来确定它们的依赖项。 然后容器在创建bean时注入这些依赖项。 从根本上说，这个过程与bean本身相反(因此得名“控制反转”)。</p><p>使用依赖注入的代码更清晰，并且在向对象提供依赖时【解耦更有效】。</p><p>DI主要有以下两种方式:</p><ul><li>Constructor-based依赖注入，基于构造器的依赖注入，本质上是使用构造器给成员变量赋值。</li><li>Setter-based依赖注入，基于setter方法的依赖注入，本质上是使用set方法给成员变量赋值。</li></ul><h4 id="_1、基于构造函数的依赖注入" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、基于构造函数的依赖注入">#</a> 1、基于构造函数的依赖注入</h4><blockquote><p>基于构造器的依赖注入是通过容器调用带有许多参数的构造器来实现的，每个参数表示一个依赖项：</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br><br>    <span class="hljs-comment">// the SimpleMovieLister has a dependency on a MovieFinder</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MovieFinder movieFinder;<br><br>    <span class="hljs-comment">// a constructor so that the Spring container can inject a MovieFinder</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleMovieLister</span><span class="hljs-params">(MovieFinder movieFinder)</span> &#123;<br>        <span class="hljs-built_in">this</span>.movieFinder = movieFinder;<br>    &#125;<br><br>    <span class="hljs-comment">// business logic that actually uses the injected MovieFinder is omitted...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意，这个类没有什么特别之处。 它是一个POJO，不依赖于容器特定的接口、基类或注解。</p><blockquote><p>1、使用参数的顺序实现</p></blockquote><p>如果beanDifination的构造函数参数中不存在【潜在的歧义】，那么在beanDifination中定义【构造函数参数的顺序】就是在实例化bean时将这些参数提供给适当构造函数的顺序，我们可以看一下下边这个类:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> x.y;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThingOne</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ThingOne</span><span class="hljs-params">(ThingTwo thingTwo,ThingThree thingThree)</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 假设【ThingTwo】和【ThingThree】类没有继承关系，就不存在潜在的歧义。 因此，下面的配置工作正常，并且您不需要在<code>&lt;constructor-arg/&gt; </code>元素中显式指定【构造函数参数索引或类型】。</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;beanOne&quot; class=&quot;x.y.ThingOne&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- 直接写就可以 --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>constructor-arg ref=&quot;beanTwo&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>constructor-arg ref=&quot;beanThree&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;beanTwo&quot; class=&quot;x.y.ThingTwo&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;beanThree&quot; class=&quot;x.y.ThingThree&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>2、构造函数参数类型匹配</p></blockquote><p>​ 当引用另一个bean时，类型是已知的，可以进行匹配（如上例所示）。 当使用简单类型时，例如<code>&lt;value&gt;true&lt;/value&gt; </code>， Spring无法确定值的类型，因此在没有帮助的情况下无法按类型匹配。 考虑以下官网提供的类:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> examples;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleBean</span> &#123;<br><br>    <span class="hljs-comment">// Number of years to calculate the Ultimate Answer</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> years;<br><br>    <span class="hljs-comment">// The Answer to Life， the Universe， and Everything</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String ultimateAnswer;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ExampleBean</span><span class="hljs-params">(<span class="hljs-type">int</span> years,String ultimateAnswer)</span> &#123;<br>        <span class="hljs-built_in">this</span>.years = years;<br>        <span class="hljs-built_in">this</span>.ultimateAnswer = ultimateAnswer;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在前面的场景中，如果你通过使用【type】属性显式指定构造函数参数的类型，容器可以使用与简单类型匹配的类型，如下面的示例所示:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;exampleBean&quot; class=&quot;examples.ExampleBean&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>constructor-arg type=&quot;int&quot; value=&quot;7500000&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>constructor-arg type=&quot;java.lang.String&quot; value=&quot;42&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>3、按照构造函数参数的下标匹配</p></blockquote><p>你可以使用【index】属性显式指定构造函数参数的索引，如下例所示:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;exampleBean&quot; class=&quot;examples.ExampleBean&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>constructor-arg index=&quot;0&quot; value=&quot;7500000&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>constructor-arg index=&quot;1&quot; value=&quot;42&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>除了解决多个简单值的歧义之外，指定索引还解决构造函数具有相同类型的两个参数的歧义。</p><blockquote><p>4、按照构造函数参数的名字匹配</p></blockquote><p>还可以使用构造函数参数名来消除值的歧义，如下面的示例所示:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;exampleBean&quot; class=&quot;examples.ExampleBean&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>constructor-arg name=&quot;years&quot; value=&quot;7500000&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>constructor-arg name=&quot;ultimateAnswer&quot; value=&quot;42&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、基于setter的注入" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、基于setter的注入">#</a> 2、基于setter的注入</h4><p>基于setter的DI是通过容器在【调用无参数构造函数】或【无参数“静态”工厂方法】实例化bean后调用bean上的setter方法来实现的。</p><p>下面的示例展示了一个只能通过使用纯setter注入进行依赖注入的类。 这个类是传统的Java。 它是一个POJO，不依赖于容器特定的接口、基类或注解。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br><br>    <span class="hljs-comment">// the SimpleMovieLister has a dependency on the MovieFinder</span><br>    <span class="hljs-keyword">private</span> MovieFinder movieFinder;<br><br>    <span class="hljs-comment">// a setter method so that the Spring container can inject a MovieFinder</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMovieFinder</span><span class="hljs-params">(MovieFinder movieFinder)</span> &#123;<br>        <span class="hljs-built_in">this</span>.movieFinder = movieFinder;<br>    &#125;<br><br>    <span class="hljs-comment">// business logic that actually uses the injected MovieFinder is omitted...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><p>【ApplicationContext】支持它管理的bean的【基于构造函数】和【基于setter】的依赖注入。 在已经通过构造函数方法注入了一些依赖项之后，它还支持基于setter的DI。也就意味着先通过有参构造构建对象，再通过setter方法进行特殊值的赋值。</p><blockquote><p>下面的元数据配置示例为【基于setter】的DI方式：</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;exampleBean&quot; class=&quot;examples.ExampleBean&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- setter injection using the nested ref element --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;beanOne&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>ref bean=&quot;anotherExampleBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- setter injection using the neater ref attribute --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;beanTwo&quot; ref=&quot;yetAnotherBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;integerProperty&quot; value=&quot;1&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;anotherExampleBean&quot; class=&quot;examples.AnotherBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;yetAnotherBean&quot; class=&quot;examples.YetAnotherBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>下面的示例显示了相应的【ExampleBean】类:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleBean</span> &#123;<br><br>    <span class="hljs-keyword">private</span> AnotherBean beanOne;<br><br>    <span class="hljs-keyword">private</span> YetAnotherBean beanTwo;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> i;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBeanOne</span><span class="hljs-params">(AnotherBean beanOne)</span> &#123;<br>        <span class="hljs-built_in">this</span>.beanOne = beanOne;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBeanTwo</span><span class="hljs-params">(YetAnotherBean beanTwo)</span> &#123;<br>        <span class="hljs-built_in">this</span>.beanTwo = beanTwo;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setIntegerProperty</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-built_in">this</span>.i = i;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>其他情况</p></blockquote><p>现在考虑这个例子的一个变体，在这里，Spring不是使用构造函数，而是被告知调用一个【static】工厂方法来返回对象的一个实例:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;exampleBean&quot; class=&quot;examples.ExampleBean&quot; factory-method=&quot;createInstance&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>constructor-arg ref=&quot;anotherExampleBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>constructor-arg ref=&quot;yetAnotherBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>constructor-arg value=&quot;1&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;anotherExampleBean&quot; class=&quot;examples.AnotherBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;yetAnotherBean&quot; class=&quot;examples.YetAnotherBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面的示例显示了相应的' ExampleBean '类:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleBean</span> &#123;<br><br>    <span class="hljs-comment">// a private constructor</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">ExampleBean</span><span class="hljs-params">(...)</span> &#123;<br>        ...<br>    &#125;<br><br>    <span class="hljs-comment">// a static factory method; the arguments to this method can be</span><br>    <span class="hljs-comment">// considered the dependencies of the bean that is returned，</span><br>    <span class="hljs-comment">// regardless of how those arguments are actually used.</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExampleBean <span class="hljs-title function_">createInstance</span> <span class="hljs-params">(</span><br><span class="hljs-params">        AnotherBean anotherBean， YetAnotherBean yetAnotherBean， <span class="hljs-type">int</span> i)</span> &#123;<br><br>        <span class="hljs-type">ExampleBean</span> <span class="hljs-variable">eb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExampleBean</span> (...);<br>        <span class="hljs-comment">// some other operations...</span><br>        <span class="hljs-keyword">return</span> eb;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【static】工厂方法的参数是由<code>&lt;constructor-arg/&gt; </code>元素提供的，就像实际使用了构造函数一样。spring会根据元数据构造工厂对象，再由工厂对象创建实例，创建的实例交由spring容器管理。</p><h4 id="_3、基于构造函数还是基于setter的依赖注入" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、基于构造函数还是基于setter的依赖注入">#</a> 3、基于构造函数还是基于setter的依赖注入?</h4><p>我们可以混合使用基于构造【函数和setter】的DI，一般情况下，我们对于【强制性依赖项】使用构造函数，对于【可选依赖项】使用setter方法注入，这是一个很好的经验法则。 注意，在setter方法上使用【@Required】注解可以使属性成为必需依赖项。</p><p>Spring团队更提倡使用构造函数注入，因为它允许你将应用程序组件实现为【不可变的对象】，并确保所需的依赖项不是”空“的，这样会更加的安全可靠。 而且，构造函数注入的组件总是以完全初始化的状态返回给客户端(调用)代码。</p><p>Setter注入主要应该只用于【可选依赖项】，这些依赖项可以在类中分配合理的默认值。 setter注入的一个好处是，setter方法使该类的对象能够在稍后进行重新配置或重新注入。</p><p>有时，在处理您没有源代码的第三方类时，您可以自行选择。 例如，如果第三方类不公开任何setter方法，那么构造函数注入可能是DI的唯一可用形式。</p><h4 id="_4、依赖关系和配置细节" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、依赖关系和配置细节">#</a> 4、依赖关系和配置细节</h4><p>​ 从上边的课程我们知道，可以将【bean属性】和【构造函数参数】定义为对【其他合作者bean(合作者)的引用】。 Spring基于xml配置的元数据应该为其<code>&lt;property/&gt; </code>和<code>&lt;constructor-arg/&gt;</code>元素中支持多样的元素类型。</p><h5 id="_1-直接值-原语、字符串等" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1-直接值-原语、字符串等">#</a> （1）直接值(原语、字符串等)</h5><p>​ <code>&lt;property/&gt; </code>元素的【value】属性将【属性或构造函数参数】指定为人类可读的字符串表示形式。 Spring的【类型转化器】用于将这些值从' String '转换为属性或参数的实际类型（比如数字类型，甚至是对象）。</p><p>下面的示例显示了正在设置的各种值:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;myDataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; destroy-method=&quot;close&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- results in a setDriverClassName(String) call --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/mydb&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;username&quot; value=&quot;root&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;password&quot; value=&quot;misterkaoli&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-idref元素" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2-idref元素">#</a> （2）idref元素</h5><p>​ 【idref 】元素只是将容器中另一个bean的【id 字符串值-不是引用】传递给·<code>&lt;constructor-arg/&gt; </code>或<code>&lt;property/&gt; </code>元素的一种防错误方法。 下面的例子展示了如何使用它:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;theTargetBean&quot; class=&quot;...&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;theClientBean&quot; class=&quot;...&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;targetName&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>idref bean=&quot;theTargetBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>前面的beanDifination代码段(在运行时)与下面的代码段完全相同:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;theTargetBean&quot; class=&quot;...&quot; /<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;client&quot; class=&quot;...&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;targetName&quot; value=&quot;theTargetBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 第一种形式比第二种形式更可取，因为使用' idref '标记可以让容器在部署时【验证所引用的已命名bean是否实际存在】。 在第二个变体中，没有对传递给"theClientBean"的【targetName】属性的值执行验证。 只有在实际实例化【theClientBean】时才会发现拼写错误（很可能导致致命的结果）。 如果“客户端”bean是一【prototype bean马上要讲到】，那么这个错误和由此产生的异常可能只有在容器部署很久之后才会被发现。</p><h5 id="_3-对其他bean的引用-collaborators合作者" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3-对其他bean的引用-collaborators合作者">#</a> （3）对其他bean的引用(Collaborators合作者)</h5><p>​ 【ref】元素是<code>&lt;constructor-arg/&gt; </code>或<code>&lt;property/&gt; </code>定义元素中的最后一个元素。 在这里，您将bean的指定属性的值设置为容器管理的另一个bean（合作者bean）的引用。 被引用的bean是要设置其属性的bean的依赖项，并且在设置属性之前根据需要初始化它。</p><p>​ 通过<code>&lt;ref/&gt; </code>标记的【bean属性】指定目标bean是最常用的一种形式，它允许创建同一容器中的任何bean的引用，而不管它是否在同一XML文件中。 【bean属性】的值可以与目标bean的【id】属性相同，也可以与目标bean的【name】属性中的一个值相同。 下面的例子展示了如何使用【ref】元素:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;accountService&quot; class=&quot;com.something.SimpleAccountService&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- insert dependencies as required here --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;accountService&quot; <span class="hljs-symbol">&amp;lt;</span>!-- bean name is the same as the parent bean --<span class="hljs-symbol">&amp;gt;</span><br>    class=&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;target&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>ref bean=&quot;accountService&quot;/<span class="hljs-symbol">&amp;gt;</span> <span class="hljs-symbol">&amp;lt;</span>!-- notice how we refer to the parent bean --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- insert other configuration and dependencies as required here --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-内部bean" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4-内部bean">#</a> （4）内部bean</h5><blockquote><p>在<code>&lt;property/&gt; </code>或<code>&lt;constructor-arg/&gt; </code>元素内部的'<code>&lt;bean/&gt; </code>元素定义了一个内部bean，如下面的例子所示:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;outer&quot; class=&quot;...&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- instead of using a reference to a target bean， simply define the target bean inline --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;target&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>bean class=&quot;com.example.Person&quot;<span class="hljs-symbol">&amp;gt;</span> <span class="hljs-symbol">&amp;lt;</span>!-- this is the inner bean --<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>property name=&quot;name&quot; value=&quot;Fiona Apple&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>property name=&quot;age&quot; value=&quot;25&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 内部bean总是匿名的，并且总是与外部bean一起创建的。 不可能独立地访问内部bean，也不可能将它们注入到外围bean之外的协作bean中。</p><p>​</p><h5 id="_5-集合" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5-集合">#</a> （5）集合</h5><p>​ <code>&lt;list/&gt;</code>， <code>&lt;set/&gt;</code>， <code>&lt;map/&gt;</code>， 和 <code>&lt;props/&gt;</code> 元素分别设置 Java <code>Collection</code> 类型 <code>List</code>， <code>Set</code>， <code>Map</code>，和 <code>Properties</code>的属性和参数。 下面的例子展示了如何使用它们:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;moreComplexObject&quot; class=&quot;example.ComplexObject&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- results in a setAdminEmails(java.util.Properties) call --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;adminEmails&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>props<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>prop key=&quot;administrator&quot;<span class="hljs-symbol">&amp;gt;</span>administrator@example.org<span class="hljs-symbol">&amp;lt;</span>/prop<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>prop key=&quot;support&quot;<span class="hljs-symbol">&amp;gt;</span>support@example.org<span class="hljs-symbol">&amp;lt;</span>/prop<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>prop key=&quot;development&quot;<span class="hljs-symbol">&amp;gt;</span>development@example.org<span class="hljs-symbol">&amp;lt;</span>/prop<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/props<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- results in a setSomeList(java.util.List) call --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;someList&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>list<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>value<span class="hljs-symbol">&amp;gt;</span>a list element followed by a reference<span class="hljs-symbol">&amp;lt;</span>/value<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>ref bean=&quot;myDataSource&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/list<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- results in a setSomeMap(java.util.Map) call --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;someMap&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>map<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>entry key=&quot;an entry&quot; value=&quot;just some string&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>entry key=&quot;a ref&quot; value-ref=&quot;myDataSource&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/map<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- results in a setSomeSet(java.util.Set) call --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;someSet&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>set<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>value<span class="hljs-symbol">&amp;gt;</span>just some string<span class="hljs-symbol">&amp;lt;</span>/value<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>ref bean=&quot;myDataSource&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/set<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>映射键或值或集合值的值也可以是以下元素中的任何一个:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">bean | ref | idref | list | set | map | props | value | null<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><h5 id="_6-null值和空字符串" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6-null值和空字符串">#</a> （6）null值和空字符串</h5><p>​ Spring将属性的【空参数】等作为空字符串处理，以下基于xml的配置元数据片段将' email '属性设置为空字符("")。</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean class=&quot;ExampleBean&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;email&quot; value=&quot;&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的例子等价于下面的Java代码:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">exampleBean.setEmail(<span class="hljs-string">&quot;&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p><code>&lt;null/&gt;</code>元素处理 <code>null</code>值。 下面的例子显示了一个示例:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean class=&quot;ExampleBean&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;email&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>null/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述配置相当于以下Java代码:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">exampleBean.setEmail(<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><h5 id="_7-带有【p命名空间】的xml配置方式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_7-带有【p命名空间】的xml配置方式">#</a> （7）带有【p命名空间】的XML配置方式</h5><p>​ 【p-名称空间】允许您使用【bean元素的属性】（而不是嵌套的<code>&lt;property/&gt;</code>元素）来描述协作bean的属性值，或者两者都使用。说的简单一点就是另外一种写法。</p><blockquote><p>下面的示例显示了两个XML片段(第一个使用标准XML格式，第二个使用p-名称空间)，它们解析相同的结果:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xmlns:p=&quot;http://www.springframework.org/schema/p&quot;<br>    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean name=&quot;classic&quot; class=&quot;com.example.ExampleBean&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;email&quot; value=&quot;someone@somewhere.com&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean name=&quot;p-namespace&quot; class=&quot;com.example.ExampleBean&quot;<br>        p:email=&quot;someone@somewhere.com&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>下一个例子包括另外两个beanDifination，它们都引用了另一个bean:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xmlns:p=&quot;http://www.springframework.org/schema/p&quot;<br>    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean name=&quot;john-classic&quot; class=&quot;com.example.Person&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;name&quot; value=&quot;John Doe&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;spouse&quot; ref=&quot;jane&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean name=&quot;john-modern&quot;<br>        class=&quot;com.example.Person&quot;<br>        p:name=&quot;John Doe&quot;<br>        <span class="hljs-symbol">&amp;lt;</span>!--p命名空间支持这样定义的bean的引用--<span class="hljs-symbol">&amp;gt;</span><br>        p:spouse-ref=&quot;jane&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean name=&quot;jane&quot; class=&quot;com.example.Person&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;name&quot; value=&quot;Jane Doe&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们建议您仔细选择方法，并将其告知您的团队成员，用以形成规范的统一的XML文档。</p><h5 id="_8-带有c命名空间的xml快捷方式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_8-带有c命名空间的xml快捷方式">#</a> （8）带有c命名空间的XML快捷方式</h5><p>​ 与带有p-名称空间的XML配置方式类似，在Spring 3.1中引入的【c-名称空间】允许内联属性来配置构造函数参数，而不是嵌套的【constructor-arg】元素。</p><blockquote><p>下面的例子使用了【c: 命名空间】来完成与【基于构造器的依赖注入】:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xmlns:c=&quot;http://www.springframework.org/schema/c&quot;<br>    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;beanTwo&quot; class=&quot;x.y.ThingTwo&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;beanThree&quot; class=&quot;x.y.ThingThree&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- traditional declaration with optional argument names --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;beanOne&quot; class=&quot;x.y.ThingOne&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>constructor-arg name=&quot;thingTwo&quot; ref=&quot;beanTwo&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>constructor-arg name=&quot;thingThree&quot; ref=&quot;beanThree&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>constructor-arg name=&quot;email&quot; value=&quot;something@somewhere.com&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- c-namespace declaration with argument names --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;beanOne&quot; class=&quot;x.y.ThingOne&quot; c:thingTwo-ref=&quot;beanTwo&quot;<br>        c:thingThree-ref=&quot;beanThree&quot; c:email=&quot;something@somewhere.com&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【c: 命名空间】通过名称设置构造函数参数。 类似地，它需要在XML文件中声明对应的命名空间。</p><blockquote><p>对于【构造函数参数名不可用的罕见情况】(通常是在没有调试信息的情况下编译字节码)，可以使用回退参数索引，如下所示:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- c-namespace index declaration --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;beanOne&quot; class=&quot;x.y.ThingOne&quot; c:_0-ref=&quot;beanTwo&quot; c:_1-ref=&quot;beanThree&quot;<br>    c:_2=&quot;something@somewhere.com&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 由于XML语法的原因，索引表示法要求出现前导' _ '，因为XML属性名不能以数字开头(尽管一些ide允许它)。 对于<code>&lt;constructor-arg&gt;</code>元素也有相应的索引表示法，但不常用，因为一般的声明顺序就足够了。</p><p>​ 实际上，【构造函数解析机制】在匹配参数方面非常有效，所以除非真的需要，否则我们建议在整个配置中使用名称表示法。</p><h5 id="_9-复合属性名" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_9-复合属性名">#</a> （9）复合属性名</h5><p>当您设置bean属性时，您可以使用复合或嵌套属性名，只要路径的所有组件（除了最终属性名）不为' null '。 考虑以下beanDifination:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;something&quot; class=&quot;things.ThingOne&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;fred.bob.sammy&quot; value=&quot;123&quot; /<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【something】bean有一个【 fred 】属性，fred 属性有一个【bob】属性，bob 属性有一个【sammy】'属性，最后的【sammy】属性的值被设置为'123'。 为了使其工作，在构造bean之后，' something '的' fred '属性和' fred '的' bob '属性不能为' null '。 否则，抛出一个NullPointerException。</p><h5 id="_10-延迟初始化的-bean" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_10-延迟初始化的-bean">#</a> （10）延迟初始化的 Bean</h5><p>默认情况下，【ApplicationContext】实现会作为初始化过程的一部分，会在容器初始化的时候急切地创建和配置所有【singleton bean】。 通常，这种预实例化是可取的，因为配置或周围环境中的错误可以被立马发现，而不是几个小时甚至几天之后（调用一个方法，创建一个实例的时候等）。 当这种行为不可取时，您可以通过将beanDifination标记为【惰性初始化】来防止【单例bean的预实例化】。 延迟初始化的bean告诉IoC容器在【第一次请求】时创建bean实例，而不是在启动时。</p><blockquote><p>在XML中，这种行为是由<code>&lt;bean/&gt; </code>元素上的【lazy-init】属性控制的，如下面的示例所示:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;lazy&quot; class=&quot;com.something.ExpensiveToCreateBean&quot; lazy-init=&quot;true&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>bean name=&quot;not.lazy&quot; class=&quot;com.something.AnotherBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>然而，当一个【延迟初始化的bean】是一个没有延迟初始化的单例bean的依赖时，ApplicationContext会在启动时创建这个延迟初始化的bean，因为它必须满足单例bean的依赖， 延迟初始化的bean会被注入到没有延迟初始化的其他单例bean中。</p><blockquote><p>你也可以在容器级通过在<code>&lt;beans/&gt;</code>元素上使用“default-lazy-init”属性来控制延迟初始化，如下面的例子所示:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans default-lazy-init=&quot;true&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- no beans will be pre-instantiated... --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5、自动装配" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5、自动装配">#</a> 5、自动装配</h4><blockquote><p>Spring容器可以自动装配【协作bean之间的关系】。 自动装配具有以下优点:</p></blockquote><ul><li>自动装配可以显著减少指定属性或构造函数参数的需要。</li><li>自动装配可以随着对象的发展更新配置。 例如，如果您需要向类添加依赖项，则无需修改配置即可自动满足该依赖项。</li></ul><p>​ 当使用基于xml的配置元数据时，您可以使用<code>&lt;bean/&gt;</code>元素的【autowire】属性为beanDifination指定自动装配模式。 自动装配功能有四种模式。 您可以指定每个bean的自动装配，从而可以选择要自动装配哪些bean，自动装配的四种模式如下表所示:</p><table><thead><tr><th style="text-align:left;">运行方式</th><th style="text-align:left;">解释</th></tr></thead><tbody><tr><td style="text-align:left;"><code>no</code></td><td style="text-align:left;">(默认)没有自动装配。 Bean引用必须由【ref】元素定义。 对于较大的部署，不建议更改默认设置，因为【明确指定协作者】可以提供更大的控制和清晰度。 在某种程度上，它记录了系统的结构。</td></tr><tr><td style="text-align:left;"><code>byName</code></td><td style="text-align:left;"><strong>通过属性名自动装配</strong>。 Spring寻找与需要自动连接的属性同名的bean。 例如，如果一个beanDifination被设置为按名称自动装配，并且它包含一个“master”属性（也就是说，它有一个“setMaster(..)”方法），Spring会寻找一个名为“master”的beanDifination并使用它来设置属性。</td></tr><tr><td style="text-align:left;"><code>byType</code></td><td style="text-align:left;">如果容器中恰好有一个<strong>属性类型</strong>的bean，则允许自动连接属性。 如果存在多个，则抛出异常，这表明您不能对该bean使用' byType '自动装配。 如果没有匹配的bean，则不会发生任何事情(没有设置属性)。</td></tr><tr><td style="text-align:left;"><code>constructor</code></td><td style="text-align:left;">类似于' byType '，但适用于构造函数参数。 如果容器中没有一个构造函数参数类型的bean，则会引发致命错误。</td></tr></tbody></table><p>​ 通过' byType '或' constructor '自动装配模式，您可以连接【数组和类型化集合】。 在这种情况下，容器中所有【匹配预期类型的自动装配候选对象】都将被提供以满足依赖关系。其中，自动连接的“Map”实例的值包含所有与期望类型匹配的bean实例，而“Map”实例的键包含相应的bean名称。</p><blockquote><p>从自动装配中排除Bean</p></blockquote><p>​ 在每个bean的基础上，您可以将一个bean排除在自动装配之外。 在Spring的XML格式中，将<code>&lt;bean/&gt;</code>元素的【autowire-candidate】属性设置为' false '。</p><p>​ “autowire-candidate”属性被设计成只影响【基于类型】的自动装配。 它不会影响【按名称的显式引用】，即使指定的bean没有被标记为自动连接候选对象，也会解析该引用。 因此，如果名称匹配，按名称自动装配仍然会注入一个bean。</p><p>​ 您还可以根据bean名称的模式匹配来限制自动装配候选对象。 顶级元素<code> &lt;beans/&gt;</code>在其【default-autowire-candidates】属性中接受一个或多个匹配规则。 例如，要将自动装配候选状态限制为名称以' Repository '结尾的任何bean，可以提供' *Repository '值。 要提供多个规则，请在逗号分隔的列表中定义它们。 beanDifination的【autowire-candidate】属性的值“true”或“false”总是优先。 对于这样的bean，模式匹配规则不适用。</p><p>​ 这些技术对于那些【永远不想通过自动装配将其注入到其他bean中的bean】非常有用。 但这并不意味着被排除的bean本身不能通过使用自动装配来配置。</p><h4 id="_6、循环依赖" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6、循环依赖">#</a> 6、循环依赖</h4><figure><img class="lazy" alt="image-20211128102816659" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211128102816659-b5c945d9.png" tabindex="0"/><figcaption>image-20211128102816659</figcaption></figure><blockquote><p>容器会按照如下方式执行bean依赖关系解析:</p></blockquote><ul><li><p>使用描述所有bean的配置元数据创建和初始化【ApplicationContext】。 配置元数据可以由XML、Java代码或注解指定。</p></li><li><p>对于每个bean，其依赖关系都以属性、构造函数参数或静态工厂方法参数的形式表示。 这些依赖项是在实际创建bean时提供给bean的。</p></li><li><p>每个属性或构造函数参数的值将从其指定的格式转换为该属性或构造函数参数的实际类型。 默认情况下，Spring可以将字符串格式提供的值转换为所有内置类型，比如' int '、' long '、' string '、' boolean '等等。</p></li></ul><p>​ Spring会在需要的时候实例化一个bean，我们说的简单一点，Spring创建A对象，创建后会注入一个依赖项B，注入时发现依赖的bean不存在，于是就开始创建依赖的B对象，这是一个典型的控制翻转，循环依赖的问题就是实例化B时发现，B竟然依赖A，这是两个对象的互相依赖，组成了一个圆环，循环依赖可能是三个或是更多对象组成。</p><p>​ 使用setter注入的循环依赖是可以解决的，通常是采用三级缓存的方式。</p><h4 id="循环依赖的问题" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#循环依赖的问题">#</a> -----循环依赖的问题</h4><p>​ 但如果主要使用构造函数注入，可能会创建不可解析的循环依赖场景。</p><h3 id="七、bean-作用范围-作用域" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#七、bean-作用范围-作用域">#</a> 七、Bean 作用范围（作用域）</h3><p>​ 当您创建一个beanDifination时，其实是在为这个bean的定义创建描述它的元数据。 beanDifination是元数据的想法很重要，因为这意味着，与类一样，您可以从一份元数据中创建许多对象实例。</p><p>​ 您不仅可以控制beanDifination的对象中的<strong>各种依赖项和配置值</strong>，还可以控制从特定的bean的定义中创建的对象的作用范围。 这种方法功能强大且灵活，因为您可以通过配置，选择创建的对象的作用范围，而不必在Java类级别上确定对象的作用范围。 Spring框架支持六个作用域，其中四个只有在你使用web感知的ApplicationContext时才可用：</p><blockquote><p>下表描述了支持的范围:</p></blockquote><table><thead><tr><th style="text-align:left;">scope</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">singleton</td><td style="text-align:left;">每个bean在ioc容器中都是独一无二的单例形式。</td></tr><tr><td style="text-align:left;">prototype</td><td style="text-align:left;">将单个beanDifination定义为，spring容器可以【实例化任意数量】的对象实例。</td></tr><tr><td style="text-align:left;">request</td><td style="text-align:left;">将单个beanDifination限定为单个HTTP请求的生命周期。 也就是说，每个HTTP请求都有自己的bean实例，它是在单个beanDifination的后面创建的。 仅在web环境中的Spring【ApplicationContext】的上下文中有效。</td></tr><tr><td style="text-align:left;">session</td><td style="text-align:left;">将单个beanDifination定义为HTTP 【Session】的生命周期。 仅在web环境中的Spring 【ApplicationContext】的上下文中有效。</td></tr><tr><td style="text-align:left;">application</td><td style="text-align:left;">将单个beanDifination定义为【ServletContext】的生命周期。 仅在web环境中的Spring 【ApplicationContext】的上下文中有效。</td></tr><tr><td style="text-align:left;">websocket</td><td style="text-align:left;">将单个beanDifination作用域定义为【WebSocket】的生命周期。 仅在web环境中的Spring【ApplicationContext】的上下文中有效。</td></tr></tbody></table><h4 id="_1、单例的作用域" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、单例的作用域">#</a> 1、单例的作用域</h4><p>容器只管理【一个bean的共享实例】，所有对具有一个或多个标识符的bean的请求都将导致Spring容器返回一个特定唯一的bean实例。</p><p>换句话说，当您定义一个beanDifination并且它的作用域为单例时，Spring IoC容器会创建由该beanDifination定义的对象的一个实例。 这个实例对象会存储单例bean的缓存中，对该命名bean的所有后续请求和引用都会返回缓存的对象。 下面的图片展示了单例作用域是如何工作的:</p><figure><img class="lazy" alt="singleton" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/singleton-517d1f2f.png" tabindex="0"/><figcaption>singleton</figcaption></figure><p>【Spring的单例bean概念不同于设计模式书中定义的单例模式】。 单例设计模式对对象的作用域进行硬编码，使得每个ClassLoader只创建一个特定类的实例。 Spring单例的作用域最好描述为每个容器和每个bean，这并不影响我们手动创建更多个实例。 单例作用域是Spring中的默认作用域。 要在XML中将beanDifination为单例，可以定义如下示例所示的bean:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;accountService&quot; class=&quot;com.something.DefaultAccountService&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>!-- the following is equivalent， though redundant (singleton scope is the default) --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;accountService&quot; class=&quot;com.something.DefaultAccountService&quot; scope=&quot;singleton&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、原型作用域" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、原型作用域">#</a> 2、原型作用域</h4><p>非单例原型作用域导致【每次对特定bean发出请求时都要创建一个新的bean实例】。 也就是说，该bean被注入到另一个bean中，或者您通过容器上的<code>getBean()</code>方法调用请求它，都会创建一个新的bean。 作为一条规则，您应该对所有<strong>有状态bean</strong>使用原型作用域，对<strong>无状态bean</strong>使用单例作用域。</p><blockquote><p>下图说明了Spring原型的作用域:</p></blockquote><figure><img class="lazy" alt="prototype" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/prototype-a17423f2.png" tabindex="0"/><figcaption>prototype</figcaption></figure><blockquote><p>下面的示例用XML将beanDifination为原型:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;accountService&quot; class=&quot;com.something.DefaultAccountService&quot; scope=&quot;prototype&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>与其他作用域相比，Spring并【不管理原型bean的完整生命周期】。 容器实例化、配置和组装一个原型对象，并将其传递给客户端，而不需要进一步记录该原型实例，不会缓存，不会管理他的后续生命周期。 因此，尽管初始化生命周期回调方法在所有对象上都被调用但在原型的情况下，配置的销毁生命周期回调不会被调用（这个小知识下个小节讲）。</p><p>在某些方面，Spring容器在原型作用域bean中的角色是Java【new】操作符的替代。 超过这一点的所有生命周期管理都必须由客户端处理。</p><h4 id="_3、会话、应用和websocket作用域" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、会话、应用和websocket作用域">#</a> 3、会话、应用和WebSocket作用域</h4><p>【request 】，【session 】， 【application】和【websocket 】作用域只有在你使用web项目中的Spring【ApplicationContext】实现（如XmlWebApplicationContext）时才可用。 如果您将这些作用域与常规Spring IoC容器一起使用，例如“ClassPathXmlApplicationContext”，则会抛出一个“IllegalStateException”，该异常会告知一个未知的bean作用域。</p><h4 id="_4、自定义范围" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、自定义范围">#</a> 4、自定义范围</h4><p>bean作用域机制是可扩展的，您可以定义自己的作用域，甚至可以重新定义现有的作用域，尽管后者被认为是不好的做法，而且您不能覆盖内置的' singleton '和' prototype '作用域。</p><h3 id="八、更多bean的特性" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#八、更多bean的特性">#</a> 八、更多bean的特性</h3><p>Spring框架提供了许多接口，您可以使用这些接口自定义bean的性质。将它们归类如下:</p><ul><li>生命周期回调</li><li>ApplicationContextAware<code>和</code>BeanNameAware</li><li>其他r<code>Aware</code> 接口</li></ul><h4 id="_1、生命周期回调" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、生命周期回调">#</a> 1、生命周期回调</h4><blockquote><p>初始化回调</p></blockquote><p><code>org.springframework.beans.factory.InitializingBean.InitializingBean</code>的接口允许bean在容器设置了bean上的所有必要属性之后执行【初始化工作】。【InitializingBean】接口指定了一个方法:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>我们建议您不要使用【InitializingBean】接口，因为这将你的代码与Spring的代码耦合在一起。 我们更推荐使用【@PostConstruct】注解或指定POJO初始化方法。</p><p>在基于xml的配置元数据的情况下，您可以使用【init-method】属性指定具有void无参数签名的方法的名称。 在Java配置中，您可以使用【@Bean】的【initMethod】属性。可以看看下面的例子:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;exampleInitBean&quot; class=&quot;examples.ExampleBean&quot; init-method=&quot;init&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleBean</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// do some initialization work</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>前面的示例几乎与下面的示例（包含两个例子）具有完全相同的效果:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;exampleInitBean&quot; class=&quot;examples.AnotherExampleBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnotherExampleBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InitializingBean</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// do some initialization work</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然而，前面两个示例中的第一个并没有将代码与Spring耦合起来。</p><h4 id="_2、销毁回调" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、销毁回调">#</a> 2、销毁回调</h4><p>实现<code>org.springframework.beans.factory.DisposableBean</code>接口可以让bean在管理它的容器被销毁时获得回调。 ' DisposableBean '接口指定了一个方法:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>同样，我们并不建议您使用【DisposableBean】回调接口，因为我们没有必要将自己的代码与Spring耦合在一起。 另外，我们建议使用【@PreDestroy】注解或指定beanDifination支持的销毁方法。 对于基于xml的配置元数据，您可以在<code>&lt;bean/&gt;</code>上使用' destroy-method '属性。 在Java配置中，您可以使用“@Bean”的【destroyMethod】属性。如下所示:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;exampleInitBean&quot; class=&quot;examples.ExampleBean&quot; destroy-method=&quot;cleanup&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleBean</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanup</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// do some destruction work (like releasing pooled connections)</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>前面的定义与下面的定义几乎完全相同:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;exampleInitBean&quot; class=&quot;examples.AnotherExampleBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnotherExampleBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DisposableBean</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// do some destruction work (like releasing pooled connections)</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3、默认初始化和销毁方法" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、默认初始化和销毁方法">#</a> 3、默认初始化和销毁方法</h4><p>​ 当我们不使用spring特有的InitializingBean和disapablebean回调接口进行初始化和销毁时，我们通常会编写名为【init()】、 【initialize()】、 【dispose()】等的方法。 理想情况下，这种生命周期回调方法的名称在项目中应该是标准化的（项目经理规定了都必须这么写），以便所有开发人员使用相同的方法名称，并确保一致性。</p><p>​ 您可以配置统一的bean的初始化和销毁方法。 这意味着，作为应用程序开发人员，您可以仅仅声明一个名为【init()】的初始化方法即可，而不必为每个beanDifination配置一个【init-method=“init】属性。</p><p>​ 假设你的初始化回调方法名为“init()”，你的destroy回调方法名为“destroy()”。 你的类就像下面这个例子中的类:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultBlogService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BlogService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> BlogDao blogDao;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBlogDao</span><span class="hljs-params">(BlogDao blogDao)</span> &#123;<br>        <span class="hljs-built_in">this</span>.blogDao = blogDao;<br>    &#125;<br><br>    <span class="hljs-comment">// this is (unsurprisingly) the initialization callback method</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.blogDao == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;The [blogDao] property must be set.&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，您可以在bean中使用该类，类似如下:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans default-init-method=&quot;init&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;blogService&quot; class=&quot;com.something.DefaultBlogService&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;blogDao&quot; ref=&quot;blogDao&quot; /<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 顶层<code>&lt;beans/&gt;</code>元素属性上的【default-init-method】属性导致Spring IoC容器将bean类上的一个名为【init】的方法识别为初始化方法回调。 在创建和组装bean时，如果bean类有这样的方法，就会在适当的时候调用它。</p><p>​ 如果现有的bean类已经有按约定命名的回调方法，那么您可以通过使用<code>&lt;bean/&gt;</code>本身的【init-method】和【destroy-method】属性指定对应方法来覆盖默认值。</p><h4 id="_4、总结" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、总结">#</a> 4、总结</h4><blockquote><p>从Spring 2.5开始，你有三个选项来控制bean的生命周期行为:</p></blockquote><ul><li><code>InitializingBean</code>和 <code>DisposableBean</code> 和 <code>DisposableBean</code>回调接口</li><li>自定义 <code>init()</code>和 <code>destroy()</code> 方法</li><li><code>@PostConstruct</code> 和 <code>@PreDestroy</code> 您可以组合这些机制来控制给定的bean。</li></ul><blockquote><p>为同一个bean配置的多个生命周期机制(具有不同的初始化方法)，调用顺序如下：</p></blockquote><ol><li>用“@PostConstruct”注解的方法</li><li><code>afterPropertiesSet()</code> 由 <code>InitializingBean</code> 回调接口</li><li>自定义配置的init()方法</li></ol><blockquote><p>Destroy方法的调用顺序相同:</p></blockquote><ol><li>用 <code>@PreDestroy</code>注解的方法</li><li><code>destroy()</code>由 <code>DisposableBean</code> 回调接口定义</li><li>自定义配置的 <code>destroy()</code> 方法</li></ol><h4 id="_5、applicationcontextaware-和-beannameaware" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5、applicationcontextaware-和-beannameaware">#</a> 5、<code>ApplicationContextAware</code> 和 <code>BeanNameAware</code></h4><blockquote><p>下面显示了“ApplicationContextAware”接口的定义:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApplicationContextAware</span> &#123;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setApplicationContext</span><span class="hljs-params">(ApplicationContext applicationContext)</span> <span class="hljs-keyword">throws</span> BeansException;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 因此，bean可以通过【ApplicationContextAware】接口，以编程方式【操作】创建它们的【ApplicationContext】。 其中一个用途是对其他bean进行编程检索， 有时这种能力是有用的。 但是，一般来说，您应该【避免使用它】，因为它将代码与Spring耦合在一起，而不遵循控制反转(Inversion of Control)风格，在这种风格中，协作者作为属性提供给bean。 ApplicationContext的其他方法提供了对文件资源的访问、发布应用程序事件和访问MessageSource。</p><p>​ 当ApplicationContext创建一个实现了BeanNameAware接口的类时。 他提供了对其关联对象定义中定义的名称的引用。 下面的例子显示了BeanNameAware接口的定义:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanNameAware</span> &#123;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBeanName</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> BeansException;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 回调在填充普通bean属性之后，但在初始化回调(如“InitializingBean.afterPropertiesSet()”或自定义初始化方法之前调用。</p><p>​ 总结：实现了aware相关的接口，ioc容器不在遵循ioc风格，意思就是不在遵循按需初始化并注入依赖，而是在统一的地方统一注入，这个在源码中有所体现，后边的内容会涉及。</p><h4 id="_6、other-aware-interfaces" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6、other-aware-interfaces">#</a> 6、Other <code>Aware</code> Interfaces</h4><p>​ 除了“ApplicationContextAware”和“BeanNameAware”，spring提供了一个广泛的“aware”回调接口，让bean指示容器，他们需要一定【基础设施】的依赖。 作为一般规则，名称指示了所需依赖项的类型。 下表总结了一些最重要的“Aware”接口:</p><table><thead><tr><th style="text-align:left;">命名</th><th style="text-align:left;">依赖注入</th></tr></thead><tbody><tr><td style="text-align:left;"><code>ApplicationContextAware</code></td><td style="text-align:left;">将<code>ApplicationContext</code>注入bean当中</td></tr><tr><td style="text-align:left;"><code>ApplicationEventPublisherAware</code></td><td style="text-align:left;">将<code>ApplicationEventPublisherAware</code>注入bean当中</td></tr><tr><td style="text-align:left;"><code>BeanClassLoaderAware</code></td><td style="text-align:left;">将类加载器用于装入bean类</td></tr><tr><td style="text-align:left;"><code>BeanFactoryAware</code></td><td style="text-align:left;">将<code>BeanFactory</code>注入bean当中</td></tr><tr><td style="text-align:left;"><code>BeanNameAware</code></td><td style="text-align:left;">将bean的名称注入bean中</td></tr><tr><td style="text-align:left;"><code>ResourceLoaderAware</code></td><td style="text-align:left;">配置了用于访问资源的加载器</td></tr><tr><td style="text-align:left;"><code>ServletConfigAware</code></td><td style="text-align:left;">当前的' ServletConfig '容器运行。 仅在web感知的Spring ' ApplicationContext '中有效。</td></tr><tr><td style="text-align:left;"><code>ServletContextAware</code></td><td style="text-align:left;">当前运行容器的“ServletContext”。 仅在web感知的Spring ' ApplicationContext '中有效。</td></tr></tbody></table><p>​ 再次注意，使用这些接口将您的代码与Spring API绑定在一起，而不是遵循控制反转风格。 因此，我们将它们推荐给需要对容器进行编程访问的基础架构bean。</p><h4 id="_7、bean的继承" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_7、bean的继承">#</a> 7、Bean的继承</h4><p>​ bean的定义可以包含大量配置信息，包括构造函数参数、属性值和特定于容器的信息，比如初始化方法、静态工厂方法名，等等。 子beanDifination可以从父beanDifination继承配置数据。 子beanDifination可以根据需要覆盖一些值或添加其他值。 使用父beanDifination和子beanDifination可以节省大量输入。 实际上，这是模板的一种形式。</p><p>​ 当您使用基于xml的配置元数据时，您可以通过使用“parent”属性来指示子beanDifination，下面的例子展示了如何做到这一点:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;inheritedTestBean&quot; abstract=&quot;true&quot;<br>        class=&quot;org.springframework.beans.TestBean&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;name&quot; value=&quot;parent&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;age&quot; value=&quot;1&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;inheritsWithDifferentClass&quot;<br>        class=&quot;org.springframework.beans.DerivedTestBean&quot;<br>        parent=&quot;inheritedTestBean&quot; init-method=&quot;initialize&quot;<span class="hljs-symbol">&amp;gt;</span>  <br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;name&quot; value=&quot;override&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- the age property value of 1 will be inherited from parent --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 如果没有指定，子beanDifination将使用来自父beanDifination的bean类，但也可以覆盖它。 在后一种情况下，子bean类必须与父bean兼容(也就是说，它必须接受父bean的属性值)。</p><p>​ 子beanDifination从父bean继承范围、构造函数参数值、属性值和方法覆盖，并可选择添加新值。 您指定的任何scope、初始化方法、销毁方法或“静态”工厂方法设置都会覆盖相应的父方法设置。</p><p>​ 其余的设置总是取自子定义:依赖、自动装配模式、依赖项检查、单例和延迟初始化。</p><p>​ 前面的示例通过使用【 abstract 】属性显式地将父beanDifination标记为抽象。 如果父beanDifination没有指定类，则需要显式地将父beanDifination标记为【抽象】，如下例所示:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;inheritedTestBeanWithoutClass&quot; abstract=&quot;true&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;name&quot; value=&quot;parent&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;age&quot; value=&quot;1&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;inheritsWithClass&quot; class=&quot;org.springframework.beans.DerivedTestBean&quot;<br>        parent=&quot;inheritedTestBeanWithoutClass&quot; init-method=&quot;initialize&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;name&quot; value=&quot;override&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- age will inherit the value of 1 from the parent bean definition--<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 父bean不能单独实例化，因为它是不完整的，而且它也显式地被标记为“抽象”。 当定义是【抽象的】时，它只能作为作为一个父beanDifination的【纯模板beanDifination使用】。 试图单独使用这样一个【抽象】的父bean，通过将其作为另一个bean的ref属性引用，或使用父bean ID执行显式的“getBean()”调用，将返回错误。 类似地，容器内部的' preinstantiatesingleton() '方法会忽略定义为抽象的beanDifination。</p><h3 id="九、基于注解的容器配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#九、基于注解的容器配置">#</a> 九、基于注解的容器配置</h3><blockquote><p>在配置Spring时，注解比XML更好吗?</p></blockquote><p>​ 引入基于注解的配置提出了这样一个问题：这种方法是否比XML“更好”， 简短的回答是“视情况而定”。 长期的答案是，每种方法都有其优点和缺点。通常，由开发人员决定哪种策略更适合他们。 由于注解在其声明中提供了【大量上下文】，从而导致配置更简短、更简洁。 然而，XML擅长【连接组件】，而无需修改它们的源代码或重新编译它们。 一些开发人员更喜欢接近源代码进行连接，而另一些开发人员则认为带注解的类不再是pojo，而且配置变得分散且更难控制。</p><blockquote><p>使用注解配置，我们需要开启以下的配置：</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;<br>    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd<br>        http://www.springframework.org/schema/context<br>        https://www.springframework.org/schema/context/spring-context.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>context:annotation-config/<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1、使用-autowired" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、使用-autowired">#</a> 1、使用 <code>@Autowired</code></h4><blockquote><p>作用就是自动装配，有byType的语义。你可以将<code>@Autowired</code>注解应用到构造函数中，如下面的例子所示:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CustomerPreferenceDao customerPreferenceDao;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MovieRecommender</span><span class="hljs-params">(CustomerPreferenceDao customerPreferenceDao)</span> &#123;<br>        <span class="hljs-built_in">this</span>.customerPreferenceDao = customerPreferenceDao;<br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：从Spring Framework 4.3开始，如果目标bean只定义了一个构造函数，就不再需要在这样的构造函数上添加【 @Autowired 】注解。 然而，如果有几个构造函数可用，并且没有主/默认构造函数，那么至少其中一个构造函数必须用【@Autowired 】注解，以便告诉容器使用哪个构造函数。</p><blockquote><p>你也可以将<code>@Autowire</code>d注解应用到传统的 setter方法，如下面的例子所示:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br><br>    <span class="hljs-keyword">private</span> MovieFinder movieFinder;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMovieFinder</span><span class="hljs-params">(MovieFinder movieFinder)</span> &#123;<br>        <span class="hljs-built_in">this</span>.movieFinder = movieFinder;<br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>你还可以将注解应用到具有任意名称和多个参数的方法，如下面的示例所示:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br><br>    <span class="hljs-keyword">private</span> MovieCatalog movieCatalog;<br><br>    <span class="hljs-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">(MovieCatalog movieCatalog，</span><br><span class="hljs-params">            CustomerPreferenceDao customerPreferenceDao)</span> &#123;<br>        <span class="hljs-built_in">this</span>.movieCatalog = movieCatalog;<br>        <span class="hljs-built_in">this</span>.customerPreferenceDao = customerPreferenceDao;<br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>用的最多的但spring官方并不推荐的方法是，你也可以将 <code>@Autowired</code> 应用到字段上，甚至可以将它与构造函数混合使用，如下面的示例所示:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CustomerPreferenceDao customerPreferenceDao;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MovieCatalog movieCatalog;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MovieRecommender</span><span class="hljs-params">(CustomerPreferenceDao customerPreferenceDao)</span> &#123;<br>        <span class="hljs-built_in">this</span>.customerPreferenceDao = customerPreferenceDao;<br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>你也可以通过在一个字段或方法中添加【@Autowired】注解来指示Spring从【ApplicationContext】中提供所有特定类型的bean，该字段或方法需要该类型的数组，如下面的例子所示:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MovieCatalog[] movieCatalogs;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>这同样适用于类型化的集合，如下例所示:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Set&amp;lt;MovieCatalog&amp;gt; movieCatalogs;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMovieCatalogs</span><span class="hljs-params">(Set&amp;lt;MovieCatalog&amp;gt; movieCatalogs)</span> &#123;<br>        <span class="hljs-built_in">this</span>.movieCatalogs = movieCatalogs;<br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>即使是类型化的“Map”实例，只要期望的键类型是“String”，也可以自动连接。 映射值包含预期类型的所有bean，键包含相应的bean名，如下例所示:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Map&amp;lt;String， MovieCatalog&amp;gt; movieCatalogs;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMovieCatalogs</span><span class="hljs-params">(Map&amp;lt;String， MovieCatalog&amp;gt; movieCatalogs)</span> &#123;<br>        <span class="hljs-built_in">this</span>.movieCatalogs = movieCatalogs;<br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：默认情况下，当给定注入点没有可用的匹配候选bean时，自动装配将失败。 对于声明的数组、集合或映射，至少需要一个匹配元素。</p><p>​</p><blockquote><p>默认行为是将带注解的方法和字段视为指示所需的依赖关系。 你可以像下面的例子一样改变这种行为，通过将一个不满足的注入点标记为非必需的(例如，通过将【 @Autowired】中的' required '属性设置为' false ')来让框架跳过它:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br><br>    <span class="hljs-keyword">private</span> MovieFinder movieFinder;<br><br>    <span class="hljs-meta">@Autowired(required = false)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMovieFinder</span><span class="hljs-params">(MovieFinder movieFinder)</span> &#123;<br>        <span class="hljs-built_in">this</span>.movieFinder = movieFinder;<br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、使用-primary微调基于注解的自动装配" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、使用-primary微调基于注解的自动装配">#</a> 2、使用 <code>@Primary</code>微调基于注解的自动装配</h4><p>​ 由于按类型自动装配可能会导致多个【候选者】，因此通常需要对选择过程进行更多的控制。 实现这一点的一种方法是使用Spring的【@Primary 】注解。 【@Primary】表示当多个bean可以作为一个依赖项的候选bean时，应该优先考虑某个特定bean。 如果在候选bean中恰好存在一个主要的bean，那么它将成为自动连接的值。</p><blockquote><p>考虑以下配置，将' firstMovieCatalog '定义为主要的' MovieCatalog ':</p></blockquote><p>以下内容【@Bean】是下个章节的:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@Primary</span><br>    <span class="hljs-keyword">public</span> MovieCatalog <span class="hljs-title function_">firstMovieCatalog</span><span class="hljs-params">()</span> &#123; ... &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> MovieCatalog <span class="hljs-title function_">secondMovieCatalog</span><span class="hljs-params">()</span> &#123; ... &#125;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过上述配置，下面的“MovieRecommender”将自动与“firstMovieCatalog”连接:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MovieCatalog movieCatalog;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>当然在xml中我们可以如下配置、相应的beanDifination如下，效果是等价的:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;<br>    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd<br>        http://www.springframework.org/schema/context<br>        https://www.springframework.org/schema/context/spring-context.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>context:annotation-config/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean class=&quot;example.SimpleMovieCatalog&quot; primary=&quot;true&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- inject any dependencies required by this bean --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean class=&quot;example.SimpleMovieCatalog&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- inject any dependencies required by this bean --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;movieRecommender&quot; class=&quot;example.MovieRecommender&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3、使用-qualifier微调基于注解的自动装配" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、使用-qualifier微调基于注解的自动装配">#</a> 3、使用@Qualifier微调基于注解的自动装配</h4><p>​ 当可以确定一个主要候选时，【@Primary】注解可以轻松完成这个工作。 当您需要对选择过程进行更多控制时，可以使用Spring的【@Qualifier】注解。 您可以将【限定符值】与特定的参数关联起来，从而缩小类型匹配的集合，以便为每个参数选择特定的bean。 在最简单的情况下，这可以是一个简单的描述性值，如下例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-meta">@Qualifier(&quot;main&quot;)</span><br>    <span class="hljs-keyword">private</span> MovieCatalog movieCatalog;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>您还可以在单个构造函数参数或方法参数上指定' @Qualifier '注解，如下面的示例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br><br>    <span class="hljs-keyword">private</span> MovieCatalog movieCatalog;<br><br>    <span class="hljs-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;main&quot;)</span> MovieCatalog movieCatalog，</span><br><span class="hljs-params">            CustomerPreferenceDao customerPreferenceDao)</span> &#123;<br>        <span class="hljs-built_in">this</span>.movieCatalog = movieCatalog;<br>        <span class="hljs-built_in">this</span>.customerPreferenceDao = customerPreferenceDao;<br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>下面的示例显示了相应的beanDifination：</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;<br>    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd<br>        http://www.springframework.org/schema/context<br>        https://www.springframework.org/schema/context/spring-context.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>context:annotation-config/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean class=&quot;example.SimpleMovieCatalog&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>qualifier value=&quot;main&quot;/<span class="hljs-symbol">&amp;gt;</span> <br><br>        <span class="hljs-symbol">&amp;lt;</span>!-- inject any dependencies required by this bean --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean class=&quot;example.SimpleMovieCatalog&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>qualifier value=&quot;action&quot;/<span class="hljs-symbol">&amp;gt;</span> <br><br>        <span class="hljs-symbol">&amp;lt;</span>!-- inject any dependencies required by this bean --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;movieRecommender&quot; class=&quot;example.MovieRecommender&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**注意：**除了使用qualifier标签决定，其实 @Qualifier可以使用id，name等属性定义的任何标识符。</p><p>​ 其实，如果您打算按【名称标识符】完成的注入，那么就可以不使用【@Autowired 】，即使它能够在类型匹配的候选对象中按bean名称进行选择（需要配合@Qualifier同时使用）。 有一个更好的选择是使用JSR-250的 【@Resource】注解，该注解在语义上定义为通过惟一的【名称标识】选择特定的目标组件，声明的类型与匹配过程无关。</p><h4 id="_4、使用-resource" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、使用-resource">#</a> 4、使用 <code>@Resource</code></h4><p>​ Spring还通过在字段或bean属性设置方法上使用JSR-250的 【@Resource】注解(' javax.annotation.Resource ')来支持注入。 这是Java EE中的常见模式， Spring也支持这种模式用于Spring管理的对象。</p><p><code>@Resource</code> 带有一个name属性。 默认情况下，Spring将该值解释为要注入的bean名。 换句话说，它遵循by-name语义，如下面的示例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br><br>    <span class="hljs-keyword">private</span> MovieFinder movieFinder;<br><br>    <span class="hljs-meta">@Resource(name=&quot;myMovieFinder&quot;)</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMovieFinder</span><span class="hljs-params">(MovieFinder movieFinder)</span> &#123;<br>        <span class="hljs-built_in">this</span>.movieFinder = movieFinder;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 如果没有显式指定名称，则默认名称为【字段名或setter方法的参数名】。 对于字段，它接受字段名。 对于setter方法，它采用bean属性名。 下面的例子将把名为【movieFinder】的bean注入到它的setter方法中:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br><br>    <span class="hljs-keyword">private</span> MovieFinder movieFinder;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMovieFinder</span><span class="hljs-params">(MovieFinder movieFinder)</span> &#123;<br>        <span class="hljs-built_in">this</span>.movieFinder = movieFinder;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 因此，在下面的示例中，' customerPreferenceDao '字段首先查找名为"customerPreferenceDao"的bean，然后按照类型' customerPreferenceDao '的主类型匹配:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> ApplicationContext context; <br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MovieRecommender</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="十、容器的启动过程" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#十、容器的启动过程">#</a> 十、容器的启动过程</h3><p>核心方法：refresh()</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refresh</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException， IllegalStateException &#123;<br>    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>.startupShutdownMonitor) &#123;<br>        <span class="hljs-comment">// 准备刷新，准备开店，检查环境，是不是适合开店，比如我选用哪个日志</span><br>        prepareRefresh();<br><br>        <span class="hljs-comment">// 把门面租下来，获得一个bean工厂，loadBeanDefinitions(beanFactory)获取蛋糕的制作流程</span><br>        <span class="hljs-type">ConfigurableListableBeanFactory</span> <span class="hljs-variable">beanFactory</span> <span class="hljs-operator">=</span> obtainFreshBeanFactory();<br><br>        <span class="hljs-comment">// Prepare the bean factory for use in this context.</span><br>        prepareBeanFactory(beanFactory);<br>        <span class="hljs-comment">// 忽略对应的自动装配</span><br>            <span class="hljs-comment">//beanFactory.ignoreDependencyInterface(EnvironmentAware.class);</span><br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// Allows post-processing of the bean factory in context subclasses.</span><br>            postProcessBeanFactory(beanFactory);<br><br>            <span class="hljs-comment">// bean工厂已经基本好了，后置处理器</span><br>            invokeBeanFactoryPostProcessors(beanFactory);<br><br>            <span class="hljs-comment">// Register bean processors that intercept bean creation.</span><br>            registerBeanPostProcessors(beanFactory);<br><br>            <span class="hljs-comment">// Initialize message source for this context.</span><br>            initMessageSource();<br><br>            <span class="hljs-comment">// Initialize event multicaster for this context.</span><br>            initApplicationEventMulticaster();<br><br>            <span class="hljs-comment">// Initialize other special beans in specific context subclasses.</span><br>            onRefresh();<br><br>            <span class="hljs-comment">// Check for listener beans and register them.</span><br>            registerListeners();<br><br>            <span class="hljs-comment">// 初始化bean</span><br>            finishBeanFactoryInitialization(beanFactory);<br><br>            <span class="hljs-comment">// Last step: publish corresponding event.</span><br>            finishRefresh();<br>        &#125;<br><br>        <span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br>            <span class="hljs-keyword">if</span> (logger.isWarnEnabled()) &#123;<br>                logger.warn(<span class="hljs-string">&quot;Exception encountered during context initialization - &quot;</span> +<br>                            <span class="hljs-string">&quot;cancelling refresh attempt: &quot;</span> + ex);<br>            &#125;<br><br>            <span class="hljs-comment">// Destroy already created singletons to avoid dangling resources.</span><br>            destroyBeans();<br><br>            <span class="hljs-comment">// Reset &#x27;active&#x27; flag.</span><br>            cancelRefresh(ex);<br><br>            <span class="hljs-comment">// Propagate exception to caller.</span><br>            <span class="hljs-keyword">throw</span> ex;<br>        &#125;<br><br>        <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">// Reset common introspection caches in Spring&#x27;s core， since we</span><br>            <span class="hljs-comment">// might not ever need metadata for singleton beans anymore...</span><br>            resetCommonCaches();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 已经完成了创建和属性填充给你的工作</span><br><span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">initializeBean</span><span class="hljs-params">(String beanName， Object bean， <span class="hljs-meta">@Nullable</span> RootBeanDefinition mbd)</span> &#123;<br>        <span class="hljs-keyword">if</span> (System.getSecurityManager() != <span class="hljs-literal">null</span>) &#123;<br>            AccessController.doPrivileged((PrivilegedAction&amp;lt;Object&amp;gt;) () -&amp;gt; &#123;<br>                invokeAwareMethods(beanName， bean);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125;， getAccessControlContext());<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// 1、调用实现的aware接口</span><br>           invokeAwareMethods(beanName， bean);<br>        &#125;<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">wrappedBean</span> <span class="hljs-operator">=</span> bean;<br>        <span class="hljs-keyword">if</span> (mbd == <span class="hljs-literal">null</span> || !mbd.isSynthetic()) &#123;<br>            <span class="hljs-comment">// 调用beanpostproccessor的BeforeInitialization方法</span><br>            wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean， beanName);<br>        &#125;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 调用初始化方法在这里</span><br>            invokeInitMethods(beanName， wrappedBean， mbd);<br>        &#125;<br>        <span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanCreationException</span>(<br>                    (mbd != <span class="hljs-literal">null</span> ? mbd.getResourceDescription() : <span class="hljs-literal">null</span>)，<br>                    beanName， <span class="hljs-string">&quot;Invocation of init method failed&quot;</span>， ex);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (mbd == <span class="hljs-literal">null</span> || !mbd.isSynthetic()) &#123;<br>            <span class="hljs-comment">// 调用beanpostproccessor的AfterInitialization</span><br>            wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean， beanName);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> wrappedBean;<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>1、初始化Spring容器</strong></p><p>这个阶段相当于考察一下地理环境怎么样</p><p>prepareRefresh()：做一些准备阶段做的是：标记容器为active状态，以及检查当前的运行环境，比如使用log4j，还是jdklog等。</p><p><strong>2、获得一个新的容器</strong></p><p>这个阶段相当于租一个门面，同时准备好产品的制作流程</p><p>ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</p><p>如果有旧的容器，那么清空容器和容器中注册了的bean，创建新的容器DefaultListableBeanFactory。</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs text">protected final void refreshBeanFactory() throws BeansException &#123;<br>        if (hasBeanFactory()) &#123;<br>            destroyBeans();<br>            closeBeanFactory();<br>        &#125;<br>        try &#123;<br>            DefaultListableBeanFactory beanFactory = createBeanFactory();<br>            beanFactory.setSerializationId(getId());<br>            customizeBeanFactory(beanFactory);<br>            loadBeanDefinitions(beanFactory);<br>            this.beanFactory = beanFactory;<br>        &#125;<br>        catch (IOException ex) &#123;<br>            throw new ApplicationContextException(&quot;I/O error parsing bean definition source for &quot; + getDisplayName()， ex);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3、bean工厂的准备阶段</strong></p><p>相当于做一些基础装修，比如设备的采购</p><p>prepareBeanFactory(beanFactory);</p><p>设置一些处理器</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">tandardBeanExpressionResolver<br>ResourceEditorRegistrar<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4、调用所有的BeanFactory后置处理器</strong></p><p>这是留给我们进行扩展的，同事spring在也有很多的扩展实现。</p><p>执行</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">// Invoke factory processors registered as beans in the context.<br>invokeBeanFactoryPostProcessors(beanFactory);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5、注册BeanPostProcessors</strong></p><p><strong>6、完成bean的创建</strong></p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">beanFactory.preInstantiateSingletons();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>在创建bean的过程中，会执行如下流程：</p><p>（1）创建bean</p><p>（3）执行BeanPostProcessors</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">postProcessBeforeInitialization<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>（4）执行配置的初始化方法</p><p>（5）执行BeanPostProcessors</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">postProcessAfterInitialization<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs text">protected Object initializeBean(String beanName， Object bean， @Nullable RootBeanDefinition mbd) &#123;<br>   if (System.getSecurityManager() != null) &#123;<br>      AccessController.doPrivileged((PrivilegedAction&amp;lt;Object&amp;gt;) () -&amp;gt; &#123;<br>         invokeAwareMethods(beanName， bean);<br>         return null;<br>      &#125;， getAccessControlContext());<br>   &#125;<br>   else &#123;<br>      invokeAwareMethods(beanName， bean);<br>   &#125;<br><br>   Object wrappedBean = bean;<br>   if (mbd == null || !mbd.isSynthetic()) &#123;<br>      wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean， beanName);<br>   &#125;<br><br>   try &#123;<br>      invokeInitMethods(beanName， wrappedBean， mbd);<br>   &#125;<br>   catch (Throwable ex) &#123;<br>      throw new BeanCreationException(<br>            (mbd != null ? mbd.getResourceDescription() : null)，<br>            beanName， &quot;Invocation of init method failed&quot;， ex);<br>   &#125;<br>   if (mbd == null || !mbd.isSynthetic()) &#123;<br>      wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean， beanName);<br>   &#125;<br>   return wrappedBean;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>一些重要的BeanFactory后置处理器</p><ul><li>BeanFactoryPostProcessor：BeanFactory后置处理器</li><li>ConfigurationClassPostProcessor：解析配置类的BeanFactory后置处理器</li></ul><p>一些重要的BeanFactory</p><ul><li>InstantiationAwareBeanPostProcessor：Bean实例化前后运行的后置处理器，还负责设置属性值populateBean()</li><li>AutowiredAnnotationBeanPostProcessor：对注解@Autowired的实现</li><li>CommonAnnotationBeanPostProcessor：对注解 @Resource的实现</li><li>InitDestroyAnnotationBeanPostProcessor：主要是实现了Bean的@PostConstruct和@PreDestroy方法。</li><li>AnnotationAwareAspectJAutoProxyCreator：AOP代理的后置处理器，AOP生成代理的地方就是在后置处理器postProcessAfterInitialization方法中实现的。</li><li>InfrastructureAdvisorAutoProxyCreator：自动代理创建器，仅考虑基础结构Advisor Bean，而忽略任何应用程序定义的Advisor。Spring 的事务使用的是这个后置处理器。</li></ul><h3 id="十一、classpath扫描和组件管理" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#十一、classpath扫描和组件管理">#</a> 十一、classpath扫描和组件管理</h3><p>​ 本章中的大多数例子都使用【XML来指定配置元数据】，这些元数据在Spring容器启动时被扫描，每一个bean的元数据对应生成一个“BeanDefinition”。</p><p>​ 本节我们可以通过【扫描类路径】隐式检测候选组件。 【候选组件】指的是通过扫描筛选并在容器中注册了相应beanDifination的类。 这样就不需要使用XML来执行bean注册。 相反，您可以使用注解（例如，【@Component 】）。</p><p>​ 更多操作从Spring 3.0开始，Spring JavaConfig项目提供的许多特性都是核心Spring框架的一部分。 这允许您使用Java而不是使用传统的XML文件来定义bean。</p><h4 id="_1、-component-和及其派生出的其他注解注解" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、-component-和及其派生出的其他注解注解">#</a> 1、<code>@Component</code> 和及其派生出的其他注解注解</h4><ul><li><p><code>@Component</code> 是任何spring管理组件的通用注解。</p></li><li><p><code>@Repository</code>、<code>@Service</code>和<code>@Controller</code>是【@Component】用于更具体用例的注解（分别在持久性、服务和表示层中）。这些注解对于我们后期对特定bean进行批量处理时是有帮助的。</p></li></ul><h4 id="_2、自动检测类和注册beandifination" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、自动检测类和注册beandifination">#</a> 2、自动检测类和注册beanDifination</h4><blockquote><p>Spring可以自动检测类的信息，并将相应的【BeanDefinition】实例注册到【ApplicationContext】中。 例如，以下两个类适合这样的自动检测:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br><br>    <span class="hljs-keyword">private</span> MovieFinder movieFinder;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleMovieLister</span><span class="hljs-params">(MovieFinder movieFinder)</span> &#123;<br>        <span class="hljs-built_in">this</span>.movieFinder = movieFinder;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JpaMovieFinder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MovieFinder</span> &#123;<br>    <span class="hljs-comment">// implementation elided for clarity</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><p>要自动检测这些类并注册相应的bean，您需要将【@ComponentScan】添加到您的【 @Configuration】类中，其中【basePackages】属性是这两个类的公共父包。说人话就是：指定一个包名，自动扫描会检测这个包及其子包下的所有类信息。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ComponentScan(basePackages = &quot;org.example&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span>  &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为简单起见，前面的示例可能使用了注解的<code>value</code>属性 （即 <code>@ComponentScan("org.example")</code>）。</p><blockquote><p>当然我们可以使用以下XML代替，他们是等效的：</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;<br>    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd<br>        http://www.springframework.org/schema/context<br>        https://www.springframework.org/schema/context/spring-context.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>context:component-scan base-package=&quot;org.example&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注：<code>&lt;context:component-scan&gt;</code> 的使用会隐式启用 <code>&lt;context:annotation-config&gt;</code>，当使用 <code>&lt;context:component-scan&gt;</code>时，通常不需要包含<code>&lt;context:annotation-config&gt;</code>元素。</p><h4 id="_3、组件命名" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、组件命名">#</a> 3、组件命名</h4><blockquote><p>当组件作为扫描过程的一部分被自动检测时，它的bean名是由该扫描器所知道的“BeanNameGenerator”策略生成的。</p></blockquote><p>默认情况下，会使用【@Component】， 【@Repository】，【@Service】和【@Controller】注解的value值，因此将该名称会提供给相应的beanDefination。 如果你的注解不包含任何名称属性，会有默认bean名称生成器将返回【非首字母大写的非全限定类名】。 例如，如果检测到以下组件类，则名称为【myMovieLister】和【movieFinderImp】，这个和xml自动生成的标识符名称不同:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service(&quot;myMovieLister&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieFinderImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MovieFinder</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4、为自动检测组件提供scope" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、为自动检测组件提供scope">#</a> 4、为自动检测组件提供scope</h4><blockquote><p>与spring管理的组件一样，自动检测组件的默认和最常见的作用域是“单例”。 然而，有时您需要一个不同的范围，可以由' @Scope '注解指定。 您可以在注解中提供作用域的名称，如下面的示例所示:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Scope(&quot;prototype&quot;)</span><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieFinderImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MovieFinder</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5、使用过滤器自定义扫描" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5、使用过滤器自定义扫描">#</a> 5、使用过滤器自定义扫描</h4><p>默认情况下，带有【@Component】、【@Repository】、【@Service】、【@Controller】、【@Configuration】注解的类是一定能被筛选器选中并进行注册的候选组件。 但是，您可以通过应用自定义过滤器来修改和扩展此行为，自由定制筛选哪些或不包含那些组件。 将它们作为<code>@ComponentScan</code>注解的<code>includeFilters</code> 或 <code>excludeFilters </code>属性添加（或者作为XML配置中' &lt;context:include-filter /&gt; '或' &lt;context:exclude-filter /&gt; '元素的子元素）。 每个筛选器元素都需要' type '和' expression '属性。 下表描述了过滤选项:</p><table><thead><tr><th style="text-align:left;">过滤方式</th><th style="text-align:left;">示例表达式</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">annotation (默认)</td><td style="text-align:left;"><code>org.example.SomeAnnotation</code></td><td style="text-align:left;">要在目标组件的类型级别上“存在”或“元注解存在”的注解。</td></tr><tr><td style="text-align:left;">assignable</td><td style="text-align:left;"><code>org.example.SomeClass</code></td><td style="text-align:left;">指定要排除的bean的类</td></tr><tr><td style="text-align:left;">aspectj</td><td style="text-align:left;"><code>org.example..*Service+</code></td><td style="text-align:left;">要被目标组件匹配的AspectJ类型表达式，后边会学习</td></tr><tr><td style="text-align:left;">regex</td><td style="text-align:left;"><code>org\.example\.Default\.*</code></td><td style="text-align:left;">由目标组件的类名匹配的正则表达式</td></tr><tr><td style="text-align:left;">custom</td><td style="text-align:left;"><code>org.example.MyTypeFilter</code></td><td style="text-align:left;">' org.springframework.core.type的自定义实现，TypeFilter”接口。</td></tr></tbody></table><blockquote><p>下面的示例显示了忽略所有【@Repository】注解，而使用【stub】包下的类进行替换:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ComponentScan(basePackages = &quot;org.example&quot;，</span><br><span class="hljs-meta">        includeFilters = @Filter(type = FilterType.REGEX， pattern = &quot;.*Stub.*Repository&quot;)，</span><br><span class="hljs-meta">        excludeFilters = @Filter(Repository.class))</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面的例子显示了等效的XML:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>context:component-scan base-package=&quot;org.example&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>context:include-filter type=&quot;regex&quot;<br>                expression=&quot;.*Stub.*Repository&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>context:exclude-filter type=&quot;annotation&quot;<br>                expression=&quot;org.springframework.stereotype.Repository&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/context:component-scan<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【小知识】：您还可以通过在注解上设置<code>useDefaultFilters=false</code> 或通过提供<code>use-default-filters="false" </code>作为<code>&lt;component-scan/&gt; </code>元素的属性来禁用默认过滤器。 这将有效地禁用使用【@Component】、【@Repository 】、【@Service】、【 @Controller】、【@Configuration】注解或元注解的类的自动检测。</p><h4 id="_6、在组件中定义bean元数据" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6、在组件中定义bean元数据">#</a> 6、在组件中定义Bean元数据</h4><blockquote><p>Spring组件还可以向容器提供beanDifination元数据。 可以使用 @Bean 注解来实现这一点。</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FactoryMethodComponent</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@Qualifier(&quot;public&quot;)</span><br>    <span class="hljs-keyword">public</span> TestBean <span class="hljs-title function_">publicInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestBean</span>(<span class="hljs-string">&quot;publicInstance&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// Component method implementation omitted</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>前面的类是一个Spring组件，它的【doWork()】方法中包含特定于应用程序的代码。 然而，它还提供了一个beanDifination，该beanDifination有一个引用方法【public Instance()】的工厂方法。 【@Bean注解】标识工厂方法，通过【@Qualifier】注解标识一个限定符值。 其他可以指定的方法级注解有【@Scope 】， 【@Lazy 】等。</p><blockquote><p>下面的例子展示了如何做到这一点:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FactoryMethodComponent</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> i;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@Qualifier(&quot;public&quot;)</span><br>    <span class="hljs-keyword">public</span> TestBean <span class="hljs-title function_">publicInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestBean</span>(<span class="hljs-string">&quot;publicInstance&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// use of a custom qualifier and autowiring of method parameters</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">protected</span> TestBean <span class="hljs-title function_">protectedInstance</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-meta">@Qualifier(&quot;public&quot;)</span> TestBean spouse，</span><br><span class="hljs-params">            <span class="hljs-meta">@Value(&quot;#&#123;privateInstance.age&#125;&quot;)</span> String country)</span> &#123;<br>        <span class="hljs-type">TestBean</span> <span class="hljs-variable">tb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestBean</span>(<span class="hljs-string">&quot;protectedInstance&quot;</span>， <span class="hljs-number">1</span>);<br>        tb.setSpouse(spouse);<br>        tb.setCountry(country);<br>        <span class="hljs-keyword">return</span> tb;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">private</span> TestBean <span class="hljs-title function_">privateInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestBean</span>(<span class="hljs-string">&quot;privateInstance&quot;</span>， i++);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><h4 id="_7、基于java的容器配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_7、基于java的容器配置">#</a> 7、基于Java的容器配置</h4><h5 id="_1-bean和-configuration" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1-bean和-configuration">#</a> （1） @Bean和@Configuration</h5><p>Spring新的java配置支持的中心组件是带注解的【@Configuration】类和带注解的【@Bean】方法。</p><p><code>@Bean</code>注解用于指示一个方法，该方法负责【实例化、配置和初始化】一个由Spring IoC容器管理的新对象。 对于那些熟悉Spring <code>&lt;beans/&gt;</code>XML配置的人来说，<code>@Bean</code>注解扮演着与<code>&lt;bean/&gt; </code>元素相同的角色。 你可以在任何Spring <code>@Component</code>中使用<code>@Bean</code>注解方法。 但是，它们最常与<code>@Configuration</code>一起使用。</p><p>用<code>@Configuration</code>注解的一个类表明它的主要目的是作为beanDifination的源，我们通常称之为【配置类】。 <strong>此外，【@Configuration】类允许通过调用同一类中的其他【@Bean 】方法来【定义bean间的依赖关系】</strong>。 最简单的【@Configuration】类如下所示：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> MyService <span class="hljs-title function_">myService</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyServiceImpl</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>前面的' AppConfig '类等价于下面的Spring <code>&lt;beans/&gt;</code>XML:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;myService&quot; class=&quot;com.acme.services.MyServiceImpl&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><h5 id="_2-使用-annotationconfigapplicationcontext实例化spring容器" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2-使用-annotationconfigapplicationcontext实例化spring容器">#</a> （2）使用 <code>AnnotationConfigApplicationContext</code>实例化Spring容器</h5><p>下面的章节记录了Spring 3.0中引入的【AnnotationConfigApplicationContext】。 这个通用的【ApplicationContext】实现不仅能够接受【@Configuration】类作为输入，还能够接受普通的【@Component】类和用JSR-330元数据注解的类。</p><p>当提供【@Configuration】类作为输入时，【@Configuration】类本身被注册为一个beanDifination，并且类中所有声明的【@Bean】方法也被注册为beanDifination。</p><p>当提供【@Component 】和JSR-330相关的注解类时，它们被注册为beanDifination。</p><blockquote><p>a、结构简洁</p></blockquote><p>就像Spring XML文件在实例化【ClassPathXmlApplicationContext】时被用作输入一样，当实例化【AnnotationConfigApplicationContext】时，你可以使用【@Configuration】类作为输入。 这允许Spring容器完全不使用xml，如下例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(AppConfig.class);<br>    <span class="hljs-type">MyService</span> <span class="hljs-variable">myService</span> <span class="hljs-operator">=</span> ctx.getBean(MyService.class);<br>    myService.doStuff();<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><p>正如前面提到的，【AnnotationConfigApplicationContext】并不局限于只与【@Configuration】类一起工作。 任何【@Component】或JSR-330注解类都可以作为输入提供给构造函数，如下面的例子所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(MyServiceImpl.class， Dependency1.class， Dependency2.class);<br>    <span class="hljs-type">MyService</span> <span class="hljs-variable">myService</span> <span class="hljs-operator">=</span> ctx.getBean(MyService.class);<br>    myService.doStuff();<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>前面的例子假设【MyServiceImpl】、【Dependency1】和【Dependency2】使用Spring依赖注入注解，比如【@Autowired】。</p><blockquote><p>b、通过使用' register(Class&lt;?&gt;…)'以编程方式构建容器</p></blockquote><p>你可以使用一个【没有参数的构造函数】来实例化一个【AnnotationConfigApplicationContext】，然后使用【register()】方法来配置它。 当以编程方式构建一个“AnnotationConfigApplicationContext”时，这种方法特别有用。 下面的例子展示了如何做到这一点:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">AnnotationConfigApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>();<br>    ctx.register(AppConfig.class， OtherConfig.class);<br>    ctx.register(AdditionalConfig.class);<br>    ctx.refresh();<br>    <span class="hljs-type">MyService</span> <span class="hljs-variable">myService</span> <span class="hljs-operator">=</span> ctx.getBean(MyService.class);<br>    myService.doStuff();<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>c、使用 <code>scan(String…)</code>启用组件扫描</p></blockquote><p>要启用组件扫描，你可以像下面这样注解你的 <code>@Configuration</code> 类：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ComponentScan(basePackages = &quot;com.acme&quot;)</span> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span>  &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans<span class="hljs-symbol">&amp;gt;</span> <br>    <span class="hljs-symbol">&amp;lt;</span>context:component-scan base-package=&quot;com.ydlclass&quot; / <span class="hljs-symbol">&amp;gt;</span> <br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span>”<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><p>同时，AnnotationConfigApplicationContext也暴露了【 scan(String…)】方法来允许相同的组件扫描功能，如下例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">AnnotationConfigApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>();<br>    ctx.scan(<span class="hljs-string">&quot;com.acme&quot;</span>);<br>    ctx.refresh();<br>    <span class="hljs-type">MyService</span> <span class="hljs-variable">myService</span> <span class="hljs-operator">=</span> ctx.getBean(MyService.class);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>请记住，【@Configuration】类是带有【@Component】元注解的一个注解，因此它们是组件扫描的候选对象。 在前面的例子中，假设【AppConfig】在"com.acme"中声明。 在' refresh() '之后，它的所有' @Bean '方法都被处理并注册为容器中的beanDifination。</p><h5 id="_3-bean注解" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3-bean注解">#</a> （3） @Bean注解</h5><p>【@Bean】是一个方法级注解，与XML<code>&lt;bean/&gt; </code>元素具有相同的能力。 注解支持<code>&lt;bean/&gt;</code>提供的一些属性，例如:</p><ul><li>init-method</li><li>destroy-method</li><li>autowiring</li><li>name</li></ul><p>你可以在带有【@Configuration】注解的类或带有【@Component】注解的类中使用【@Bean】注解。</p><blockquote><p>a、声明一个 Bean</p></blockquote><p>使用【@Bean】对方法进行注解可以帮助我们申明一个bean。 您可以使用此方法在【ApplicationContext】中注册一个beanDifination，该bean的类型会被指定为【方法的返回值类型】，而具体的返回值则是交由spring管理的bean实例。 默认情况下，bean名与方法名相同。 下面的例子显示了一个【 @Bean 】方法声明:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> TransferServiceImpl <span class="hljs-title function_">transferService</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransferServiceImpl</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的配置与下面的Spring XML完全相同:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;transferService&quot; class=&quot;com.acme.TransferServiceImpl&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注：你也可以使用接口（或基类）作为返回类型来声明你的<code>@Bean</code>方法，如下面的例子所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> TransferService <span class="hljs-title function_">transferService</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransferServiceImpl</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>b、Bean的依赖关系</p></blockquote><p>带注解的【@Bean】方法可以有任意数量的参数，这些参数描述构建该bean所需的依赖关系。 例如，如果我们的【TransferService】需要一个【AccountRepository】，我们可以用一个方法参数来实现这个依赖，如下例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> TransferService <span class="hljs-title function_">transferService</span><span class="hljs-params">(AccountRepository accountRepository)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransferServiceImpl</span>(accountRepository);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>c、接受生命周期回调</p></blockquote><ul><li><p>任何用【@Bean】注解定义的类都支持常规的生命周期回调，并且可以使用JSR-250的' @PostConstruct '和' @PreDestroy '注解。</p></li><li><p>也完全支持常规的Spring lifecycle回调。 如果一个bean实现了' InitializingBean '、' DisposableBean '或' Lifecycle '，则容器会调用它们各自的方法。</p></li><li><p>标准的【Aware 】接口也完全支持。</p></li></ul><p>【@Bean注解】支持指定任意的初始化和销毁回调方法，就像Spring XML在' bean '元素上的' init-method '和' destroy-method '属性一样，如下面的示例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeanOne</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// initialization logic</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeanTwo</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanup</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// destruction logic</span><br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean(initMethod = &quot;init&quot;)</span><br>    <span class="hljs-keyword">public</span> BeanOne <span class="hljs-title function_">beanOne</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanOne</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Bean(destroyMethod = &quot;cleanup&quot;)</span><br>    <span class="hljs-keyword">public</span> BeanTwo <span class="hljs-title function_">beanTwo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanTwo</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>小知识</strong>：对于上面例子中的' BeanOne '，在构造过程中直接调用' init() '方法同样有效，如下例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> BeanOne <span class="hljs-title function_">beanOne</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">BeanOne</span> <span class="hljs-variable">beanOne</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanOne</span>();<br>        beanOne.init();<br>        <span class="hljs-keyword">return</span> beanOne;<br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当您直接在代码中进行配置时，您可以对您的对象做任何您想做的事情，而不总是需要依赖于容器生命周期。</p><blockquote><p>d、指定Bean范围</p></blockquote><p>Spring包含了【@Scope】注解，以便您可以指定bean的范围。</p><p>默认的作用域是' singleton '，但是你可以用' @Scope '注解来覆盖它，如下面的例子所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@Scope(&quot;prototype&quot;)</span><br>    <span class="hljs-keyword">public</span> Encryptor <span class="hljs-title function_">encryptor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>e、定制Bean命名</p></blockquote><p>默认情况下，配置类使用【@Bean】方法的名称作为结果bean的名称。 但是，可以使用' name '属性覆盖该功能，如下例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean(&quot;myThing&quot;)</span><br>    <span class="hljs-keyword">public</span> Thing <span class="hljs-title function_">thing</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thing</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有时需要为单个bean提供多个名称，或者称为bean别名。【@Bean】注解的' name '属性为此接受String数组。 下面的例子展示了如何为一个bean设置多个别名:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean(&#123;&quot;dataSource&quot;， &quot;subsystemA-dataSource&quot;， &quot;subsystemB-dataSource&quot;&#125;)</span><br>    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// instantiate， configure and return DataSource bean...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>f、Bean 描述</p></blockquote><p>有时，提供bean的更详细的文本描述是很有帮助的。 当bean被公开（可能通过JMX）用于监视目的时，这可能特别有用。</p><p>要向【@Bean】添加描述，可以使用【@Description】注解，如下面的示例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@Description(&quot;Provides a basic example of a bean&quot;)</span><br>    <span class="hljs-keyword">public</span> Thing <span class="hljs-title function_">thing</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thing</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-configuration" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4-configuration">#</a> （4） <code>@Configuration</code></h5><p>【@Configuration】是一个类级注解，指示一个对象是beanDifination的源。【@Configuration】类通过【@Bean】带注解的方法声明bean。 【在“@Configuration”类上调用“@Bean”方法也可以用来定义bean间的依赖关系】。</p><blockquote><p>注入bean之间的依赖</p></blockquote><p>当<code>@Bean</code>方法在没有标注<code>@Configuration</code>的类中声明时，它们被认为是在【lite】模式下处理的。 在【@Component】中声明的Bean方法甚至在一个普通的类中声明的Bean方法都被认为是【lite】。在这样的场景中，【@Bean】方法是一种通用工厂方法机制。</p><p>与<code>@Configuration</code> 不同，【lite】模式下 【@Bean】方法不能【声明bean】间的【依赖关系】。 因此，这样的【@Bean】方法不应该调用其他【@Bean】下的方法。 每个这样的方法实际上只是特定bean引用的工厂方法，没有任何特殊的运行时语义。</p><p>在一般情况下，<code>@Bean</code>方法要在【@Configuration】类中声明，这种功能情况下，会使用【full】模式，因此交叉方法引用会被重定向到容器的生命周期管理。 这可以防止通过常规Java调用意外调用相同的Bean，这有助于减少在【lite】模式下操作时难以跟踪的微妙错误。</p><p><code>@Bean</code> 和<code>@Configuration</code>注解将在下面几节中深入讨论。 不过，我们首先介绍通过使用基于java的配置创建spring容器的各种方法。</p><p>当bean相互依赖时，表示这种依赖就像让一个bean方法调用另一个bean方法一样简单，如下面的示例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> BeanOne <span class="hljs-title function_">beanOne</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// full模式可以直接调用方法，这个调用过程由容器管理，lite模式这就是普通方法调用，多次调用会产生多个实例。</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanOne</span>(beanTwo());<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> BeanTwo <span class="hljs-title function_">beanTwo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanTwo</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在前面的例子中，【beanOne】通过构造函数注入接收对【beanTwo】的引用。</p><blockquote><p>考虑下面的例子，它显示了一个带注解的<code>@Bean</code>方法被调用两次:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ClientService <span class="hljs-title function_">clientService1</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ClientServiceImpl</span> <span class="hljs-variable">clientService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientServiceImpl</span>();<br>        clientService.setClientDao(clientDao());<br>        <span class="hljs-keyword">return</span> clientService;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ClientService <span class="hljs-title function_">clientService2</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ClientServiceImpl</span> <span class="hljs-variable">clientService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientServiceImpl</span>();<br>        clientService.setClientDao(clientDao());<br>        <span class="hljs-keyword">return</span> clientService;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ClientDao <span class="hljs-title function_">clientDao</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientDaoImpl</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>clientDao()</code> 在【clientService1()】和【clientService2()】中分别被调用一次。 由于该方法创建了一个新的【ClientDaoImpl】实例并返回它，所以通常期望有两个实例(每个服务一个)。 这肯定会有问题。在Spring中，实例化的bean默认有一个【单例】作用域，在调用父方法并创建新实例之前，首先检查容器中是否有缓存的（有作用域的）bean。</p><blockquote><p>我们目前学习的描述候选组件的注解很多，但是仔细意思考，其实很简单：</p></blockquote><p>我们自己的写代码通常使用以下注解来标识一个组件：</p><ul><li>@Component 组件的通用注解</li><li>@Repository，持久层</li><li>@Service，业务层</li><li>@Controller，控制层</li></ul><p>配置类通常是我们不能修改源代码，但是需要注入别人写的类。例如向容器注入一个德鲁伊数据源的bean，我们是绝对不能给这个类加个【@Component 】注解的。</p><p>@Configuration + @Bean</p><h5 id="_5-使用-import-注解" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5-使用-import-注解">#</a> （5） 使用 <code>@Import</code> 注解</h5><blockquote><p>就像在Spring XML文件中使用<code>&lt;import/&gt; </code>元素来实现模块化配置一样，<code>@Import</code>注解允许从另一个配置类加载【@Bean】定义，如下面的示例所示:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigA</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> A <span class="hljs-title function_">a</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@Import(ConfigA.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigB</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> B <span class="hljs-title function_">b</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，在实例化上下文时不需要同时指定<code>ConfigA.class </code>和<code>ConfigB.class</code>，只需要显式地提供【ConfigB】，如下面的示例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(ConfigB.class);<br><br>    <span class="hljs-comment">// now both beans A and B will be available...</span><br>    <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> ctx.getBean(A.class);<br>    <span class="hljs-type">B</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> ctx.getBean(B.class);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这种方法简化了容器实例化，因为只需要处理一个类，而不是要求您在构造过程中记住潜在的大量【@Configuration】类。</p><p>【小知识】我们一样可以给该注解传入一个实现了ImportSelector接口的类，返回的字符串数组的Bean都会被加载到容器当中：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigSelector</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ImportSelector</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;com.ydlclass.A&quot;</span>，<span class="hljs-string">&quot;com.ydlclass.B&quot;</span>&#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6-结合java和xml配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6-结合java和xml配置">#</a> （6）结合Java和XML配置</h5><blockquote><p>Spring的【@Configuration】类支持的目标并不是100%完全替代Spring XML，有些场景xml仍然是配置容器的理想方式。</p></blockquote><p>我们有如下选择：</p><p>1、容器实例化在一个“以XML为中心”的方式使用，例如，“ClassPathXmlApplicationContext”。</p><p>2、"以java编程的方式为中心”的方式，实例化它通过使用【@ImportResource】注解导入XML。</p><blockquote><p>以xml为中心使用“@Configuration”类</p></blockquote><p>最好从XML引导Spring容器，并以一种特别的方式包含【@Configuration 】类。将【@Configuration 】类声明为普通的Spring <code>&lt;bean/&gt; </code>元素。记住，【@Configuration】类最终是容器中的beanDifination。</p><p>下面的例子展示了Java中一个普通的配置类:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DataSource dataSource;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> AccountRepository <span class="hljs-title function_">accountRepository</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcAccountRepository</span>(dataSource);<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> TransferService <span class="hljs-title function_">transferService</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransferService</span>(accountRepository());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面的例子显示了一个' system-test-config.xml '文件的一部分:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- enable processing of annotations such as @Autowired and @Configuration --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>context:annotation-config/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>context:property-placeholder location=&quot;classpath:/com/acme/jdbc.properties&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean class=&quot;com.acme.AppConfig&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面的示例显示了一个可能的' jdbc '。 属性的文件:</p><div class="language-properties line-numbers-mode" data-ext="properties"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight properties"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">user</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">password</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">url</span>=<span class="hljs-string">jdbc:mysql://127.0.0.1:3306/ydlclass?characterEncoding=utf8&amp;amp;serverTimezone=Asia/Shanghai</span><br><span class="hljs-attr">driverName</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;classpath:/com/acme/system-test-config.xml&quot;</span>);<br>    <span class="hljs-type">TransferService</span> <span class="hljs-variable">transferService</span> <span class="hljs-operator">=</span> ctx.getBean(TransferService.class);<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为【@Configuration】是用【@Component】注解的，所以被【@Configuration】注解的类会自动被组件扫描。 使用与前面示例中描述的相同的场景，我们可以重新定义<code>system-test-config.xml</code>来利用组件扫描。</p><p>下面的示例显示了修改后的system-test-config.xml文件:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- picks up and registers AppConfig as a bean definition --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>context:component-scan base-package=&quot;com.acme&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>context:property-placeholder location=&quot;classpath:/com/acme/jdbc.properties&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>使用@ImportResource以类为中心使用XML</p></blockquote><p>在【@Configuration】类是配置容器的主要机制的应用程序中，可能仍然需要使用至少一些XML。 在这些场景中，您可以使用【@ImportResource】注解，并只定义所需的XML。 这样做可以实现一种“以java为中心”的方法来配置容器，并将XML最小化。</p><p>下面的例子说明了这一点：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ImportResource(&quot;classpath:/com/acme/properties-config.xml&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String url;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DriverManagerDataSource</span>(url， username， password);<br>    &#125;<br>&#125;<br><br><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>properties-config.xml</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>context:property-placeholder location=&quot;classpath:/com/acme/jdbc.properties&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>jdbc.properties：</p><div class="language-properties line-numbers-mode" data-ext="properties"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight properties"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">jdbc.url</span>=<span class="hljs-string">jdbc:hsqldb:hsql://localhost/xdb</span><br><span class="hljs-attr">jdbc.username</span>=<span class="hljs-string">sa</span><br><span class="hljs-attr">jdbc.password</span>=<span class="hljs-string"></span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动容器：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(AppConfig.class);<br>    <span class="hljs-type">TransferService</span> <span class="hljs-variable">transferService</span> <span class="hljs-operator">=</span> ctx.getBean(TransferService.class);<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8、beanfactory和factorybean" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_8、beanfactory和factorybean">#</a> 8、BeanFactory和FactoryBean</h4><p>FactoryBean通常用来创建一个复杂对象：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">FactoryBean</span>&amp;lt;T&amp;gt; &#123;<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">OBJECT_TYPE_ATTRIBUTE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;factoryBeanObjectType&quot;</span>;<br><br>    <span class="hljs-meta">@Nullable</span><br>    T <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;<br><br>    <span class="hljs-meta">@Nullable</span><br>    Class&amp;lt;?&amp;gt; getObjectType();<br><br>    <span class="hljs-keyword">default</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9、环境抽象" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_9、环境抽象">#</a> 9、环境抽象</h4><ul><li><p>【Environment 】接口是一个抽象，集成在容器中，它模拟了应用程序环境的两个关键方面:【profiles】 and 【properties】。</p></li><li><p>一个profile是一个【给定名字】的，在【逻辑上分了组】的beanDifination配置，只有在给定的profile是激活的情况下才向容器注册。</p></li><li><p>properties 在几乎所有的应用程序中都扮演着重要的角色，并且可能源自各种来源：属性文件、JVM系统属性、系统环境变量、JNDI、servlet上下文参数、特定的【Properties】对象、“Map”对象，等等。 与属性相关的“Environment”对象的作用是为用户提供一个方便的服务接口，用于配置属性源并从那里解析属性。</p></li></ul><h5 id="_1-profiles" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1-profiles">#</a> （1）Profiles</h5><p>Profiles在核心容器中提供了一种机制，允许在不同环境中注册不同的Bean。 “环境”这个词对不同的用户有不同的含义，</p><ul><li>在开发中使用内存中的数据源，还是在生产中从JNDI中查找的数据源。</li><li>为客户A和客户B部署注册定制的bean实现。</li></ul><p>考虑一个实际应用程序中的第一个用例，它需要一个“数据源”。 在测试环境中，配置可能类似如下:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EmbeddedDatabaseBuilder</span>()<br>        .setType(EmbeddedDatabaseType.HSQL)<br>        .addScript(<span class="hljs-string">&quot;my-schema.sql&quot;</span>)<br>        .addScript(<span class="hljs-string">&quot;my-test-data.sql&quot;</span>)<br>        .build();<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在考虑如何将该应用程序部署到生产环境中，假设应用程序的数据源已注册到生产应用程序服务器的JNDI目录中。 我们的' dataSource ' bean现在看起来如下所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">Context</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br>    <span class="hljs-keyword">return</span> (DataSource) ctx.lookup(<span class="hljs-string">&quot;java:comp/env/jdbc/datasource&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>重点</strong>：问题是如何根据当前环境在使用这两种数据源之间进行切换？</p><p>当然，我们可以使用 <code>@Profile</code>。</p><p>【@Profile】注解允许您指出，当一个或多个bean在哪一种Profile被激活时被注入。 使用前面的例子，我们可以将dataSource配置重写如下:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@Profile(&quot;development&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StandaloneDataConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EmbeddedDatabaseBuilder</span>()<br>            .setType(EmbeddedDatabaseType.HSQL)<br>            .addScript(<span class="hljs-string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>)<br>            .addScript(<span class="hljs-string">&quot;classpath:com/bank/config/sql/test-data.sql&quot;</span>)<br>            .build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@Profile(&quot;production&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JndiDataConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean(destroyMethod=&quot;&quot;)</span><br>    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Context</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br>        <span class="hljs-keyword">return</span> (DataSource) ctx.lookup(<span class="hljs-string">&quot;java:comp/env/jdbc/datasource&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>@Profile</code>也可以在方法级别声明，只包含一个配置类的一个特定bean(例如，对于一个特定bean的替代变体)，如下面的示例所示:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean(&quot;dataSource&quot;)</span><br>    <span class="hljs-meta">@Profile(&quot;development&quot;)</span> <br>    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">standaloneDataSource</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EmbeddedDatabaseBuilder</span>()<br>            .setType(EmbeddedDatabaseType.HSQL)<br>            .addScript(<span class="hljs-string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>)<br>            .addScript(<span class="hljs-string">&quot;classpath:com/bank/config/sql/test-data.sql&quot;</span>)<br>            .build();<br>    &#125;<br><br>    <span class="hljs-meta">@Bean(&quot;dataSource&quot;)</span><br>    <span class="hljs-meta">@Profile(&quot;production&quot;)</span> <br>    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">jndiDataSource</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Context</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br>        <span class="hljs-keyword">return</span> (DataSource) ctx.lookup(<span class="hljs-string">&quot;java:comp/env/jdbc/datasource&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-xml-bean-定义环境" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2-xml-bean-定义环境">#</a> （2）XML Bean 定义环境</h5><blockquote><p>XML对应的是<code>&lt;beans&gt;</code> 元素的' profile '属性。 前面的示例配置可以在两个XML文件中重写，如下所示：</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans profile=&quot;development&quot;<br>    xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xmlns:jdbc=&quot;http://www.springframework.org/schema/jdbc&quot;<br>    xsi:schemaLocation=&quot;...&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>jdbc:embedded-database id=&quot;dataSource&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>jdbc:script location=&quot;classpath:com/bank/config/sql/schema.sql&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>jdbc:script location=&quot;classpath:com/bank/config/sql/test-data.sql&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/jdbc:embedded-database<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>beans profile=&quot;production&quot;<br>    xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xmlns:jee=&quot;http://www.springframework.org/schema/jee&quot;<br>    xsi:schemaLocation=&quot;...&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>jee:jndi-lookup id=&quot;dataSource&quot; jndi-name=&quot;java:comp/env/jdbc/datasource&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以避免在同一个文件中分割和嵌套<code>&lt;beans/&gt; </code>元素，如下例所示:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xmlns:jdbc=&quot;http://www.springframework.org/schema/jdbc&quot;<br>    xmlns:jee=&quot;http://www.springframework.org/schema/jee&quot;<br>    xsi:schemaLocation=&quot;...&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- other bean definitions --<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>beans profile=&quot;development&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>jdbc:embedded-database id=&quot;dataSource&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>jdbc:script location=&quot;classpath:com/bank/config/sql/schema.sql&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>jdbc:script location=&quot;classpath:com/bank/config/sql/test-data.sql&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/jdbc:embedded-database<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>beans profile=&quot;production&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>jee:jndi-lookup id=&quot;dataSource&quot; jndi-name=&quot;java:comp/env/jdbc/datasource&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>spring bean.xsd</code>被限制为只允许这些元素作为文件中的最后一个元素。 这将有助于在不引起XML文件混乱的情况下提供灵活性。</p><h5 id="_3-激活一个环境" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3-激活一个环境">#</a> （3）激活一个环境</h5><p>现在我们已经更新了配置，我们仍然需要指示Spring哪个配置文件是活动的。 如果我们现在启动我们的样例应用程序，我们会看到抛出一个<code>NoSuchBeanDefinitionException</code>，因为容器无法找到名为<code>dataSource</code>的Spring bean。</p><p>激活配置文件有几种方式，但最直接的方式是通过【ApplicationContext】可用的【Environment】API以编程方式执行。 下面的例子展示了如何做到这一点:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProfile</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">// 创建容器</span><br>    <span class="hljs-type">AnnotationConfigApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>();<br>    <span class="hljs-comment">// 激活环境</span><br>    context.getEnvironment().setActiveProfiles(<span class="hljs-string">&quot;development&quot;</span>);<br>    <span class="hljs-comment">// 扫包</span><br>    context.scan(<span class="hljs-string">&quot;com.ydlclass.datasource&quot;</span>);<br>    <span class="hljs-comment">//  刷新</span><br>    context.refresh();<br>    <span class="hljs-comment">// 使用</span><br>    <span class="hljs-type">DataSource</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> context.getBean(DataSource.class);<br>    logger.info(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>，bean);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 此外，你还可以通过spring.profiles来声明性地激活环境【active】属性，它可以通过系统环境变量、JVM系统属性、servlet上下文参数在' web.xml '中指定。</p><p>请注意，配置文件不是一个“非此即彼”的命题。 您可以一次激活多个配置文件。 通过编程方式，您可以向' setActiveProfiles() '方法提供多个配置文件名，该方法接受' String…'可变参数。 下面的示例激活多个配置文件:</p><p>加入启动参数：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">-Dspring.profiles.active=&quot;profile1，profile2&quot;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>编程的方式</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ctx.getEnvironment().setActiveProfiles(<span class="hljs-string">&quot;profile1&quot;</span>， <span class="hljs-string">&quot;profile2&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><h5 id="_4-porperties" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4-porperties">#</a> （4）porperties</h5><p>Spring的【环境抽象】提供了对【属性】的搜索操作。 考虑以下例子:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericApplicationContext</span>();<br><span class="hljs-type">Environment</span> <span class="hljs-variable">env</span> <span class="hljs-operator">=</span> ctx.getEnvironment();<br><span class="hljs-type">boolean</span> <span class="hljs-variable">containsMyProperty</span> <span class="hljs-operator">=</span> env.containsProperty(<span class="hljs-string">&quot;my-property&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;Does my environment contain the &#x27;my-property&#x27; property? &quot;</span> + containsMyProperty);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在前面的代码片段中，我们看到了查询Spring是否为当前环境定义了【my-property】属性的方法。 为了回答这个问题，“Environment”对象对一组【PropertySource】对象执行搜索。 “PropertySource”是对任何【键值对源】的一个简单抽象， spring的【StandardEnvironment】配置了两个PropertySource对象——一个代表JVM系统属性的集合（“System.getProperties()”）和一个代表系统环境变量的设置（System.getenv()”）。</p><figure><img class="lazy" alt="image-20211215174653618" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211215174653618-8f4cf0ff.png" tabindex="0"/><figcaption>image-20211215174653618</figcaption></figure><p>具体地说，当你使用【StandardEnvironment】时，如果【my-property】系统属性或【my-property】环境变量在运行时存在，对<code>env.containsProperty("my-property")</code>的调用将返回true。</p><p>最重要的是，整个机制都是可配置的。 也许您有一个自定义的属性源，希望将其集成到此搜索中。 为此，我们可以实例化自己的【PropertySource】，并将它添加到当前' Environment '的' propertyssources '集合中。 下面的示例显示了如何这样做:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericApplicationContext</span>();<br><span class="hljs-type">MutablePropertySources</span> <span class="hljs-variable">sources</span> <span class="hljs-operator">=</span> ctx.getEnvironment().getPropertySources();<br>sources.addFirst(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyPropertySource</span>());<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>使用<code>@PropertySource</code></p></blockquote><p>【@PropertySource ]】注解提供了一种方便的声明性机制，用于向Spring的【Environment】中添加【 PropertySource】。</p><p>给定一个名为app的文件。 下面的【@Configuration】类使用了【@PropertySource】，从而调用“testBean.getName()”返回“myTestBean”:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@PropertySource(&quot;classpath:/com/myco/app.properties&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    Environment env;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> TestBean <span class="hljs-title function_">testBean</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">TestBean</span> <span class="hljs-variable">testBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestBean</span>();<br>        testBean.setName(env.getProperty(<span class="hljs-string">&quot;testbean.name&quot;</span>));<br>        <span class="hljs-keyword">return</span> testBean;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="value" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#value">#</a> @Value("${}")</h4><p>对于引入的properties文件</p><h4 id="_10、事件机制" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_10、事件机制">#</a> 10、事件机制</h4><p>为了以更面向框架的风格增强【BeanFactory】功能，ApplicationContext还提供了以下功能:</p><ul><li>通过MessageSource接口访问i18n风格的消息，实现国际化。</li><li>通过ResourceLoader接口访问资源，例如url和文件。</li><li>事件发布，即通过使用' ApplicationEventPublisher '接口发布实现' ApplicationListener '接口的bean。</li><li>通过“HierarchicalBeanFactory”接口，加载多个(分层的)上下文，让每个上下文都集中在一个特定的层上，比如应用程序的web层。</li></ul><blockquote><p>1、自定义事件</p></blockquote><p>ApplicationContext中的事件处理是通过【ApplicationEvent】类和【ApplicationListener】接口提供的。 如果将实现“ApplicationListener”接口的bean部署到上下文中，那么每次将【ApplicationEvent】发布到【ApplicationContext】时，都会通知该bean。 本质上，这是标准的Observer设计模式。</p><p>从spring4.2开始，事件基础设施得到了显著的改进，并提供了一个【基于注解的事件模型】以及发布任意事件的能力 。</p><p>您可以使用spring创建和发布自己的自定义事件。 下面的例子展示了一个简单的类，它扩展了Spring的【ApplicationEvent】基类:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockedListEvent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ApplicationEvent</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String address;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String content;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BlockedListEvent</span><span class="hljs-params">(Object source， String address， String content)</span> &#123;<br>        <span class="hljs-built_in">super</span>(source);<br>        <span class="hljs-built_in">this</span>.address = address;<br>        <span class="hljs-built_in">this</span>.content = content;<br>    &#125;<br><br>    <span class="hljs-comment">// accessor and other methods...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要发布自定义的【ApplicationEvent】，需要调用【ApplicationEventPublisher】上的【publishEvent()】方法。 通常，这是通过创建一个实现' ApplicationEventPublisherAware '的类并将其注册为Spring bean来实现的。 下面的例子展示了这样一个类:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationEventPublisherAware</span> &#123;<br><br>    <span class="hljs-keyword">private</span> List&amp;lt;String&amp;gt; blockedList;<br>    <span class="hljs-keyword">private</span> ApplicationEventPublisher publisher;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBlockedList</span><span class="hljs-params">(List&amp;lt;String&amp;gt; blockedList)</span> &#123;<br>        <span class="hljs-built_in">this</span>.blockedList = blockedList;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setApplicationEventPublisher</span><span class="hljs-params">(ApplicationEventPublisher publisher)</span> &#123;<br>        <span class="hljs-built_in">this</span>.publisher = publisher;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendEmail</span><span class="hljs-params">(String address， String content)</span> &#123;<br>        <span class="hljs-keyword">if</span> (blockedList.contains(address)) &#123;<br>            publisher.publishEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BlockedListEvent</span>(<span class="hljs-built_in">this</span>， address， content));<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">// send email...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><p>在配置时，Spring容器检测到【EmailService】实现了【 ApplicationEventPublisherAware】并自动调用【setApplicationEventPublisher()】。 实际上，传入的参数是Spring容器本身。 你通过它的【ApplicationEventPublisher】接口与应用上下文交互。</p><p>要接收自定义的【 ApplicationEvent】，您可以创建一个类来实现【ApplicationListener】并将其注册为Spring bean。 下面的例子展示了这样一个类:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockedListNotifier</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationListener</span>&amp;lt;BlockedListEvent&amp;gt; &#123;<br><br>    <span class="hljs-keyword">private</span> String notificationAddress;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNotificationAddress</span><span class="hljs-params">(String notificationAddress)</span> &#123;<br>        <span class="hljs-built_in">this</span>.notificationAddress = notificationAddress;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onApplicationEvent</span><span class="hljs-params">(BlockedListEvent event)</span> &#123;<br>        <span class="hljs-comment">// notify appropriate parties via notificationAddress...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将来容器只要发布这个事件，这个监听者就可以感知。</p><blockquote><p>基于注解的事件监听器</p></blockquote><p>您可以使用【@EventListener】注解在托管bean的任何方法上注册一个事件侦听器。 【BlockedListNotifier】可以重写如下:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockedListNotifier</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String notificationAddress;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNotificationAddress</span><span class="hljs-params">(String notificationAddress)</span> &#123;<br>        <span class="hljs-built_in">this</span>.notificationAddress = notificationAddress;<br>    &#125;<br><br>    <span class="hljs-meta">@EventListener</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processBlockedListEvent</span><span class="hljs-params">(BlockedListEvent event)</span> &#123;<br>        <span class="hljs-comment">// notify appropriate parties via notificationAddress...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>方法签名再次声明它侦听的事件类型，但这一次使用了灵活的名称，而没有实现特定的侦听器接口。 只要实际事件类型在其实现层次结构中解析泛型参数，就可以通过泛型缩小事件类型。</p><p>如果您的方法应该侦听多个事件，或者您想在不带参数的情况下定义它，也可以在注解本身上指定事件类型。 下面的例子展示了如何做到这一点:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EventListener(&#123;ContextStartedEvent.class， ContextRefreshedEvent.class&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleContextStart</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><blockquote><p>2、Spring提供的标准事件</p></blockquote><table><thead><tr><th style="text-align:left;">事件</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><code>ContextRefreshedEvent</code></td><td style="text-align:left;">在“ApplicationContext”被初始化或刷新时发布(例如，通过使用“ConfigurableApplicationContext”接口上的“refresh()”方法)。 这里，“初始化”意味着加载了所有bean，检测并激活了后处理器bean，预实例化了单例，并且“ApplicationContext”对象已经准备好使用了。 只要上下文还没有被关闭，一个刷新可以被触发多次，只要选择的' ApplicationContext '实际上支持这种“热”刷新。 例如，' XmlWebApplicationContext '支持热刷新，但' GenericApplicationContext '不支持。</td></tr><tr><td style="text-align:left;"><code>ContextStartedEvent</code></td><td style="text-align:left;">在' ConfigurableApplicationContext '接口上使用' start() '方法启动' ApplicationContext '时发布。 在这里，“started”意味着所有的“生命周期”bean都接收一个显式的开始信号。 通常，此信号用于在显式停止之后重新启动bean，但它也可用于启动尚未配置为自动启动的组件(例如，在初始化时尚未启动的组件)。</td></tr><tr><td style="text-align:left;"><code>ContextStoppedEvent</code></td><td style="text-align:left;">在' ConfigurableApplicationContext '接口上使用' stop() '方法停止' ApplicationContext '时发布。 这里，“stopped”意味着所有“Lifecycle”bean都接收一个显式的停止信号。 一个停止的上下文可以通过' start() '调用重新启动。</td></tr><tr><td style="text-align:left;"><code>ContextClosedEvent</code></td><td style="text-align:left;">在' ConfigurableApplicationContext '接口上的' close() '方法或通过JVM关闭钩子关闭' ApplicationContext '时发布。 这里，“closed”意味着将销毁所有单例bean。 一旦关闭上下文，它将到达其生命周期的结束，不能刷新或重新启动。</td></tr><tr><td style="text-align:left;"><code>RequestHandledEvent</code></td><td style="text-align:left;">一个特定于web的事件，告诉所有bean一个HTTP请求已经得到了服务。 此事件在请求完成后发布。 这个事件只适用于使用Spring ' DispatcherServlet '的web应用程序。</td></tr><tr><td style="text-align:left;"><code>ServletRequestHandledEvent</code></td><td style="text-align:left;">' requestthandledevent '的子类，用于添加特定于servlet的上下文信息。</td></tr></tbody></table><p>这些标准事件会在特定的时间发布，我们可以监听这些事件，并在事件发布时做我们想做的工作。</p><h2 id="第三章-resources" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第三章-resources">#</a> 第三章：Resources</h2><p>Java拥有标准【java.net.URL】类和各种URL前缀的标准处理程序，不幸的是，对于所有底层资源的访问来说，还不够充分。 例如，没有标准化的【URL】用来访问需要从类路径或相对于【ServletContext】获取资源的方式，而spring为我们解决了这些问题。</p><h3 id="一、resource接口" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、resource接口">#</a> 一、Resource接口</h3><p>Spring的【Resource】接口位于【<a href="http://org.springframework.core.io" rel="noopener noreferrer" target="_blank">org.springframework.core.io<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>】 包，他抽象了对资源的访问的能力。 下面提供了【Resource】接口的概述， Spring本身广泛地使用了<code>Resource</code>接口。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Resource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputStreamSource</span> &#123;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">exists</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isReadable</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isOpen</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFile</span><span class="hljs-params">()</span>;<br>    URL <span class="hljs-title function_">getURL</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException;<br>    URI <span class="hljs-title function_">getURI</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException;<br>    File <span class="hljs-title function_">getFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException;<br>    ReadableByteChannel <span class="hljs-title function_">readableChannel</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException;<br>    <span class="hljs-type">long</span> <span class="hljs-title function_">contentLength</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException;<br>    <span class="hljs-type">long</span> <span class="hljs-title function_">lastModified</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException;<br>    Resource <span class="hljs-title function_">createRelative</span><span class="hljs-params">(String relativePath)</span> <span class="hljs-keyword">throws</span> IOException;<br>    String <span class="hljs-title function_">getFilename</span><span class="hljs-params">()</span>;<br>    String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二、内置的-resource的实现" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、内置的-resource的实现">#</a> 二、内置的 <code>Resource</code>的实现</h3><p>Spring包含了几个内置的 <code>Resource</code> 实现，如下所示：</p><h4 id="_1、urlresource" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、urlresource">#</a> 1、<code>UrlResource</code></h4><p><code>UrlResource</code>包装了<code>java.net.URL</code>，可以用来访问任何需要通过URL访问的对象，例如文件、HTTPS目标、FTP目标等。 所有URL都用一个标准化的“String”表示，这样就可以使用适当的标准化前缀来表示不同类型的URL。 这包括用于访问文件系统路径的' file: '，用于通过https协议访问资源的' https: '，用于通过ftp访问资源的' ftp: '等。</p><h4 id="_2、-classpathresource" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-classpathresource">#</a> 2、 <code>ClassPathResource</code></h4><p>该类表示应该从【类路径】中获取的资源。 它使用线程上下文类装入器、给定的类装入器或给定的类装入资源。</p><h4 id="_3、filesystemresource" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、filesystemresource">#</a> 3、<code>FileSystemResource</code></h4><p>这是【<a href="http://java.io" rel="noopener noreferrer" target="_blank">java.io<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>】的【Resource】实现。</p><h4 id="_4、pathresource" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、pathresource">#</a> 4、<code>PathResource</code></h4><p>这是一个【java.nio.file】的【资源】实现。</p><h4 id="_5、servletcontextresource" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5、servletcontextresource">#</a> 5、<code>ServletContextResource</code></h4><p>这是【ServletContext】资源的【Resource】实现，它解释了相关web应用程序根目录中的相对路径。</p><h4 id="_6、inputstreamresource" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6、inputstreamresource">#</a> 6、<code>InputStreamResource</code></h4><p>一个【InputStreamResource】是一个给定的【InputStream】的【Resource】实现。 只有当没有特定的【资源】实现适用时，才应该使用它。 特别是，如果可能的话，最好使用【ByteArrayResource】或任何基于文件的【Resource】实现。</p><h4 id="_7、-bytearrayresource" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_7、-bytearrayresource">#</a> 7、 <code>ByteArrayResource</code></h4><p>这是一个给定字节数组的【资源】实现。 它为给定的字节数组创建一个<code>ByteArrayInputStream</code>。</p><p>它可以从任何给定的字节数组加载内容，而不需要求助于一次性使用的<code>InputStreamResource</code>。</p><h3 id="三、resourceloader接口" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、resourceloader接口">#</a> 三、ResourceLoader接口</h3><p><code>ResourceLoader</code> 接口定义了加载资源的基本能力和方式。 下面的例子显示了 <code>ResourceLoader</code>接口定义:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ResourceLoader</span> &#123;<br><br>    Resource <span class="hljs-title function_">getResource</span><span class="hljs-params">(String location)</span>;<br><br>    ClassLoader <span class="hljs-title function_">getClassLoader</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>所有应用程序上下文（applicationContext）都实现了【ResourceLoader】接口。 因此，可以所有的【应用程序上下文实现（ClassPathXmlA...）】都拥有加载资源的能力。</p><p>当您在特定的应用程序上下文中调用' getResource() '时，如果指定的位置路径【没有特定的前缀】，您将返回【适合该特定应用程序上下文中】的' Resource '类型。 例如，假设以下代码片段是在' ClassPathXmlApplicationContext '实例上运行的:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Resource</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> ctx.getResource(<span class="hljs-string">&quot;some/resource/path/myTemplate.txt&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><ul><li>针对<code> ClassPathXmlApplicationContext</code>，该代码返回' ClassPathResource '。</li><li>针对<code>FileSystemXmlApplicationContext</code>实例运行相同的方法，它将返回' FileSystemResource '。</li><li>针对<code>WebApplicationContext</code>，它会返回' ServletContextResource '。 它同样会为每个上下文返回适当的对象。</li></ul><p>另一方面，你也可以通过指定特殊的【' classpath: '前缀】来强制使用【ClassPathResource】，无论应用程序的上下文类型是什么，如下面的示例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Resource</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> ctx.getResource(<span class="hljs-string">&quot;classpath:some/resource/path/myTemplate.txt&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>类似地，您可以通过指定任何标准的<code>java.net.URL</code>前缀来强制使用【UrlResource】。 下面的例子使用了【file】和【https】前缀:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Resource</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> ctx.getResource(<span class="hljs-string">&quot;file:///some/resource/path/myTemplate.txt&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Resource</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> ctx.getResource(<span class="hljs-string">&quot;https://myhost.com/resource/path/myTemplate.txt&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>下表总结了将' String '对象转换为' Resource '对象的策略:</p><table><thead><tr><th style="text-align: left;">前缀</th><th style="text-align: left;">举例</th><th style="text-align: left;">说明</th></tr></thead><tbody><tr><td style="text-align: left;">classpath:</td><td style="text-align: left;"><code>classpath:com/myapp/config.xml</code></td><td style="text-align: left;">从类路径加载。</td></tr><tr><td style="text-align: left;">file:</td><td style="text-align: left;"><code>file:///data/config.xml</code></td><td style="text-align: left;">作为一个“URL”从文件系统加载。 请参见<a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-filesystemresource-caveats" rel="noopener noreferrer" target="_blank">' FileSystemResource ' Caveats<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</td></tr><tr><td style="text-align: left;">https:</td><td style="text-align: left;"><code>https://myserver/logo.png</code></td><td style="text-align: left;">作为一个 <code>URL</code>加载。</td></tr><tr><td style="text-align: left;">(none)</td><td style="text-align: left;"><code>/data/config.xml</code></td><td style="text-align: left;">依赖于底层的 <code>ApplicationContext</code>。</td></tr></tbody></table><h3 id="四、-应用环境和资源路径" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、-应用环境和资源路径">#</a> 四、 应用环境和资源路径</h3><p>本节介绍如何【使用资源】创建应用程序上下文，包括使用XML的快捷方式、使用通配符以及其他细节。</p><h4 id="_1、构建应用程序上下文" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、构建应用程序上下文">#</a> 1、构建应用程序上下文</h4><p>应用程序上下文构造函数通常采用【字符串或字符串数组】作为资源的位置路径，例如组成上下文定义的XML文件。</p><p>当这样的位置路径没有前缀时，从该路径构建并用于加载beanDifination的特定【Resource】类型取决于我们使用的这个特定的应用程序上下文。 例如，考虑下面的例子，它创建了一个' ClassPathXmlApplicationContext ':</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;conf/appContext.xml&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>beanDifination是从类路径加载的，因此他使用了【ClassPathResource】。 但是，考虑下面的例子，它创建了一个' FileSystemXmlApplicationContext ':</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileSystemXmlApplicationContext</span>(<span class="hljs-string">&quot;conf/appContext.xml&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>现在从【文件系统】位置加载beanDifination(在本例中，相对于当前工作目录)。</p><p>注意，在位置路径上使用特殊的【classpath前缀】或标准URL前缀会覆盖为加载beanDifination而创建的【默认类型Resource】。 考虑以下例子:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileSystemXmlApplicationContext</span>(<span class="hljs-string">&quot;classpath:conf/appContext.xml&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>使用【FileSystemXmlApplicationContext】从类路径加载beanDifination。 然而，它仍然是一个“FileSystemXmlApplicationContext”。 如果它随后被用作【ResourceLoader】，任何没有前缀的路径仍然被视为文件系统路径。</p><h4 id="_2、源路径中的通配符" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、源路径中的通配符">#</a> 2、源路径中的通配符</h4><p>应用程序上下文构造函数值中的资源路径可以是简单路径，每个路径都有到【目标资源】的一对一映射。当然，也可以包含特殊的【classpath*:】前缀或【内部ant模式】， 后者实际上都是通配符。</p><p>注意，这种通配符特定于在应用程序上下文构造函数中使用资源路径(或直接使用“PathMatcher”实用程序类层次结构时)，并在构造时解析。 它与“资源”类型本身无关。 你不能使用' classpath*: '前缀来构造一个【实际的Resource】，因为一个resource一次只指向一个资源。</p><blockquote><p>Ant-style的匹配原则</p></blockquote><figure><img class="lazy" alt="image-20211201212643242" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211201212643242-f2c29555.png" tabindex="0"/><figcaption>image-20211201212643242</figcaption></figure><blockquote><p>Ant-style 模式</p></blockquote><p>路径位置可以包含ant样式的模式，如下例所示:</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">/WEB-INF/*-context.xml<br>com/mycompany/**/applicationContext.xml<br>file:C:/some/path/*-context.xml<br>classpath:com/mycompany/**/applicationContext.xml<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当路径位置包含【ant样式模式】时，解析器将遵循更复杂的过程来尝试解析通配符。</p><blockquote><p>classpath*:前缀</p></blockquote><p>当构造基于xml的应用上下文时，位置字符串可以使用特殊的' classpath*: '前缀，如下所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;classpath*:conf/appContext.xml&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>classpath:和classpath*:的区别</p></blockquote><p>classpath: ：表示从该工程中的类路径中加载资源，classpath:和classpath:/是等价的，都是相对于类的根路径。资源文件库标准的在文件系统中，也可以在JAR或ZIP的类包中。 classpath*：假设多个JAR包或文件系统类路径都有一个相同的配置文件，classpath:只会在第一个加载的类路径下查找，而【classpath*:】会扫描所有这些JAR包及类路径下出现的同名文件。</p><h2 id="第四章-验证、数据绑定和类型转换" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第四章-验证、数据绑定和类型转换">#</a> 第四章 验证、数据绑定和类型转换</h2><h3 id="一、beanwrapper" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、beanwrapper">#</a> 一、BeanWrapper</h3><p>bean包中一个非常重要的类是【BeanWrappe】接口及其相应的实现(【BeanWrapperImpl】)。 正如在javadoc中引用的，【BeanWrapper】提供了【设置和获取属性值】、【获取属性描述符】等功能。 此外，【BeanWrapper】提供了对嵌套属性的支持，允许对子属性进行无限深度的检索。 说的简单一点，就是这个类能帮助我对使用更简单的api通过反射操作一个bean的属性。</p><blockquote><p>我们以设置和获取基本和嵌套属性为例</p></blockquote><p>设置和获取属性是通过【BeanWrapper】的' setPropertyValue '和' getPropertyValue '重载方法变体来完成的。 下表显示了这些约定的一些例子:</p><table><thead><tr><th style="text-align:left;">表达式</th><th style="text-align:left;">释义</th></tr></thead><tbody><tr><td style="text-align:left;"><code>name</code></td><td style="text-align:left;">指示属性“name”对应于“getName()”或“isName()”和“setName(..)”方法。</td></tr><tr><td style="text-align:left;"><code>account.name</code></td><td style="text-align:left;">指示属性' account '的嵌套属性' name '，该属性对应于(例如)' getAccount(). setname() '或' getAccount(). getname() '方法。</td></tr><tr><td style="text-align:left;"><code>account[2]</code></td><td style="text-align:left;">指示索引属性' account '的<em>third</em>元素。 索引属性的类型可以是' array '、' list '或其他自然有序的集合。</td></tr><tr><td style="text-align:left;"><code>account[COMPANYNAME]</code></td><td style="text-align:left;">指示由“account”、“map”属性的“COMPANYNAME”键索引的映射条目的值。</td></tr></tbody></table><p>下面两个示例类使用' BeanWrapper '来获取和设置属性:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Company</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Employee managingDirector;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Employee <span class="hljs-title function_">getManagingDirector</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.managingDirector;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setManagingDirector</span><span class="hljs-params">(Employee managingDirector)</span> &#123;<br>        <span class="hljs-built_in">this</span>.managingDirector = managingDirector;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> salary;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getSalary</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> salary;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSalary</span><span class="hljs-params">(<span class="hljs-type">float</span> salary)</span> &#123;<br>        <span class="hljs-built_in">this</span>.salary = salary;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面的代码片段展示了如何【检索和操作】实例化后的' Company ' 和' Employee ' 的一些属性:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">BeanWrapper</span> <span class="hljs-variable">company</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanWrapperImpl</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Company</span>());<br><span class="hljs-comment">// setting the company name..</span><br>company.setPropertyValue(<span class="hljs-string">&quot;name&quot;</span>， <span class="hljs-string">&quot;Some Company Inc.&quot;</span>);<br><span class="hljs-comment">// ... can also be done like this:</span><br><span class="hljs-type">PropertyValue</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PropertyValue</span>(<span class="hljs-string">&quot;name&quot;</span>， <span class="hljs-string">&quot;Some Company Inc.&quot;</span>);<br>company.setPropertyValue(value);<br><br><span class="hljs-comment">// ok， let&#x27;s create the director and tie it to the company:</span><br><span class="hljs-type">BeanWrapper</span> <span class="hljs-variable">jim</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanWrapperImpl</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>());<br>jim.setPropertyValue(<span class="hljs-string">&quot;name&quot;</span>， <span class="hljs-string">&quot;Jim Stravinsky&quot;</span>);<br>company.setPropertyValue(<span class="hljs-string">&quot;managingDirector&quot;</span>， jim.getWrappedInstance());<br><br><span class="hljs-comment">// retrieving the salary of the managingDirector through the company</span><br><span class="hljs-type">Float</span> <span class="hljs-variable">salary</span> <span class="hljs-operator">=</span> (Float) company.getPropertyValue(<span class="hljs-string">&quot;managingDirector.salary&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二、propertyeditor属性编辑器" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、propertyeditor属性编辑器">#</a> 二、PropertyEditor属性编辑器</h3><p>Spring使用【PropertyEditor】的概念来实现【对象】和【字符串】之间的转换。</p><p>例如，【Date】可以用人类可读的方式表示（如"2007-14-09"），而我们仍然可以将人类可读的形式转换回原始日期（或者，更好的是，将任何以人类可读形式输入的日期转换回【Date 对象】。 这种行为可以通过注册类型为【java.beans.PropertyEditor 】的自定义编辑器来实现。</p><blockquote><p>Spring中使用PropertyEditor的几个例子:</p></blockquote><ul><li>通过使用【PropertyEditor】实现来设置bean的属性。</li><li>在Spring的MVC框架中解析HTTP请求参数是通过使用各种各样的【PropertyEditor】实现来完成的，后续学mvc的时候会讲。</li></ul><p>Spring有许多内置的【PropertyEditor】实现，这使得我们的工作变得更加简单。 它们都位于【org.springframework.beans】中的propertyeditors包中。 默认情况下，大多数是由【BeanWrapperImpl】注册的。 下表描述了Spring提供的各种【PropertyEditor】实现:</p><table><thead><tr><th style="text-align:left;">分类</th><th style="text-align:left;">释义</th></tr></thead><tbody><tr><td style="text-align:left;"><code>ClassEditor</code></td><td style="text-align:left;">将表示类的字符串解析为实际类，反之亦然。 当未找到类时，将抛出一个' IllegalArgumentException '。 默认情况下，由' BeanWrapperImpl '注册。</td></tr><tr><td style="text-align:left;"><code>CustomBooleanEditor</code></td><td style="text-align:left;">【布尔属性】的属性编辑器。完成字符串和布尔值的转化。 默认情况下，由' BeanWrapperImpl '注册。</td></tr><tr><td style="text-align:left;"><code>CustomCollectionEditor</code></td><td style="text-align:left;">集合的属性编辑器，将给定的描述集合的字符串转化为目标【集合类型】。</td></tr><tr><td style="text-align:left;"><code>CustomDateEditor</code></td><td style="text-align:left;">可自定义的属性编辑器，支持自定义【日期格式】。 默认未注册。 必须根据需要使用适当的格式进行用户注册。</td></tr><tr><td style="text-align:left;"><code>ByteArrayPropertyEditor</code></td><td style="text-align:left;">字节数组的编辑器， 将字符串转换为对应的字节表示形式。 默认情况下由' BeanWrapperImpl '注册。</td></tr><tr><td style="text-align:left;"><code>CustomNumberEditor</code></td><td style="text-align:left;">可自定义任何【数字类】的属性编辑器，如“整数”、“长”、“Float”或“Double”。 默认情况下，由' BeanWrapperImpl '注册，但可以通过将其自定义实例注册为自定义编辑器来覆盖。</td></tr><tr><td style="text-align:left;"><code>FileEditor</code></td><td style="text-align:left;">将字符串解析为【java.io.file】的对象。 默认情况下，由' BeanWrapperImpl '注册。</td></tr><tr><td style="text-align:left;"><code>LocaleEditor</code></td><td style="text-align:left;">可以将字符串解析为' Locale '对象，反之亦然(字符串格式为' [language]<em>[country]</em>[variant] '，与' Locale '的' toString() '方法相同)。 也接受空格作为分隔符，作为下划线的替代。 默认情况下，由' BeanWrapperImpl '注册。</td></tr><tr><td style="text-align:left;"><code>PatternEditor</code></td><td style="text-align:left;">可以将字符串解析为' java.util.regex。 模式的对象，反之亦然。</td></tr><tr><td style="text-align:left;"><code>PropertiesEditor</code></td><td style="text-align:left;">可以转换字符串到' Properties '对象。 默认情况下，由' BeanWrapperImpl '注册。</td></tr><tr><td style="text-align:left;"><code>StringTrimmerEditor</code></td><td style="text-align:left;">修剪字符串的属性编辑器。 允许将空字符串转换为' null '值。 默认情况下未注册-必须是用户注册的。</td></tr><tr><td style="text-align:left;"><code>URLEditor</code></td><td style="text-align:left;">可以将URL的字符串表示形式解析为实际的' URL '对象。 默认情况下，由' BeanWrapperImpl '注册。</td></tr></tbody></table><blockquote><p>注册额外的自定义【PropertyEditor】实现</p></blockquote><p>当将bean属性设置为【字符串值】时，Spring IoC容器最终使用标准JavaBeans的PropertyEditor实现将这些字符串转换为属性的复杂类型。 Spring预注册了许多自定义的【PropertyEditor】实现（例如，将一个表示为字符串的类名转换为' class '对象）。 此外，Java的标准JavaBeans 【PropertyEditor】查找机制允许对类的【 PropertyEditor 】进行适当的命名，并将其放置在与其提供支持的类相同的包中，这样就可以自动找到它。</p><blockquote><p>如果需要注册其他自定义的【propertyeEditors】，可以使用几种机制，其实本质是一样的。</p></blockquote><ul><li>第一种手动的方法（通常不方便也不推荐）是使用【ConfigurableBeanFactory】接口的【registerCustomEditor()】方法，这里您必须佣有一个【BeanFactory】引用，比如我们可以写一个【beanFactoryPostProccessor】。</li><li>另一种（稍微方便一点）机制是使用名为【CustomEditorConfigurer】的特殊beanFactoryPostProccessor，这是spring给我们提供的，下边的案例演示了这个方式。</li></ul><p>标准【PropertyEditor】实例用于将表示为字符串的属性值转换为属性的实际复杂类型。 你可以使用【CustomEditorConfigurer】，一个beanFactoryPostProccessor，来方便地添加对附加的【PropertyEditor】实例的支持到【ApplicationContext】。</p><p>考虑下面的例子，它定义了一个名为【ExoticType】的用户类和另一个名为【DependsOnExoticType】的类，后者需要将【ExoticType】设置为属性:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> example;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExoticType</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ExoticType</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DependsOnExoticType</span> &#123;<br><br>    <span class="hljs-keyword">private</span> ExoticType type;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setType</span><span class="hljs-params">(ExoticType type)</span> &#123;<br>        <span class="hljs-built_in">this</span>.type = type;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们希望能够将type属性分配为字符串，【PropertyEditor】将其转换为实际的【ExoticType】实例。 下面的beanDifination展示了如何建立这种关系:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;sample&quot; class=&quot;example.DependsOnExoticType&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 这里没有使用rel，二十使用value，这个会当做字符串进行解析 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;type&quot; value=&quot;aNameForExoticType&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【PropertyEditor】实现类似如下:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// converts string representation to ExoticType object</span><br><span class="hljs-keyword">package</span> example;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExoticTypeEditor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PropertyEditorSupport</span> &#123;<br>    <span class="hljs-comment">// 容器发现需要一个对象的实例，而只是找到了一个字符串，就会根据type的类型匹配这个转化器</span><br>    <span class="hljs-comment">// 这个转化器会进行构造</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAsText</span><span class="hljs-params">(String text)</span> &#123;<br>        setValue(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ExoticType</span>(text.toUpperCase()));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后，下面的例子展示了如何使用【CustomEditorConfigurer】向【ApplicationContext】注册新的【PropertyEditor】，然后它将能够在需要时使用它:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomEditorConfigurer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanFactoryPostProcessor</span>, Ordered<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>这家伙是一个BeanFactoryPostProcessor，他会在创建好bean工厂后进行注册：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.propertyEditorRegistrars != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">for</span> (PropertyEditorRegistrar propertyEditorRegistrar : <span class="hljs-built_in">this</span>.propertyEditorRegistrars) &#123;<br>            beanFactory.addPropertyEditorRegistrar(propertyEditorRegistrar);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.customEditors != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-built_in">this</span>.customEditors.forEach(beanFactory::registerCustomEditor);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要我们写的仅仅是在xml中注册一下即可：</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean class=&quot;org.springframework.beans.factory.config.CustomEditorConfigurer&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;customEditors&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>map<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>entry key=&quot;example.ExoticType&quot; value=&quot;example.ExoticTypeEditor&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/map<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>我们还可以使用PropertyEditorRegistrar</p></blockquote><p>下面的例子展示了如何创建自己的【propertyeditorregistry】实现:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.foo.editors.spring;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomPropertyEditorRegistrar</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PropertyEditorRegistrar</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerCustomEditors</span><span class="hljs-params">(PropertyEditorRegistry registry)</span> &#123;<br><br>        <span class="hljs-comment">// it is expected that new PropertyEditor instances are created</span><br>        registry.registerCustomEditor(ExoticType.class， <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExoticTypeEditor</span>());<br><br>        <span class="hljs-comment">// you could register as many custom property editors as are required here...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下一个例子展示了如何配置一个【CustomEditorConfigurer】，并将一个【CustomPropertyEditorRegistrar】的实例注入其中:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean class=&quot;org.springframework.beans.factory.config.CustomEditorConfigurer&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;propertyEditorRegistrars&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>list<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>ref bean=&quot;customPropertyEditorRegistrar&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/list<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;customPropertyEditorRegistrar&quot;<br>    class=&quot;com.foo.editors.spring.CustomPropertyEditorRegistrar&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="三、类型转换" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、类型转换">#</a> 三、类型转换</h3><p>Spring 3核心包提供了一个【通用类型转换系统】。 在Spring容器中，您可以使用此系统作为【PropertyEditor】的替代方案，将外部化bean属性值字符串转换为所需的属性类型。</p><h4 id="_1、-converter的api" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、-converter的api">#</a> 1、 Converter的API</h4><p>实现类型转换逻辑很简单，如下面的接口定义所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.springframework.core.convert.converter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Converter</span>&amp;lt;S, T&amp;gt; &#123;<br><br>    T <span class="hljs-title function_">convert</span><span class="hljs-params">(S source)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建你自己的转换器，需要实现【转换器】接口，并使用泛型“S”作为你要转换的【原始类型】，“T”作为你要转换的【目标类型】。</p><p><code>core.convert</code>中提供了几个转换器实现。 其中包括从字符串到数字和其他常见类型的转换器。 下面的例子显示了' StringToInteger '类，它是一个典型的' Converter '实现:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.springframework.core.convert.support;<br><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StringToInteger</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Converter</span>&amp;lt;String,Integer&amp;gt; &#123;<br><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">convert</span><span class="hljs-params">(String source)</span> &#123;<br>        <span class="hljs-keyword">return</span> Integer.valueOf(source);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、-conversionservice的-api" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-conversionservice的-api">#</a> 2、 ConversionService的 API</h4><p>【conversionservice】定义了一个用于在运行时执行类型转换逻辑的统一API：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.springframework.core.convert;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ConversionService</span> &#123;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">canConvert</span><span class="hljs-params">(Class&amp;lt;?&amp;gt; sourceType， Class&amp;lt;?&amp;gt; targetType)</span>;<br><br>    &amp;lt;T&amp;gt; T <span class="hljs-title function_">convert</span><span class="hljs-params">(Object source， Class&amp;lt;T&amp;gt; targetType)</span>;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">canConvert</span><span class="hljs-params">(TypeDescriptor sourceType， TypeDescriptor targetType)</span>;<br><br>    Object <span class="hljs-title function_">convert</span><span class="hljs-params">(Object source， TypeDescriptor sourceType， TypeDescriptor targetType)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>大多数【ConversionService】实现也实现【ConverterRegistry】，它提供了一个用于注册转换器的API。</p><p>spring提供了一个强大的【ConversionService】实现，即 【GenericConversionService】 ，他是适合在大多数环境中使用的通用实现。Spring会选择' ConversionService'，并在框架需要执行类型转换时使用它。</p><p>要在Spring中注册默认的' conververService '，请添加以下带有【converversionservice】id '的beanDifination:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;conversionService&quot;<br>    class=&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>默认的【converversionservice】可以在字符串、数字、枚举、集合、映射和其他常见类型之间进行转换。 要使用您自己的【自定义转换器】来补充或覆盖默认转换器，请设置【converters】属性。 属性值可以实现任何' Converter '、' ConverterFactory '或' GenericConverter '接口。</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;conversionService&quot;<br>        class=&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;converters&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>set<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>bean class=&quot;example.MyCustomConverter&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/set<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3、-配置-databinder进行数据验证" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、-配置-databinder进行数据验证">#</a> 3、 配置 <code>DataBinder</code>进行数据验证</h3><p>从Spring 3开始，你就可以用一个【Validator】配置一个【DataBinder】实例。 一旦配置完成，您就可以通过调用【binder.validate() 】来调用【 Validator】。 任何验证' Errors '都会自动添加到绑定的' BindingResult '中。</p><p>下面的例子展示了如何通过编程方式使用DataBinder在绑定到目标对象后调用验证逻辑:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 绑定一个要验证的实例</span><br><span class="hljs-type">DataBinder</span> <span class="hljs-variable">dataBinder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataBinder</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">105</span>,<span class="hljs-string">&quot;22&quot;</span>,<span class="hljs-string">&quot;22&quot;</span>));<br><span class="hljs-comment">// 绑定一个验证的规则</span><br>dataBinder.addValidators(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Validator</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(Class&amp;lt;?&amp;gt; clazz)</span> &#123;<br>        <span class="hljs-keyword">return</span> clazz == User.class;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validate</span><span class="hljs-params">(Object target, Errors errors)</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User)target;<br>        <span class="hljs-keyword">if</span> (user.getId() &amp;gt; <span class="hljs-number">100</span>)&#123;<br>            errors.rejectValue(<span class="hljs-string">&quot;id&quot;</span>,<span class="hljs-string">&quot;202&quot;</span>,<span class="hljs-string">&quot;值太大了&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;);<br><span class="hljs-comment">// 开始验证</span><br>dataBinder.validate();<br><span class="hljs-comment">// 获取验证的结果</span><br><span class="hljs-type">BindingResult</span> <span class="hljs-variable">bindingResult</span> <span class="hljs-operator">=</span> dataBinder.getBindingResult();<br>List&amp;lt;ObjectError&amp;gt; allErrors = bindingResult.getAllErrors();<br><span class="hljs-keyword">for</span> (ObjectError allError : allErrors) &#123;<br>    System.out.println(allError);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第五章-spring表达式语言-spel" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第五章-spring表达式语言-spel">#</a> 第五章：Spring表达式语言（SpEL）</h2><h3 id="一、简介" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、简介">#</a> 一、简介</h3><p>本节介绍【SpEL接口及其表达式语言】的简单使用。 下面的代码引入了SpEL API来计算字符串字面表达式' Hello World '。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br><span class="hljs-type">Expression</span> <span class="hljs-variable">exp</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;&#x27;Hello World&#x27;&quot;</span>); <br><span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> (String) exp.getValue();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>消息变量的值是“Hello World”。</p><p>【ExpressionParser】接口【负责解析表达式字符串】。 在前面的示例中，表达式字符串是由单引号表示的字符串字面量。 【Expression】接口负责计算前面定义的表达式字符串。 当调用<code>parser </code>时，可以抛出<code>ParseException</code>和<code>EvaluationException</code>两个异常。</p><p>【Expression】接口负责【计算前面定义的表达式字符串】。 SpEL支持广泛的特性，例如调用方法、访问属性和调用构造函数。</p><blockquote><p>在下面的方法调用示例中，我们甚至可以在字符串字面量上调用【concat】方法：</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br><span class="hljs-type">Expression</span> <span class="hljs-variable">exp</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;&#x27;Hello World&#x27;.concat(&#x27;!&#x27;)&quot;</span>); <br><span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> (String) exp.getValue();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>' message '的值现在是'Hello World!'。</p><blockquote><p>下面的例子调用了' String '属性【bytes】:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br><br><span class="hljs-comment">// invokes &#x27;getBytes()&#x27;</span><br><span class="hljs-type">Expression</span> <span class="hljs-variable">exp</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;&#x27;Hello World&#x27;.bytes&quot;</span>); <br><span class="hljs-type">byte</span>[] bytes = (<span class="hljs-type">byte</span>[]) exp.getValue();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这一行将字面值转换为字节数组。</p><blockquote><p>SpEL还通过使用标准点表示法（如' prop1.prop2.prop3 '）和相应的属性值设置来支持嵌套属性。 也可以访问公共字段。</p></blockquote><p>下面的例子展示了如何使用点表示法来获取文字的长度:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br><br><span class="hljs-comment">// invokes &#x27;getBytes().length&#x27;</span><br><span class="hljs-type">Expression</span> <span class="hljs-variable">exp</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;&#x27;Hello World&#x27;.bytes.length&quot;</span>); <br><span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> (Integer) exp.getValue();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>还可以调用String的构造函数而不是使用字符串字面值，如下例所示:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br><span class="hljs-type">Expression</span> <span class="hljs-variable">exp</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;new String(&#x27;hello world&#x27;).toUpperCase()&quot;</span>); <br><span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> exp.getValue(String.class);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从字面量构造一个新的' String '，并使其为大写。</p><blockquote><p>SpEL更常见的用法是提供一个针对特定对象实例（称为根对象）求值的表达式字符串。 下面的例子展示了如何从' Inventor '类的实例中检索' name '属性:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Create and set a calendar</span><br><span class="hljs-type">GregorianCalendar</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GregorianCalendar</span>();<br>c.set(<span class="hljs-number">1856</span>， <span class="hljs-number">7</span>， <span class="hljs-number">9</span>);<br><br><span class="hljs-comment">// The constructor arguments are name， birthday， and nationality.</span><br><span class="hljs-type">Inventor</span> <span class="hljs-variable">tesla</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Inventor</span>(<span class="hljs-string">&quot;Nikola Tesla&quot;</span>， c.getTime()， <span class="hljs-string">&quot;Serbian&quot;</span>);<br><br><span class="hljs-type">ExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br><br><span class="hljs-type">Expression</span> <span class="hljs-variable">exp</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;name&quot;</span>); <span class="hljs-comment">// Parse name as an expression</span><br><span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (String) exp.getValue(tesla);<br><span class="hljs-comment">// name == &quot;Nikola Tesla&quot;</span><br><span class="hljs-comment">// 这个表达式在比较连个名字是不是’Nikola Tesla‘</span><br>exp = parser.parseExpression(<span class="hljs-string">&quot;name == &#x27;Nikola Tesla&#x27;&quot;</span>);<br><span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> exp.getValue(tesla， Boolean.class);<br><span class="hljs-comment">// result == true</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二-、-bean-定义中的表达式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二-、-bean-定义中的表达式">#</a> 二 、 Bean 定义中的表达式</h3><p>您可以使用SpEL表达式和基于xml或基于注解的配置元数据来定义【BeanDefinition】实例。 在这两种情况下，定义表达式的语法形式都是<code>#&#123;&lt;expression string&gt;&#125;</code>。</p><h4 id="_1、xml配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、xml配置">#</a> 1、XML配置</h4><p>属性或构造函数参数值可以通过使用表达式设置，如下例所示:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;numberGuess&quot; class=&quot;org.spring.samples.NumberGuess&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;randomNumber&quot; value=&quot;#&#123; T(java.lang.Math).random() * 100.0 &#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- other properties --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>应用程序上下文中的所有bean都可以作为【具有公共bean名称】的预定义【变量】使用。 这包括用于访问运行时环境的标准上下文bean，如【environment】(类型为' org.springframework.core.env.Environment ')，以及【systemProperties】和【systemEnvironment 】(类型为' Map&lt;String， Object&gt; ')。</p><p>下面的示例显示了对【systemProperties】 bean的SpEL变量访问:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;taxCalculator&quot; class=&quot;org.spring.samples.TaxCalculator&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;defaultLocale&quot; value=&quot;#&#123;systemProperties[&#x27;user.region&#x27;] &#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- other properties --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意，这里不需要在预定义变量前加上' # '符号。</p><p>您还可以通过名称引用其他bean属性，如下例所示:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;numberGuess&quot; class=&quot;org.spring.samples.NumberGuess&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;randomNumber&quot; value=&quot;#&#123; T(java.lang.Math).random() * 100.0 &#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- other properties --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;shapeGuess&quot; class=&quot;org.spring.samples.ShapeGuess&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;initialShapeSeed&quot; value=&quot;#&#123; numberGuess.randomNumber &#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- other properties --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、注解配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、注解配置">#</a> 2、注解配置</h4><p>要指定默认值，可以在字段、方法和方法或构造函数参数上放置“@Value”注解。</p><p>设置字段的默认值的示例如下:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FieldValueTestBean</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String defaultLocale;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDefaultLocale</span><span class="hljs-params">(String defaultLocale)</span> &#123;<br>        <span class="hljs-built_in">this</span>.defaultLocale = defaultLocale;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDefaultLocale</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.defaultLocale;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面的例子展示了一个等价的属性setter方法:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PropertyValueTestBean</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String defaultLocale;<br><br>    <span class="hljs-meta">@Value(&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDefaultLocale</span><span class="hljs-params">(String defaultLocale)</span> &#123;<br>        <span class="hljs-built_in">this</span>.defaultLocale = defaultLocale;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDefaultLocale</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.defaultLocale;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>自动连接的方法和构造函数也可以使用' @Value '注解，如下面的例子所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br><br>    <span class="hljs-keyword">private</span> MovieFinder movieFinder;<br>    <span class="hljs-keyword">private</span> String defaultLocale;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(MovieFinder movieFinder，</span><br><span class="hljs-params">            <span class="hljs-meta">@Value(&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;)</span> String defaultLocale)</span> &#123;<br>        <span class="hljs-built_in">this</span>.movieFinder = movieFinder;<br>        <span class="hljs-built_in">this</span>.defaultLocale = defaultLocale;<br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String defaultLocale;<br><br>    <span class="hljs-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MovieRecommender</span><span class="hljs-params">(CustomerPreferenceDao customerPreferenceDao，</span><br><span class="hljs-params">            <span class="hljs-meta">@Value(&quot;#&#123;systemProperties[&#x27;user.country&#x27;]&#125;&quot;)</span> String defaultLocale)</span> &#123;<br>        <span class="hljs-built_in">this</span>.customerPreferenceDao = customerPreferenceDao;<br>        <span class="hljs-built_in">this</span>.defaultLocale = defaultLocale;<br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="三、语法参考-不需要记忆啊" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、语法参考-不需要记忆啊">#</a> 三、语法参考（不需要记忆啊）</h3><p>本节描述Spring表达式语言的工作原理。 它涵盖以下主题:</p><h4 id="_1、-文字表达方式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、-文字表达方式">#</a> 1、 文字表达方式</h4><p>支持的文字表达式类型有字符串、数字值(int、real、hex)、布尔值和空值。 字符串由单引号分隔。 若要将单引号本身放入字符串中，请使用两个单引号字符。</p><p>下面的例子显示了文字的简单用法。 通常，它们不会像这样单独使用，而是作为更复杂表达式的一部分使用——例如，在逻辑比较运算符的一侧使用文字。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br><br><span class="hljs-comment">// evals to &quot;Hello World&quot;</span><br><span class="hljs-type">String</span> <span class="hljs-variable">helloWorld</span> <span class="hljs-operator">=</span> (String) parser.parseExpression(<span class="hljs-string">&quot;&#x27;Hello World&#x27;&quot;</span>).getValue();<br><br><span class="hljs-type">double</span> <span class="hljs-variable">avogadrosNumber</span> <span class="hljs-operator">=</span> (Double) parser.parseExpression(<span class="hljs-string">&quot;6.0221415E+23&quot;</span>).getValue();<br><br><span class="hljs-comment">// evals to 2147483647</span><br><span class="hljs-type">int</span> <span class="hljs-variable">maxValue</span> <span class="hljs-operator">=</span> (Integer) parser.parseExpression(<span class="hljs-string">&quot;0x7FFFFFFF&quot;</span>).getValue();<br><br><span class="hljs-type">boolean</span> <span class="hljs-variable">trueValue</span> <span class="hljs-operator">=</span> (Boolean) parser.parseExpression(<span class="hljs-string">&quot;true&quot;</span>).getValue();<br><br><span class="hljs-type">Object</span> <span class="hljs-variable">nullValue</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;null&quot;</span>).getValue();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>数字支持使用负号、指数符号和小数点。 默认情况下，使用<code>Double.parseDouble()</code>解析实数。</p><h4 id="_2、-arrays-lists-maps" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-arrays-lists-maps">#</a> 2、 Arrays， Lists， Maps</h4><blockquote><p>使用句点来指示嵌套的属性值。</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// evals to 1856</span><br><span class="hljs-type">int</span> <span class="hljs-variable">year</span> <span class="hljs-operator">=</span> (Integer) parser.parseExpression(<span class="hljs-string">&quot;birthdate.year + 1900&quot;</span>).getValue(context);<br><br><span class="hljs-type">String</span> <span class="hljs-variable">city</span> <span class="hljs-operator">=</span> (String) parser.parseExpression(<span class="hljs-string">&quot;placeOfBirth.city&quot;</span>).getValue(context);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>More Actions允许属性名称的首字母不区分大小写。 因此，上面例子中的表达式可以写成“生日”。 “年+ 1900”和“出生地点”。 分别城”。 此外，可以通过方法调用访问属性——例如，' getPlaceOfBirth(). getcity() '而不是' placeOfBirth.city '。</p><blockquote><p>使用方括号表示法获取数组和列表的内容，示例如下:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br><span class="hljs-type">EvaluationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> SimpleEvaluationContext.forReadOnlyDataBinding().build();<br><br><span class="hljs-comment">// Inventions Array</span><br><br><span class="hljs-comment">// evaluates to &quot;Induction motor&quot;</span><br><span class="hljs-type">String</span> <span class="hljs-variable">invention</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;inventions[3]&quot;</span>).getValue(<br>        context,tesla,String.class);<br><br><span class="hljs-comment">// Members List</span><br><br><span class="hljs-comment">// evaluates to &quot;Nikola Tesla&quot;</span><br><span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;members[0].name&quot;</span>).getValue(<br>        context,ieee,String.class);<br><br><span class="hljs-comment">// List and Array navigation</span><br><span class="hljs-comment">// evaluates to &quot;Wireless communication&quot;</span><br><span class="hljs-type">String</span> <span class="hljs-variable">invention</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;members[0].inventions[6]&quot;</span>).getValue(<br>        context,ieee,String.class);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3、-内联列表" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、-内联列表">#</a> 3、 内联列表</h4><p>可以使用<code>&#123;&#125;</code>符号在表达式中直接表示列表。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// evaluates to a Java list containing the four numbers</span><br><span class="hljs-type">List</span> <span class="hljs-variable">numbers</span> <span class="hljs-operator">=</span> (List) parser.parseExpression(<span class="hljs-string">&quot;&#123;1，2，3，4&#125;&quot;</span>).getValue(context);<br><br><span class="hljs-type">List</span> <span class="hljs-variable">listOfLists</span> <span class="hljs-operator">=</span> (List) parser.parseExpression(<span class="hljs-string">&quot;&#123;&#123;&#x27;a&#x27;，&#x27;b&#x27;&#125;，&#123;&#x27;x&#x27;，&#x27;y&#x27;&#125;&#125;&quot;</span>).getValue(context);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>&#123;&#125;</code> 它本身就是一个空列表。 出于性能原因，如果列表本身完全由固定的字面值组成，则创建一个常量列表来表示表达式(而不是在每次求值时构建一个新列表)。</p><h4 id="_4、-内联映射" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、-内联映射">#</a> 4、 内联映射</h4><p>您还可以使用<code>&#123;key:value&#125;</code> 表示法在表达式中直接表示映射。 下面的例子展示了如何做到这一点:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// evaluates to a Java map containing the two entries</span><br><span class="hljs-type">Map</span> <span class="hljs-variable">inventorInfo</span> <span class="hljs-operator">=</span> (Map) parser.parseExpression(<span class="hljs-string">&quot;&#123;name:&#x27;Nikola&#x27;，dob:&#x27;10-July-1856&#x27;&#125;&quot;</span>).getValue(context);<br><br><span class="hljs-type">Map</span> <span class="hljs-variable">mapOfMaps</span> <span class="hljs-operator">=</span> (Map) parser.parseExpression(<span class="hljs-string">&quot;&#123;name:&#123;first:&#x27;Nikola&#x27;，last:&#x27;Tesla&#x27;&#125;，dob:&#123;day:10，month:&#x27;July&#x27;，year:1856&#125;&#125;&quot;</span>).getValue(context);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>&#123;:&#125;</code>它本身就是一个空映射。 出于性能原因，如果映射本身由固定的文字或其他嵌套的常量结构(列表或映射)组成，则创建一个常量映射来表示表达式(而不是在每次求值时构建一个新映射)。 map键的引用是可选的(除非键包含句号(' . '))。 上面的例子没有使用引号键。</p><h4 id="_5、-数组结构" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5、-数组结构">#</a> 5、 数组结构</h4><p>可以使用熟悉的Java语法构建数组，也可以提供一个初始化式，以便在构造时填充数组。 下面的例子展示了如何做到这一点:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span>[] numbers1 = (<span class="hljs-type">int</span>[]) parser.parseExpression(<span class="hljs-string">&quot;new int[4]&quot;</span>).getValue(context);<br><br><span class="hljs-comment">// Array with initializer</span><br><span class="hljs-type">int</span>[] numbers2 = (<span class="hljs-type">int</span>[]) parser.parseExpression(<span class="hljs-string">&quot;new int[]&#123;1，2，3&#125;&quot;</span>).getValue(context);<br><br><span class="hljs-comment">// Multi dimensional array</span><br><span class="hljs-type">int</span>[][] numbers3 = (<span class="hljs-type">int</span>[][]) parser.parseExpression(<span class="hljs-string">&quot;new int[4][5]&quot;</span>).getValue(context);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You cannot currently supply an initializer when you construct a multi-dimensional array.</p><h4 id="_6、-方法调用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6、-方法调用">#</a> 6、 方法调用</h4><p>您可以使用典型的Java编程语法来调用方法。 您还可以在文字上调用方法。 也支持变量参数。 下面的例子展示了如何调用方法:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// string literal， evaluates to &quot;bc&quot;</span><br><span class="hljs-type">String</span> <span class="hljs-variable">bc</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;&#x27;abc&#x27;.substring(1,3)&quot;</span>).getValue(String.class);<br><br><span class="hljs-comment">// evaluates to true</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">isMember</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;isMember(&#x27;Mihajlo Pupin&#x27;)&quot;</span>).getValue(<br>        societyContext， Boolean.class);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7、-运算符" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_7、-运算符">#</a> 7、 运算符</h4><p>Spring表达式语言支持以下类型的操作符:</p><ul><li><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-operators-relational" rel="noopener noreferrer" target="_blank">关系运算符<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-operators-logical" rel="noopener noreferrer" target="_blank">逻辑运算符<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-operators-mathematical" rel="noopener noreferrer" target="_blank">数学运算符<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-assignment" rel="noopener noreferrer" target="_blank">赋值运算符<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><blockquote><p>关系运算符</p></blockquote><p>使用标准操作符表示法支持关系操作符(等于、不等于、小于、小于或等于、大于和大于或等于)。 下面的例子展示了一些操作符示例:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// evaluates to true</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">trueValue</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;2 == 2&quot;</span>).getValue(Boolean.class);<br><br><span class="hljs-comment">// evaluates to false</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">falseValue</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;2 &amp;lt; -5.0&quot;</span>).getValue(Boolean.class);<br><br><span class="hljs-comment">// evaluates to true</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">trueValue</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;&#x27;black&#x27; &amp;lt; &#x27;block&#x27;&quot;</span>).getValue(Boolean.class);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>除了标准的关系操作符外，SpEL还支持<code>instanceof</code>和基于正则表达式的<code>matches</code>操作符。 下面的例子展示了两者的例子:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// evaluates to false</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">falseValue</span> <span class="hljs-operator">=</span> parser.parseExpression(<br>        <span class="hljs-string">&quot;&#x27;xyz&#x27; instanceof T(Integer)&quot;</span>).getValue(Boolean.class);<br><br><span class="hljs-comment">// evaluates to true</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">trueValue</span> <span class="hljs-operator">=</span> parser.parseExpression(<br>        <span class="hljs-string">&quot;&#x27;5.00&#x27; matches &#x27;^-?\\d+(\\.\\d&#123;2&#125;)?$&#x27;&quot;</span>).getValue(Boolean.class);<br><br><span class="hljs-comment">// evaluates to false</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">falseValue</span> <span class="hljs-operator">=</span> parser.parseExpression(<br>        <span class="hljs-string">&quot;&#x27;5.0067&#x27; matches &#x27;^-?\\d+(\\.\\d&#123;2&#125;)?$&#x27;&quot;</span>).getValue(Boolean.class);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每个符号运算符也可以指定为纯字母等效符。 这避免了所使用的符号对嵌入表达式的文档类型(例如XML文档)具有特殊意义的问题。 对应文本为:</p><ul><li><code>lt</code> (<code>&lt;</code>)</li><li><code>gt</code> (<code>&gt;</code>)</li><li><code>le</code> (<code>&lt;=</code>)</li><li><code>ge</code> (<code>&gt;=</code>)</li><li><code>eq</code> (<code>==</code>)</li><li><code>ne</code> (<code>!=</code>)</li><li><code>div</code> (<code>/</code>)</li><li><code>mod</code> (<code>%</code>)</li><li><code>not</code> (<code>!</code>).</li></ul><p>所有的文本操作符都是不区分大小写的。</p><blockquote><p>逻辑运算符</p></blockquote><p>SpEL支持以下逻辑操作符:</p><ul><li><code>and</code> (<code>&amp;&amp;</code>)</li><li><code>or</code> (<code>||</code>)</li><li><code>not</code> (<code>!</code>)</li></ul><p>下面的示例演示如何使用逻辑运算符:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// -- AND --</span><br><br><span class="hljs-comment">// evaluates to false</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">falseValue</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;true and false&quot;</span>).getValue(Boolean.class);<br><br><span class="hljs-comment">// evaluates to true</span><br><span class="hljs-type">String</span> <span class="hljs-variable">expression</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;isMember(&#x27;Nikola Tesla&#x27;) and isMember(&#x27;Mihajlo Pupin&#x27;)&quot;</span>;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">trueValue</span> <span class="hljs-operator">=</span> parser.parseExpression(expression).getValue(societyContext， Boolean.class);<br><br><span class="hljs-comment">// -- OR --</span><br><br><span class="hljs-comment">// evaluates to true</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">trueValue</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;true or false&quot;</span>).getValue(Boolean.class);<br><br><span class="hljs-comment">// evaluates to true</span><br><span class="hljs-type">String</span> <span class="hljs-variable">expression</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;isMember(&#x27;Nikola Tesla&#x27;) or isMember(&#x27;Albert Einstein&#x27;)&quot;</span>;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">trueValue</span> <span class="hljs-operator">=</span> parser.parseExpression(expression).getValue(societyContext， Boolean.class);<br><br><span class="hljs-comment">// -- NOT --</span><br><br><span class="hljs-comment">// evaluates to false</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">falseValue</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;!true&quot;</span>).getValue(Boolean.class);<br><br><span class="hljs-comment">// -- AND and NOT --</span><br><span class="hljs-type">String</span> <span class="hljs-variable">expression</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;isMember(&#x27;Nikola Tesla&#x27;) and !isMember(&#x27;Mihajlo Pupin&#x27;)&quot;</span>;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">falseValue</span> <span class="hljs-operator">=</span> parser.parseExpression(expression).getValue(societyContext， Boolean.class);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>数学运算符</p></blockquote><p>你可以在数字和字符串上使用加法运算符(<code>+</code>)。 您可以只在数字上使用减法(<code>-</code>)、乘法(<code>*</code>)和除法(<code>/</code>)操作符。 您还可以对数字使用模(<code>%</code>)和指数幂(<code>^</code>)运算符。 执行标准操作符优先级。 下面的例子展示了使用中的数学运算符:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Addition</span><br><span class="hljs-type">int</span> <span class="hljs-variable">two</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;1 + 1&quot;</span>).getValue(Integer.class);  <span class="hljs-comment">// 2</span><br><br><span class="hljs-type">String</span> <span class="hljs-variable">testString</span> <span class="hljs-operator">=</span> parser.parseExpression(<br>        <span class="hljs-string">&quot;&#x27;test&#x27; + &#x27; &#x27; + &#x27;string&#x27;&quot;</span>).getValue(String.class);  <span class="hljs-comment">// &#x27;test string&#x27;</span><br><br><span class="hljs-comment">// Subtraction</span><br><span class="hljs-type">int</span> <span class="hljs-variable">four</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;1 - -3&quot;</span>).getValue(Integer.class);  <span class="hljs-comment">// 4</span><br><br><span class="hljs-type">double</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;1000.00 - 1e4&quot;</span>).getValue(Double.class);  <span class="hljs-comment">// -9000</span><br><br><span class="hljs-comment">// Multiplication</span><br><span class="hljs-type">int</span> <span class="hljs-variable">six</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;-2 * -3&quot;</span>).getValue(Integer.class);  <span class="hljs-comment">// 6</span><br><br><span class="hljs-type">double</span> <span class="hljs-variable">twentyFour</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;2.0 * 3e0 * 4&quot;</span>).getValue(Double.class);  <span class="hljs-comment">// 24.0</span><br><br><span class="hljs-comment">// Division</span><br><span class="hljs-type">int</span> <span class="hljs-variable">minusTwo</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;6 / -3&quot;</span>).getValue(Integer.class);  <span class="hljs-comment">// -2</span><br><br><span class="hljs-type">double</span> <span class="hljs-variable">one</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;8.0 / 4e0 / 2&quot;</span>).getValue(Double.class);  <span class="hljs-comment">// 1.0</span><br><br><span class="hljs-comment">// Modulus</span><br><span class="hljs-type">int</span> <span class="hljs-variable">three</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;7 % 4&quot;</span>).getValue(Integer.class);  <span class="hljs-comment">// 3</span><br><br><span class="hljs-type">int</span> <span class="hljs-variable">one</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;8 / 5 % 2&quot;</span>).getValue(Integer.class);  <span class="hljs-comment">// 1</span><br><br><span class="hljs-comment">// Operator precedence</span><br><span class="hljs-type">int</span> <span class="hljs-variable">minusTwentyOne</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;1+2-3*8&quot;</span>).getValue(Integer.class);  <span class="hljs-comment">// -21</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>赋值运算</p></blockquote><p>要设置属性，请使用赋值操作符(<code>=</code>)。 这通常是在调用 <code>setValue</code>中完成的，但也可以在调用<code>getValue</code>中完成。 下面的例子展示了使用赋值操作符的两种方法:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Inventor</span> <span class="hljs-variable">inventor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Inventor</span>();<br><span class="hljs-type">EvaluationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> SimpleEvaluationContext.forReadWriteDataBinding().build();<br><br>parser.parseExpression(<span class="hljs-string">&quot;name&quot;</span>).setValue(context， inventor， <span class="hljs-string">&quot;Aleksandar Seovic&quot;</span>);<br><br><span class="hljs-comment">// alternatively</span><br><span class="hljs-type">String</span> <span class="hljs-variable">aleks</span> <span class="hljs-operator">=</span> parser.parseExpression(<br>        <span class="hljs-string">&quot;name = &#x27;Aleksandar Seovic&#x27;&quot;</span>).getValue(context， inventor， String.class);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8、类型" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_8、类型">#</a> 8、类型</h4><p>你可以使用特殊的' T '操作符来指定一个' java.lang.Class '(类型)的实例。 静态方法也可以通过使用此操作符来调用。 ' StandardTypeLocator '(它可以被替换)是建立在对' java。 朗的包。 这意味着' T() '引用' java。 Lang '包不需要完全限定，但所有其他类型引用必须是完全限定的。 下面的示例演示如何使用“T”操作符:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">dateClass</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;T(java.util.Date)&quot;</span>).getValue(Class.class);<br><br><span class="hljs-type">Class</span> <span class="hljs-variable">stringClass</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;T(String)&quot;</span>).getValue(Class.class);<br><br><span class="hljs-type">boolean</span> <span class="hljs-variable">trueValue</span> <span class="hljs-operator">=</span> parser.parseExpression(<br>        <span class="hljs-string">&quot;T(java.math.RoundingMode).CEILING &amp;lt; T(java.math.RoundingMode).FLOOR&quot;</span>)<br>        .getValue(Boolean.class);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9、构造函数" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_9、构造函数">#</a> 9、构造函数</h4><p>你可以使用<code>new</code>操作符来调用构造函数。 你应该对所有类型使用完全限定类名，除了那些位于 <code>java. lang</code> package ( <code>Integer</code> ， <code>Float</code> ， <code>String</code> ，等等)。 下面的例子展示了如何使用<code>new</code>操作符来调用构造函数:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Inventor</span> <span class="hljs-variable">einstein</span> <span class="hljs-operator">=</span> p.parseExpression(<br>        <span class="hljs-string">&quot;new org.spring.samples.spel.inventor.Inventor(&#x27;Albert Einstein&#x27;， &#x27;German&#x27;)&quot;</span>)<br>        .getValue(Inventor.class);<br><br><span class="hljs-comment">// create new Inventor instance within the add() method of List</span><br>p.parseExpression(<br>        <span class="hljs-string">&quot;Members.add(new org.spring.samples.spel.inventor.Inventor(</span><br><span class="hljs-string">            &#x27;Albert Einstein&#x27;， &#x27;German&#x27;))&quot;</span>).getValue(societyContext);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_10、-变量" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_10、-变量">#</a> 10、 变量</h4><p>可以使用 <code>#variableName</code> 语法引用表达式中的变量。 变量是通过在<code>EvaluationContext</code>实现上使用<code>setVariable</code>方法设置的。</p><p>下面的例子展示了如何使用变量。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Inventor</span> <span class="hljs-variable">tesla</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Inventor</span>(<span class="hljs-string">&quot;Nikola Tesla&quot;</span>,<span class="hljs-string">&quot;Serbian&quot;</span>);<br><br><span class="hljs-comment">// 我们必须创建一个上下文，在上下文中定义变量</span><br><span class="hljs-type">EvaluationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> SimpleEvaluationContext.forReadWriteDataBinding().build();<br>context.setVariable(<span class="hljs-string">&quot;newName&quot;</span>,<span class="hljs-string">&quot;Mike Tesla&quot;</span>);<br><br>parser.parseExpression(<span class="hljs-string">&quot;name = #newName&quot;</span>).getValue(context,tesla);<br>System.out.println(tesla.getName())  <span class="hljs-comment">// &quot;Mike Tesla&quot;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_11、-bean-的引用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_11、-bean-的引用">#</a> 11、 Bean 的引用</h4><p>如果计算上下文已经配置了bean解析器，那么您可以使用<code>@</code>符号从表达式中查找bean。</p><p>下面的例子展示了如何做到这一点:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 定义一个容器</span><br><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(A.class);<br><span class="hljs-comment">// 创建一个解析器</span><br><span class="hljs-type">ExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br><span class="hljs-comment">// 定义一个表达式上下文</span><br><span class="hljs-type">StandardEvaluationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StandardEvaluationContext</span>();<br><span class="hljs-comment">// 这个地方规定了我要从哪里查找bean，我们的具体实现是BeanFactoryResolver，代表了从容器中获取</span><br>context.setBeanResolver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanFactoryResolver</span>(ctx));<br><span class="hljs-type">Object</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;@messageListener&quot;</span>).getValue(context);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要访问FactoryBean本身，应该在bean名称前加上' &amp; '符号。 下面的例子展示了如何做到这一点:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br><span class="hljs-type">StandardEvaluationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StandardEvaluationContext</span>();<br>context.setBeanResolver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyBeanResolver</span>());<br><br><span class="hljs-comment">// This will end up calling resolve(context，&quot;&amp;amp;foo&quot;) on MyBeanResolver during evaluation</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;&amp;amp;foo&quot;</span>).getValue(context);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_12、-三元运算符-if-then-else" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_12、-三元运算符-if-then-else">#</a> 12、 三元运算符 (If-Then-Else)</h4><p>可以使用三元运算符在表达式中执行if-then-else条件逻辑。 下面的例子显示了一个最小的示例:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">falseString</span> <span class="hljs-operator">=</span> parser.parseExpression(<br>        <span class="hljs-string">&quot;false ? &#x27;trueExp&#x27; : &#x27;falseExp&#x27;&quot;</span>).getValue(String.class);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>在这种情况下，布尔值<code>false</code>导致返回字符串值<code>'false exp '</code> 。 下面是一个更现实的例子:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Expression</span> <span class="hljs-variable">exp</span> <span class="hljs-operator">=</span> parser.parseExpression(<span class="hljs-string">&quot;&#x27;Hello World&#x27;.bytes.length gt 2 ? 2:3&quot;</span>)<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><h2 id="第六章-spring面向切面编程" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第六章-spring面向切面编程">#</a> 第六章 Spring面向切面编程</h2><p>我们会有这样的需求：</p><p>批量给所有的service层的方法实现上统一加上事务，而不是一个个加：</p><figure><img class="lazy" alt="image-20211206130611410" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206130611410-3b9ed4d4.png" tabindex="0"/><figcaption>image-20211206130611410</figcaption></figure><p><strong>面向切面编程的本质</strong>很像我们web阶段学习的过滤器，本质是找到一批具有相同特征（在相同包下，拥有相同的注解）的类，对其进行批量的动态代理（对每一个bean的构建进行拦截）。</p><p>其实我们可以通过BeanPostProcessor做一个简单的实现，而事实上，本章学习的AOP也是通过一个特殊的BeanPostProcessor实现的。BeanPostProcessor本身就可以在容器启动的时候拦截已经构造完成的bean并对它进行处理。</p><h3 id="一、-aop-概述" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、-aop-概述">#</a> 一、 AOP 概述</h3><ul><li><p>面向切面编程(AOP)通过提供另一种考虑程序结构的方法对面向对象编程(OOP)进行了补充。</p></li><li><p>OOP中模块化的关键单元是类，而AOP中模块化的关键单元是aspect（切面）。</p></li><li><p>Spring的关键组件之一是AOP框架。 虽然Spring IoC容器不依赖于AOP(这意味着如果您不想使用AOP就不需要)，但AOP对Spring IoC进行了补充，提供了一个非常强大的企业级解决方案。</p></li></ul><blockquote><p>这里有几个名词需要了解一下：</p></blockquote><ol><li>aop alliance：是AOP联盟，该组织定义了很多针对面向切面的接口api，通常Spring等其它具备动态织入功能的框架依赖此包。</li><li>AspectJ：AOP虽然是方法论，但就好像OOP中的Java一样，一些先行者也开发了一套语言来支持AOP。目前用得比较火的就是AspectJ语言了，它是一种几乎和Java完全一样的语言，而且完全兼容Java。当然spring也有独立的AOP的实现。</li></ol><blockquote><p>让我们从定义一些核心的AOP概念和术语开始：</p></blockquote><ol><li>Aspect（切面）：一个关注点的模块化，这个关注点可能会横切多个对象。事务管理是J2EE应用中一个关于横切关注点的很好的例子。</li><li>Join point（连接点 ）：在程序执行过程中某个特定的点，比如某方法调用的时候或者处理异常的时候。</li><li>Advice（通知）：在切面的某个特定的连接点（Joinpoint）上执行的动作。通知有各种类型，其中包括“around”、“before”和“after”等通知。 通知的类型将在后面部分进行讨论。许多AOP框架，包括Spring，都是以拦截器做通知模型， 并维护一个以连接点为中心的拦截器链。</li><li>Pointcut（切入点 ）：匹配连接点（Joinpoint）的断言。通知和一个【切入点表】达式关联，并在满足这个切入点的连接点上运行。 【切入点表达式如何和连接点匹配】是AOP的核心：Spring缺省使用AspectJ切入点语法。</li><li>Introduction（引入）： Spring允许引入新的接口（以及一个对应的实现）到任何被代理的对象。例如，你可以使用一个引入来使bean实现 IsModified 接口，以便简化缓存机制。</li><li>Target object（目标对象）：被一个或者多个切面（aspect）所通知（advise）的对象。也有人把它叫做 被通知（advised） 对象。 既然Spring AOP是通过运行时代理实现的，这个对象永远是一个 被代理（proxied） 对象。</li><li>AOP代理 AOP proxy： 在Spring中，AOP代理可以是JDK动态代理或者CGLIB代理。</li><li>Weaving（织入）：把切面（aspect）连接到其它的应用程序类型或者对象上，并创建一个被通知（advised）的对象，这个过程叫织入。 这些可以在编译时（例如使用AspectJ编译器），类加载时和运行时完成。 Spring和其他纯Java AOP框架一样，在运行时完成织入。</li></ol><blockquote><p>Spring AOP包括以下类型的通知:</p></blockquote><ul><li>Before advice :在连接点之前运行的通知，但不能阻止执行流继续执行到连接点(除非它抛出异常)。</li><li>After returning advice :在连接点正常完成后运行的通知(例如，如果方法返回而不引发异常)。</li><li>After throwing advice:在方法通过抛出异常退出时运行的通知。</li><li>After (finally) advice:不管连接点以何种方式退出(正常或异常返回)，都要运行的通知。</li><li>Around advice:围绕连接点(如方法调用)的通知。 这是最有力的建议。 Around通知可以在方法调用前后执行自定义行为。 它还负责选择是继续到连接点，还是通过返回自己的返回值或抛出异常来简化被通知的方法执行。</li></ul><p>更多的内容会在后边的学习中进一步深入。</p><h3 id="二、spring-aop能力和目标" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、spring-aop能力和目标">#</a> 二、Spring AOP能力和目标</h3><ul><li><p>Spring AOP是用纯Java实现的。 不需要特殊的编译过程。</p></li><li><p>Spring AOP目前只支持【方法执行连接点】(在Spring bean上的方法上执行通知)。 如果需要通知字段访问和更新连接点，可以考虑使用AspectJ之类的语言。</p></li><li><p>Spring AOP的AOP方法不同于大多数其他AOP框架。 目的不是提供最完整的AOP实现(尽管Spring AOP很有能力)。 相反，其目的是提供AOP实现和Spring IoC之间的紧密集成，以帮助解决企业应用程序中的常见问题。</p></li></ul><blockquote><p>Spring和AspectJ</p></blockquote><p>Spring框架的AOP功能通常与Spring IoC容器一起使用。 切面是通过使用普通beanDifination语法配置的。 使用Spring AOP不能轻松或有效地完成一些事情，比如通知非常细粒度的对象（通常是域对象）。 AspectJ是这种情况下的最佳选择。 然而，我们的经验是，Spring AOP为企业Java应用程序中的大多数问题提供了一个很好的解决方案。</p><p>Spring AOP从不与AspectJ竞争，以提供全面的AOP解决方案。 我们相信基于代理的框架（如Spring AOP）和成熟的框架（如AspectJ）都是有价值的，它们是互补的，而不是相互竞争的。 Spring无缝地将Spring AOP和IoC与AspectJ集成在一起，以支持在一致的基于Spring的应用程序体系结构中使用AOP。 这种集成不会影响Spring AOP API或AOP Alliance API， Spring AOP保持向后兼容。</p><h3 id="三、aop代理" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、aop代理">#</a> 三、AOP代理</h3><p>Spring AOP默认为AOP代理使用标准的JDK动态代理， 这允许代理任何接口（或接口集）。</p><p>Spring AOP也可以使用CGLIB代理。 缺省情况下，如果业务对象没有实现接口，则使用CGLIB。 由于编写接口是很好的实践，因此业务类通常实现一个或多个业务接口是可能的。</p><h3 id="四、-aspectj风格的支持" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、-aspectj风格的支持">#</a> 四、@AspectJ风格的支持</h3><p>@AspectJ是将【切面】声明为带有注解的常规Java类的一种风格。 @AspectJ风格是由<a href="https://www.eclipse.org/aspectj" rel="noopener noreferrer" target="_blank">AspectJ项目<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>作为AspectJ 5发行版的一部分引入的。 Spring与AspectJ 5有相同的注解， 但是，AOP运行时仍然是纯Spring AOP，并且不依赖于AspectJ编译器或编织器。</p><h4 id="_1、对于-aspectj的支持" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、对于-aspectj的支持">#</a> 1、对于 @AspectJ的支持</h4><p>要在Spring配置中使用@AspectJ注解，您需要启用Spring支持，以便基于@AspectJ注解配置Spring AOP，如果Spring确定一个bean被一个或多个切面通知，它将自动为该bean生成一个代理，以拦截方法调用，并确保通知在需要时运行。</p><p>@AspectJ支持可以通过XML或java的配置来启用。 在这两种情况下，你还需要确保【AspectJ的' aspectjweaver.jar '库】在你的应用程序的类路径上(1.8或更高版本)。 这个库可以在AspectJ发行版的' lib '目录中或Maven中央存储库中获得。</p><blockquote><p>使用Java配置启用@AspectJ支持</p></blockquote><p>要使用Java的【@Configuration】启用@AspectJ支持，请添加【@EnableAspectJAutoProxy】注解，如下面的示例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableAspectJAutoProxy</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>使用XML配置启用@AspectJ支持，请使用<code>&lt;aop:aspectj-autoproxy/&gt;</code>元素，如下例所示:</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;<br>    xsi:schemaLocation=&quot;<br>        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd<br>        http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- bean definitions here --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>aop:aspectj-autoproxy/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然，我们需要引入aop的命名空间。</p><h4 id="_2、-声明一个切面" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-声明一个切面">#</a> 2、 声明一个切面</h4><p>启用@AspectJ支持后，在应用程序上下文中定义的任何带有@AspectJ注解类的bean都会被Spring自动检测并用于配置Spring AOP。</p><p>两个示例中的第一个展示了应用程序上下文中的常规beanDifination，它指向一个具有“@Aspect”注解的bean类:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;myAspect&quot; class=&quot;org.xyz.NotVeryUsefulAspect&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- configure properties of the aspect here --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>两个示例中的第二个展示了' NotVeryUsefulAspect '类定义，它是用' org.aspectj.lang.annotation '标注的。 方面的注解;</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.xyz;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotVeryUsefulAspect</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用“@Aspect”标注的类可以有方法和字段，与任何其他类一样。 它们还可以包含切入点、通知和引入(类型间)声明。</p><p>通过组件扫描自动检测切面你可以在Spring XML配置中通过“@Configuration”类中的“@Bean”方法将切面类注册为常规bean，或者让Spring通过类路径扫描自动检测它们——就像任何其他Spring管理的bean一样。 但是，请注意，“@Aspect”注解不足以实现类路径中的自动检测。 为了达到这个目的，您需要添加一个单独的【@Component】注解。</p><p>在Spring AOP中，切面本身不能成为来自其他通知的目标。 类上的“@Aspect”注解将其标记为一个切面类，因此会将其排除在自动代理之外。</p><h4 id="_3、声明一个切入点" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、声明一个切入点">#</a> 3、声明一个切入点</h4><p>【切入点确定感兴趣的连接点】，从而使我们能够控制通知何时运行。</p><p>切入点声明由两部分组成：包含【名称和方法签名】，以及确定我们感兴趣的方法执行的【切入点表达式】。</p><p>怎么确定一个方法：public void com.ydlclass.service.impl.*(..)</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Pointcut(&quot;execution(* transfer(..))&quot;)</span> <span class="hljs-comment">// the pointcut expression</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">anyOldTransfer</span><span class="hljs-params">()</span> &#123;&#125; <span class="hljs-comment">// the pointcut signature</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>支持切入点指示器</p></blockquote><p>Spring AOP支持以下在切入点表达式中使用的AspectJ切入点指示器(PCD):</p><ul><li><code>execution</code>: （常用）用于匹配方法执行的连接点，这是在使用Spring AOP时使用的主要切入点指示符。（匹配方法）</li></ul><figure><img class="lazy" alt="image-20211206155835362" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206155835362-973942fb.png" tabindex="0"/><figcaption>image-20211206155835362</figcaption></figure><ul><li><code>within</code>: 用于匹配指定类型内的方法执行。（匹配整个类）</li></ul><figure><img class="lazy" alt="image-20211206160019905" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160019905-eba06d20.png" tabindex="0"/><figcaption>image-20211206160019905</figcaption></figure><ul><li><code>this</code>: 用于匹配当前【AOP代理对象】类型的执行方法；注意是AOP代理对象的类型匹配，这样就可能【包括引入接口】也进行类型匹配。（配置整个类）</li></ul><figure><img class="lazy" alt="image-20211206160040279" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160040279-4d86c19f.png" tabindex="0"/><figcaption>image-20211206160040279</figcaption></figure><ul><li><code>target</code>: 用于匹配当前目标对象类型的执行方法；注意是目标对象的类型匹配，这样就【不包括引入接口】也进行类型匹配。（配置整个类）</li></ul><figure><img class="lazy" alt="image-20211206160056790" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160056790-0c9563ec.png" tabindex="0"/><figcaption>image-20211206160056790</figcaption></figure><ul><li><code>args</code>: 限制匹配连接点(使用Spring AOP时的方法执行)，其中参数是给定类型的实例。 （参数类型匹配）</li></ul><figure><img class="lazy" alt="image-20211206160112474" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160112474-06016645.png" tabindex="0"/><figcaption>image-20211206160112474</figcaption></figure><ul><li><code>@target</code>: 用于匹配当前目标对象类型的执行方法，其中目标对象持有指定的注解 。（类上的注解）</li></ul><figure><img class="lazy" alt="image-20211206160242492" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160242492-70637337.png" tabindex="0"/><figcaption>image-20211206160242492</figcaption></figure><ul><li><code>@args</code>: 用于匹配当前执行的方法传入的参数持有指定注解的执行。（参数上的注解）</li></ul><figure><img class="lazy" alt="image-20211206160309143" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160309143-8a1c0052.png" tabindex="0"/><figcaption>image-20211206160309143</figcaption></figure><ul><li><code>@within</code>: 用于匹配所有持有指定注解类型内的方法。（类上的注解）</li></ul><figure><img class="lazy" alt="image-20211206160256390" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160256390-ff41f6f4.png" tabindex="0"/><figcaption>image-20211206160256390</figcaption></figure><ul><li><code>@annotation</code>: （常用）于匹配当前执行方法持有指定注解的方法。（方法上的注解）</li></ul><figure><img class="lazy" alt="image-20211206160329137" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160329137-8f97bcea.png" tabindex="0"/><figcaption>image-20211206160329137</figcaption></figure><p>bean：使用“bean(Bean id或名字通配符)”匹配特定名称的Bean对象的执行方法；Spring ASP扩展的，在AspectJ中无相应概念。</p><figure><img class="lazy" alt="image-20211206160712945" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211206160712945-4010a6b1.png" tabindex="0"/><figcaption>image-20211206160712945</figcaption></figure><blockquote><p>切入点表达式运算</p></blockquote><p>可以使用' &amp;&amp;' || '和' ! '组合切入点表达式。 您还可以通过名称引用切入点表达式。 下面的例子展示了三个切入点表达式:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Pointcut(&quot;execution(public * *(..))&quot;)</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">anyPublicOperation</span><span class="hljs-params">()</span> &#123;&#125; <br><br><span class="hljs-meta">@Pointcut(&quot;within(com.xyz.myapp.trading..*)&quot;)</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inTrading</span><span class="hljs-params">()</span> &#123;&#125; <br><br><span class="hljs-meta">@Pointcut(&quot;anyPublicOperation() &amp;amp;&amp;amp; inTrading()&quot;)</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tradingOperation</span><span class="hljs-params">()</span> &#123;&#125; <br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>共享公共切入点定义</p></blockquote><p>在使用企业应用程序时，开发人员经常希望从几个切面引用应用程序的模块和特定的操作集。 我们建议定义一个【CommonPointcut】切面来捕获通用的切入点表达式。 这样一个方面典型地类似于以下示例:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xyz.myapp;<br><br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Pointcut;<br><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonPointcuts</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * A join point is in the web layer if the method is defined</span><br><span class="hljs-comment">     * in a type in the com.xyz.myapp.web package or any sub-package</span><br><span class="hljs-comment">     * under that.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Pointcut(&quot;within(com.xyz.myapp.web..*)&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inWebLayer</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * A join point is in the service layer if the method is defined</span><br><span class="hljs-comment">     * in a type in the com.xyz.myapp.service package or any sub-package</span><br><span class="hljs-comment">     * under that.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Pointcut(&quot;within(com.xyz.myapp.service..*)&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inServiceLayer</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * A join point is in the data access layer if the method is defined</span><br><span class="hljs-comment">     * in a type in the com.xyz.myapp.dao package or any sub-package</span><br><span class="hljs-comment">     * under that.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Pointcut(&quot;within(com.xyz.myapp.dao..*)&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inDataAccessLayer</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * A business service is the execution of any method defined on a service</span><br><span class="hljs-comment">     * interface. This definition assumes that interfaces are placed in the</span><br><span class="hljs-comment">     * &quot;service&quot; package， and that implementation types are in sub-packages.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * If you group service interfaces by functional area (for example，</span><br><span class="hljs-comment">     * in packages com.xyz.myapp.abc.service and com.xyz.myapp.def.service) then</span><br><span class="hljs-comment">     * the pointcut expression &quot;execution(* com.xyz.myapp..service.*.*(..))&quot;</span><br><span class="hljs-comment">     * could be used instead.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * Alternatively， you can write the expression using the &#x27;bean&#x27;</span><br><span class="hljs-comment">     * PCD， like so &quot;bean(*Service)&quot;. (This assumes that you have</span><br><span class="hljs-comment">     * named your Spring service beans in a consistent fashion.)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Pointcut(&quot;execution(* com.xyz.myapp..service.*.*(..))&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">businessService</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * A data access operation is the execution of any method defined on a</span><br><span class="hljs-comment">     * dao interface. This definition assumes that interfaces are placed in the</span><br><span class="hljs-comment">     * &quot;dao&quot; package， and that implementation types are in sub-packages.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Pointcut(&quot;execution(* com.xyz.myapp.dao.*.*(..))&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dataAccessOperation</span><span class="hljs-params">()</span> &#123;&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>您可以在任何需要切入点表达式的地方引用在这样一个切面中定义的切入点。 例如，要使服务层成为事务性的，可以这样写:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>aop:config<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>aop:advisor<br>        pointcut=&quot;com.xyz.myapp.CommonPointcuts.businessService()&quot;<br>        advice-ref=&quot;tx-advice&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/aop:config<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>tx:advice id=&quot;tx-advice&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:attributes<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;*&quot; propagation=&quot;REQUIRED&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/tx:attributes<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/tx:advice<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4、-声明通知" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、-声明通知">#</a> 4、 声明通知</h4><p>通知与切入点表达式相关联，并在切入点匹配的方法执行之前、之后或前后运行。 切入点表达式可以是对指定切入点的【简单引用】，也可以是适当声明的切入点表达式。</p><h5 id="a、-before-advice-前置通知" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#a、-before-advice-前置通知">#</a> a、（Before advice）前置通知</h5><p>你可以使用【@Before】注解在方面中声明before通知:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Before;<br><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeforeExample</span> &#123;<br><br>    <span class="hljs-meta">@Before(&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAccessCheck</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果使用切入点表达式，可以将前面的示例重写为以下示例:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Before;<br><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeforeExample</span> &#123;<br><br>    <span class="hljs-meta">@Before(&quot;execution(* com.xyz.myapp.dao.*.*(..))&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAccessCheck</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="b、-after-returning-advice-返回通知" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#b、-after-returning-advice-返回通知">#</a> b、（After returning advice）返回通知</h5><p>当匹配的方法执行正常返回时，返回通知运行。 你可以通过使用【@AfterReturning】注解声明它:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.AfterReturning;<br><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterReturningExample</span> &#123;<br><br>    <span class="hljs-meta">@AfterReturning(&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAccessCheck</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有时，您需要在通知主体中访问返回的实际值。 你可以使用' @afterreturn '的形式绑定返回值以获得访问，如下例所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.AfterReturning;<br><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterReturningExample</span> &#123;<br><br>    <span class="hljs-meta">@AfterReturning(</span><br><span class="hljs-meta">        pointcut=&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation()&quot;，</span><br><span class="hljs-meta">        returning=&quot;retVal&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAccessCheck</span><span class="hljs-params">(Object retVal)</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><h5 id="c、-after-throwing-advice-抛出异常后通知" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#c、-after-throwing-advice-抛出异常后通知">#</a> c、（After throwing advice）抛出异常后通知</h5><p>抛出通知后，当匹配的方法执行通过抛出异常退出时运行。 你可以通过使用【 @AfterThrowing】注解来声明它，如下面的例子所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;<br><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterThrowingExample</span> &#123;<br><br>    <span class="hljs-meta">@AfterThrowing(&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doRecoveryActions</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通常，您如果希望通知仅在【抛出给定类型】的异常时运行，而且您还经常需要访问通知主体中抛出的异常。 你可以使用' thrown '属性来限制匹配（如果需要，则使用' Throwable '作为异常类型），并将抛出的异常绑定到一个advice参数。 下面的例子展示了如何做到这一点:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;<br><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterThrowingExample</span> &#123;<br><br>    <span class="hljs-meta">@AfterThrowing(</span><br><span class="hljs-meta">        pointcut=&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation()&quot;，</span><br><span class="hljs-meta">        throwing=&quot;ex&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doRecoveryActions</span><span class="hljs-params">(DataAccessException ex)</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【throwing】属性中使用的【名称必须与通知方法中的参数名称】相对应。 当一个方法执行通过抛出异常而退出时，异常将作为相应的参数值传递给advice方法。</p><h5 id="d、after-finally-最终通知" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#d、after-finally-最终通知">#</a> d、After (Finally) 最终通知</h5><p>After （finally）通知在匹配的方法执行退出时运行。 它是通过使用【@After 】注解声明的。 After advice必须准备好处理正常和异常返回条件，它通常用于释放资源以及类似的目的。 下面的例子展示了如何使用after finally通知:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.After;<br><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterFinallyExample</span> &#123;<br><br>    <span class="hljs-meta">@After(&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doReleaseLock</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更多值得注意的地方，AspectJ中的' @After '通知被定义为【after finally】，类似于try-catch语句中的finally块。 它将对任何结果，其中包括【正常返回】或【从连接点抛出异常】都会进行调用，而【 @ afterreturn】只适用于成功的正常返回。</p><h5 id="e、around通知" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#e、around通知">#</a> e、Around通知</h5><p>【Around advice】环绕匹配的方法执行。 它有机会在方法运行之前和之后进行工作，并确定方法何时、如何运行，甚至是否真正运行。 如果您需要在方法执行之前和之后以线程安全的方式共享状态（例如，启动和停止计时器），经常使用Around通知。 我们推荐，总是使用最弱的通知形式，以满足你的要求(也就是说，不要使用环绕通知，如果前置通知也可以完成需求)。</p><p>Around通知是通过使用【@Around】注解声明的。 advice方法的第一个参数必须是【ProceedingJoinPoint】类型。 在通知体中，在【ProceedingJoinPoint】上调用【proceed()】会导致底层方法运行。 【proceed】方法也可以传入【Object[] 】。 当方法执行时，数组中的值被用作方法执行的参数。</p><blockquote><p>下面的例子展示了如何使用around advice:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Around;<br><span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<br><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AroundExample</span> &#123;<br><br>    <span class="hljs-meta">@Around(&quot;com.xyz.myapp.CommonPointcuts.businessService()&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">doBasicProfiling</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-comment">// 我们可以在前边做一些工作，比如启动计时器</span><br><br>        <span class="hljs-comment">// 这里是真正的方法调用的地方</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">retVal</span> <span class="hljs-operator">=</span> pjp.proceed();<br>        <span class="hljs-comment">// 我们可以在后边做一些工作，比如停止计时器，搜集方法的执行时间</span><br>        <span class="hljs-keyword">return</span> retVal;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注</strong>：around通知返回的值是【方法调用者看到的返回值】。 例如，一个简单的缓存切面可以从缓存返回一个值(如果它有一个值)，如果没有，则调用' proceed() '。 注意，【proceed方法】你可以只调用一次，也可以调用多次，也可以根本不去调用， 这都是可以的。</p><h5 id="f、通知的参数" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#f、通知的参数">#</a> f、通知的参数</h5><p>Spring提供了完整类型的通知，这意味着您可以在【通知签名】中声明【所需的参数】(就像我们前面在返回和抛出示例中看到的那样)。</p><blockquote><p>访问当前 <code>JoinPoint</code></p></blockquote><p>任何通知方法都可以声明一个类型为【org.aspectj.lang.JoinPoint】的参数作为它的【第一个参数】（注意，around通知需要声明类型为' ProceedingJoinPoint ）的第一个参数，它是【oinPoint】的一个子类。 【JoinPoint】接口提供了许多有用的方法:</p><ul><li><code>getArgs()</code>: 返回方法参数。</li><li><code>getThis()</code>: 返回代理对象。</li><li><code>getTarget()</code>: 返回目标对象。</li><li><code>getSignature()</code>: 返回被通知的方法的签名。</li><li><code>toString()</code>: 打印被建议的方法的有用描述。</li></ul><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Before(&quot;beforePointcut()&quot;)</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeAdvice</span><span class="hljs-params">(JoinPoint jp)</span> <span class="hljs-keyword">throws</span> InvocationTargetException, IllegalAccessException &#123;<br>    <span class="hljs-type">MethodSignature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> (MethodSignature)jp.getSignature();<br>    <span class="hljs-comment">// 能拿到方法，能不能拿到方法的注解</span><br>    <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> signature.getMethod();<br>    <span class="hljs-comment">// 调用方法的过程</span><br>    method.invoke(jp.getTarget(), jp.getArgs());<br><br>    System.out.println(<span class="hljs-string">&quot;this is before advice&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img class="lazy" alt="image-20211207174813931" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211207174813931-9bb8faab.png" tabindex="0"/><figcaption>image-20211207174813931</figcaption></figure><blockquote><p>将参数传递给Advice</p></blockquote><p>我们已经看到了如何绑定【返回值或异常值】。 要使参数值对通知主体可用，可以使用【args 】的绑定形式。 如果在args表达式中使用【参数名】代替类型名，则在【调用通知】时将传递相应值作为参数值。</p><p>举个例子应该能更清楚地说明这一点：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">order</span><span class="hljs-params">(Integer money)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;这是order的方法&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;inner try&quot;</span>;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;finally&quot;</span>);<br>        <span class="hljs-comment">//return &quot;finally&quot;;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Before(&quot;execution(* com.ydlclass.service.impl.OrderService.*(..)) &amp;amp;&amp;amp; args(money,..)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateAccount</span><span class="hljs-params">(Integer money)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;before--------&quot;</span> + money);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>切入点表达式的' args(account，..) '部分有两个目的</p></blockquote><ul><li>首先，它限制只匹配哪些方法执行，其中方法接受至少一个参数，并且传递给该参数的参数是' Account '的一个实例。</li><li>其次，它通过' Account '参数使通知可以使用实际的' Account '对象。</li></ul><p>​ 另一种方式是【编写方法】声明一个切入点，该切入点在匹配连接点时“提供”‘Account’对象值，然后从通知中引用指定的切入点。 这看起来如下:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Pointcut(&quot;com.xyz.myapp.CommonPointcuts.dataAccessOperation() &amp;amp;&amp;amp; args(account，..)&quot;)</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accountDataAccessOperation</span><span class="hljs-params">(Account account)</span> &#123;&#125;<br><br><span class="hljs-meta">@Before(&quot;accountDataAccessOperation(account)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateAccount</span><span class="hljs-params">(Account account)</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5、引入introduction" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5、引入introduction">#</a> 5、引入Introduction</h4><p>引入使切面能够声明被通知的对象【实现给定的接口】，也就是让代理对象实现新的接口。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DeclareParents(value=&quot;com.ydlclass.service.impl.OrderService&quot;,defaultImpl= ActivityService.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IActivityService activityService;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>要实现的接口由注解字段的类型决定。 @DeclareParents注解的【value】属性是一个AspectJ类型类。 任何与之匹配的类型的bean都将实现【UsageTracked】接口。 注意，在前面示例的before通知中，服务bean可以直接用作【UsageTracked】接口的实现。 如果以编程方式访问bean，您将编写以下代码:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">IActivityService</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> ctx.getBean(IActivityService.class);<br>bean.sendGif();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>搞过debug看到了，生成的代理实现了两个接口：</p><figure><img class="lazy" alt="image-20211207184848931" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/image-20211207184848931-935d9190.png" tabindex="0"/><figcaption>image-20211207184848931</figcaption></figure><h4 id="_6、advice-ordering" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6、advice-ordering">#</a> 6、Advice Ordering</h4><ul><li><p>当多个通知都想在同一个连接点上运行时，Spring AOP遵循与AspectJ相同的优先规则来确定通知执行的顺序。 优先级最高的通知在【进入时】首先运行【因此，给定两个before通知，优先级最高的将首先运行】。 从连接点【退出】时，优先级最高的通知最后运行【因此，给定两个after通知，优先级最高的通知将第二运行】。</p></li><li><p>当在不同切面定义的两个通知都需要在同一个连接点上运行时，除非另行指定，否则执行顺序是未定义的。 您可以通过指定优先级来控制执行顺序。 在切面类中使用【Ordered】接口，或者用【@Order】注释它。 对于两个切面，从' Ordered.getOrder() '返回较低值的切面(或注释值)具有较高的优先级。</p></li></ul><h4 id="_7、aop-的例子" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_7、aop-的例子">#</a> 7、AOP 的例子</h4><p>业务代码的执行有时会由于【并发性问题】而失败（例如，死锁而导致的失败）。 如果再次尝试该操作，很可能在下一次尝试时成功。 对于适合在这种条件下重试的业务服务，我们希望进行透明地重试操作。 这是一个明显跨越service层中的多个服务的需求，因此是通过切面实现的理想需求。</p><p>因为我们想要重试操作，所以我们需要使用around通知，以便我们可以多次调用' proceed '。 下面的例子显示了基本方面的实现:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcurrentOperationExecutor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Ordered</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DEFAULT_MAX_RETRIES</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> DEFAULT_MAX_RETRIES;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMaxRetries</span><span class="hljs-params">(<span class="hljs-type">int</span> maxRetries)</span> &#123;<br>        <span class="hljs-built_in">this</span>.maxRetries = maxRetries;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.order;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOrder</span><span class="hljs-params">(<span class="hljs-type">int</span> order)</span> &#123;<br>        <span class="hljs-built_in">this</span>.order = order;<br>    &#125;<br><br>    <span class="hljs-meta">@Around(&quot;com.xyz.myapp.CommonPointcuts.businessService()&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">doConcurrentOperation</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">numAttempts</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        PessimisticLockingFailureException lockFailureException;<br>        <span class="hljs-keyword">do</span> &#123;<br>            numAttempts++;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">return</span> pjp.proceed();<br>            &#125;<br>            <span class="hljs-keyword">catch</span>(PessimisticLockingFailureException ex) &#123;<br>                lockFailureException = ex;<br>            &#125;<br>        &#125; <span class="hljs-keyword">while</span>(numAttempts &amp;lt;= <span class="hljs-built_in">this</span>.maxRetries);<br>        <span class="hljs-keyword">throw</span> lockFailureException;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意，切面实现了' Ordered '接口，因此我们可以将【该切面的优先级】设置得高于【事务通知】，我们希望每次重试时都有一个新的事务。 ' maxRetries '和' order '属性都是可以由Spring配置注入的。</p><p>对应的Spring配置如下:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>aop:aspectj-autoproxy/<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;concurrentOperationExecutor&quot; class=&quot;com.xyz.myapp.service.impl.ConcurrentOperationExecutor&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;maxRetries&quot; value=&quot;3&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;order&quot; value=&quot;100&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="五、基于schema的aop支持" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#五、基于schema的aop支持">#</a> 五、基于schema的AOP支持</h3><p>如果您喜欢基于xml的格式，Spring还提供了使用【aop命名空间】标记定义切面的支持。 它支持与使用@AspectJ样式时完全相同的切入点表达式和通知类型。</p><p>要使用本节中描述的aop命名空间标记，您需要导入' spring-aop '模块。</p><p>在Spring配置中，所有【切面和通知】元素都必须放在一个<code>&lt;aop:config&gt; </code>元素中（在应用程序上下文配置中可以有多个<code>&lt;aop:config&gt; </code>元素）。 一个<code>&lt;aop:config&gt; </code>元素可以包含切入点、通知和切面元素（注意这些元素必须按照这个顺序声明）。</p><blockquote><p>配置切面，切点表达式，通知的方法如下</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;<br>       xsi:schemaLocation=&quot;<br>        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd<br>        http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java">&amp;lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&amp;gt;<br>&amp;lt;beans xmlns=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span><br>       xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>       xmlns:aop=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span><br>       xsi:schemaLocation=<span class="hljs-string">&quot;</span><br><span class="hljs-string">        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="hljs-string">        http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&amp;gt;<br><br>&amp;lt;!--    &amp;lt;aop:aspectj-autoproxy/&amp;gt;--&amp;gt;<br><br>    &amp;lt;aop:config&amp;gt;<br>        &amp;lt;aop:aspect ref=<span class="hljs-string">&quot;aop&quot;</span>&amp;gt;<br>            &amp;lt;aop:pointcut id=<span class="hljs-string">&quot;point&quot;</span> expression=<span class="hljs-string">&quot;execution(* com.ydlclass..*(..))&quot;</span>/&amp;gt;<br>            &amp;lt;aop:before method=<span class="hljs-string">&quot;beforeAdvice&quot;</span> pointcut=<span class="hljs-string">&quot;execution(* com.ydlclass..*(..)) and args(money,..)&quot;</span>/&amp;gt;<br>            &amp;lt;aop:after method=<span class="hljs-string">&quot;afterAdvice&quot;</span> pointcut-ref=<span class="hljs-string">&quot;point&quot;</span>/&amp;gt;<br>            &amp;lt;aop:after-returning method=<span class="hljs-string">&quot;afterReturningAdvice&quot;</span> pointcut-ref=<span class="hljs-string">&quot;point&quot;</span>/&amp;gt;<br>            &amp;lt;aop:after-throwing throwing=<span class="hljs-string">&quot;ex&quot;</span> method=<span class="hljs-string">&quot;afterThrowing&quot;</span> pointcut-ref=<span class="hljs-string">&quot;point&quot;</span>/&amp;gt;<br><br>        &amp;lt;/aop:aspect&amp;gt;<br>    &amp;lt;/aop:config&amp;gt;<br><br>    &amp;lt;bean id=<span class="hljs-string">&quot;aop&quot;</span> class=<span class="hljs-string">&quot;com.ydlclass.aspecj.MyAop&quot;</span>/&amp;gt;<br>    &amp;lt;bean id=<span class="hljs-string">&quot;orderService&quot;</span> class=<span class="hljs-string">&quot;com.ydlclass.service.impl.OrderService&quot;</span>/&amp;gt;<br>    &amp;lt;bean id=<span class="hljs-string">&quot;userService&quot;</span> class=<span class="hljs-string">&quot;com.ydlclass.service.impl.UserService&quot;</span>/&amp;gt;<br><br>&amp;lt;/beans&amp;gt;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Introduction</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>aop:aspect id=&quot;usageTrackerAspect&quot; ref=&quot;usageTracking&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>aop:declare-parents<br>        types-matching=&quot;com.xzy.myapp.service.*+&quot;<br>        implement-interface=&quot;com.xyz.myapp.service.tracking.UsageTracked&quot;<br>        default-impl=&quot;com.xyz.myapp.service.tracking.DefaultUsageTracked&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/aop:aspect<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>AOP示例</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcurrentOperationExecutor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Ordered</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DEFAULT_MAX_RETRIES</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> DEFAULT_MAX_RETRIES;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMaxRetries</span><span class="hljs-params">(<span class="hljs-type">int</span> maxRetries)</span> &#123;<br>        <span class="hljs-built_in">this</span>.maxRetries = maxRetries;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.order;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOrder</span><span class="hljs-params">(<span class="hljs-type">int</span> order)</span> &#123;<br>        <span class="hljs-built_in">this</span>.order = order;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">doConcurrentOperation</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">numAttempts</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        PessimisticLockingFailureException lockFailureException;<br>        <span class="hljs-keyword">do</span> &#123;<br>            numAttempts++;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">return</span> pjp.proceed();<br>            &#125;<br>            <span class="hljs-keyword">catch</span>(PessimisticLockingFailureException ex) &#123;<br>                lockFailureException = ex;<br>            &#125;<br>        &#125; <span class="hljs-keyword">while</span>(numAttempts &amp;lt;= <span class="hljs-built_in">this</span>.maxRetries);<br>        <span class="hljs-keyword">throw</span> lockFailureException;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对应的Spring配置如下:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>aop:config<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>aop:aspect id=&quot;concurrentOperationRetry&quot; ref=&quot;concurrentOperationExecutor&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>aop:pointcut id=&quot;idempotentOperation&quot;<br>            expression=&quot;execution(* com.xyz.myapp.service.*.*(..))&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>aop:around<br>            pointcut-ref=&quot;idempotentOperation&quot;<br>            method=&quot;doConcurrentOperation&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/aop:aspect<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/aop:config<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;concurrentOperationExecutor&quot;<br>    class=&quot;com.xyz.myapp.service.impl.ConcurrentOperationExecutor&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;maxRetries&quot; value=&quot;3&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;order&quot; value=&quot;100&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><h3 id="六、选择使用哪种aop声明风格" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#六、选择使用哪种aop声明风格">#</a> 六、选择使用哪种AOP声明风格</h3><p>一旦您确定使用aop是实现给定需求的最佳方法，您如何决定是使用Spring AOP还是AspectJ，是使用【切面语言(代码)风格aspectj】、@AspectJ注解风格还是Spring XML风格?</p><h4 id="_1、spring-aop-还是-full-aspectj" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、spring-aop-还是-full-aspectj">#</a> 1、Spring AOP 还是 Full AspectJ?</h4><p>Spring AOP比使用完整的AspectJ更简单，因为不需要在开发和构建过程中引入AspectJ编译器/编织器。 如果您只需要在Spring bean上执行操作，那么Spring AOP是正确的选择。 如果需要【通知不受Spring容器管理的对象】，则需要AspectJ。</p><h4 id="_2、-aspectj还是spring-aop的-xml" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-aspectj还是spring-aop的-xml">#</a> 2、 @AspectJ还是Spring AOP的 XML?</h4><p>如果您选择使用Spring AOP，那么您可以选择@AspectJ或XML样式。</p><p>XML样式可能是现有Spring用户最熟悉的，并且它是由真正的pojo支持的。 当使用AOP作为配置企业服务的工具时，XML可能是一个很好的选择(一个很好的测试是您是否认为切入点表达式是您可能想要独立更改的配置的一部分)。 使用XML样式，可以从配置中更清楚地看出系统中存在哪些。</p><p>XML样式有两个缺点。 首先，它没有将它所处理的需求的实现完全封装在一个地方。 其次，与@AspectJ风格相比，XML风格在它能表达的内容上稍微受到一些限制，只支持“单例”切面实例化模型，并且不可能组合在XML中声明的命名切入点。 例如，在@AspectJ风格中，你可以写如下内容:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Pointcut(&quot;execution(* get*())&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">propertyAccess</span><span class="hljs-params">()</span> &#123;&#125;<br><br><span class="hljs-meta">@Pointcut(&quot;execution(org.xyz.Account+ *(..))&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operationReturningAnAccount</span><span class="hljs-params">()</span> &#123;&#125;<br><br><span class="hljs-meta">@Pointcut(&quot;propertyAccess() &amp;amp;&amp;amp; operationReturningAnAccount()&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accountPropertyAccess</span><span class="hljs-params">()</span> &#123;&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在XML样式中，可以声明前两个切入点:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>aop:pointcut id=&quot;propertyAccess&quot;<br>        expression=&quot;execution(* get*())&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>aop:pointcut id=&quot;operationReturningAnAccount&quot;<br>        expression=&quot;execution(org.xyz.Account+ *(..))&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>XML方法的缺点是不能通过组合这些定义来定义“accountPropertyAccess”切入点。</p><p>​ @AspectJ还有一个优点，即@AspectJ切面可以被Spring AOP和AspectJ理解(从而使用)。 因此，如果您以后决定需要AspectJ的功能来实现额外的需求，您可以轻松地迁移到经典的AspectJ当中。</p><p>​ <strong>总的来说，Spring团队更喜欢自定义切面的@AspectJ风格，而不是简单的企业服务配置。</strong></p><h3 id="七、以编程方式创建-aspectj代理" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#七、以编程方式创建-aspectj代理">#</a> 七、以编程方式创建@AspectJ代理</h3><p>除了通过使用<code>&lt;aop:config&gt; </code>或<code>&lt;aop:aspectj-autoproxy&gt;</code>在配置中声明方面之外，还可以通过编程方式创建通知目标对象的代理。</p><p>代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">AspectJProxyFactory</span> <span class="hljs-variable">aspectJProxyFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AspectJProxyFactory</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>());<br>    aspectJProxyFactory.addAspect(MyAspect.class);<br>    <span class="hljs-type">IOrderService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (IOrderService)aspectJProxyFactory.getProxy();<br>    proxy.order(<span class="hljs-number">111</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第七章-事务管理" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第七章-事务管理">#</a> 第七章 事务管理</h2><p>回顾jdbc中的事务是怎么实现的：</p><div class="language-sql line-numbers-mode" data-ext="sql"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight sql"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 将事务设置为手动提交</span><br><span class="hljs-keyword">set</span> autocommit <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><span class="hljs-comment">-- 开启事务</span><br><span class="hljs-keyword">START</span> TRANSACTION;<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `<span class="hljs-keyword">user</span>`(id,username,`password`) <span class="hljs-keyword">values</span> (<span class="hljs-number">10001</span>,<span class="hljs-string">&#x27;zs&#x27;</span>,<span class="hljs-string">&#x27;123&#x27;</span>);<br><span class="hljs-comment">-- 新增保存点</span><br><span class="hljs-keyword">SAVEPOINT</span> x;<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `<span class="hljs-keyword">user</span>`(id,username,`password`) <span class="hljs-keyword">values</span> (<span class="hljs-number">10002</span>,<span class="hljs-string">&#x27;lisi&#x27;</span>,<span class="hljs-string">&#x27;123&#x27;</span>);<br><span class="hljs-comment">-- 回滚到保存点x</span><br><span class="hljs-keyword">ROLLBACK</span> <span class="hljs-keyword">TO</span> x;<br><span class="hljs-keyword">START</span> TRANSACTION;<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `<span class="hljs-keyword">user</span>`(id,username,`password`) <span class="hljs-keyword">values</span> (<span class="hljs-number">10003</span>,<span class="hljs-string">&#x27;lisi&#x27;</span>,<span class="hljs-string">&#x27;123&#x27;</span>);<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>;<br><span class="hljs-keyword">COMMIT</span>;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="一、spring框架事务支持模型的优点" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、spring框架事务支持模型的优点">#</a> 一、Spring框架事务支持模型的优点</h3><p>全面的事务支持是使用Spring框架最令人信服的原因之一。 Spring Framework为事务管理提供了一个一致的抽象，给我们的开发带来了极大的遍历。</p><p>Spring允许应用程序开发人员在任何环境中使用【一致的编程模型】。 只需编写一次代码，它就可以从不同环境中的不同事务管理策略中获益。 Spring框架同时提供【声明式】和【编程式】事务管理。 大多数用户更喜欢【声明式事务管理】，这也是我们在大多数情况下所推荐的。 使用声明式模型，开发人员通常【很少或不编写】与事务管理相关的代码，因此，不依赖于Spring Framework事务API或任何其他事务API，也就是啥也不用写。</p><h3 id="二、-理解spring框架的事务抽象" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、-理解spring框架的事务抽象">#</a> 二、 理解Spring框架的事务抽象</h3><p>spring事务对事务抽象提现在一下三个类中：<code>PlatformTransactionManager</code>，<code>TransactionDefinition</code> ，<code>TransactionStatus</code>。</p><h4 id="_1、transactionmanager" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、transactionmanager">#</a> 1、TransactionManager</h4><p>TransactionManage主要有一下两个子接口：</p><p><code>org.springframework.transaction.PlatformTransactionManager</code>接口用于为不同平台提供统一抽象的事务管理器。</p><p><code>org.springframework.transaction.ReactiveTransactionManager</code>接口用于响应式事务管理，这个不重要。</p><blockquote><p>下面显示了' PlatformTransactionManager ' API的定义:</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PlatformTransactionManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TransactionManager</span> &#123;<br><br>    TransactionStatus <span class="hljs-title function_">getTransaction</span><span class="hljs-params">(TransactionDefinition definition)</span> <span class="hljs-keyword">throws</span> TransactionException;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">commit</span><span class="hljs-params">(TransactionStatus status)</span> <span class="hljs-keyword">throws</span> TransactionException;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">rollback</span><span class="hljs-params">(TransactionStatus status)</span> <span class="hljs-keyword">throws</span> TransactionException;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>任何【PlatformTransactionManager】接口实现类的方法抛出的【TransactionException】是未检查的 （也就是说，它继承了【java.lang.RuntimeException】的类）。 这里边隐藏了一个知识点，我们后续再说。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NestedRuntimeException</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TransactionException</span><span class="hljs-params">(String msg)</span> &#123;<br>        <span class="hljs-built_in">super</span>(msg);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TransactionException</span><span class="hljs-params">(String msg， Throwable cause)</span> &#123;<br>        <span class="hljs-built_in">super</span>(msg， cause);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 任何一个【TransactionManager】的实现通常需要了解它们工作的环境：JDBC、mybatis、Hibernate等等。 下面的示例展示了如何定义一个本地的【PlatformTransactionManager】实现（在本例中，使用纯JDBC）。</p><p>你可以通过创建一个类似于下面这样的bean来定义JDBC ' DataSource ':</p><div class="language-properties line-numbers-mode" data-ext="properties"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight properties"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">password</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">url</span>=<span class="hljs-string">jdbc:mysql://127.0.0.1:3306/ydlclass?characterEncoding=utf8&amp;amp;serverTimezone=Asia/Shanghai</span><br><span class="hljs-attr">driverName</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>       xmlns:p=&quot;http://www.springframework.org/schema/p&quot;<br>       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;<br>       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd<br>        http://www.springframework.org/schema/context<br>        https://www.springframework.org/schema/context/spring-context.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>context:property-placeholder location=&quot;jdbc.properties&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;driverClassName&quot; value=&quot;$&#123;driverName&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>DataSourceTransactionManager是PlatformTransactionManager的一个子类，他需要一个数据源进行注入：</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;txManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意点，在DataSourceTransactionManager源码中有这么一句话，讲线程的持有者绑定到线程当中：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Bind the connection holder to the thread.</span><br>    <span class="hljs-keyword">if</span> (txObject.isNewConnectionHolder()) &#123;<br>        TransactionSynchronizationManager.bindResource(obtainDataSource(), txObject.getConnectionHolder());<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">private static final ThreadLocal&amp;lt;Map&amp;lt;Object, Object&amp;gt;&amp;gt; resources =<br>            new NamedThreadLocal&amp;lt;&amp;gt;(&quot;Transactional resources&quot;);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>从这里我们也能大致明白，PlatformTransactionManager的事务是和线程绑定的，事务的获取是从当前线程中获取的。</p><h4 id="_2、transactiondefinition" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、transactiondefinition">#</a> 2、<code>TransactionDefinition</code></h4><p><code>TransactionDefinition</code> 接口指定了当前事务的相关配置，主要配置如下:</p><ul><li>Propagation：通常情况下，事务范围内的所有代码都在该事务中运行。 但是，如果事务方法在 【已经存在事务的上下文中运行】，则可以指定事务的【传播行为】。</li><li>Isolation：该事务与其他事务的工作隔离的程度。 例如，这个事务可以看到其他事务未提交的写入吗? 【隔离级别】</li><li>Timeout：该事务在超时并被底层事务基础设施自动回滚之前运行多长时间。</li><li>只读状态：当代码读取但不修改数据时，可以使用只读事务。 在某些情况下，如使用Hibernate时，只读事务可能是一种有用的优化。</li></ul><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TransactionDefinition</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Support a current transaction; create a new one if none exists.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">PROPAGATION_REQUIRED</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Support a current transaction; execute non-transactionally if none exists.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">PROPAGATION_SUPPORTS</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Support a current transaction; throw an exception if no current transaction</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">PROPAGATION_MANDATORY</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Create a new transaction, suspending the current transaction if one exists.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">PROPAGATION_REQUIRES_NEW</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Do not support a current transaction; rather always execute non-transactionally.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">PROPAGATION_NOT_SUPPORTED</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Do not support a current transaction; throw an exception if a current transaction</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">PROPAGATION_NEVER</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Execute within a nested transaction if a current transaction exists,</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">PROPAGATION_NESTED</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;<br><br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">ISOLATION_DEFAULT</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br><br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">ISOLATION_READ_UNCOMMITTED</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;  <br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">ISOLATION_READ_COMMITTED</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>; <br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">ISOLATION_REPEATABLE_READ</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;  <br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">ISOLATION_SERIALIZABLE</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;  <br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Use the default timeout of the underlying transaction system,</span><br><span class="hljs-comment">     * or none if timeouts are not supported.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">TIMEOUT_DEFAULT</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个接口有一个默认实现：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultTransactionDefinition</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TransactionDefinition</span>, Serializable &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">propagationBehavior</span> <span class="hljs-operator">=</span> PROPAGATION_REQUIRED;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">isolationLevel</span> <span class="hljs-operator">=</span> ISOLATION_DEFAULT;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> TIMEOUT_DEFAULT;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">readOnly</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-comment">//....</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3、transactionstatus" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、transactionstatus">#</a> 3、<code>TransactionStatus</code></h4><p>​ <code>TransactionStatus</code>接口为事务代码提供了一种简单的方法来控制事务执行和查询事务状态。下面的例子显示了<code>TransactionStatus</code>接口:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TransactionStatus</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TransactionExecution</span>， SavepointManager， Flushable &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-comment">//返回当前事务是否是新的; 否则将参与现有事务，或者可能从一开始就不在实际事务中运行。</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isNewTransaction</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasSavepoint</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-comment">// 只设置事务回滚。 这指示事务管理器，事务的唯一可能结果可能是回滚，而不是抛出异常，从而触发回滚。 </span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRollbackOnly</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-comment">// 返回事务是否被标记为仅回滚(由应用程序或事务基础设施)。  </span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isRollbackOnly</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">flush</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-comment">// 返回该事务是否已完成，即是否已提交或回滚。  </span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCompleted</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><h3 id="三、编程式事务管理" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、编程式事务管理">#</a> 三、编程式事务管理</h3><p>Spring Framework提供了两种编程式事务管理的方法:</p><ul><li>使用<code>TransactionTemplate</code>。</li><li>使用 <code>TransactionManager</code>。</li></ul><p>​</p><h4 id="_1、-使用-transactionmanager" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、-使用-transactionmanager">#</a> 1、 使用 <code>TransactionManager</code></h4><blockquote><p>使用 <code>PlatformTransactionManager</code></p></blockquote><p>我们可以直接使用【org.springframework.transaction.PlatformTransactionManager】直接管理事务。 为此，通过bean引用将您使用的<code>PlatformTransactionManager</code>的实现传递给您的bean。 然后，通过使用<code>TransactionDefinition</code>和 <code>TransactionStatus</code>对象，您可以发起事务、回滚和提交。 下面的示例显示了如何这样做:</p><p>给容器注入对应的事务管理器：</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>context:property-placeholder location=&quot;jdbc.properties&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>context:component-scan base-package=&quot;com.ydlclass&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>!-- 注入事务管理器 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>!-- 注入事务管理器 --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>!--数据源--<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;driverClassName&quot; value=&quot;$&#123;driverName&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;username&quot; value=&quot;$&#123;user&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注入对应的service</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transfer</span><span class="hljs-params">(String from, String to, Integer money)</span> &#123;<br><br>    <span class="hljs-comment">// 默认的事务配置</span><br>    <span class="hljs-type">DefaultTransactionDefinition</span> <span class="hljs-variable">definition</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultTransactionDefinition</span>();<br>    <span class="hljs-comment">// 使用事务管理器进行事务管理</span><br>    <span class="hljs-type">TransactionStatus</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> transactionManager.getTransaction(definition);<br><br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-comment">// 转账其实是两个语句</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">moneyFrom</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;update account set money = money - ? where username = ? &quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">moneyTo</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;update account set money = money + ? where username = ? &quot;</span>;<br>        <span class="hljs-comment">// 从转账的人处扣钱</span><br>        jdbcTemplate.update(moneyFrom,money,from);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>/<span class="hljs-number">0</span>;<br>        jdbcTemplate.update(moneyTo,money,to);<br>    &#125;<span class="hljs-keyword">catch</span> (RuntimeException exception)&#123;<br>        exception.printStackTrace();<br>        <span class="hljs-comment">// 回滚</span><br>        transactionManager.rollback(transaction);<br>    &#125;<br>    <span class="hljs-comment">// 提交</span><br>    transactionManager.commit(transaction);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#">#</a></h3><h4 id="_2、-使用transactiontemplate" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-使用transactiontemplate">#</a> 2、 使用<code>TransactionTemplate</code></h4><p>【TransactionTemplate】采用了与其他Spring模板相同的方法，比如【JdbcTemplate】。 它使用回调方法将应用程序代码从获取和释放事务性资源的样板程序中解放出来，因为您的代码只关注您想要做的事情，而不是希望将大量的时间浪费在这里。</p><p>正如下面的示例所示，使用【TransactionTemplate】绝对会将您与Spring的事务基础设施和api耦合在一起。 编程事务管理是否适合您的开发需求，这是您必须自己做出的决定。</p><p>必须在事务上下文中运行并显式使用<code>TransactionTemplate</code>的应用程序代码类似于下一个示例。 您作为一个应用程序开发人员，可以编写一个<code>TransactionCallback</code>实现（通常表示为一个匿名内部类），其中包含您需要在事务上下文中运行的代码。 然后你可以将你的自定义 <code>TransactionCallback</code>的一个实例传递给<code>TransactionTemplate</code>中暴露的 <code>execute(..)</code>方法。 下面的示例显示了如何这样做:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;transactionTemplate&quot; class=&quot;org.springframework.transaction.support.TransactionTemplate&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;transactionManager&quot; ref=&quot;transactionManager&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果没有返回值，你可以在匿名类中使用方便的<code>TransactionCallbackWithoutResult</code>类，如下所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transfer3</span><span class="hljs-params">(String from, String to, Integer money)</span> &#123;<br><br>    transactionTemplate.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransactionCallbackWithoutResult</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doInTransactionWithoutResult</span><span class="hljs-params">(TransactionStatus status)</span> &#123;<br>            <span class="hljs-comment">// 转账其实是两个语句</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">moneyFrom</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;update account set money = money - ? where username = ? &quot;</span>;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">moneyTo</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;update account set money = money + ? where username = ? &quot;</span>;<br>            <span class="hljs-comment">// 从转账的人处扣钱</span><br>            jdbcTemplate.update(moneyFrom, money, from);<br>            <span class="hljs-comment">//                int i = 1 / 0;</span><br>            jdbcTemplate.update(moneyTo, money, to);<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3、-声明式事务管理" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、-声明式事务管理">#</a> 3、 声明式事务管理</h4><p>大多数Spring框架用户选择声明式事务管理。 该选项对应用程序代码的影响最小，因此最符合非侵入式轻量级容器的理想。</p><p>Spring框架的声明性事务管理是通过Spring面向切面编程(AOP)实现的。 然而，由于事务切面代码随Spring Framework发行版一起提供，并且可以模板的方式使用，所以通常不需要理解AOP概念就可以有效地使用这些代码。</p><h5 id="_1-理解spring框架的声明式事务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1-理解spring框架的声明式事务">#</a> （1） 理解Spring框架的声明式事务</h5><p>Spring框架的声明式事务通过AOP代理进行实现，事务的通知是由AOP元数据与事务性元数据的结合产生了一个AOP代理，该代理使用【TransactionInterceptor】结合适当的【TransactionManager】实现来驱动方法调用的事务。</p><p>Spring Framework的【TransactionInterceptor】为命令式和响应式编程模型提供了事务管理。 拦截器通过检查方法返回类型来检测所需的事务管理风格。 事务管理风格会影响需要哪个事务管理器。 命令式事务需要【PlatformTransactionManager】，而响应式事务使用【ReactiveTransactionManager 】实现。</p><p>【@Transactional 】通常用于【PlatformTransactionManager 】管理的【线程绑定事务】，将事务暴露给当前执行线程中的所有数据访问操作。（注意：这不会传播到方法中新启动的线程）。</p><h5 id="_2-声明式事务实现的示例" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2-声明式事务实现的示例">#</a> （2）声明式事务实现的示例</h5><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- from the file &#x27;context.xml&#x27; --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;<br>    xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;<br>    xsi:schemaLocation=&quot;<br>        http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd<br>        http://www.springframework.org/schema/tx<br>        https://www.springframework.org/schema/tx/spring-tx.xsd<br>        http://www.springframework.org/schema/aop<br>        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>  <span class="hljs-symbol">&amp;lt;</span>!-- the transactional advice (what &#x27;happens&#x27;; see the <span class="hljs-symbol">&amp;lt;</span>aop:advisor/<span class="hljs-symbol">&amp;gt;</span> bean below) --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- the transactional semantics... --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>tx:attributes<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>!-- all methods starting with &#x27;get&#x27; are read-only --<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;get*&quot; read-only=&quot;true&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>!-- other methods use the default transaction settings (see below) --<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;*&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/tx:attributes<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/tx:advice<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- ensure that the above transactional advice runs for any execution<br>        of an operation defined by the FooService interface --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>aop:config<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>aop:pointcut id=&quot;point&quot; expression=&quot;within(com.ydlclass.service..*)&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>aop:advisor advice-ref=&quot;txAdvice&quot; pointcut-ref=&quot;point&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/aop:config<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-事务回滚" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3-事务回滚">#</a> （3）事务回滚</h5><p>上一节概述了如何在应用程序中以声明的方式为类（通常是服务层类）指定事务设置的基础知识。 本节描述如何以简单的声明式方式控制事务的回滚。</p><p>重点：</p><p>​ <strong>在其默认配置中，Spring框架的事务基础结构代码只在运行时、未检查的异常情况下标记事务进行回滚。 也就是说，当抛出的异常是' RuntimeException '的实例或子类时。 (默认情况下，' Error '实例也会导致回滚)。 事务方法抛出的已检查异常不会导致默认配置的回滚。</strong></p><p>您还可以准确地配置哪些“Exception”类型将事务标记为回滚。 下面的XML代码片段演示了如何为一个已检查的、特定于应用程序的“Exception”类型配置回滚:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;txManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:attributes<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;get*&quot; read-only=&quot;true&quot; rollback-for=&quot;NoProductInStockException&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;*&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/tx:attributes<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/tx:advice<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果您不想在抛出异常时回滚事务，您还可以指定“无回滚规则”。 下面的例子告诉Spring框架的事务基础架构，即使面对InstrumentNotFoundException`，也要提交相应的事务:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>tx:advice id=&quot;txAdvice&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:attributes<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;updateStock&quot; no-rollback-for=&quot;InstrumentNotFoundException&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;*&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/tx:attributes<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/tx:advice<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当Spring Framework的事务，捕获异常并参考配置的回滚规则来决定是否将事务标记为回滚时，最强匹配规则胜出。 因此，在以下配置的情况下，除了<code>InstrumentNotFoundException</code>之外的任何异常都会导致事务的回滚:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>tx:advice id=&quot;txAdvice&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:attributes<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;*&quot; rollback-for=&quot;Throwable&quot; no-rollback-for=&quot;InstrumentNotFoundException&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/tx:attributes<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/tx:advice<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-tx-advice-设置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4-tx-advice-设置">#</a> （4） <code>&lt;tx:advice/&gt;</code> 设置</h5><p>本节总结了通过使用<code>&lt;tx:advice/&gt; </code>标记可以指定的各种事务设置。 默认的<code>&lt;tx:advice/&gt; </code>设置是:</p><ul><li>传播行为是<code>REQUIRED.</code>。</li><li>隔离级别为 <code>DEFAULT.</code></li><li>事务处于可读写状态。</li><li>事务超时默认为底层事务系统的默认超时，如果不支持超时，则为none。</li><li>任何<code>RuntimeException</code>触发回滚，而任何选中的<code>Exception</code>不会。</li></ul><p>您可以更改这些默认设置。 下表总结了嵌套在<code>&lt;tx:advice/&gt;`和`&lt;tx:attributes/&gt;</code>标签中的<code>&lt;tx:method/&gt;</code>标签的各种属性:</p><table><thead><tr><th style="text-align:left;">属性</th><th style="text-align:left;">Required?</th><th style="text-align:left;">默认值</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;"><code>name</code></td><td style="text-align:left;">Yes</td><td style="text-align:left;"></td><td style="text-align:left;">要与事务属性相关联的方法名。 通配符(<em>)字符可用于将相同的事务属性设置与许多方法相关联(例如，' get</em> '、' handle* '、' on*Event '等等)。</td></tr><tr><td style="text-align:left;"><code>propagation</code></td><td style="text-align:left;">No</td><td style="text-align:left;"><code>REQUIRED</code></td><td style="text-align:left;">事务传播行为。</td></tr><tr><td style="text-align:left;"><code>isolation</code></td><td style="text-align:left;">No</td><td style="text-align:left;"><code>DEFAULT</code></td><td style="text-align:left;">事务隔离级别。 仅适用于' REQUIRED '或' REQUIRES_NEW '的传播设置。</td></tr><tr><td style="text-align:left;"><code>timeout</code></td><td style="text-align:left;">No</td><td style="text-align:left;">-1</td><td style="text-align:left;">事务超时(秒)。 仅适用于传播' REQUIRED '或' REQUIRES_NEW '。</td></tr><tr><td style="text-align:left;"><code>read-only</code></td><td style="text-align:left;">No</td><td style="text-align:left;">false</td><td style="text-align:left;">读写事务与只读事务。 只适用于' REQUIRED '或' REQUIRES_NEW '。</td></tr><tr><td style="text-align:left;"><code>rollback-for</code></td><td style="text-align:left;">No</td><td style="text-align:left;"></td><td style="text-align:left;">触发回滚的“Exception”实例的逗号分隔列表。 例如,“com.foo.MyBusinessException, ServletException”。</td></tr><tr><td style="text-align:left;"><code>no-rollback-for</code></td><td style="text-align:left;">No</td><td style="text-align:left;"></td><td style="text-align:left;">不触发回滚的“Exception”实例的逗号分隔列表。 例如,“com.foo.MyBusinessException, ServletException”。</td></tr></tbody></table><h5 id="_5-使用-transactional" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5-使用-transactional">#</a> （5）使用 <code>@Transactional</code></h5><p>除了事务配置的基于xml的声明性方法外，还可以使用基于注解的方法。 直接在Java源代码中声明事务语义使声明更接近受影响的代码。 不存在过多耦合的危险，因为要以事务方式使用的代码几乎总是以这种方式部署的。</p><p>使用' @Transactional '注解所提供的易用性可以用一个示例进行最好的说明，下面的文本将对此进行解释。 考虑以下类定义:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// the service class that we want to make transactional</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultFooService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FooService</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Foo <span class="hljs-title function_">getFoo</span><span class="hljs-params">(String fooName)</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Foo <span class="hljs-title function_">getFoo</span><span class="hljs-params">(String fooName， String barName)</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFoo</span><span class="hljs-params">(Foo foo)</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFoo</span><span class="hljs-params">(Foo foo)</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在如上所述的类级别上使用，注解指示声明类(及其子类)的所有方法的默认值。 或者，每个方法都可以单独注解。 请注意，类级注解并不适用于类层次结构中的祖先类; 在这种情况下，<strong>继承的方法需要在本地重新声明</strong>，以便参与子类级别的注解。</p><p>当上述POJO类被定义为Spring上下文中的bean时，您可以通过“@Configuration”类中的“@EnableTransactionManagement”注解使bean实例具有事务性。 详见<a href="https://docs.spring.io/spring-framework/docs/5.3.13/javadoc-api/org/springframework/transaction/annotation/EnableTransactionManagement.html" rel="noopener noreferrer" target="_blank">javadoc<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><p>在XML配置中，<code>&lt;tx:annotation-driven transaction-manager="txManager"/&gt;</code>标签提供了类似的便利:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- from the file &#x27;context.xml&#x27; --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;<br>    xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;<br>    xsi:schemaLocation=&quot;<br>        http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd<br>        http://www.springframework.org/schema/tx<br>        https://www.springframework.org/schema/tx/spring-tx.xsd<br>        http://www.springframework.org/schema/aop<br>        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- this is the service object that we want to make transactional --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;fooService&quot; class=&quot;x.y.service.DefaultFooService&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- enable the configuration of transactional behavior based on annotations --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- a TransactionManager is still required --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:annotation-driven transaction-manager=&quot;txManager&quot;/<span class="hljs-symbol">&amp;gt;</span> <br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;txManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- (this dependency is defined somewhere else) --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- other <span class="hljs-symbol">&amp;lt;</span>bean/<span class="hljs-symbol">&amp;gt;</span> definitions here --<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果要连接的' TransactionManager '的bean名称为' TransactionManager '，则可以省略' <a class="" href="/doc21xnv/java/third/framework/2%E3%80%81spring/tx:annotation-driven/">tx:annotation-driven/</a> '标记中的' transaction-manager '属性。 如果您想要依赖注入的' TransactionManager ' bean有任何其他名称，您必须使用' transaction-manager '属性，如前面的示例所示。</p><p>当你在Spring的标准配置中使用事务性代理时，你应该只把' @Transactional '注解应用到可视性为' public '的方法上。 如果使用' @Transactional '注解' protected '、' private '或包可见的方法，则不会引发错误，但已注解的方法不会显示已配置的事务设置。</p><p>如果需要注解非公共方法，请考虑下面段落中关于基于类的代理的提示，或者考虑使用AspectJ编译时或加载时编织(稍后介绍)。 当在“@Configuration”类中使用“@EnableTransactionManagement”时，通过注册一个自定义的“transactionAttributeSource”bean，“受保护的”或包可见的方法也可以使基于类的代理具有事务性，如下面的示例所示。 然而，请注意，基于接口的代理中的事务方法必须始终是“公共的”，并且在被代理的接口中定义。</p><p>Spring团队建议只使用' @Transactional '注解来注解具体的类(以及具体类的方法)，而不是注解接口。 当然，您可以将' @Transactional '注解放在接口(或接口方法)上，<strong>但只有当您使用基于接口的代理时，它才会发挥作用。</strong> Java注解的事实并不意味着继承接口，如果使用基于类的代理(proxy-target-class = " true ")或weaving-based方面('模式=“aspectj”)，事务设置不认可的代理和编织的基础设施，和对象不是包在一个事务代理。</p><p>在代理模式(这是默认的)中，只有通过代理进入的外部方法调用会被拦截。 这意味着，即使被调用的方法被标记为' @Transactional '，自调用(实际上是目标对象中的一个方法调用目标对象的另一个方法)在运行时也不会导致实际的事务。 此外，代理必须完全初始化以提供预期的行为，因此您不应该在初始化代码中依赖此特性——例如，在' @PostConstruct '方法中。</p><h5 id="_6-transactional的设置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6-transactional的设置">#</a> （6）<code>@Transactional</code>的设置</h5><p>' @Transactional '注解是元数据，它指定接口、类或方法必须具有事务性语义(例如，“在调用此方法时启动一个全新的只读事务，暂停任何现有事务”)。 默认的“@Transactional”设置如下:</p><ul><li>传播设置为 <code>PROPAGATION_REQUIRED.</code></li><li>隔离级别为 <code>ISOLATION_DEFAULT.</code></li><li>事务处于可读写状态。</li><li>事务超时默认为底层事务系统的默认超时，如果不支持超时，则为none。</li><li>任何<code>RuntimeException</code>触发回滚，而任何选中的<code>Exception</code>不会。</li></ul><p>您可以更改这些默认设置。 下表总结了<code>@Transactional</code>注解的各种属性:</p><table><thead><tr><th style="text-align: left;">特质</th><th style="text-align: left;">类型</th><th style="text-align: left;">描述</th></tr></thead><tbody><tr><td style="text-align: left;"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#tx-multiple-tx-mgrs-with-attransactional" rel="noopener noreferrer" target="_blank">value<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align: left;"><code>String</code></td><td style="text-align: left;">指定要使用的事务管理器的可选限定符。</td></tr><tr><td style="text-align: left;"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#tx-propagation" rel="noopener noreferrer" target="_blank">propagation<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align: left;"><code>enum</code>: <code>Propagation</code></td><td style="text-align: left;">可选的传播环境。</td></tr><tr><td style="text-align: left;"><code>isolation</code></td><td style="text-align: left;"><code>enum</code>: <code>Isolation</code></td><td style="text-align: left;">可选的隔离级别。 仅适用于<code>REQUIRED</code> 或 <code>REQUIRES_NEW</code>的传播值。</td></tr><tr><td style="text-align: left;"><code>timeout</code></td><td style="text-align: left;"><code>int</code>（以秒为粒度）</td><td style="text-align: left;">可选的事务超时。 仅适用于 <code>REQUIRED</code> 或 <code>REQUIRES_NEW</code>的传播值。</td></tr><tr><td style="text-align: left;"><code>readOnly</code></td><td style="text-align: left;"><code>boolean</code></td><td style="text-align: left;">读写事务与只读事务。 只适用于 <code>REQUIRED</code> 或 <code>REQUIRES_NEW</code>的值。</td></tr><tr><td style="text-align: left;"><code>rollbackFor</code></td><td style="text-align: left;"><code>Class</code> 对象的数组，它必须派生自 <code>Throwable.</code></td><td style="text-align: left;">必须导致回滚的异常类的可选数组。</td></tr><tr><td style="text-align: left;"><code>rollbackForClassName</code></td><td style="text-align: left;">类名数组。 类必须派生自 <code>Throwable.</code></td><td style="text-align: left;">必须导致回滚的异常类名称的可选数组。</td></tr><tr><td style="text-align: left;"><code>noRollbackFor</code></td><td style="text-align: left;"><code>Class</code> 对象的数组，它必须派生自<code>Throwable.</code></td><td style="text-align: left;">不能导致回滚的异常类的可选数组。</td></tr><tr><td style="text-align: left;"><code>noRollbackForClassName</code></td><td style="text-align: left;"><code>String</code>类名数组，它必须派生自 <code>Throwable.</code></td><td style="text-align: left;">异常类名称的可选数组，该数组必须不会导致回滚。</td></tr><tr><td style="text-align: left;"><code>label</code></td><td style="text-align: left;">数组<code>String</code>标签，用于向事务添加富有表现力的描述。</td><td style="text-align: left;">事务管理器可以评估标签，以将特定于实现的行为与实际事务关联起来。</td></tr></tbody></table><p>目前，您不能显式地控制事务的名称，其中“name”指出现在事务监视器(例如，WebLogic的事务监视器)和日志输出中的事务名称。 对于声明性事务，事务名总是完全限定类名+ '。 +事务建议类的方法名。 例如，如果' BusinessService '类的' handlePayment(..) '方法启动了一个事务，事务的名称将是: <code>com.example.BusinessService.handlePayment</code>.</p><h5 id="_7-带-transactional的多个事务管理器" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_7-带-transactional的多个事务管理器">#</a> （7） 带 <code>@Transactional</code>的多个事务管理器</h5><p>大多数Spring应用程序只需要一个事务管理器，但是在某些情况下，您可能希望在一个应用程序中有多个独立的事务管理器。 您可以使用' @Transactional '注解的' value '或' transactionManager '属性来指定要使用的' transactionManager '的标识。 这可以是bean名，也可以是事务管理器bean的限定符值。 例如，使用限定符表示法，您可以在应用程序上下文中将下列Java代码与下列事务管理器bean声明组合起来:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionalService</span> &#123;<br><br>    <span class="hljs-meta">@Transactional(&quot;order&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSomething</span><span class="hljs-params">(String name)</span> &#123; ... &#125;<br><br>    <span class="hljs-meta">@Transactional(&quot;account&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span> &#123; ... &#125;<br><br>    <span class="hljs-meta">@Transactional(&quot;reactive-account&quot;)</span><br>    <span class="hljs-keyword">public</span> Mono&amp;lt;Void&amp;gt; doSomethingReactive() &#123; ... &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面的例子显示了bean声明:</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>tx:annotation-driven/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;transactionManager1&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>        ...<br>        <span class="hljs-symbol">&amp;lt;</span>qualifier value=&quot;order&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;transactionManager2&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>        ...<br>        <span class="hljs-symbol">&amp;lt;</span>qualifier value=&quot;account&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;transactionManager3&quot; class=&quot;org.springframework.data.r2dbc.connectionfactory.R2dbcTransactionManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>        ...<br>        <span class="hljs-symbol">&amp;lt;</span>qualifier value=&quot;reactive-account&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这种情况下，' TransactionalService '上的各个方法在单独的事务管理器下运行，通过' order '、' account '和' reactive-account '限定符进行区分。 如果没有找到特别限定的' transactionManager ' bean，则仍然使用默认的' <a href="tx:%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8%E7%9A%84">tx:注解驱动的</a> '目标bean名' transactionManager '。</p><h5 id="_8-自定义注解组成" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_8-自定义注解组成">#</a> （8）自定义注解组成</h5><p>如果您发现在许多不同的方法上重复使用带有' @Transactional '的相同属性，<a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-meta-annotations" rel="noopener noreferrer" target="_blank">Spring的元注解支持<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>允许您为特定的用例定义自定义的组合注解。 例如，考虑以下注解定义:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.METHOD， ElementType.TYPE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Transactional(transactionManager = &quot;order&quot;， label = &quot;causal-consistency&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> OrderTx &#123;<br>&#125;<br><br><span class="hljs-meta">@Target(&#123;ElementType.METHOD， ElementType.TYPE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Transactional(transactionManager = &quot;account&quot;， label = &quot;retryable&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AccountTx &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>前面的注解让我们将上一节中的示例编写为如下所示:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionalService</span> &#123;<br><br>    <span class="hljs-meta">@OrderTx</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSomething</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br><br>    <span class="hljs-meta">@AccountTx</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在前面的示例中，我们使用语法来定义事务管理器限定符和事务标签，但是我们还可以包括传播行为、回滚规则、超时和其他特性。</p><h3 id="四、-事务传播" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、-事务传播">#</a> 四、 事务传播</h3><table><thead><tr><th>传播行为</th><th>含义</th></tr></thead><tbody><tr><td>PROPAGATION_REQUIRED</td><td>表示当前方法必须运行在事务中。如果当前事务存在，方法将会在该事务中运行。否则，会启动一个新的事务</td></tr><tr><td>PROPAGATION_SUPPORTS</td><td>表示当前方法不需要事务上下文，但是如果存在当前事务的话，那么该方法会在这个事务中运行</td></tr><tr><td>PROPAGATION_MANDATORY</td><td>表示该方法必须在事务中运行，如果当前事务不存在，则会抛出一个异常</td></tr><tr><td>PROPAGATION_REQUIRED_NEW</td><td>表示当前方法必须运行在它自己的事务中。一个新的事务将被启动。如果存在当前事务，在该方法执行期间，当前事务会被挂起。如果使用JTATransactionManager的话，则需要访问TransactionManager</td></tr><tr><td>PROPAGATION_NOT_SUPPORTED</td><td>表示该方法不应该运行在事务中。如果存在当前事务，在该方法运行期间，当前事务将被挂起。如果使用JTATransactionManager的话，则需要访问TransactionManager</td></tr><tr><td>PROPAGATION_NEVER</td><td>表示当前方法不应该运行在事务上下文中。如果当前正有一个事务在运行，则会抛出异常</td></tr><tr><td>PROPAGATION_NESTED</td><td>表示如果当前已经存在一个事务，那么该方法将会在嵌套事务中运行。嵌套的事务可以独立于当前事务进行单独地提交或回滚。如果当前事务不存在，那么其行为与PROPAGATION_REQUIRED一样。注意各厂商对这种传播行为的支持是有所差异的。可以参考资源管理器的文档来确认它们是否支持嵌套事务</td></tr></tbody></table><table><thead><tr><th>隔离级别</th><th>含义</th></tr></thead><tbody><tr><td>ISOLATION_DEFAULT</td><td>使用后端数据库默认的隔离级别</td></tr><tr><td>ISOLATION_READ_UNCOMMITTED</td><td>最低的隔离级别，允许读取尚未提交的数据变更，可能会导致脏读、幻读或不可重复读</td></tr><tr><td>ISOLATION_READ_COMMITTED</td><td>允许读取并发事务已经提交的数据，可以阻止脏读，但是幻读或不可重复读仍有可能发生</td></tr><tr><td>ISOLATION_REPEATABLE_READ</td><td>对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，可以阻止脏读和不可重复读，但幻读仍有可能发生</td></tr><tr><td>ISOLATION_SERIALIZABLE</td><td>最高的隔离级别，完全服从ACID的隔离级别，确保阻止脏读、不可重复读以及幻读，也是最慢的事务隔离级别，因为它通常是通过完全锁定事务相关的数据库表来实现的</td></tr></tbody></table><p>本节描述Spring中事务传播的一些语义。 本节详细描述了Spring中关于事务传播的一些语义。</p><p>在spring管理的事务中，要注意物理事务和逻辑事务之间的差异，以及传播设置如何应用于这种差异。</p><h4 id="_1、了解-propagation-required" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、了解-propagation-required">#</a> 1、了解 <code>PROPAGATION_REQUIRED</code></h4><figure><img class="lazy" alt="tx prop required" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/tx_prop_required-67e4b03c.png" tabindex="0"/><figcaption>tx prop required</figcaption></figure><p><code>PROPAGATION_REQUIRED</code>强制物理事务，如果还没有事务存在，则强制当前范围的本地事务，或者强制参与为更大范围定义的现有“外部”事务。 在同一线程内的公共调用堆栈安排中，这是一个很好的默认设置(例如，一个服务facade将委托给几个存储库方法，其中所有底层资源都必须参与服务级事务)。</p><table><thead><tr><th></th><th>默认情况下，参与的事务加入外部范围的特征，静默地忽略本地隔离级别、超时值或只读标志(如果有的话)。 如果您希望在参与具有不同隔离级别的现有事务时拒绝隔离级别声明，请考虑将事务管理器上的' validateExistingTransactions '标记切换为' true '。 这种非宽松模式还拒绝只读不匹配(即试图参与只读外部作用域的内部读写事务)。</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><p>当传播设置为“PROPAGATION_REQUIRED”时，将为应用该设置的每个方法创建一个逻辑事务范围。 每个这样的逻辑事务作用域都可以单独确定仅回滚状态，而外部事务作用域在逻辑上独立于内部事务作用域。 对于标准的‘PROPAGATION_REQUIRED’行为，所有这些作用域都映射到同一个物理事务。 因此，在内部事务作用域中设置的仅回滚标记确实会影响外部事务实际提交的机会。</p><p>但是，在内部事务范围设置仅回滚标记的情况下，外部事务本身没有决定回滚，因此回滚(由内部事务范围无声地触发)是不可预料的。 这时会抛出一个相应的' unexpected drollbackexception '。 这是预期的行为，这样事务的调用者就不会被误导，以为执行了提交，而实际上并没有执行。 因此，如果内部事务(外部调用者不知道)将事务静默地标记为仅回滚，那么外部调用者仍然调用commit。 外部调用者需要接收一个' unexpected drollbackexception '来清楚地表明回滚被执行了。</p><h4 id="_2、理解-propagation-requires-new" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、理解-propagation-requires-new">#</a> 2、理解 <code>PROPAGATION_REQUIRES_NEW</code></h4><figure><img class="lazy" alt="tx prop requires new" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/%E6%A1%86%E6%9E%B6/spring/tx_prop_requires_new-6ba58064.png" tabindex="0"/><figcaption>tx prop requires new</figcaption></figure><p>与<code>PROPAGATION_REQUIRES_NEW</code>相比， <code>PROPAGATION_REQUIRED</code>始终为每个受影响的事务范围使用独立的物理事务，从不参与外部范围的现有事务。 在这种安排中，底层资源事务是不同的，因此可以独立地提交或回滚，外部事务不受内部事务的回滚状态的影响，内部事务的锁在完成后立即释放。 这样一个独立的内部事务还可以声明它自己的隔离级别、超时和只读设置，而不继承外部事务的特征。</p><h4 id="_3、理解-propagation-nested" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、理解-propagation-nested">#</a> 3、理解 <code>PROPAGATION_NESTED</code></h4><p><code>PROPAGATION_NESTED</code> 使用单个物理事务，其中包含多个保存点，可以回滚到这些保存点。 这样的部分回滚允许内部事务范围触发其范围的回滚，而外部事务可以继续物理事务，尽管已经回滚了一些操作。 该设置通常映射到JDBC保存点上，因此它只适用于JDBC资源事务。 看到Spring的 <a href="https://docs.spring.io/spring-framework/docs/5.3.13/javadoc-api/org/springframework/jdbc/datasource/DataSourceTransactionManager.html" rel="noopener noreferrer" target="_blank"><code>DataSourceTransactionManager</code><span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><h3 id="五、-在编程式和声明式事务管理之间进行选择" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#五、-在编程式和声明式事务管理之间进行选择">#</a> 五、 在编程式和声明式事务管理之间进行选择</h3><p>只有在有少量事务操作的情况下，编程式事务管理通常是一个好主意。 例如，如果您有一个web应用程序，它只需要为某些更新操作使用事务，那么您可能不希望使用Spring或任何其他技术来设置事务代理。 在这种情况下，使用<code>TransactionTemplate</code>可能是一种很好的方法。 只有使用事务管理的编程方法才能显式地设置事务名称。</p><p>另一方面，如果应用程序有许多事务操作，则声明式事务管理通常是值得的。 它使事务管理远离业务逻辑，并且不难配置。 当使用Spring框架而不是EJB CMT时，声明性事务管理的配置成本大大降低了。</p><h4 id="整合mybatis" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#整合mybatis">#</a> 整合mybatis</h4><p><a href="http://mybatis.org/spring" rel="noopener noreferrer" target="_blank">http://mybatis.org/spring<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;<br>         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>modelVersion<span class="hljs-symbol">&amp;gt;</span>4.0.0<span class="hljs-symbol">&amp;lt;</span>/modelVersion<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>com.ydlclass<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>ssm<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.0-SNAPSHOT<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>properties<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>maven.compiler.source<span class="hljs-symbol">&amp;gt;</span>11<span class="hljs-symbol">&amp;lt;</span>/maven.compiler.source<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>maven.compiler.target<span class="hljs-symbol">&amp;gt;</span>11<span class="hljs-symbol">&amp;lt;</span>/maven.compiler.target<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/properties<span class="hljs-symbol">&amp;gt;</span><br><br><br>    <span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>junit<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>junit<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>4.13.2<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>scope<span class="hljs-symbol">&amp;gt;</span>test<span class="hljs-symbol">&amp;lt;</span>/scope<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-context<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>5.2.18.RELEASE<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-jdbc<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>5.2.18.RELEASE<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.aspectj<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>aspectjweaver<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.9.6<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>!-- 数据源--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>com.alibaba<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>druid<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.2.8<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- 日志 --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>ch.qos.logback<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>logback-classic<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.2.6<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- 数据区驱动--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>mysql<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>mysql-connector-java<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>8.0.26<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>!-- mybatis--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.mybatis<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>mybatis<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>3.5.5<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>!-- 整合使用 --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.mybatis<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>mybatis-spring<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>2.0.6<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.projectlombok<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>lombok<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.18.22<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>build<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>plugins<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>plugin<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.apache.maven.plugins<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>maven-compiler-plugin<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>3.8.1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>configuration<span class="hljs-symbol">&amp;gt;</span><br>                    <span class="hljs-symbol">&amp;lt;</span>source<span class="hljs-symbol">&amp;gt;</span>$&#123;maven.compiler.source&#125;<span class="hljs-symbol">&amp;lt;</span>/source<span class="hljs-symbol">&amp;gt;</span><br>                    <span class="hljs-symbol">&amp;lt;</span>target<span class="hljs-symbol">&amp;gt;</span>$&#123;maven.compiler.target&#125;<span class="hljs-symbol">&amp;lt;</span>/target<span class="hljs-symbol">&amp;gt;</span><br>                    <span class="hljs-symbol">&amp;lt;</span>encoding<span class="hljs-symbol">&amp;gt;</span>UTF-8<span class="hljs-symbol">&amp;lt;</span>/encoding<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>/configuration<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>/plugin<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/plugins<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/build<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/project<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> itnanls(微信)</span><br><span class="hljs-comment"> * 我们的服务： 一路陪跑，顺利就业</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br><br>    User <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;userId&quot;)</span> <span class="hljs-type">int</span> userId)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>       xmlns:p=&quot;http://www.springframework.org/schema/p&quot;<br>       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;<br>       xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;<br>       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;<br>       xmlns:mybatis=&quot;http://mybatis.org/schema/mybatis-spring&quot;<br>       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>        https://www.springframework.org/schema/beans/spring-beans.xsd<br>        http://www.springframework.org/schema/context<br>        https://www.springframework.org/schema/context/spring-context.xsd<br>        http://www.springframework.org/schema/tx<br>        https://www.springframework.org/schema/tx/spring-tx.xsd<br>        http://mybatis.org/schema/mybatis-spring<br>        http://mybatis.org/schema/mybatis-spring.xsd<br>        http://www.springframework.org/schema/aop<br>        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>context:property-placeholder location=&quot;jdbc.properties&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>context:component-scan base-package=&quot;com.ydlclass&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!--扫描mapper文件--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>mybatis:scan base-package=&quot;com.ydlclass.mapper&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;configLocation&quot; value=&quot;mybatis-config.xml&quot;/<span class="hljs-symbol">&amp;gt;</span>--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;mapperLocations&quot; value=&quot;mapper/**/*.xml&quot;/<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;configuration&quot;<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>bean class=&quot;org.apache.ibatis.session.Configuration&quot;<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>property name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>property name=&quot;logPrefix&quot; value=&quot;ydlclass_&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/property<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 注入事务管理器 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!--数据源--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;driverClassName&quot; value=&quot;$&#123;driverName&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;username&quot; value=&quot;$&#123;user&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- the transactional advice (what &#x27;happens&#x27;; see the <span class="hljs-symbol">&amp;lt;</span>aop:advisor/<span class="hljs-symbol">&amp;gt;</span> bean below) --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- the transactional semantics... --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>tx:attributes<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>!-- all methods starting with &#x27;get&#x27; are read-only --<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;get*&quot; read-only=&quot;true&quot; propagation=&quot;SUPPORTS&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;select*&quot; read-only=&quot;true&quot; propagation=&quot;SUPPORTS&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>!-- other methods use the default transaction settings (see below) --<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;update*&quot; read-only=&quot;false&quot; propagation=&quot;REQUIRED&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;delete*&quot; read-only=&quot;false&quot; propagation=&quot;REQUIRED&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;insert*&quot; read-only=&quot;false&quot; propagation=&quot;REQUIRED&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/tx:attributes<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/tx:advice<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- ensure that the above transactional advice runs for any execution<br>        of an operation defined by the FooService interface --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>aop:config<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>aop:pointcut id=&quot;point&quot; expression=&quot;within(com.ydlclass.service..*)&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>aop:advisor advice-ref=&quot;txAdvice&quot; pointcut-ref=&quot;point&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/aop:config<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!DOCTYPE configuration<br>        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;<br>        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>configuration<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>typeAliases<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>typeAlias type=&quot;com.ydlclass.entity.User&quot; alias=&quot;user&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/typeAliases<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/configuration<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ClassPathXmlApplicationContext</span> <span class="hljs-variable">application</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;application.xml&quot;</span>);<br>        <span class="hljs-type">UserMapper</span> <span class="hljs-variable">userMapper</span> <span class="hljs-operator">=</span> application.getBean(UserMapper.class);<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.getUser(<span class="hljs-number">10002</span>);<br>        log.info(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,user);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text"><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div></div>
<div class="article-footer fs14"></div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">回顾上一篇</div><a href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/redis/redis.html">redis</a></div><div class="item" id="next"><div class="note">接下来阅读</div><a href="/wiki/YDLDoc2/%E6%A1%86%E6%9E%B6/springmvc/springmvc.html">springmvc</a></div></section></div>


  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>快来参与讨论吧~</p>

    </section>
    <section class='body cmt-body waline'>
      

<div id="waline_container" class="waline_thread"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>

    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="sitemap"><div class="sitemap-group"><span class="fs15">博客</span><a href="/">近期</a><a href="/categories/">分类</a><a href="/tags/">标签</a><a href="/archives/">归档</a></div><div class="sitemap-group"><span class="fs15">站点</span><a target="_blank" rel="noopener" href="https://status.thatcoder.cn/status/public/">公共服务</a><a target="_blank" rel="noopener" href="https://ai.thatcoder.cn/">ChatGPT</a><a target="_blank" rel="noopener" href="https://alist.thatcoder.cn/">文件资源</a><a target="_blank" rel="noopener" href="https://docs.thatapi.cn/">公共接口</a></div><div class="sitemap-group"><span class="fs15">社交</span><a href="/links/">友人帐</a><a href="/links/#comments">留言板</a><a href="/animes/">在追番</a><a href="/cinemas/">还追剧</a></div><div class="sitemap-group"><span class="fs15">更多</span><a href="/about/#tab_1-1/">本站动态</a><a target="_blank" rel="noopener" href="https://muselink.cc/naive">联系博主</a><a target="_blank" rel="noopener" href="https://github.com/ThatCoders">GitHub</a><a target="_blank" rel="noopener" href="https://gitee.com/thatcoder">Gitee</a></div></div><div class="text"><p style="text-align:center" >
本站由 <a style="font-weight: bold;" href="/author/ThatCoder/">钟意</a> 使用 <a style="font-weight: bold;" target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。
<br>
由 <a style="font-weight: bold;" target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral">又拍云</a> 提供CDN加速/云存储服务
<br>
由 <a style="font-weight: bold;" target="_blank" rel="noopener" href="https://vercel.com/">vercel</a> 提供托管服务
<br>
<a href="https://beian.miit.gov.cn/" target="_blank">湘ICP备2023019799号-1</a>
<br>
<!--不蒜子计数器-->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!--添加一个访问量-->
<span>总访问 <span id="busuanzi_value_site_pv" style="font-weight: bold;"></span> 次 | 本页访问 <span id="busuanzi_value_page_pv" style="font-weight: bold;"></span> 次</span> 
<div id="siteruntime"></div>
</p>
<script>
function siteTime(){
    window.setTimeout("siteTime()", 1000);
    var seconds = 1000
    var minutes = seconds * 60
    var hours = minutes * 60
    var days = hours * 24
    var years = days * 365
    var today = new Date()
    var todayYear = today.getFullYear()
    var todayMonth = today.getMonth()
    var todayDate = today.getDate()
    var todayHour = today.getHours()
    var todayMinute = today.getMinutes()
    var todaySecond = today.getSeconds()
    var t1 = Date.UTC(2020,4,30,08,00,00)
    var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond)
    var diff = t2-t1
    var diffYears = Math.floor(diff/years)
    var diffDays = Math.floor((diff/days)-diffYears*365)
    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours)
    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes)
    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds)
    document.getElementById("siteruntime").innerHTML="<p style=\"text-align:center\">小破站已颠沛流离 "+diffYears+" 年 "+diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒</p>"
}
siteTime();
</script>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="auto"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E6%A6%82%E8%BF%B0"><span class="toc-text"> 第一章 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81why-spring-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8spring"><span class="toc-text"> 一、Why Spring?（为什么使用spring）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81spring-%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-text"> 二、Spring 的特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%89%88%E6%9C%AC%E5%85%B3%E7%B3%BB"><span class="toc-text"> 三、版本关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-ioc-%E5%AE%B9%E5%99%A8"><span class="toc-text"> 第二章 IOC 容器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="toc-text"> 一、概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%85%8D%E7%BD%AE%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-text"> 二、配置元数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%AE%9E%E4%BE%8B%E5%8C%96%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8"><span class="toc-text"> 三、实例化一个容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%BD%BF%E7%94%A8%E5%AE%B9%E5%99%A8"><span class="toc-text"> 四、使用容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81bean%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="toc-text"> 五、Bean的概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81bean%E7%9A%84%E5%91%BD%E5%90%8D"><span class="toc-text"> 1、bean的命名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81bean%E7%9A%84%E5%88%AB%E5%90%8D"><span class="toc-text"> 2、bean的别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E5%AE%9E%E4%BE%8B%E5%8C%96bean"><span class="toc-text"> 3、实例化bean</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_1-%E4%BD%BF%E7%94%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-text"> （1）使用构造函数实例化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_2-%E4%BD%BF%E7%94%A8%E9%9D%99%E6%80%81%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-text"> （2）使用静态工厂方法实例化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_3-%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-text"> （3）使用实例工厂方法实例化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5-dependency-injection"><span class="toc-text"> 六、依赖注入 Dependency Injection</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E5%9F%BA%E4%BA%8E%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-text"> 1、基于构造函数的依赖注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E5%9F%BA%E4%BA%8Esetter%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="toc-text"> 2、基于setter的注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E5%9F%BA%E4%BA%8E%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E8%BF%98%E6%98%AF%E5%9F%BA%E4%BA%8Esetter%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-text"> 3、基于构造函数还是基于setter的依赖注入?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E5%92%8C%E9%85%8D%E7%BD%AE%E7%BB%86%E8%8A%82"><span class="toc-text"> 4、依赖关系和配置细节</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_1-%E7%9B%B4%E6%8E%A5%E5%80%BC-%E5%8E%9F%E8%AF%AD%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%AD%89"><span class="toc-text"> （1）直接值(原语、字符串等)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_2-idref%E5%85%83%E7%B4%A0"><span class="toc-text"> （2）idref元素</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_3-%E5%AF%B9%E5%85%B6%E4%BB%96bean%E7%9A%84%E5%BC%95%E7%94%A8-collaborators%E5%90%88%E4%BD%9C%E8%80%85"><span class="toc-text"> （3）对其他bean的引用(Collaborators合作者)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_4-%E5%86%85%E9%83%A8bean"><span class="toc-text"> （4）内部bean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_5-%E9%9B%86%E5%90%88"><span class="toc-text"> （5）集合</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_6-null%E5%80%BC%E5%92%8C%E7%A9%BA%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text"> （6）null值和空字符串</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_7-%E5%B8%A6%E6%9C%89%E3%80%90p%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E3%80%91%E7%9A%84xml%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="toc-text"> （7）带有【p命名空间】的XML配置方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_8-%E5%B8%A6%E6%9C%89c%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%9A%84xml%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F"><span class="toc-text"> （8）带有c命名空间的XML快捷方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_9-%E5%A4%8D%E5%90%88%E5%B1%9E%E6%80%A7%E5%90%8D"><span class="toc-text"> （9）复合属性名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_10-%E5%BB%B6%E8%BF%9F%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84-bean"><span class="toc-text"> （10）延迟初始化的 Bean</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_5%E3%80%81%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="toc-text"> 5、自动装配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_6%E3%80%81%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96"><span class="toc-text"> 6、循环依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text"> -----循环依赖的问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81bean-%E4%BD%9C%E7%94%A8%E8%8C%83%E5%9B%B4-%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-text"> 七、Bean 作用范围（作用域）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E5%8D%95%E4%BE%8B%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-text"> 1、单例的作用域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E5%8E%9F%E5%9E%8B%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-text"> 2、原型作用域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E4%BC%9A%E8%AF%9D%E3%80%81%E5%BA%94%E7%94%A8%E5%92%8Cwebsocket%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-text"> 3、会话、应用和WebSocket作用域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8C%83%E5%9B%B4"><span class="toc-text"> 4、自定义范围</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%9B%B4%E5%A4%9Abean%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-text"> 八、更多bean的特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%9E%E8%B0%83"><span class="toc-text"> 1、生命周期回调</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E9%94%80%E6%AF%81%E5%9B%9E%E8%B0%83"><span class="toc-text"> 2、销毁回调</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E9%BB%98%E8%AE%A4%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E9%94%80%E6%AF%81%E6%96%B9%E6%B3%95"><span class="toc-text"> 3、默认初始化和销毁方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text"> 4、总结</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_5%E3%80%81applicationcontextaware-%E5%92%8C-beannameaware"><span class="toc-text"> 5、ApplicationContextAware 和 BeanNameAware</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_6%E3%80%81other-aware-interfaces"><span class="toc-text"> 6、Other Aware Interfaces</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_7%E3%80%81bean%E7%9A%84%E7%BB%A7%E6%89%BF"><span class="toc-text"> 7、Bean的继承</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%AE%B9%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-text"> 九、基于注解的容器配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E4%BD%BF%E7%94%A8-autowired"><span class="toc-text"> 1、使用 @Autowired</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E4%BD%BF%E7%94%A8-primary%E5%BE%AE%E8%B0%83%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="toc-text"> 2、使用 @Primary微调基于注解的自动装配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E4%BD%BF%E7%94%A8-qualifier%E5%BE%AE%E8%B0%83%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="toc-text"> 3、使用@Qualifier微调基于注解的自动装配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E4%BD%BF%E7%94%A8-resource"><span class="toc-text"> 4、使用 @Resource</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E5%AE%B9%E5%99%A8%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="toc-text"> 十、容器的启动过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81classpath%E6%89%AB%E6%8F%8F%E5%92%8C%E7%BB%84%E4%BB%B6%E7%AE%A1%E7%90%86"><span class="toc-text"> 十一、classpath扫描和组件管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81-component-%E5%92%8C%E5%8F%8A%E5%85%B6%E6%B4%BE%E7%94%9F%E5%87%BA%E7%9A%84%E5%85%B6%E4%BB%96%E6%B3%A8%E8%A7%A3%E6%B3%A8%E8%A7%A3"><span class="toc-text"> 1、@Component 和及其派生出的其他注解注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E8%87%AA%E5%8A%A8%E6%A3%80%E6%B5%8B%E7%B1%BB%E5%92%8C%E6%B3%A8%E5%86%8Cbeandifination"><span class="toc-text"> 2、自动检测类和注册beanDifination</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E7%BB%84%E4%BB%B6%E5%91%BD%E5%90%8D"><span class="toc-text"> 3、组件命名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E4%B8%BA%E8%87%AA%E5%8A%A8%E6%A3%80%E6%B5%8B%E7%BB%84%E4%BB%B6%E6%8F%90%E4%BE%9Bscope"><span class="toc-text"> 4、为自动检测组件提供scope</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_5%E3%80%81%E4%BD%BF%E7%94%A8%E8%BF%87%E6%BB%A4%E5%99%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E6%89%AB%E6%8F%8F"><span class="toc-text"> 5、使用过滤器自定义扫描</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_6%E3%80%81%E5%9C%A8%E7%BB%84%E4%BB%B6%E4%B8%AD%E5%AE%9A%E4%B9%89bean%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-text"> 6、在组件中定义Bean元数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_7%E3%80%81%E5%9F%BA%E4%BA%8Ejava%E7%9A%84%E5%AE%B9%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-text"> 7、基于Java的容器配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_1-bean%E5%92%8C-configuration"><span class="toc-text"> （1） @Bean和@Configuration</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_2-%E4%BD%BF%E7%94%A8-annotationconfigapplicationcontext%E5%AE%9E%E4%BE%8B%E5%8C%96spring%E5%AE%B9%E5%99%A8"><span class="toc-text"> （2）使用 AnnotationConfigApplicationContext实例化Spring容器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_3-bean%E6%B3%A8%E8%A7%A3"><span class="toc-text"> （3） @Bean注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_4-configuration"><span class="toc-text"> （4） @Configuration</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_5-%E4%BD%BF%E7%94%A8-import-%E6%B3%A8%E8%A7%A3"><span class="toc-text"> （5） 使用 @Import 注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_6-%E7%BB%93%E5%90%88java%E5%92%8Cxml%E9%85%8D%E7%BD%AE"><span class="toc-text"> （6）结合Java和XML配置</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_8%E3%80%81beanfactory%E5%92%8Cfactorybean"><span class="toc-text"> 8、BeanFactory和FactoryBean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_9%E3%80%81%E7%8E%AF%E5%A2%83%E6%8A%BD%E8%B1%A1"><span class="toc-text"> 9、环境抽象</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_1-profiles"><span class="toc-text"> （1）Profiles</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_2-xml-bean-%E5%AE%9A%E4%B9%89%E7%8E%AF%E5%A2%83"><span class="toc-text"> （2）XML Bean 定义环境</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_3-%E6%BF%80%E6%B4%BB%E4%B8%80%E4%B8%AA%E7%8E%AF%E5%A2%83"><span class="toc-text"> （3）激活一个环境</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_4-porperties"><span class="toc-text"> （4）porperties</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#value"><span class="toc-text"> @Value(&quot;${}&quot;)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_10%E3%80%81%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6"><span class="toc-text"> 10、事件机制</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-resources"><span class="toc-text"> 第三章：Resources</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81resource%E6%8E%A5%E5%8F%A3"><span class="toc-text"> 一、Resource接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%86%85%E7%BD%AE%E7%9A%84-resource%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text"> 二、内置的 Resource的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81urlresource"><span class="toc-text"> 1、UrlResource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-classpathresource"><span class="toc-text"> 2、 ClassPathResource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81filesystemresource"><span class="toc-text"> 3、FileSystemResource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81pathresource"><span class="toc-text"> 4、PathResource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_5%E3%80%81servletcontextresource"><span class="toc-text"> 5、ServletContextResource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_6%E3%80%81inputstreamresource"><span class="toc-text"> 6、InputStreamResource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_7%E3%80%81-bytearrayresource"><span class="toc-text"> 7、 ByteArrayResource</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81resourceloader%E6%8E%A5%E5%8F%A3"><span class="toc-text"> 三、ResourceLoader接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81-%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83%E5%92%8C%E8%B5%84%E6%BA%90%E8%B7%AF%E5%BE%84"><span class="toc-text"> 四、 应用环境和资源路径</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E6%9E%84%E5%BB%BA%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-text"> 1、构建应用程序上下文</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E6%BA%90%E8%B7%AF%E5%BE%84%E4%B8%AD%E7%9A%84%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-text"> 2、源路径中的通配符</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E9%AA%8C%E8%AF%81%E3%80%81%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-text"> 第四章 验证、数据绑定和类型转换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81beanwrapper"><span class="toc-text"> 一、BeanWrapper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81propertyeditor%E5%B1%9E%E6%80%A7%E7%BC%96%E8%BE%91%E5%99%A8"><span class="toc-text"> 二、PropertyEditor属性编辑器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-text"> 三、类型转换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81-converter%E7%9A%84api"><span class="toc-text"> 1、 Converter的API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-conversionservice%E7%9A%84-api"><span class="toc-text"> 2、 ConversionService的 API</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#_3%E3%80%81-%E9%85%8D%E7%BD%AE-databinder%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81"><span class="toc-text"> 3、 配置 DataBinder进行数据验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-spring%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%AD%E8%A8%80-spel"><span class="toc-text"> 第五章：Spring表达式语言（SpEL）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%AE%80%E4%BB%8B"><span class="toc-text"> 一、简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E3%80%81-bean-%E5%AE%9A%E4%B9%89%E4%B8%AD%E7%9A%84%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text"> 二 、 Bean 定义中的表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81xml%E9%85%8D%E7%BD%AE"><span class="toc-text"> 1、XML配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE"><span class="toc-text"> 2、注解配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%AF%AD%E6%B3%95%E5%8F%82%E8%80%83-%E4%B8%8D%E9%9C%80%E8%A6%81%E8%AE%B0%E5%BF%86%E5%95%8A"><span class="toc-text"> 三、语法参考（不需要记忆啊）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81-%E6%96%87%E5%AD%97%E8%A1%A8%E8%BE%BE%E6%96%B9%E5%BC%8F"><span class="toc-text"> 1、 文字表达方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-arrays-lists-maps"><span class="toc-text"> 2、 Arrays， Lists， Maps</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81-%E5%86%85%E8%81%94%E5%88%97%E8%A1%A8"><span class="toc-text"> 3、 内联列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81-%E5%86%85%E8%81%94%E6%98%A0%E5%B0%84"><span class="toc-text"> 4、 内联映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_5%E3%80%81-%E6%95%B0%E7%BB%84%E7%BB%93%E6%9E%84"><span class="toc-text"> 5、 数组结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_6%E3%80%81-%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="toc-text"> 6、 方法调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_7%E3%80%81-%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text"> 7、 运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_8%E3%80%81%E7%B1%BB%E5%9E%8B"><span class="toc-text"> 8、类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_9%E3%80%81%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text"> 9、构造函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_10%E3%80%81-%E5%8F%98%E9%87%8F"><span class="toc-text"> 10、 变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_11%E3%80%81-bean-%E7%9A%84%E5%BC%95%E7%94%A8"><span class="toc-text"> 11、 Bean 的引用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_12%E3%80%81-%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6-if-then-else"><span class="toc-text"> 12、 三元运算符 (If-Then-Else)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-spring%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B"><span class="toc-text"> 第六章 Spring面向切面编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81-aop-%E6%A6%82%E8%BF%B0"><span class="toc-text"> 一、 AOP 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81spring-aop%E8%83%BD%E5%8A%9B%E5%92%8C%E7%9B%AE%E6%A0%87"><span class="toc-text"> 二、Spring AOP能力和目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81aop%E4%BB%A3%E7%90%86"><span class="toc-text"> 三、AOP代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81-aspectj%E9%A3%8E%E6%A0%BC%E7%9A%84%E6%94%AF%E6%8C%81"><span class="toc-text"> 四、@AspectJ风格的支持</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E5%AF%B9%E4%BA%8E-aspectj%E7%9A%84%E6%94%AF%E6%8C%81"><span class="toc-text"> 1、对于 @AspectJ的支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E5%88%87%E9%9D%A2"><span class="toc-text"> 2、 声明一个切面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E5%88%87%E5%85%A5%E7%82%B9"><span class="toc-text"> 3、声明一个切入点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81-%E5%A3%B0%E6%98%8E%E9%80%9A%E7%9F%A5"><span class="toc-text"> 4、 声明通知</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a%E3%80%81-before-advice-%E5%89%8D%E7%BD%AE%E9%80%9A%E7%9F%A5"><span class="toc-text"> a、（Before advice）前置通知</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#b%E3%80%81-after-returning-advice-%E8%BF%94%E5%9B%9E%E9%80%9A%E7%9F%A5"><span class="toc-text"> b、（After returning advice）返回通知</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#c%E3%80%81-after-throwing-advice-%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%E5%90%8E%E9%80%9A%E7%9F%A5"><span class="toc-text"> c、（After throwing advice）抛出异常后通知</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#d%E3%80%81after-finally-%E6%9C%80%E7%BB%88%E9%80%9A%E7%9F%A5"><span class="toc-text"> d、After (Finally) 最终通知</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#e%E3%80%81around%E9%80%9A%E7%9F%A5"><span class="toc-text"> e、Around通知</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#f%E3%80%81%E9%80%9A%E7%9F%A5%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-text"> f、通知的参数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_5%E3%80%81%E5%BC%95%E5%85%A5introduction"><span class="toc-text"> 5、引入Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_6%E3%80%81advice-ordering"><span class="toc-text"> 6、Advice Ordering</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_7%E3%80%81aop-%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-text"> 7、AOP 的例子</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%9F%BA%E4%BA%8Eschema%E7%9A%84aop%E6%94%AF%E6%8C%81"><span class="toc-text"> 五、基于schema的AOP支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%80%89%E6%8B%A9%E4%BD%BF%E7%94%A8%E5%93%AA%E7%A7%8Daop%E5%A3%B0%E6%98%8E%E9%A3%8E%E6%A0%BC"><span class="toc-text"> 六、选择使用哪种AOP声明风格</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81spring-aop-%E8%BF%98%E6%98%AF-full-aspectj"><span class="toc-text"> 1、Spring AOP 还是 Full AspectJ?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-aspectj%E8%BF%98%E6%98%AFspring-aop%E7%9A%84-xml"><span class="toc-text"> 2、 @AspectJ还是Spring AOP的 XML?</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E4%BB%A5%E7%BC%96%E7%A8%8B%E6%96%B9%E5%BC%8F%E5%88%9B%E5%BB%BA-aspectj%E4%BB%A3%E7%90%86"><span class="toc-text"> 七、以编程方式创建@AspectJ代理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-text"> 第七章 事务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81spring%E6%A1%86%E6%9E%B6%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-text"> 一、Spring框架事务支持模型的优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-%E7%90%86%E8%A7%A3spring%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BA%8B%E5%8A%A1%E6%8A%BD%E8%B1%A1"><span class="toc-text"> 二、 理解Spring框架的事务抽象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81transactionmanager"><span class="toc-text"> 1、TransactionManager</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81transactiondefinition"><span class="toc-text"> 2、TransactionDefinition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81transactionstatus"><span class="toc-text"> 3、TransactionStatus</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%BC%96%E7%A8%8B%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-text"> 三、编程式事务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81-%E4%BD%BF%E7%94%A8-transactionmanager"><span class="toc-text"> 1、 使用 TransactionManager</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">#</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-%E4%BD%BF%E7%94%A8transactiontemplate"><span class="toc-text"> 2、 使用TransactionTemplate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-text"> 3、 声明式事务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_1-%E7%90%86%E8%A7%A3spring%E6%A1%86%E6%9E%B6%E7%9A%84%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="toc-text"> （1） 理解Spring框架的声明式事务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_2-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%A4%BA%E4%BE%8B"><span class="toc-text"> （2）声明式事务实现的示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_3-%E4%BA%8B%E5%8A%A1%E5%9B%9E%E6%BB%9A"><span class="toc-text"> （3）事务回滚</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_4-tx-advice-%E8%AE%BE%E7%BD%AE"><span class="toc-text"> （4） &lt;tx:advice&#x2F;&gt; 设置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_5-%E4%BD%BF%E7%94%A8-transactional"><span class="toc-text"> （5）使用 @Transactional</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_6-transactional%E7%9A%84%E8%AE%BE%E7%BD%AE"><span class="toc-text"> （6）@Transactional的设置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_7-%E5%B8%A6-transactional%E7%9A%84%E5%A4%9A%E4%B8%AA%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-text"> （7） 带 @Transactional的多个事务管理器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_8-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%E7%BB%84%E6%88%90"><span class="toc-text"> （8）自定义注解组成</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81-%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD"><span class="toc-text"> 四、 事务传播</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E4%BA%86%E8%A7%A3-propagation-required"><span class="toc-text"> 1、了解 PROPAGATION_REQUIRED</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E7%90%86%E8%A7%A3-propagation-requires-new"><span class="toc-text"> 2、理解 PROPAGATION_REQUIRES_NEW</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E7%90%86%E8%A7%A3-propagation-nested"><span class="toc-text"> 3、理解 PROPAGATION_NESTED</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81-%E5%9C%A8%E7%BC%96%E7%A8%8B%E5%BC%8F%E5%92%8C%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E4%B9%8B%E9%97%B4%E8%BF%9B%E8%A1%8C%E9%80%89%E6%8B%A9"><span class="toc-text"> 五、 在编程式和声明式事务管理之间进行选择</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E5%90%88mybatis"><span class="toc-text"> 整合mybatis</span></a></li></ol></li></ol></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"post, page, docs","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    applyThemeToGiscus(theme)
  }

  const applyThemeToGiscus = (theme) => {
    theme = theme === 'auto' ? 'preferred_color_scheme' : theme

    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)

    const messages = {
      light: `切换到浅色模式`,
      dark: `切换到深色模式`,
      auto: `切换到跟随系统配色`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    }
  })()
</script>


<!-- optional -->

  <script type="module">
  import { init } from 'https://upyun.thatcdn.cn/public/web/waline/v3/client/dist/waline.js'

  function load_comment(){
    if(!document.getElementById("waline_container"))return;

    utils.css('https://upyun.thatcdn.cn/public/web/waline/v3/client/dist/waline.css');
    utils.css('https://gcore.jsdelivr.net/npm/@waline/client@3.1.3/dist/waline-meta.css');

    const el = document.getElementById("waline_container");
    var path = el.getAttribute('comment_id');
    if (!path) {
      path = decodeURI(window.location.pathname);
    }

    const waline = init(Object.assign({"js":"https://upyun.thatcdn.cn/public/web/waline/v3/client/dist/waline.js","css":"https://upyun.thatcdn.cn/public/web/waline/v3/client/dist/waline.css","meta_css":"https://gcore.jsdelivr.net/npm/@waline/client@3.1.3/dist/waline-meta.css","serverURL":"https://waline.thatapi.cn/","commentCount":true,"pageview":false,"custom":{"css":"/custom/css/ZYWaline.css"},"search":false,"locale":{"placeholder":"  遇事不决, 可问春风..."},"emoji":["https://upyun.thatcdn.cn/public/web/emojis/bilibili","https://upyun.thatcdn.cn/public/web/emojis/qq","https://upyun.thatcdn.cn/public/web/emojis/tieba","https://upyun.thatcdn.cn/public/web/emojis/weibo"],"reaction":["https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_cute.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_chuckle.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_sunglasses.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_crazy.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_pick_nose.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_not_care.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_trollface.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_thumbsup.png"],"meta":["nick","mail","link"],"imageUploader":{"fileName":"file","tokenName":"Authorization","api":"https://lsky.thatcoder.cn/api/v1/upload","token":"Bearer 6|x9vHGJGHAnjqbO0PGEE5vM7r9S9hdqFA9bmdESdm","resp":"data.links.url"}}, {
      el: '#waline_container',
      path: path,
      
        imageUploader: function(file) {
          let headers = new Headers();
          headers.set('Accept', 'application/json');
          
            headers.set('Authorization', 'Bearer 6|x9vHGJGHAnjqbO0PGEE5vM7r9S9hdqFA9bmdESdm')
          
          let formData = new FormData();
          formData.append('file', file);
          return fetch('https://lsky.thatcoder.cn/api/v1/upload',{
            method: 'POST',
            body: formData,
            headers: headers
            }).then((resp) => resp.json())
              .then((resp) => resp.data.links.url)
        },
      
    }));

  }
  window.addEventListener('DOMContentLoaded', (event) => {
    load_comment();
  });

</script>




<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.swiper-slide img, .md-text.content p>img, .md-text.content li img , .wl-content img, waline_container .vcontent img, .timeline .body .image img,  .timeline .gallery img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>




<!-- inject -->
<script type="text/javascript" src="/custom/js/ZYUtil.js"></script><script type="text/javascript" src="/custom/js/ZYDark.js"></script><script type="text/javascript" src="/custom/js/ZYCategory.js"></script><script type="text/javascript" src="/custom/js/ZYCode.js"></script><script type="text/javascript" src="/custom/js/timetmpl.js"></script>
</div></body></html>
