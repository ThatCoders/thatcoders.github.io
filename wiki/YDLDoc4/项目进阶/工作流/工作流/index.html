
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.33.1" theme-name="Stellar" theme-version="1.33.1">
  <link rel="canonical" href="https://blog.thatcoder.cn/wiki/YDLDoc4/项目进阶/工作流/工作流">
  
  <meta name="generator" content="Hexo 7.3.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  <title>YDLDoc4：工作流 - 钟意博客</title>

  
    <meta name="description" content="# Activiti7 工作流引擎入门# 做课目的# 一、适用人群： 普通人不是每个人都能进入一线互联网大厂 BATJ普通人，省城，软件公司，银行、政府做# 二、适用项目：OA CRM ERP 系统出差报销流程、请假流程# 三、课程特点：说人话快速上手工作流# 四、资料领取ydlclass.comopen in new window 领取欢迎支持# 第一章 工作流相关术语# 一、工作流介绍工作流(">
<meta property="og:type" content="website">
<meta property="og:title" content="工作流">
<meta property="og:url" content="https://blog.thatcoder.cn/wiki/YDLDoc4/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/%E5%B7%A5%E4%BD%9C%E6%B5%81/">
<meta property="og:site_name" content="钟意博客">
<meta property="og:description" content="# Activiti7 工作流引擎入门# 做课目的# 一、适用人群： 普通人不是每个人都能进入一线互联网大厂 BATJ普通人，省城，软件公司，银行、政府做# 二、适用项目：OA CRM ERP 系统出差报销流程、请假流程# 三、课程特点：说人话快速上手工作流# 四、资料领取ydlclass.comopen in new window 领取欢迎支持# 第一章 工作流相关术语# 一、工作流介绍工作流(">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.thatcoder.cn/favicon.ico">
<meta property="article:published_time" content="2025-07-21T12:21:48.105Z">
<meta property="article:modified_time" content="2025-07-21T12:21:48.105Z">
<meta property="article:author" content="钟意">
<meta property="article:tag" content="那个码农">
<meta property="article:tag" content="码农钟意">
<meta property="article:tag" content="钟意的博客">
<meta property="article:tag" content="钟意博客">
<meta property="article:tag" content="That Coder">
<meta property="article:tag" content="thatcoder">
<meta property="article:tag" content="源柒拾柒雅舍">
<meta property="article:tag" content="源WebGary">
<meta property="article:tag" content="giligili.work">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.thatcoder.cn/favicon.ico">
  
  

  <meta name="keywords" content="那个码农,码农钟意,钟意的博客,钟意博客,That Coder,thatcoder,源柒拾柒雅舍,源WebGary,giligili.work">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="钟意博客" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.33.1">


  
    <link rel="shortcut icon" href="/favicon.ico">
  

  
    
<link rel="stylesheet" href="/custom/css/ZYCode.css">

  

  <script type="application/ld+json">{"@context":"https://schema.org","@type":"Website","@id":"https://blog.thatcoder.cn/wiki/YDLDoc4/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/%E5%B7%A5%E4%BD%9C%E6%B5%81/","author":{"@type":"Person","name":"钟意","sameAs":[],"image":"/favicon.ico"},"name":"工作流","description":"# Activiti7 工作流引擎入门# 做课目的# 一、适用人群： 普通人不是每个人都能进入一线互联网大厂 BATJ普通人，省城，软件公司，银行、政府做# 二、适用项目：OA CRM ERP 系统出差报销流程、请假流程# 三、课程特点：说人话快速上手工作流# 四、资料领取ydlclass.comopen in new window 领取欢迎支持# 第一章 工作流相关术语# 一、工作流介绍工...","url":"https://blog.thatcoder.cn/wiki/YDLDoc4/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/%E5%B7%A5%E4%BD%9C%E6%B5%81/","keywords":["那个码农","码农钟意","钟意的博客","钟意博客","That Coder","thatcoder","源柒拾柒雅舍","源WebGary","giligili.work"]}</script>
  <link rel="Shortcut Icon" href="/favicon.ico" type="image/x-icon" /><link rel='stylesheet' href='https://public.thatcdn.cn/font/old_song/result.css' /><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="/custom/css/ZYTimetmpl.css" /><meta itemprop="name" content="钟意博客"><meta itemprop="author" content="钟意"><meta itemprop="description" content="笔名钟意, 记录代码与生活."><meta name="sogou_site_verification" content="spLj7Zz5dI" /><meta itemprop="image" content="https://upyun.thatcdn.cn/hexo/stellar/image/shot.webp"><link rel="stylesheet" href="/custom/css/ZYGlobal.css"><link rel="stylesheet" href="/custom/css/ZYWaline.css"><link rel="stylesheet" href="/custom/css/ZYPage.css"><script type="text/javascript" src="/custom/js/header.js"></script><!-- Clarity tracking code for https://blog.thatcoder.cn/ -->
<script>    (function(c,l,a,r,i,t,y){        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i+"?ref=bwt";        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);    })(window, document, "clarity", "script", "fi1zg7i5q5");</script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H6GM3XZWV7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-H6GM3XZWV7');
</script>
<!-- BaiDu-ZhanZhang
<meta name="baidu-site-verification" content="codeva-8tnFVr706d" />
<!-- BaiDu-Tongji -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?233765a020502d5d6a92d4fe306d36c2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>
<body>



<div class="l_body s:aa content tech " id="start" layout="page" type="tech" ><aside class="l_left"><div class="sidebg"></div><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><div class="icon"><img no-lazy class="icon" src="/custom/img/ydl.png" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></div><a class="title" href="/wiki/YDLDoc4/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/%E5%B7%A5%E4%BD%9C%E6%B5%81"><div class="main">YDLDoc4</div><div class="sub normal cap">关于YDLDoc的笔记</div><div class="sub hover cap" style="opacity:0"> 不对之处请指出</div></a></div></header>

<div class="nav-area">

<nav class="menu dis-select"><a class="nav-item" title="博客" href="/"><span>博客</span></a><a class="nav-item active" title="笔记" href="/wiki/"><span>笔记</span></a><a class="nav-item" title="便签" href="/notes/"><span>便签</span></a><a class="nav-item" title="社交" href="/links/"><span>社交</span></a></nav>
</div>
<div class="widgets">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" data-filter="/wiki/YDLDoc4/" placeholder="在 YDLDoc4 中搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<widget class="widget-wrapper doc-tree post-list"><div class="widget-body fs14"><a class="link active" href="/wiki/YDLDoc4/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/%E5%B7%A5%E4%BD%9C%E6%B5%81/#start"><span class="toc-text">工作流</span><svg class="active-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M21 11.098v4.993c0 3.096 0 4.645-.734 5.321c-.35.323-.792.526-1.263.58c-.987.113-2.14-.907-4.445-2.946c-1.02-.901-1.529-1.352-2.118-1.47a2.225 2.225 0 0 0-.88 0c-.59.118-1.099.569-2.118 1.47c-2.305 2.039-3.458 3.059-4.445 2.945a2.238 2.238 0 0 1-1.263-.579C3 20.736 3 19.188 3 16.091v-4.994C3 6.81 3 4.666 4.318 3.333C5.636 2 7.758 2 12 2c4.243 0 6.364 0 7.682 1.332C21 4.665 21 6.81 21 11.098" opacity=".5"/><path fill="currentColor" d="M9 5.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5z"/></svg></a><a class="link" href="/wiki/YDLDoc4/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/"><span class="toc-text">自动化构建</span></a><a class="link" href="/wiki/YDLDoc4/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E7%9F%AD%E4%BF%A1%E9%80%9A%E9%81%93/%E7%9F%AD%E4%BF%A1%E9%80%9A%E9%81%93/"><span class="toc-text">短信通道</span></a><a class="link" href="/wiki/YDLDoc4/%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93%E7%BD%91/%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/"><span class="toc-text">二奢交易</span></a></div></widget>

<widget class="widget-wrapper post-card"><div class="widget-header dis-select"><span class="name">更多：开发</span></div><div class="widget-body"><a class="item wiki" href="/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/maven%E5%85%A5%E9%97%A8/maven%E5%85%A5%E9%97%A8/"><span class="title">元动力摘录 - JAVA阶段二</span><span class="excerpt">钟意关于YDLDoc的笔记</span></a><a class="item wiki" href="/wiki/YDLDoc3/kafka/kafka%E8%BF%9B%E9%98%B6/kafka%E8%BF%9B%E9%98%B6/"><span class="title">元动力摘录 - JAVA阶段三</span><span class="excerpt">钟意关于YDLDoc的笔记</span></a><a class="item wiki" href="/wiki/YuDaoBoot/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/"><span class="title">艿艿若依Boot - 开发指南</span><span class="excerpt">关于艿艿若依Boot的文档</span></a><a class="item wiki" href="/wiki/YuDaoCloud/%E5%89%8D%E7%AB%AF%E6%89%8B%E5%86%8C%20Vue%202/%E5%AD%97%E5%85%B8%E6%95%B0%E6%8D%AE/%E5%AD%97%E5%85%B8%E6%95%B0%E6%8D%AE/"><span class="title">艿艿若依Cloud - 开发指南</span><span class="excerpt">关于艿艿若依Cloud的文档</span></a><a class="item wiki" href="/wiki/Laf/start/start/"><span class="title">Laf - 开箱即用的 serverless</span><span class="excerpt">钟意关于Laf的笔记</span></a><a class="item wiki" href="/wiki/YDLDoc1/javase/%E5%8F%8D%E5%B0%84/%E5%8F%8D%E5%B0%84/"><span class="title">元动力摘录 - JAVA阶段一</span><span class="excerpt">钟意关于YDLDoc的笔记</span></a><a class="item wiki" href="/wiki/MySql/basics/select/"><span class="title">MySql - 关系型数据库管理系统</span><span class="excerpt">钟意关于关系型数据库MySql的笔记</span></a><a class="item wiki" href="/wiki/SpringCloud/start/"><span class="title">SpringCloud - JAVA系分布式微服务架构</span><span class="excerpt">钟意关于SpringCloud的笔记</span></a></div></widget>

<widget class="widget-wrapper recent post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/wiki/forgejo/s3/"><span class="title"><strong>forgejo</strong><span class="dot"></span>Forgejo S3存储桶</span></a><a class="item title" href="/wiki/forgejo/cache/"><span class="title"><strong>forgejo</strong><span class="dot"></span>Forgejo Redis缓存</span></a><a class="item title" href="/wiki/forgejo/ssh/"><span class="title"><strong>forgejo</strong><span class="dot"></span>Forgejo SSH端口修改</span></a><a class="item title" href="/wiki/forgejo/start/"><span class="title"><strong>forgejo</strong><span class="dot"></span>Forgejo 容器部署</span></a><a class="item title" href="/notes/"><span class="title"><strong>便签</strong><span class="dot"></span>钟意的便签</span></a><a class="item title" href="/notes/develop/"><span class="title"><strong>开发速查</strong><span class="dot"></span>开发助手</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" style="grid-column: span 3;height:32px;padding: 0;" href="https://space.bilibili.com/1664687779" target="_blank" rel="external nofollow noopener noreferrer"><img height="32px" src="https://upyun.thatcdn.cn/public/img/icon/bilibili-banner.jpg"/></a><a class="social" style="grid-column: span 3;height:32px;padding: 0;" href="https://muselink.cc/naive" target="_blank" rel="external nofollow noopener noreferrer"><img height="32px" src="https://upyun.thatcdn.cn/public/img/icon/wechat-banner.jpg"/></a><a class="social" style="grid-column: span 3;height:32px;padding: 0;" href="https://github.com/ThatCoders" target="_blank" rel="external nofollow noopener noreferrer"><img height="32px" src="https://upyun.thatcdn.cn/public/img/icon/github-banner.jpg"/></a><a class="social" href="javascript:ThemeChange('dark');" rel="noopener noreferrer"><img id="ThemeM" src="https://upyun.thatcdn.cn/public/img/icon/Moon.png"/></a><a class="social" href="javascript:ThemeChange('light');" rel="noopener noreferrer"><img id="ThemeL" src="https://upyun.thatcdn.cn/public/img/icon/Sun.png"/></a><a class="social" href="javascript:ThemeChange('auto');" rel="noopener noreferrer"><img id="ThemeAI" src="https://upyun.thatcdn.cn/public/img/icon/AI.png"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
    <div class="content">
      <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" id="menu" href="/wiki/">文档</a><span class="sep"></span><a class="cap breadcrumb" id="proj" href="/wiki/YDLDoc4/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/%E5%B7%A5%E4%BD%9C%E6%B5%81/">YDLDoc4</a></div>
<div class="flex-row" id="post-meta"><span class="text created">更新于：<time datetime="2025-07-21T12:21:48.105Z">2025-07-21</time></span></div></div></div>
      
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>工作流</span></h1>
        
      </div>
    </div>
    
    </div>
    </div><article class="md-text content"><div class="theme-hope-content"><h1 id="activiti7-工作流引擎入门" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#activiti7-工作流引擎入门">#</a> Activiti7 工作流引擎入门</h1><h2 id="做课目的" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#做课目的">#</a> 做课目的</h2><h3 id="一、适用人群-普通人" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、适用人群-普通人">#</a> 一、适用人群： 普通人</h3><p>不是每个人都能进入一线互联网大厂 BATJ</p><p>普通人，省城，软件公司，银行、政府做</p><h3 id="二、适用项目-oa-crm-erp-系统" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、适用项目-oa-crm-erp-系统">#</a> 二、适用项目：OA CRM ERP 系统</h3><p>出差报销流程、请假流程</p><h3 id="三、课程特点-说人话" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、课程特点-说人话">#</a> 三、课程特点：说人话</h3><p>快速上手工作流</p><h3 id="四、资料领取" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、资料领取">#</a> 四、资料领取</h3><p><a href="http://ydlclass.com" rel="noopener noreferrer" target="_blank">ydlclass.com<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 领取</p><p>欢迎支持</p><h2 id="第一章-工作流相关术语" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第一章-工作流相关术语">#</a> 第一章 工作流相关术语</h2><h3 id="一、工作流介绍" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、工作流介绍">#</a> <strong>一、工作流介绍</strong></h3><p>工作流(Workflow)，就是通过计算机对业务流程自动化执行管理。它主要解决的是“使在多个参与者之间按照某种预定义的规则自动进行传递文档、信息或任务的过程，从而实现某个预期的业务目标，或者促使此目标的实现”。</p><p>企业OA：</p><p>请假----》内网系统----》小李填写请假单7天----》组长同意----》CTO同意------》人事部部长同意-----》结束</p><p>专门的公司做OA CRM ERP: 金蝶、用友</p><h3 id="二、工作流系统" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、工作流系统">#</a> <strong>二、工作流系统</strong></h3><p>一个软件系统中具有工作流的功能，我们把它称为工作流系统，一个系统中工作流的功能是什么？就是对系统的业务流程进行自动化管理，所以工作流是建立在业务流程的基础上，所以一个软件的系统核心根本上还是系统的业务流程，工作流只是协助进行业务流程管理。即使没有工作流业务系统也可以开发运行，只不过有了工作流可以更好的管理业务流程，提高系统的可扩展性。</p><h4 id="_1、-适用行业" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、-适用行业">#</a> <strong>1、</strong> <strong>适用行业</strong></h4><p>消费品行业，制造业，电信服务业，银证险等金融服务业，物流服务业，物业服务业，物业管理，大中型进出口贸易公司，政府事业机构，研究院所及教育服务业等，特别是大的跨国企业和集团公司。</p><h4 id="_2、-具体应用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-具体应用">#</a> <strong>2、</strong> <strong>具体应用</strong></h4><ol><li><p>关键业务流程：订单、报价处理、合同审核、客户电话处理、供应链管理等</p></li><li><p>行政管理类:出差申请、加班申请、请假申请、用车申请、各种办公用品申请、购买申请、日报周报等凡是原来手工流转处理的行政表单。</p></li><li><p>人事管理类：员工培训安排、绩效考评、职位变动处理、员工档案信息管理等。kpi</p></li><li><p>财务相关类：付款请求、应收款处理、日常报销处理、出差报销、预算和计划申请等。</p></li><li><p>客户服务类：客户信息管理、客户投诉、请求处理、售后服务管理等。</p></li><li><p>特殊服务类：ISO 系列对应流程、质量管理对应流程、产品数据信息管理、贸易公司报关处理、物流公司货物跟踪处理等各种通过表单逐步手工流转完成的任务均可应用工作流软件自动规范地实施。</p></li></ol><h3 id="三、工作流实现方式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、工作流实现方式">#</a> 三、<strong>工作流实现方式</strong></h3><p>纸条：介绍信。 档案管理部门，信息管理，上级学科：图情档</p><p>在没有专门的工作流引擎之前，我们之前为了实现流程控制，通常的做法就是采用状态字段的值来跟踪流程的变化情况。这样不用角色的用户，通过状态字段的取值来决定记录是否显示。</p><figure><img alt="image-20220905011210770" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905011210770-3739df7c.png" tabindex="0"/><figcaption>image-20220905011210770</figcaption></figure><p>针对有权限可以查看的记录，当前用户根据自己的角色来决定审批是否合格的操作。如果合格将状态字段设置一个值，来代表合格；当然如果不合格也需要设置一个值来代表不合格的情况。</p><p><strong>缺点</strong>：</p><p>这是一种最为原始的方式。通过状态字段虽然做到了流程控制，但是当我们的流程发生变更的时候，这种方式所编写的代码也要进行调整。</p><figure><img alt="image-20220905011424642" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905011424642-cd2f110a.png" tabindex="0"/><figcaption>image-20220905011424642</figcaption></figure><p>想看一条记录的历史发展，怎么办？</p><figure><img alt="image-20220905011728332" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905011728332-f141b0ba.png" tabindex="0"/><figcaption>image-20220905011728332</figcaption></figure><p>那么有没有专业的方式来实现工作流的管理呢？并且可以做到业务流程变化之后，我们的程序可以不用改变，如果可以实现这样的效果，那么我们的业务系统的适应能力就得到了极大提升。</p><h3 id="四、工作流实现原理分析" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、工作流实现原理分析">#</a> 四、<strong>工作流实现原理分析</strong></h3><p>如何可以做到我们在业务流程发生变更后，我们的业务系统代码可以不发生改变？此时我们就来分析一下原理。</p><p>具体分析过程如下图所示：</p><figure><img alt="image-20220905014033874" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905014033874-f9749b33.png" tabindex="0"/><figcaption>image-20220905014033874</figcaption></figure><figure><img alt="image-20220905014356894" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905014356894-cbbd29ea.png" tabindex="0"/><figcaption>image-20220905014356894</figcaption></figure><p>文字版</p><figure><img alt="image-20220905015304532" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905015304532-acee5f5e.png" tabindex="0"/><figcaption>image-20220905015304532</figcaption></figure><h2 id="第二章-activiti7-概述" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第二章-activiti7-概述">#</a> 第二章 Activiti7 概述</h2><h3 id="一、activiti-介绍" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、activiti-介绍">#</a> <strong>一、Activiti</strong> <strong>介绍</strong></h3><p>Alfresco 软件在 2010 年 5 月 17 日宣布 Activiti 业务流程管理（BPM）开源项目的正式启动，其首席架构师由业务流程管理 BPM 的专家 Tom Baeyens 担任，Tom Baeyens 就是原来 jbpm 的架构师，而 jbpm 是一个非常有名的工作流引擎，当然 activiti 也是一个工作流引擎。</p><p>Activiti 是一个工作流引擎， activiti 可以将业务系统中复杂的业务流程抽取出来，使用专门的建模语言（BPMN2.0）进行定义，业务系统按照预先定义的流程进行执行，实现了业务系统的业务流程由 activiti 进行管理，减少业务系统由于流程变更进行系统升级改造的工作量，从而提高系统的健壮性，同时也减少了系统开发维护成本。</p><p>官方网站：<a href="https://www.activiti.org" rel="noopener noreferrer" target="_blank">https://www.activiti.org<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img alt="image-20220905015510972" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905015510972-5a03ce25.png" tabindex="0"/><figcaption>image-20220905015510972</figcaption></figure><p>经历的版本 5.X 6.X 已经不维护</p><p>目前最新版本：Activiti7.3.0</p><p>多款工作流引擎的比较</p><p><strong>1. Activiti</strong></p><p>​ Alfresco软件开发，基于JBPM4，后并入OMG，目前最高版本activiti 7。Activiti5版本的时候，核心团队发生了比较大的变动（离职），activiti6的开发团队在新版本中去除了PVM，纳入了DMN，重构XML解析，BUG较多，目前主要团队致力于activiti7。 5&amp;6已经官宣不维护。</p><p><strong>2. Flowable</strong></p><p>基于activiti6，最新的开源版本是flowable6，开发团队是从activiti中分裂出来的，修复了一众activiti6的bug，并在其基础上研发了DMN支持，BPEL支持等等。相对开源版，其商业版的功能会更强大。</p><p><strong>3. Camunda</strong></p><p>基于activiti5，所以其保留了PVM，最新版本Camunda7，开发团队也是从activiti中分裂出来的，发展轨迹与flowable相似，同时也提供了商业版。</p><p><strong>4. JFlow</strong></p><p>前身ccFlow，国产的工作流引擎，由济南驰骋公司开发维护，主打中国式的业务流程，由于是国产的软件，中文化程度比较深，业务开发也对用户比较友好。国产的开源工作流引擎还是挺多的，JFlow是其中功能比较完善的一个，同时对比activiti，流程上更加中国化，支持自定义流程跳转，加签等。其他国产工作流就不列举了。</p><h4 id="_1、bpm" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、bpm">#</a> **1、<strong>BPM</strong></h4><p>BPM（Business Process Management），即业务流程管理，是一种以规范化的构造端到端的卓越业务流程为中心，以持续的提高组织业务绩效为目的系统化方法，常见商业管理教育如 EMBA、MBA等均将 BPM 包含在内。</p><p>企业流程管理主要是对企业内部改革，改变企业职能管理机构重叠、中间层次多、流程不闭环等，做到机构不重叠、业务不重复，达到缩短流程周期、节约运作资本、提高企业效益的作用。</p><p>比较下边的两个人事加薪流程哪个效率更高？</p><p>流程一：</p><figure><img alt="image-20220905022930746" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905022930746-6c313491.png" tabindex="0"/><figcaption>image-20220905022930746</figcaption></figure><p>流程二：</p><figure><img alt="image-20220905022911309" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905022911309-f52acaab.png" tabindex="0"/><figcaption>image-20220905022911309</figcaption></figure><p>第二种情况效率更高：3天内请假，部门经理完全能处理了。不用打扰总经理。</p><h4 id="_2、-bpm-软件" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-bpm-软件">#</a> <strong>2、</strong> <strong>BPM</strong> <strong>软件</strong></h4><p>BPM 软件就是根据企业中业务环境的变化，推进人与人之间、人与系统之间以及系统与系统之间的整合及调整的经营方法与解决方案的 IT 工具。 通常以 Internet 方式实现信息传递、数据同步、业务监控和企业业务流程的持续升级优化，从而实现跨应用、跨部门、跨合作伙伴与客户的企业运作。通过 BPM 软件对企业内部及外部的业务流程的整个生命周期进行建模、自动化、管理监控和优化，使企业成本降低，利润得以大幅提升。</p><p>BPM 软件在企业中应用领域广泛，凡是有业务流程的地方都可以 BPM 软件进行管理，比如企业人事办公管理、采购流程管理、公文审批流程管理、财务管理等。</p><h4 id="_3、-bpmn" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、-bpmn">#</a> <strong>3、</strong> <strong>BPMN</strong></h4><p>BPMN（Business Process Model And Notation）- 业务流程模型和符号 是由 BPMI（Business Process Management Initiative）开发的一套标准的业务流程建模符号，使用 BPMN 提供的符号可以创建业务流程。 2004 年 5 月发布了 BPMN1.0 规范.BPMI 于 2005 年 9 月并入 OMG（The Object Management Group 对象管理组织)组织。OMG 于 2011 年 1 月发布 BPMN2.0 的最终版本。</p><p>具体发展历史如下</p><figure><img alt="image-20220905020425452" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905020425452-46032070.png" tabindex="0"/><figcaption>image-20220905020425452</figcaption></figure><p>BPMN 是目前被各 BPM 厂商广泛接受的 BPM 标准。Activiti 就是使用 BPMN 2.0 进行流程建模、流程执行管理，它包括很多的建模符号，比如：</p><p>Event 用一个圆圈表示，它是流程中运行过程中发生的事情。</p><figure><img alt="image-20220905023313346" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905023313346-e65ea374.png" tabindex="0"/><figcaption>image-20220905023313346</figcaption></figure><p>一个 bpmn 图形的例子：</p><ul><li>​ 填写请假单</li><li>​ 部门经理审核</li><li>​ 总经理审核</li></ul><p>最后请假流程结束。</p><figure><img alt="image-20220905023546896" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905023546896-45c107cc.png" tabindex="0"/><figcaption>image-20220905023546896</figcaption></figure><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>definitions xmlns=&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:activiti=&quot;http://activiti.org/bpmn&quot; xmlns:bpmndi=&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot; xmlns:omgdc=&quot;http://www.omg.org/spec/DD/20100524/DC&quot; xmlns:omgdi=&quot;http://www.omg.org/spec/DD/20100524/DI&quot; typeLanguage=&quot;http://www.w3.org/2001/XMLSchema&quot; expressionLanguage=&quot;http://www.w3.org/1999/XPath&quot; targetNamespace=&quot;http://www.activiti.org/processdef&quot;<span class="hljs-symbol">&amp;gt;</span><br>  <span class="hljs-symbol">&amp;lt;</span>process id=&quot;Test1&quot; name=&quot;Test1&quot; isExecutable=&quot;true&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>startEvent id=&quot;sid-9bb97b6a-8f2c-4e3e-bf95-ec61ae92e018&quot; name=&quot;开始流程&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>userTask id=&quot;sid-47945474-d1fe-41d7-b4ca-af9b7a997496&quot; name=&quot;填写请假单&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>userTask id=&quot;sid-4d508bbe-52a3-4818-a6b0-28a2cb93b1b0&quot; name=&quot;部门经理审核&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>sequenceFlow id=&quot;sid-5b4edab2-56a9-46c2-92f5-f271a7d3f69b&quot; sourceRef=&quot;sid-47945474-d1fe-41d7-b4ca-af9b7a997496&quot; targetRef=&quot;sid-4d508bbe-52a3-4818-a6b0-28a2cb93b1b0&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>endEvent id=&quot;sid-a3b9010e-f840-4854-a0e8-923d3021a9c8&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>sequenceFlow id=&quot;sid-2a784727-8ce3-4e6f-8926-268fa1ae2d35&quot; sourceRef=&quot;sid-9bb97b6a-8f2c-4e3e-bf95-ec61ae92e018&quot; targetRef=&quot;sid-47945474-d1fe-41d7-b4ca-af9b7a997496&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>userTask id=&quot;sid-bf087e72-0224-4bbf-bc5c-c96bcd462788&quot; name=&quot;总经理审核&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>sequenceFlow id=&quot;sid-a52795e3-543e-4397-b35e-5251d2f23394&quot; sourceRef=&quot;sid-4d508bbe-52a3-4818-a6b0-28a2cb93b1b0&quot; targetRef=&quot;sid-bf087e72-0224-4bbf-bc5c-c96bcd462788&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>sequenceFlow id=&quot;sid-bdae4683-75d1-4c3d-9a88-0929e70155d6&quot; sourceRef=&quot;sid-bf087e72-0224-4bbf-bc5c-c96bcd462788&quot; targetRef=&quot;sid-a3b9010e-f840-4854-a0e8-923d3021a9c8&quot;/<span class="hljs-symbol">&amp;gt;</span><br>  <span class="hljs-symbol">&amp;lt;</span>/process<span class="hljs-symbol">&amp;gt;</span><br>  <span class="hljs-symbol">&amp;lt;</span>bpmndi:BPMNDiagram id=&quot;BPMNDiagram_Test1&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bpmndi:BPMNPlane bpmnElement=&quot;Test1&quot; id=&quot;BPMNPlane_Test1&quot;<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>bpmndi:BPMNShape id=&quot;shape-0d2bb75a-8781-4e85-ab05-3038b936eadb&quot; bpmnElement=&quot;sid-9bb97b6a-8f2c-4e3e-bf95-ec61ae92e018&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>omgdc:Bounds x=&quot;75.0&quot; y=&quot;15.0&quot; width=&quot;30.0&quot; height=&quot;30.0&quot;/<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>/bpmndi:BPMNShape<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>bpmndi:BPMNShape id=&quot;shape-15f1ad2b-eb83-4cb3-bc6b-4d298b039035&quot; bpmnElement=&quot;sid-47945474-d1fe-41d7-b4ca-af9b7a997496&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>omgdc:Bounds x=&quot;155.0&quot; y=&quot;3.0&quot; width=&quot;100.0&quot; height=&quot;80.0&quot;/<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>/bpmndi:BPMNShape<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>bpmndi:BPMNShape id=&quot;shape-978b3c5d-c77a-4da7-8fd5-1dbc914fea61&quot; bpmnElement=&quot;sid-4d508bbe-52a3-4818-a6b0-28a2cb93b1b0&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>omgdc:Bounds x=&quot;295.0&quot; y=&quot;3.0&quot; width=&quot;100.0&quot; height=&quot;80.0&quot;/<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>/bpmndi:BPMNShape<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>bpmndi:BPMNEdge id=&quot;edge-95b4c271-fa29-4ca8-8698-e7e50f10a686&quot; bpmnElement=&quot;sid-5b4edab2-56a9-46c2-92f5-f271a7d3f69b&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>omgdi:waypoint x=&quot;255.0&quot; y=&quot;43.0&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>omgdi:waypoint x=&quot;295.0&quot; y=&quot;43.0&quot;/<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>/bpmndi:BPMNEdge<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>bpmndi:BPMNShape id=&quot;shape-41da282d-8db5-4380-96ab-449d130aadcc&quot; bpmnElement=&quot;sid-a3b9010e-f840-4854-a0e8-923d3021a9c8&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>omgdc:Bounds x=&quot;600.0&quot; y=&quot;28.0&quot; width=&quot;30.0&quot; height=&quot;30.0&quot;/<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>/bpmndi:BPMNShape<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>bpmndi:BPMNEdge id=&quot;edge-638058be-afa1-4f0d-83ff-0bb5b985c4f1&quot; bpmnElement=&quot;sid-2a784727-8ce3-4e6f-8926-268fa1ae2d35&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>omgdi:waypoint x=&quot;105.0&quot; y=&quot;22.5&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>omgdi:waypoint x=&quot;155.0&quot; y=&quot;23.0&quot;/<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>/bpmndi:BPMNEdge<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>bpmndi:BPMNShape id=&quot;sid-6d43032f-c23d-4c9d-8982-35f85948682d&quot; bpmnElement=&quot;sid-bf087e72-0224-4bbf-bc5c-c96bcd462788&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>omgdc:Bounds x=&quot;447.47275&quot; y=&quot;3.0&quot; width=&quot;100.0&quot; height=&quot;80.0&quot;/<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>/bpmndi:BPMNShape<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>bpmndi:BPMNEdge id=&quot;edge-15d8075d-253b-4eb1-8f23-9040f879d4ec&quot; bpmnElement=&quot;sid-a52795e3-543e-4397-b35e-5251d2f23394&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>omgdi:waypoint x=&quot;395.0&quot; y=&quot;43.0&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>omgdi:waypoint x=&quot;447.47275&quot; y=&quot;43.0&quot;/<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>/bpmndi:BPMNEdge<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>bpmndi:BPMNEdge id=&quot;edge-a9bb111b-d1bf-40a9-ad3d-0e9622157f6b&quot; bpmnElement=&quot;sid-bdae4683-75d1-4c3d-9a88-0929e70155d6&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>omgdi:waypoint x=&quot;547.4728&quot; y=&quot;43.0&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>omgdi:waypoint x=&quot;600.0&quot; y=&quot;43.0&quot;/<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>/bpmndi:BPMNEdge<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bpmndi:BPMNPlane<span class="hljs-symbol">&amp;gt;</span><br>  <span class="hljs-symbol">&amp;lt;</span>/bpmndi:BPMNDiagram<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/definitions<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二、activit-如何使用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、activit-如何使用">#</a> <strong>二、Activit</strong> <strong>如何使用</strong></h3><p>大的系统：电商、社交。父模块下，微服务小模块，其中有个<strong>activiti</strong>模块，专门管工作流。</p><h4 id="_1、部署-activiti" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、部署-activiti">#</a> 1、<strong>部署</strong> <strong>activiti</strong></h4><p>​ Activiti 是一个工作流引擎（其实就是一堆 jar 包 API），业务系统使用 activiti 来对系统的业务流程进行自动化管理，为了方便业务系统访问(操作)activiti 的接口或功能，通常将 activiti 环境与业务系统的环境集成在一起。</p><h4 id="_2、流程定义" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、流程定义">#</a> 2、<strong>流程定义</strong></h4><p>使用 activiti 流程建模工具(activity-designer)定义业务流程(.bpmn 文件) 。</p><p>.bpmn 文件就是业务流程定义文件，通过 xml 定义业务流程。</p><p>​ 如果使用其它公司开发的工作作引擎一般都提供了可视化的建模工具(Process Designer)用于生成流程定义文件，建模工具操作直观，一般都支持图形化拖拽方式、多窗口的用户界面、丰富的过程图形元素、过程元素拷贝、粘贴、删除等功能。</p><h4 id="_3、流程定义部署" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、流程定义部署">#</a> 3、<strong>流程定义部署</strong></h4><p>​ 向 activiti 部署业务流程定义（.bpmn 文件）。</p><p>​ 使用 activiti 提供的 api 向 activiti 中部署.bpmn 文件</p><h4 id="_4、启动一个流程实例-processinstance" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、启动一个流程实例-processinstance">#</a> <strong>4、启动一个流程实例（ProcessInstance）</strong></h4><p>​ 启动一个流程实例表示开始一次业务流程的运行，比如员工请假流程部署完成，如果张三要请假就可以启动一个流程实例，如果李四要请假也启动一个流程实例，两个流程的执行互相不影响，就好比定义一个 java 类，实例化两个对象一样，部署的流程就好比 java 类，启动一个流程实例就好比 new 一个 java 对象。</p><h4 id="_5、用户查询待办任务-task" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5、用户查询待办任务-task">#</a> <strong>5、用户查询待办任务(Task)</strong></h4><p>​ 因为现在系统的业务流程已经交给 activiti 管理，通过 activiti 就可以查询当前流程执行到哪了，当前用户需要办理什么任务了，这些 activiti帮我们管理了，而不像上边需要我们在 sql语句中的where条件中指定当前查询的状态值是多少。</p><h4 id="_6、用户办理任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6、用户办理任务">#</a> 6、<strong>用户办理任务</strong></h4><p>​ 用户查询待办任务后，就可以办理某个任务，如果这个任务办理完成还需要其它用户办理，比如采购单创建后由部门经理审核，这个过程也是由 activiti 帮我们完成了，不需要我们在代码中硬编码指定下一个任务办理人了。</p><h4 id="_7、流程结束" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_7、流程结束">#</a> 7、<strong>流程结束</strong></h4><p>​ 当任务办理完成没有下一个任务/结点了，这个流程实例就完成了。</p><h2 id="第三章-搭建环境" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第三章-搭建环境">#</a> 第三章 搭建环境</h2><h3 id="一、项目环境" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、项目环境">#</a> 一、项目环境</h3><p>父工程 ydl-oa</p><p>子模块 ydl-common ydl-bussiness</p><p>子模块 activiti-demo</p><h3 id="二、开发环境" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、开发环境">#</a> 二、开发环境</h3><h4 id="_1、-java-环境" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、-java-环境">#</a> <strong>1、</strong> <strong>Java</strong> <strong>环境</strong></h4><p>Jdk1.8 或以上版本</p><h4 id="_2、-数据库" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-数据库">#</a> <strong>2、</strong> 数据库</h4><p>Mysql 5 及以上的版本</p><p>本教程采用 8 版本</p><h4 id="_3、-web-容器" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、-web-容器">#</a> <strong>3、</strong> <strong>Web</strong> <strong>容器</strong></h4><p>本项目采用的是 Tomcat8.5</p><h4 id="_4、-开发工具" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、-开发工具">#</a> <strong>4、</strong> 开发工具</h4><p>Mysql 客户端连接工具，navicat或其它</p><p>文本编辑器 EditPlus 或其它</p><p>Java 开发工具：IDEA</p><h3 id="三、activiti-环境" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、activiti-环境">#</a> <strong>三、Activiti</strong> <strong>环境</strong></h3><h4 id="_1、下载-activiti7" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、下载-activiti7">#</a> 1、<strong>下载</strong> <strong>activiti7</strong></h4><p>Activiti 下载地址：<a href="https://activiti.gitbook.io/activiti-7-developers-guide/releases/7.4.0" rel="noopener noreferrer" target="_blank">https://activiti.gitbook.io/activiti-7-developers-guide/releases/7.4.0<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>dependencyManagement<span class="hljs-symbol">&amp;gt;</span><br>  <span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-dependencies<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>7.4.0<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>scope<span class="hljs-symbol">&amp;gt;</span>import<span class="hljs-symbol">&amp;lt;</span>/scope<span class="hljs-symbol">&amp;gt;</span><br>      <span class="hljs-symbol">&amp;lt;</span>type<span class="hljs-symbol">&amp;gt;</span>pom<span class="hljs-symbol">&amp;lt;</span>/type<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>  <span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependencyManagement<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_1-database" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1-database">#</a> <strong>（1）Database</strong>：</h5><p>activiti 运行需要有数据库的支持，支持的数据库有：h2, mysql, oracle, postgres, mssql, db2等，该目录存放 activiti 的建表脚本。</p><p><strong>（2） Docs</strong></p><p>Activiti 的帮助文档。</p><p><strong>（3） Wars</strong></p><p>官方自带的示例工程</p><h4 id="_2、-流程设计器-插件安装" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-流程设计器-插件安装">#</a> 2、 <strong>流程设计器</strong> 插件安装</h4><h5 id="_1-简介" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1-简介">#</a> <strong>（1）简介</strong></h5><p>Activiti插件actiBPM在新版的idea 2020中已经不支持，这里找到一款替代的Activiti BPMN visualizer。</p><h5 id="_2-安装-设置-插件-搜索-bpmn" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2-安装-设置-插件-搜索-bpmn">#</a> （2）安装（设置-插件-搜索 bpmn）</h5><figure><img alt="image-20220905034740998" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905034740998-ee08c430.png" tabindex="0"/><figcaption>image-20220905034740998</figcaption></figure><p>或者在idea插件官网：<a href="https://plugins.jetbrains.com/" rel="noopener noreferrer" target="_blank">https://plugins.jetbrains.com/<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="_3、-activiti-支持的数据库" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、-activiti-支持的数据库">#</a> <strong>3、</strong> <strong>Activiti</strong> <strong>支持的数据库</strong></h4><p>Activiti 的运行需要数据库支撑，需要安装 activiti 数据库，支持如下版本：</p><ul><li><p>h2:1.3.168</p></li><li><p>mysql :5.1.21</p></li><li><p>oracle:11.2.0.1.0</p></li><li><p>postgres:8.1</p></li><li><p>db2:DB2 10.1 using db2jcc4</p></li><li><p>mssql:2008 using sqljdbc4</p></li></ul><h4 id="_4、创建mysql数据库" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、创建mysql数据库">#</a> 4、创建mysql<strong>数据库</strong></h4><p>本教程使用 mysql 数据库。</p><p>创建 mysql 数据库 activiti（名字任意）：</p><p>CREATE DATABASE activiti DEFAULT CHARACTER SET utf8;</p><figure><img alt="image-20220905034934385" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905034934385-9a936dd5.png" tabindex="0"/><figcaption>image-20220905034934385</figcaption></figure><h4 id="_5、创建表方式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5、创建表方式">#</a> 5、创建表方式</h4><p>通过运行 java 程序创建表。</p><h5 id="_1-创建-java-工程" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1-创建-java-工程">#</a> （1）<strong>创建</strong> <strong>java</strong> <strong>工程</strong></h5><p>使用 idea 创建 maven 的 java 工程。</p><figure><img alt="image-20220905040841227" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905040841227-be3fa368.png" tabindex="0"/><figcaption>image-20220905040841227</figcaption></figure><h5 id="_2-加入-maven-依赖的坐标-jar-包" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2-加入-maven-依赖的坐标-jar-包">#</a> （2）<strong>加入</strong> <strong>maven</strong> **依赖的坐标（**jar <strong>包）</strong></h5><p>首先需要在 java 工程中加入 ProcessEngine 所需要的 jar 包，包括：</p><ol><li><p>activiti-engine-7.0.0.beta1.jar</p></li><li><p>activiti 依赖的 jar 包：mybatis、alf4j、log4j 等</p></li><li><p>activiti 依赖的 spring 包</p></li><li><p>数据库驱动</p></li><li><p>第三方数据连接池 dbcp</p></li><li><p>单元测试 Junit-4.12.jar</p></li></ol><p>我们使用 maven 来实现项目的构建，所以应当导入这些 jar 所对应的坐标到 pom.xml 文件中。</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>properties<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>maven.compiler.source<span class="hljs-symbol">&amp;gt;</span>8<span class="hljs-symbol">&amp;lt;</span>/maven.compiler.source<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>maven.compiler.target<span class="hljs-symbol">&amp;gt;</span>8<span class="hljs-symbol">&amp;lt;</span>/maven.compiler.target<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>slf4j.version<span class="hljs-symbol">&amp;gt;</span>1.6.6<span class="hljs-symbol">&amp;lt;</span>/slf4j.version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>log4j.version<span class="hljs-symbol">&amp;gt;</span>1.2.12<span class="hljs-symbol">&amp;lt;</span>/log4j.version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>activiti.version<span class="hljs-symbol">&amp;gt;</span>7.4.0<span class="hljs-symbol">&amp;lt;</span>/activiti.version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>activiti.cloud.version<span class="hljs-symbol">&amp;gt;</span>7.4.0<span class="hljs-symbol">&amp;lt;</span>/activiti.cloud.version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>mysql.version<span class="hljs-symbol">&amp;gt;</span>8.0.20<span class="hljs-symbol">&amp;lt;</span>/mysql.version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>java.version<span class="hljs-symbol">&amp;gt;</span>1.8<span class="hljs-symbol">&amp;lt;</span>/java.version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>slf4j.version<span class="hljs-symbol">&amp;gt;</span>1.6.6<span class="hljs-symbol">&amp;lt;</span>/slf4j.version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>log4j.version<span class="hljs-symbol">&amp;gt;</span>1.2.12<span class="hljs-symbol">&amp;lt;</span>/log4j.version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>mybatis.version<span class="hljs-symbol">&amp;gt;</span>3.4.5<span class="hljs-symbol">&amp;lt;</span>/mybatis.version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>junit.version<span class="hljs-symbol">&amp;gt;</span>4.12<span class="hljs-symbol">&amp;lt;</span>/junit.version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>commonsio.version<span class="hljs-symbol">&amp;gt;</span>2.6<span class="hljs-symbol">&amp;lt;</span>/commonsio.version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dbcp.version<span class="hljs-symbol">&amp;gt;</span>1.4<span class="hljs-symbol">&amp;lt;</span>/dbcp.version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/properties<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-engine<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;activiti.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-spring<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;activiti.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- bpmn 模型处理 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-bpmn-model<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;activiti.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- bpmn 转换 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-bpmn-converter<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;activiti.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- bpmn json数据转换 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-json-converter<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;activiti.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- bpmn 布局 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-bpmn-layout<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;activiti.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- mysql驱动 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>mysql<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>mysql-connector-java<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;mysql.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- mybatis --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.mybatis<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>mybatis<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;mybatis.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 链接池 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>commons-dbcp<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>commons-dbcp<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;dbcp.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>commons-io<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>commons-io<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;commonsio.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>junit<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>junit<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;junit.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- log start --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>log4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>log4j<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;log4j.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-api<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;slf4j.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-log4j12<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;slf4j.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-log4j-properties" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3-log4j-properties">#</a> <strong>（3）</strong> <strong>log4j.properties</strong></h5><div class="language-properties line-numbers-mode" data-ext="properties"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight properties"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># Set root category priority to INFO and its only appender to CONSOLE.</span><br><span class="hljs-comment">#log4j.rootCategory=INFO, CONSOLE debug info warn error fatal</span><br><span class="hljs-attr">log4j.rootCategory</span>=<span class="hljs-string">debug, CONSOLE, LOGFILE</span><br><span class="hljs-comment"># Set the enterprise logger category to FATAL and its only appender to CONSOLE.</span><br><span class="hljs-attr">log4j.logger.org.apache.axis.enterprise</span>=<span class="hljs-string">FATAL, CONSOLE</span><br><span class="hljs-comment"># CONSOLE is set to be a ConsoleAppender using a PatternLayout.</span><br><span class="hljs-attr">log4j.appender.CONSOLE</span>=<span class="hljs-string">org.apache.log4j.ConsoleAppender</span><br><span class="hljs-attr">log4j.appender.CONSOLE.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-attr">log4j.appender.CONSOLE.layout.ConversionPattern</span>=<span class="hljs-string">%d&#123;ISO8601&#125; %-6r[%15.15t] %-5p %30.30c %x - %m\n</span><br><span class="hljs-comment"># LOGFILE is set to be a File appender using a PatternLayout.</span><br><span class="hljs-attr">log4j.appender.LOGFILE</span>=<span class="hljs-string">org.apache.log4j.FileAppender</span><br><span class="hljs-attr">log4j.appender.LOGFILE.File</span>=<span class="hljs-string">f:\act\activiti.log</span><br><span class="hljs-attr">log4j.appender.LOGFILE.Append</span>=<span class="hljs-string">true</span><br><span class="hljs-attr">log4j.appender.LOGFILE.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-attr">log4j.appender.LOGFILE.layout.ConversionPattern</span>=<span class="hljs-string">%d&#123;ISO8601&#125; %-6r[%15.15t] %-5p %30.30c %x - %m\n</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-activiti-cfg-xml" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4-activiti-cfg-xml">#</a> （4）<strong>activiti.cfg.xml</strong></h5><p>在 classpath 下创建 activiti.cgf.xml 文件：</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;<br>       xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;<br>       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>                    http://www.springframework.org/schema/beans/spring-beans.xsd<br>http://www.springframework.org/schema/contex<br>http://www.springframework.org/schema/context/spring-context.xsd<br>http://www.springframework.org/schema/tx<br>http://www.springframework.org/schema/tx/spring-tx.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 这里可以使用 链接池 dbcp--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;driverClassName&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/activiti?nullCatalogMeansCurrent=true<span class="hljs-symbol">&amp;amp;</span>serverTimezone=GMT%2B8&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;username&quot; value=&quot;root&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;password&quot; value=&quot;123456&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;maxActive&quot; value=&quot;3&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;maxIdle&quot; value=&quot;1&quot; /<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;processEngineConfiguration&quot;<br>          class=&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- 引用数据源 上面已经设置好了--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- activiti 数据库表处理策略 --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;databaseSchemaUpdate&quot; value=&quot;true&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>关于 <em>processEngineConfiguration</em> 中的 <strong>databaseSchemaUpdate</strong> **参数，**通过此参数设计 activiti数据表的处理策略，参数如下：</p><p>false（默认）：检查数据库表的版本和依赖库的版本， 如果版本不匹配就抛出异常。</p><p>true: 构建流程引擎时，执行检查，如果需要就执行更新。 如果表不存在，就创建。</p><p>create-drop: 构建流程引擎时创建数据库表， 关闭流程引擎时删除这些表。</p><p>drop-create：先删除表再创建表。</p><p>create: 构建流程引擎时创建数据库表， 关闭流程引擎时不删除这些表。</p><h5 id="_5-编写程序" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5-编写程序">#</a> （5）<strong>编写程序</strong></h5><p>创建 ProcessEngineConfiguration，通过 ProcessEngineConfiguration 创建 ProcessEngine，在创建ProcessEngine 时会自动创建数据库。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//创建ProcessEngineConfiguration</span><br><span class="hljs-type">ProcessEngineConfiguration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <br>ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="hljs-string">&quot;activiti.cfg.xml&quot;</span>)<br><span class="hljs-comment">//通过ProcessEngineConfiguration创建ProcessEngine，此时会创建数据库</span><br><span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> configuration.buildProcessEngine();<br>System.out.println(processEngine);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><p>1、运行以上程序段即可完成 activiti 数据库创建，通过改变 activiti.cfg.xml 中 databaseSchemaUpdate 参数的值执行不同的数据表处理策略。</p><p>2、 上 边 的 方法 <em>createProcessEngineConfigurationFromResource</em> 在执行时在activiti.cfg.xml <em>中找固定的名称</em> <em>processEngineConfiguration</em>也可以使用重载方法调用，这时可以不用限定 <em>processEngineConfiguration</em> 名称</p><p>注意问题：</p><p>1、 jdk版本号 55 52</p><p>方案：使用18jdk</p><p>2、</p><figure><img alt="image-20220905043716868" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905043716868-694d6b50.png" tabindex="0"/><figcaption>image-20220905043716868</figcaption></figure><p>方案：nullCatalogMeansCurrent=true</p><p>此时我们查看数据库，创建了 25 张表，结果如下：</p><figure><img alt="image-20220905044011822" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905044011822-9a23cf4e.png" tabindex="0"/><figcaption>image-20220905044011822</figcaption></figure><h4 id="_6-数据库表的命名规则" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6-数据库表的命名规则">#</a> （6）<strong>数据库表的命名规则</strong></h4><p><strong>官网地址：<a href="https://www.activiti.org/userguide/#creatingDatabaseTable" rel="noopener noreferrer" target="_blank">https://www.activiti.org/userguide/#creatingDatabaseTable<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong></p><h5 id="a、表前缀说明" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#a、表前缀说明">#</a> a、表前缀说明</h5><ul><li>act_ge_ 通用数据表，ge是general的缩写</li><li>act_hi_ 历史数据表，hi是history的缩写，对应 <strong>HistoryService</strong> 接口</li><li>act_id_ 身份数据表，id是identity的缩写，对应 <strong>IdentityService</strong> 接口</li><li>act_re_ 流程存储表，re是repository的缩写，对应 <strong>RepositoryService</strong> 接口，存储流程部署和流程定义等静态数据</li><li>act_ru_ 运行时数据表，ru是runtime的缩写，对应 <strong>RuntimeService</strong> 接口和 <strong>TaskService</strong> 接口，存储流程实例和用户任务等动态数据</li></ul><h5 id="b、activiti-数据表清单" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#b、activiti-数据表清单">#</a> b、Activiti 数据表清单:</h5><table><thead><tr><th><strong>表分类</strong></th><th><strong>表名</strong></th><th><strong>备注说明</strong></th></tr></thead><tbody><tr><td><strong>一般数据</strong></td><td>ACT_GE_BYTEARRAY</td><td>流程定义的bpmn和png文件</td></tr><tr><td></td><td>ACT_GE_PROPERTY</td><td>系统相关属性</td></tr><tr><td><strong>流程历史记录</strong></td><td>ACT_HI_ACTINST</td><td>历史的流程实例</td></tr><tr><td></td><td>ACT_HI_ATTACHMENT</td><td>历史的流程附件</td></tr><tr><td></td><td>ACT_HI_COMMENT</td><td>历史的说明性信息</td></tr><tr><td></td><td>ACT_HI_DETAIL</td><td>历史的流程运行中的细节信息</td></tr><tr><td></td><td>ACT_HI_IDENTITYLINK</td><td>历史的流程运行过程中用户关系</td></tr><tr><td></td><td>ACT_HI_PROCINST</td><td>历史的流程实例</td></tr><tr><td></td><td>ACT_HI_TASKINST</td><td>历史的任务实例</td></tr><tr><td></td><td>ACT_HI_VARINST</td><td>历史的流程实例变量表</td></tr><tr><td>用户组表</td><td>ACT_ID_GROUP</td><td>身份信息-组信息</td></tr><tr><td></td><td>ACT_ID_INFO</td><td>身份信息-信息</td></tr><tr><td></td><td>ACT_ID_MEMBERSHIP</td><td>身份信息-用户和组关系的中间表</td></tr><tr><td></td><td>ACT_ID_USER</td><td>身份信息-用户信息</td></tr><tr><td><strong>流程定义表</strong></td><td>ACT_RE_DEPLOYMENT</td><td>流程定义部署表</td></tr><tr><td></td><td>ACT_RE_MODEL</td><td>模型信息</td></tr><tr><td></td><td>ACT_RE_PROCDEF</td><td>流程定义信息</td></tr><tr><td><strong>运行实例表</strong></td><td>ACT_RU_EVENT_SUBSCR</td><td>运行时事件</td></tr><tr><td></td><td>ACT_RU_EXECUTION</td><td>运行时流程执行实例</td></tr><tr><td></td><td>ACT_RU_IDENTITYLINK</td><td>运行时参与者的用户信息</td></tr><tr><td></td><td>ACT_RU_JOB</td><td>运行时作业</td></tr><tr><td></td><td>ACT_RU_TASK</td><td>运行时任务</td></tr><tr><td></td><td>ACT_RU_VARIABLE</td><td>流程运行时变量表，记录当前流程可使用的变量，包括 global 和 local</td></tr></tbody></table><p>结合数据库看</p><h2 id="第四章-activiti架构" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第四章-activiti架构">#</a> 第四章 Activiti架构</h2><p><strong>官网介绍：<a href="https://www.activiti.org/userguide/#chapterApi" rel="noopener noreferrer" target="_blank">https://www.activiti.org/userguide/#chapterApi<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong></p><figure><img alt="image-20220905101725712" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220905101725712-c0b9ab49.png" tabindex="0"/><figcaption>image-20220905101725712</figcaption></figure><p>引擎 API 是与 Activiti 交互的最常见方式。中心起点是<code>ProcessEngine</code>，可以按照 <a href="https://www.activiti.org/userguide/#configuration" rel="noopener noreferrer" target="_blank">配置部分<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中所述的多种方式创建。您可以从 ProcessEngine 获取包含工作流/BPM 方法的各种服务。ProcessEngine 和服务对象是线程安全的。因此，您可以为整个服务器保留对其中 1 个的引用。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><br><span class="hljs-type">RuntimeService</span> <span class="hljs-variable">runtimeService</span> <span class="hljs-operator">=</span> processEngine.getRuntimeService();<br><span class="hljs-type">RepositoryService</span> <span class="hljs-variable">repositoryService</span> <span class="hljs-operator">=</span> processEngine.getRepositoryService();<br><span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br><span class="hljs-type">ManagementService</span> <span class="hljs-variable">managementService</span> <span class="hljs-operator">=</span> processEngine.getManagementService();<br><span class="hljs-type">IdentityService</span> <span class="hljs-variable">identityService</span> <span class="hljs-operator">=</span> processEngine.getIdentityService();<br><span class="hljs-type">HistoryService</span> <span class="hljs-variable">historyService</span> <span class="hljs-operator">=</span> processEngine.getHistoryService();<br><span class="hljs-type">FormService</span> <span class="hljs-variable">formService</span> <span class="hljs-operator">=</span> processEngine.getFormService();<br><span class="hljs-type">DynamicBpmnService</span> <span class="hljs-variable">dynamicBpmnService</span> <span class="hljs-operator">=</span> processEngine.getDynamicBpmnService();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code> ProcessEngines.getDefaultProcessEngine()</code>将在第一次调用时初始化并构建流程引擎，然后总是返回相同的流程引擎。可以使用<code>ProcessEngines.init()</code> 和正确创建和关闭所有流程引擎<code>ProcessEngines.destroy()</code>。</p><p><code>activiti.cfg.xml</code>ProcessEngines类将扫描所有<code>activiti-context.xml</code>文件。对于所有<code>activiti.cfg.xml</code>文件，流程引擎将以典型的 Activiti 方式构建：<code>ProcessEngineConfiguration.createProcessEngineConfigurationFromInputStream(inputStream).buildProcessEngine()</code>. 对于所有<code>activiti-context.xml</code>文件，流程引擎将以 Spring 方式构建：首先创建 Spring 应用程序上下文，然后从该应用程序上下文中获取流程引擎。</p><p>所有服务都是无状态的。这意味着您可以轻松地在集群中的多个节点上运行 Activiti，每个节点都访问同一个数据库，而不必担心哪台机器实际执行了先前的调用。无论在何处执行，对任何服务的任何调用都是幂等的。</p><p>获取各个表的相关操作，不用service-dao方式来获取。activiti的各种service已经帮我们写好了。</p><p><strong>注意</strong>：在新版本中，我们通过实验可以发现 IdentityService，FormService 两个 Serivce 都已经删除了。所以后面我们对于这两个 Service 也不讲解了，但老版本中还是有这两个 Service，同学们需要了解一下。</p><h3 id="一、activiti-cfg-xml" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、activiti-cfg-xml">#</a> <strong>一、activiti.cfg.xml</strong></h3><p>activiti 的引擎配置文件，包括：ProcessEngineConfiguration 的定义、数据源定义、事务管理器等，此文件其实就是一个 spring 配置文件，下面是一个基本的配置只配置了 ProcessEngineConfiguration和数据源：</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;<br>       xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;<br>       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>                    http://www.springframework.org/schema/beans/spring-beans.xsd<br>http://www.springframework.org/schema/contex<br>http://www.springframework.org/schema/context/spring-context.xsd<br>http://www.springframework.org/schema/tx<br>http://www.springframework.org/schema/tx/spring-tx.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 这里可以使用 链接池 dbcp--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;driverClassName&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/activiti?nullCatalogMeansCurrent=true<span class="hljs-symbol">&amp;amp;</span>serverTimezone=GMT%2B8&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;username&quot; value=&quot;root&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;password&quot; value=&quot;ydlclass666&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;maxActive&quot; value=&quot;3&quot; /<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;maxIdle&quot; value=&quot;1&quot; /<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;processEngineConfiguration&quot;<br>          class=&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- 引用数据源 上面已经设置好了--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!--        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;jdbcDriver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot; /<span class="hljs-symbol">&amp;gt;</span>--<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!--        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/activiti?nullCatalogMeansCurrent=true<span class="hljs-symbol">&amp;amp;</span>serverTimezone=GMT%2B8&quot; /<span class="hljs-symbol">&amp;gt;</span>--<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!--        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;jdbcUsername&quot; value=&quot;root&quot; /<span class="hljs-symbol">&amp;gt;</span>--<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!--        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;jdbcPassword&quot; value=&quot;ydlclass666&quot; /<span class="hljs-symbol">&amp;gt;</span>--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- activiti 数据库表处理策略 --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;databaseSchemaUpdate&quot; value=&quot;true&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二、processengineconfiguration" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、processengineconfiguration">#</a> <strong>二、ProcessEngineConfiguration</strong>：</h3><p>流程引擎的配置类，通过 ProcessEngineConfiguration 可以创建工作流引擎 ProceccEngine，常用的两种方法如下：</p><h4 id="_1、-standaloneprocessengineconfiguration" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、-standaloneprocessengineconfiguration">#</a> <strong>1、</strong> <strong>StandaloneProcessEngineConfiguration</strong></h4><p><strong>通过</strong> org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration</p><p>Activiti 可以单独运行，使用它创建的 ProcessEngine，Activiti 会自己处理事务。</p><p>配置文件方式：</p><p>通常在 activiti.cfg.xml 配置文件中定义一个 id 为 processEngineConfiguration 的 bean，这里会使用 spring 的依赖注入来构建引擎。</p><p>方法如下：</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>bean id=&quot;processEngineConfiguration&quot;<br>      class=&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 引用数据源 上面已经设置好了--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- activiti 数据库表处理策略 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>property name=&quot;databaseSchemaUpdate&quot; value=&quot;true&quot;/<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、springprocessengineconfiguration" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、springprocessengineconfiguration">#</a> 2、<strong>SpringProcessEngineConfiguration</strong></h4><p>通过 <strong>org.activiti.spring.SpringProcessEngineConfiguration</strong> <strong>与</strong> Spring 整合。</p><p>创建 spring 与 activiti 的整合配置文件：activity-spring.cfg.xml（名称不固定）</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;<br>       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;<br>       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;<br>       xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;<br>       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>http://www.springframework.org/schema/beans/spring-beans-3.1.xsd<br>http://www.springframework.org/schema/mvc<br>http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd<br>http://www.springframework.org/schema/context<br>http://www.springframework.org/schema/context/spring-context-3.1.xsd<br>http://www.springframework.org/schema/aop<br>http://www.springframework.org/schema/aop/spring-aop-3.1.xsd<br>http://www.springframework.org/schema/tx<br>http://www.springframework.org/schema/tx/spring-tx-3.1.xsd &quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 工作流引擎配置bean --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;processEngineConfiguration&quot;<br>          class=&quot;org.activiti.spring.SpringProcessEngineConfiguration&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- 数据源 --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- 使用spring事务管理器 --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;transactionManager&quot; ref=&quot;transactionManager&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- 数据库策略 --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;databaseSchemaUpdate&quot; value=&quot;drop-create&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- activiti的定时任务关闭 --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;jobExecutorActivate&quot; value=&quot;false&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 流程引擎 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;processEngine&quot;<br>          class=&quot;org.activiti.spring.ProcessEngineFactoryBean&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;processEngineConfiguration&quot;<br>                  ref=&quot;processEngineConfiguration&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 资源服务service --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;repositoryService&quot; factory-bean=&quot;processEngine&quot;<br>          factory-method=&quot;getRepositoryService&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 流程运行service --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;runtimeService&quot; factory-bean=&quot;processEngine&quot;<br>          factory-method=&quot;getRuntimeService&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 任务管理service --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;taskService&quot; factory-bean=&quot;processEngine&quot;<br>          factory-method=&quot;getTaskService&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 历史管理service --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;historyService&quot; factory-bean=&quot;processEngine&quot;<br>          factory-method=&quot;getHistoryService&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 用户管理service --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;identityService&quot; factory-bean=&quot;processEngine&quot;<br>          factory-method=&quot;getIdentityService&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 引擎管理service --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;managementService&quot; factory-bean=&quot;processEngine&quot;<br>          factory-method=&quot;getManagementService&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 数据源 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/activiti&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;username&quot; value=&quot;root&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;password&quot; value=&quot;mysql&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;maxActive&quot; value=&quot;3&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;maxIdle&quot; value=&quot;1&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 事务管理器 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;transactionManager&quot;<br>          class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 通知 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>tx:attributes<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>!-- 传播行为 --<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;save*&quot; propagation=&quot;REQUIRED&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;insert*&quot; propagation=&quot;REQUIRED&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;delete*&quot; propagation=&quot;REQUIRED&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;update*&quot; propagation=&quot;REQUIRED&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;find*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;get*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/tx:attributes<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/tx:advice<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 切面，根据具体项目修改切点配置 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>aop:config proxy-target-class=&quot;true&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>aop:advisor advice-ref=&quot;txAdvice&quot;<br>                     pointcut=&quot;execution(* com.ydlclass.ydloa.service.impl.*.*(..))&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/aop:config<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3、创建-processengineconfiguration" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、创建-processengineconfiguration">#</a> 3、<strong>创建</strong> <strong>processEngineConfiguration</strong></h4><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ProcessEngineConfiguration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <br>ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="hljs-string">&quot;activiti.cfg.xml&quot;</span>)<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>上边的代码要求 activiti.cfg.xml 中必须有一个 processEngineConfiguration 的 bean也可以使用下边的方法，更改 bean 的名字：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(String resource, String beanName);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><h3 id="三、processengine" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、processengine">#</a> <strong>三、ProcessEngine</strong></h3><p>工作流引擎，相当于一个门面接口，通过 ProcessEngineConfiguration 创建 processEngine，通过ProcessEngine 创建各个 service 接口。</p><h4 id="_1、一般创建方式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、一般创建方式">#</a> 1、一般创建方式</h4><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//先构建ProcessEngineConfiguration</span><br><span class="hljs-type">ProcessEngineConfiguration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="hljs-string">&quot;activiti.cfg.xml&quot;</span>);<br><span class="hljs-comment">//通过ProcessEngineConfiguration创建ProcessEngine，此时会创建数据库</span><br><span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> configuration.buildProcessEngine();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、简单创建方式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、简单创建方式">#</a> 2、简单创建方式</h4><p>将 activiti.cfg.xml 文件名及路径固定，且 activiti.cfg.xml 文件中有 processEngineConfiguration 的配置，可以使用如下代码创建 processEngine:</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//直接使用工具类 ProcessEngines，使用classpath下的activiti.cfg.xml中的配置创建processEngine</span><br><span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br>System.out.println(processEngine);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="四、servcie服务接口" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、servcie服务接口">#</a> 四、Servcie服务接口</h3><p>Service是工作流引擎提供用于进行工作流部署、执行、管理的服务接口，我们使用这些接口可以就是操作服务对应的数据表</p><h4 id="_1、-service创建方式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、-service创建方式">#</a> 1、 Service创建方式</h4><p>通过ProcessEngine创建Service</p><p>方式如下：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">RuntimeService</span> <span class="hljs-variable">runtimeService</span> <span class="hljs-operator">=</span> processEngine.getRuntimeService();<br><span class="hljs-type">RepositoryService</span> <span class="hljs-variable">repositoryService</span> <span class="hljs-operator">=</span> processEngine.getRepositoryService();<br><span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、-service总览" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-service总览">#</a> 2、 Service总览</h4><table><thead><tr><th>service名称</th><th>service作用</th></tr></thead><tbody><tr><td>RepositoryService</td><td>activiti的资源管理类</td></tr><tr><td>RuntimeService</td><td>activiti的流程运行管理类</td></tr><tr><td>TaskService</td><td>activiti的任务管理类</td></tr><tr><td>HistoryService</td><td>activiti的历史管理类</td></tr><tr><td>ManagerService</td><td>activiti的引擎管理类</td></tr></tbody></table><p>简单介绍：</p><p><strong>RepositoryService</strong></p><p>是activiti的资源管理类，提供了管理和控制流程发布包和流程定义的操作。使用工作流建模工具设计的业务流程图需要使用此service将流程定义文件的内容部署到计算机。</p><p>除了部署流程定义以外还可以：查询引擎中的发布包和流程定义。</p><p>暂停或激活发布包，对应全部和特定流程定义。 暂停意味着它们不能再执行任何操作了，激活是对应的反向操作。获得多种资源，像是包含在发布包里的文件， 或引擎自动生成的流程图。</p><p>获得流程定义的pojo版本， 可以用来通过java解析流程，而不必通过xml。</p><h4 id="runtimeservice" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#runtimeservice">#</a> RuntimeService</h4><p>Activiti的流程运行管理类。可以从这个服务类中获取很多关于流程执行相关的信息</p><h4 id="taskservice" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#taskservice">#</a> TaskService</h4><p>Activiti的任务管理类。可以从这个类中获取任务的信息。</p><h4 id="historyservice" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#historyservice">#</a> HistoryService</h4><p>Activiti的历史管理类，可以查询历史信息，执行流程时，引擎会保存很多数据（根据配置），比如流程实例启动时间，任务的参与者， 完成任务的时间，每个流程实例的执行路径，等等。 这个服务主要通过查询功能来获得这些数据。</p><h4 id="managementservice" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#managementservice">#</a> ManagementService</h4><p>Activiti的引擎管理类，提供了对 Activiti 流程引擎的管理和维护功能，这些功能不在工作流驱动的应用程序中使用，主要用于 Activiti 系统的日常维护。</p><h2 id="第五章-activiti入门" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第五章-activiti入门">#</a> 第五章 Activiti入门</h2><p>在本章内容中，我们来创建一个Activiti工作流，并启动这个流程。</p><p>创建Activiti工作流主要包含以下几步：</p><p>1、定义流程，按照BPMN的规范，使用流程定义工具，用<strong>流程符号</strong>把整个流程描述出来</p><p>2、部署流程，把画好的流程定义文件，加载到数据库中，生成表的数据</p><p>3、启动流程，使用java代码来操作数据库表中的内容</p><h3 id="一、流程符号" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、流程符号">#</a> 一、流程符号</h3><p>BPMN 2.0是业务流程建模符号2.0的缩写。</p><p>它由Business Process Management Initiative这个非营利协会创建并不断发展。作为一种标识，BPMN 2.0是使用一些<strong>符号</strong>来明确业务流程设计流程图的一整套符号规范，它能增进业务建模时的沟通效率。</p><p>目前BPMN2.0是最新的版本，它用于在BPM上下文中进行布局和可视化的沟通。</p><p>接下来我们先来了解在流程设计中常见的 符号。</p><p>BPMN2.0的<strong>基本符合</strong>主要包含：</p><h4 id="_1、事件-event" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、事件-event">#</a> 1、事件 Event</h4><figure><img alt="1574522151044" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/1574522151044-e28537ac.png" tabindex="0"/><figcaption>1574522151044</figcaption></figure><figure><img alt="image-20220912144550284" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912144550284-139c1a50.png" tabindex="0"/><figcaption>image-20220912144550284</figcaption></figure><h4 id="_2、活动-activity" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、活动-activity">#</a> 2、活动 Activity</h4><p>活动是工作或任务的一个通用术语。一个活动可以是一个任务，还可以是一个当前流程的子处理流程； 其次，你还可以为活动指定不同的类型。常见活动如下：</p><figure><img alt="1574562726375" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/1574562726375-1b9eb6a3.png" tabindex="0"/><figcaption>1574562726375</figcaption></figure><figure><img alt="image-20220912151755093" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912151755093-2f6dac66.png" tabindex="0"/><figcaption>image-20220912151755093</figcaption></figure><h4 id="_3、网关-gateway" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、网关-gateway">#</a> 3、网关 GateWay</h4><p>网关用来处理决策，有几种常用网关需要了解：</p><figure><img alt="1574563600305" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/1574563600305-22398875.png" tabindex="0"/><figcaption>1574563600305</figcaption></figure><figure><img alt="image-20220912152316349" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912152316349-4129c644.png" tabindex="0"/><figcaption>image-20220912152316349</figcaption></figure><h5 id="_1-排他网关-x" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1-排他网关-x">#</a> （1）排他网关 (x)</h5><p>——只有一条路径会被选择。流程执行到该网关时，按照输出流的顺序逐个计算，当条件的计算结果为true时，继续执行当前网关的输出流；</p><p>​ 如果多条线路计算结果都是 true，则会执行第一个值为 true 的线路。如果所有网关计算结果没有true，则引擎会抛出异常。</p><p>​ 排他网关需要和条件顺序流结合使用，default 属性指定默认顺序流，当所有的条件不满足时会执行默认顺序流。</p><h5 id="_2-并行网关" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2-并行网关">#</a> （2）并行网关 (+)</h5><p>——所有路径会被同时选择</p><p>​ 拆分 —— 并行执行所有输出顺序流，为每一条顺序流创建一个并行执行线路。</p><p>​ 合并 —— 所有从并行网关拆分并执行完成的线路均在此等候，直到所有的线路都执行完成才继续向下执行。</p><h5 id="_3-包容网关" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3-包容网关">#</a> （3）包容网关 (+)</h5><p>—— 可以同时执行多条线路，也可以在网关上设置条件</p><p>​ 拆分 —— 计算每条线路上的表达式，当表达式计算结果为true时，创建一个并行线路并继续执行</p><p>​ 合并 —— 所有从并行网关拆分并执行完成的线路均在此等候，直到所有的线路都执行完成才继续向下执行。</p><h5 id="_4-事件网关" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4-事件网关">#</a> （4）事件网关 (+)</h5><p>—— 专门为中间捕获事件设置的，允许设置多个输出流指向多个不同的中间捕获事件。当流程执行到事件网关后，流程处于等待状态，需要等待抛出事件才能将等待状态转换为活动状态。</p><h4 id="_4、流向-flow" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、流向-flow">#</a> 4、流向 Flow</h4><p>流是连接两个流程节点的连线。常见的流向包含以下几种：</p><figure><img alt="1574563937457" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/1574563937457-93604c5c.png" tabindex="0"/><figcaption>1574563937457</figcaption></figure><h3 id="二、-流程设计器使用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、-流程设计器使用">#</a> 二、 流程设计器使用</h3><h4 id="_1、activiti-bpmn-visualizer-使用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、activiti-bpmn-visualizer-使用">#</a> 1、activiti BPMN visualizer 使用</h4><h4 id="palette-画板" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#palette-画板">#</a> <strong>Palette</strong>（画板）</h4><p>在idea中安装插件即可使用，画板中包括以下结点：</p><p>Connection—连接</p><p>Event---事件</p><p>Task---任务</p><p>Gateway---网关</p><p>Container—容器</p><p>Boundary event—边界事件</p><p>Intermediate event- -中间事件</p><p>流程图设计完毕保存生成.bpmn文件</p><h5 id="_1-新建流程-idea工具" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1-新建流程-idea工具">#</a> （1）新建流程(IDEA工具)</h5><p>首先选中存放图形的目录(选择resources下的bpmn目录)，点击菜单：New -&gt; bpmn file，如图：</p><figure><img alt="image-20220912152732544" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912152732544-22b80a7f.png" tabindex="0"/><figcaption>image-20220912152732544</figcaption></figure><p>弹出如下图所示框，输入holiday表示 出差审批流程：</p><figure><img alt="image-20220912152744314" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912152744314-f5d5b13a.png" tabindex="0"/><figcaption>image-20220912152744314</figcaption></figure><p>起完名字holiday后（默认扩展名为bpmn20.xml），就可以看到流程设计页面，如图所示：</p><figure><img alt="image-20220912152802767" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912152802767-b8cf482b.png" tabindex="0"/><figcaption>image-20220912152802767</figcaption></figure><p>右键</p><figure><img alt="image-20220912152844350" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912152844350-a63ada7b.png" tabindex="0"/><figcaption>image-20220912152844350</figcaption></figure><p>鼠标先点击画板的元素即可在左侧绘图</p><figure><img alt="image-20220912152906057" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912152906057-812a0882.png" tabindex="0"/><figcaption>image-20220912152906057</figcaption></figure><h5 id="_2-绘制流程" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2-绘制流程">#</a> （2）绘制流程</h5><p>使用滑板来绘制流程，通过从右侧把图标拖拽到左侧的画板，最终效果如下：</p><figure><img alt="image-20220912153240560" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912153240560-353257e7.png" tabindex="0"/><figcaption>image-20220912153240560</figcaption></figure><h5 id="_3-指定流程定义key" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3-指定流程定义key">#</a> （3）指定流程定义Key</h5><p>流程定义key即流程定义的标识，通过properties视图查看流程的key</p><h5 id="_4-指定任务负责人" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4-指定任务负责人">#</a> （4）指定任务负责人</h5><p>在properties视图指定每个任务结点的负责人，如：填写出差申请的负责人为 itlils</p><figure><img alt="image-20220912153440803" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912153440803-3144f04a.png" tabindex="0"/><figcaption>image-20220912153440803</figcaption></figure><p>经理审批负责人为 zhuzhu</p><figure><img alt="image-20220912154734252" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912154734252-1722438a.png" tabindex="0"/><figcaption>image-20220912154734252</figcaption></figure><p>总经理审批负责人为 itnanls</p><figure><img alt="image-20220912154748332" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912154748332-de0e4115.png" tabindex="0"/><figcaption>image-20220912154748332</figcaption></figure><p>财务审批负责人为 weiwei</p><figure><img alt="image-20220912154758003" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912154758003-1be06388.png" tabindex="0"/><figcaption>image-20220912154758003</figcaption></figure><h2 id="第六章-流程操作" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第六章-流程操作">#</a> 第六章 流程操作</h2><h3 id="一、流程定义" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、流程定义">#</a> 一、流程定义</h3><h4 id="_1、概述" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、概述">#</a> 1、概述</h4><p>流程定义是线下按照bpmn2.0标准去描述 业务流程，通常使用idea中的插件对业务流程进行建模。</p><h4 id="_2、-bpmn文件" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-bpmn文件">#</a> 2、.bpmn文件</h4><p>使用activiti-desinger设计业务流程，会生成.bpmn文件，上面我们已经创建好了bpmn文件</p><p>BPMN 2.0根节点是definitions节点。 这个元素中，可以定义多个流程定义（不过我们建议每个文件只包含一个流程定义， 可以简化开发过程中的维护难度）。 注意，definitions元素 最少也要包含xmlns 和 targetNamespace的声明。 targetNamespace可以是任意值，它用来对流程实例进行分类。</p><p>流程定义部分：定义了流程每个结点的描述及结点之间的流程流转。</p><p>流程布局定义：定义流程每个结点在流程图上的位置坐标等信息。</p><h4 id="_3、生成-png图片文件" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、生成-png图片文件">#</a> 3、生成.png图片文件</h4><p>IDEA工具中的操作方式</p><figure><img alt="image-20220912161055907" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912161055907-58a83c88.png" tabindex="0"/><figcaption>image-20220912161055907</figcaption></figure><h3 id="二、流程定义部署" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、流程定义部署">#</a> 二、流程定义部署</h3><h4 id="_1、概述-1" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、概述-1">#</a> 1、概述</h4><p>将上面在设计器中定义的流程部署到activiti数据库中，就是流程定义部署。</p><p>通过调用activiti的api将流程定义的bpmn和png两个文件一个一个添加部署到activiti中，也可以将两个文件打成zip包进行部署。</p><h4 id="_2、单个文件部署方式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、单个文件部署方式">#</a> 2、单个文件部署方式</h4><p>分别将bpmn文件和png图片文件部署。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.test;<br><br><span class="hljs-keyword">import</span> org.activiti.engine.ProcessEngine;<br><span class="hljs-keyword">import</span> org.activiti.engine.ProcessEngines;<br><span class="hljs-keyword">import</span> org.activiti.engine.RepositoryService;<br><span class="hljs-keyword">import</span> org.activiti.engine.repository.Deployment;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ActivitiDemo</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 部署流程定义</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDeployment</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//        1、创建ProcessEngine</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><span class="hljs-comment">//        2、得到RepositoryService实例</span><br>        <span class="hljs-type">RepositoryService</span> <span class="hljs-variable">repositoryService</span> <span class="hljs-operator">=</span> processEngine.getRepositoryService();<br><span class="hljs-comment">//        3、使用RepositoryService进行部署</span><br>        <span class="hljs-type">Deployment</span> <span class="hljs-variable">deployment</span> <span class="hljs-operator">=</span> repositoryService.createDeployment()<br>                .addClasspathResource(<span class="hljs-string">&quot;bpmn/holiday.bpmn&quot;</span>) <span class="hljs-comment">// 添加bpmn资源</span><br>                .addClasspathResource(<span class="hljs-string">&quot;bpmn/holiday.png&quot;</span>)  <span class="hljs-comment">// 添加png资源</span><br>                .name(<span class="hljs-string">&quot;出差申请流程&quot;</span>)<br>                .deploy();<br><span class="hljs-comment">//        4、输出部署信息</span><br>        System.out.println(<span class="hljs-string">&quot;流程部署id：&quot;</span> + deployment.getId());<br>        System.out.println(<span class="hljs-string">&quot;流程部署名称：&quot;</span> + deployment.getName());<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行此操作后activiti会将上边代码中指定的bpm文件和图片文件保存在activiti数据库。</p><h4 id="_3、压缩包部署方式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、压缩包部署方式">#</a> 3、压缩包部署方式</h4><p>将holiday.bpmn20.xml和holiday.png压缩成zip包。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deployProcessByZip</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 定义zip输入流</span><br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span><br>                .getClass()<br>                .getClassLoader()<br>                .getResourceAsStream(<br>                        <span class="hljs-string">&quot;bpmn/holiday.zip&quot;</span>);<br>        <span class="hljs-type">ZipInputStream</span> <span class="hljs-variable">zipInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZipInputStream</span>(inputStream);<br>        <span class="hljs-comment">// 获取repositoryService</span><br>        <span class="hljs-type">RepositoryService</span> <span class="hljs-variable">repositoryService</span> <span class="hljs-operator">=</span> processEngine<br>                .getRepositoryService();<br>        <span class="hljs-comment">// 流程部署</span><br>        <span class="hljs-type">Deployment</span> <span class="hljs-variable">deployment</span> <span class="hljs-operator">=</span> repositoryService.createDeployment()<br>                .addZipInputStream(zipInputStream)<br>                .deploy();<br>        System.out.println(<span class="hljs-string">&quot;id：&quot;</span> + deployment.getId());<br>        System.out.println(<span class="hljs-string">&quot;Name：&quot;</span> + deployment.getName());<br>    &#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行此操作后activiti会将上边代码中指定的bpm文件和图片文件保存在activiti数据库。</p><h4 id="_4、操作数据表" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、操作数据表">#</a> 4、操作数据表</h4><p>流程定义部署后操作activiti的3张表如下：</p><p>act_re_deployment 流程定义部署表，每部署一次增加一条记录</p><p>act_re_procdef 流程定义表，部署每个新的流程定义都会在这张表中增加一条记录</p><p>act_ge_bytearray 流程资源表</p><p>接下来我们来看看，写入了什么数据：</p><div class="language-sql line-numbers-mode" data-ext="sql"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight sql"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> act_re_deployment #流程定义部署表，记录流程部署信息<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>结果：</p><figure><img alt="image-20220912164207320" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912164207320-85132c1b.png" tabindex="0"/><figcaption>image-20220912164207320</figcaption></figure><div class="language-sql line-numbers-mode" data-ext="sql"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight sql"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> act_re_procdef #流程定义表，记录流程定义信息<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>结果：</p><p>注意，KEY 这个字段是用来唯一识别不同流程的关键字</p><figure><img alt="image-20220912164229052" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912164229052-011f3f42.png" tabindex="0"/><figcaption>image-20220912164229052</figcaption></figure><div class="language-sql line-numbers-mode" data-ext="sql"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight sql"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> act_ge_bytearray #资源表 <br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>结果：</p><figure><img alt="image-20220912164238517" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912164238517-cd5d40a7.png" tabindex="0"/><figcaption>image-20220912164238517</figcaption></figure><p>流程总结：</p><ol><li><p>插件 画流程图</p><p>bpmn20.xml png</p><p>资源文件，记录整合流程整个节点、信息流转</p></li><li><p>部署</p><p>java代码</p><p>数据库涉及到3张表。deployment 部署记录 procdef记录部署的详细信息 bytearray xml\png资源都放到数据库</p></li><li><p>deployment 和 procdef是一对多的关系</p><p>itlils 出差流程</p><p>itnanls 出差流程</p></li></ol><p>建议：一次部署一个流程，这样部署表和流程定义表是一对一有关系，方便读取流程部署及流程定义信息。</p><h3 id="三、启动流程实例" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、启动流程实例">#</a> 三、启动流程实例</h3><p>流程定义部署在activiti后就可以通过工作流管理业务流程了，也就是说上边部署的出差申请流程可以使用了。</p><p>针对该流程，启动一个流程表示发起一个新的出差申请单，这就相当于java类与java对象的关系，类定义好后需要new创建一个对象使用，当然可以new多个对象。对于请出差申请流程，张三发起一个出差申请单需要启动一个流程实例，出差申请单发起一个出差单也需要启动一个流程实例。</p><p>代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 启动流程实例</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testStartProcess</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//        1、创建ProcessEngine</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><span class="hljs-comment">//        2、获取RunTimeService</span><br>        <span class="hljs-type">RuntimeService</span> <span class="hljs-variable">runtimeService</span> <span class="hljs-operator">=</span> processEngine.getRuntimeService();<br><span class="hljs-comment">//        3、根据流程定义Id启动流程</span><br>        <span class="hljs-type">ProcessInstance</span> <span class="hljs-variable">processInstance</span> <span class="hljs-operator">=</span> runtimeService<br>                .startProcessInstanceByKey(<span class="hljs-string">&quot;holiday&quot;</span>);<br><span class="hljs-comment">//        输出内容</span><br>        System.out.println(<span class="hljs-string">&quot;流程定义id：&quot;</span> + processInstance.getProcessDefinitionId());<br>        System.out.println(<span class="hljs-string">&quot;流程实例id：&quot;</span> + processInstance.getId());<br>        System.out.println(<span class="hljs-string">&quot;当前活动Id：&quot;</span> + processInstance.getActivityId());<br>    &#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出内容如下：</p><figure><img alt="image-20220912172907148" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220912172907148-6e19b424.png" tabindex="0"/><figcaption>image-20220912172907148</figcaption></figure><p><strong>操作数据表</strong></p><p>act_hi_actinst 流程实例执行历史</p><p>act_hi_identitylink 流程的参与用户历史信息</p><p>act_hi_procinst 流程实例历史信息</p><p>act_hi_taskinst 流程任务历史信息</p><p>act_ru_execution 流程执行信息</p><p>act_ru_identitylink 流程的参与用户信息</p><p>act_ru_task 任务信息</p><h3 id="" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#">#</a></h3><h3 id="四、任务查询" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、任务查询">#</a> 四、任务查询</h3><p>流程启动后，任务的负责人就可以查询自己当前需要处理的任务，查询出来的任务都是该用户的待办任务。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询当前个人待执行的任务</span><br><span class="hljs-comment">      */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testFindPersonalTaskList</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">//        任务负责人</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">assignee</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;itlils&quot;</span>;<br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><span class="hljs-comment">//        创建TaskService</span><br>        <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br><span class="hljs-comment">//        根据流程key 和 任务负责人 查询任务</span><br>        List&amp;lt;Task&amp;gt; list = taskService.createTaskQuery()<br>                .processDefinitionKey(<span class="hljs-string">&quot;holiday&quot;</span>) <span class="hljs-comment">//流程Key</span><br>                .taskAssignee(assignee)<span class="hljs-comment">//只查询该任务负责人的任务</span><br>                .list();<br><br>        <span class="hljs-keyword">for</span> (Task task : list) &#123;<br>            System.out.println(<span class="hljs-string">&quot;流程实例id：&quot;</span> + task.getProcessInstanceId());<br>            System.out.println(<span class="hljs-string">&quot;任务id：&quot;</span> + task.getId());<br>            System.out.println(<span class="hljs-string">&quot;任务负责人：&quot;</span> + task.getAssignee());<br>            System.out.println(<span class="hljs-string">&quot;任务名称：&quot;</span> + task.getName());<br><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="五、流程任务处理" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#五、流程任务处理">#</a> 五、流程任务处理</h3><p>任务负责人查询待办任务，选择任务进行处理，完成任务。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 完成任务</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">completTask</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//        获取引擎</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><span class="hljs-comment">//        获取taskService</span><br>        <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br><br><span class="hljs-comment">//        根据流程key 和 任务的负责人 查询任务</span><br><span class="hljs-comment">//        返回一个任务对象</span><br>        <span class="hljs-type">Task</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService.createTaskQuery()<br>                .processDefinitionKey(<span class="hljs-string">&quot;holiday&quot;</span>) <span class="hljs-comment">//流程Key</span><br>                .taskAssignee(<span class="hljs-string">&quot;itlils&quot;</span>)  <span class="hljs-comment">//要查询的负责人</span><br>                .singleResult();<br><br><span class="hljs-comment">//        完成任务,参数：任务id</span><br>        taskService.complete(task.getId());<br>    &#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="六、流程定义信息查询" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#六、流程定义信息查询">#</a> 六、流程定义信息查询</h3><p>查询流程相关信息，包含流程定义，流程部署，流程定义版本</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询流程定义</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryProcessDefinition</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//        获取引擎</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><span class="hljs-comment">//        repositoryService</span><br>        <span class="hljs-type">RepositoryService</span> <span class="hljs-variable">repositoryService</span> <span class="hljs-operator">=</span> processEngine.getRepositoryService();<br><span class="hljs-comment">//        得到ProcessDefinitionQuery 对象</span><br>        <span class="hljs-type">ProcessDefinitionQuery</span> <span class="hljs-variable">processDefinitionQuery</span> <span class="hljs-operator">=</span> repositoryService.createProcessDefinitionQuery();<br><span class="hljs-comment">//          查询出当前所有的流程定义</span><br><span class="hljs-comment">//          条件：processDefinitionKey =evection</span><br><span class="hljs-comment">//          orderByProcessDefinitionVersion 按照版本排序</span><br><span class="hljs-comment">//        desc倒叙</span><br><span class="hljs-comment">//        list 返回集合</span><br>        List&amp;lt;ProcessDefinition&amp;gt; definitionList = processDefinitionQuery.processDefinitionKey(<span class="hljs-string">&quot;holiday&quot;</span>)<br>                .orderByProcessDefinitionVersion()<br>                .desc()<br>                .list();<br><span class="hljs-comment">//      输出流程定义信息</span><br>        <span class="hljs-keyword">for</span> (ProcessDefinition processDefinition : definitionList) &#123;<br>            System.out.println(<span class="hljs-string">&quot;id=&quot;</span>+processDefinition.getId());<br>            System.out.println(<span class="hljs-string">&quot;name=&quot;</span>+processDefinition.getName());<br>            System.out.println(<span class="hljs-string">&quot;key=&quot;</span>+processDefinition.getKey());<br>            System.out.println(<span class="hljs-string">&quot;Version=&quot;</span>+processDefinition.getVersion());<br>            System.out.println(<span class="hljs-string">&quot;DeploymentId =&quot;</span>+processDefinition.getDeploymentId());<br>        &#125;<br><br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">id=holiday:1:4<br>name=MyHoliday<br>key=holiday<br>Version=1<br>DeploymentId =1<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="七、流程删除" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#七、流程删除">#</a> 七、流程删除</h3><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteDeployment</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 流程部署id</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">deploymentId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;1&quot;</span>;<br><br>    <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br>    <span class="hljs-comment">// 通过流程引擎获取repositoryService</span><br>        <span class="hljs-type">RepositoryService</span> <span class="hljs-variable">repositoryService</span> <span class="hljs-operator">=</span> processEngine<br>                .getRepositoryService();<br>        <span class="hljs-comment">//删除流程定义，如果该流程定义已有流程实例启动则删除时出错</span><br>        repositoryService.deleteDeployment(deploymentId);<br>        <span class="hljs-comment">//设置true 级联删除流程定义，即使该流程有流程实例启动也可以删除，设置为false非级别删除方式，如果流程</span><br>        <span class="hljs-comment">//repositoryService.deleteDeployment(deploymentId, true);</span><br>    &#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><ol><li><pre><code>  使用repositoryService删除流程定义，历史表信息不会被删除
</code></pre></li><li><pre><code>  如果该流程定义下没有正在运行的任务，则可以用普通删除。
</code></pre></li></ol><p>如果该流程定义下存在已经运行的流程，使用普通删除报错，可用级联删除方法将流程及相关记录全部删除。</p><p>先删除没有完成流程节点，最后就可以完全删除流程定义信息</p><p>项目开发中级联删除操作一般只开放给超级管理员使用.</p><h3 id="八、流程资源下载" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#八、流程资源下载">#</a> 八、流程资源下载</h3><p>现在我们的流程资源文件已经上传到数据库了，如果其他用户想要查看这些资源文件，可以从数据库中把资源文件下载到本地。</p><p>解决方案有：</p><p>1、jdbc对blob类型，blob类型数据读取出来，保存到文件目录</p><p>2、使用activiti的api来实现</p><p>使用commons-io.jar 解决IO的操作</p><p>引入commons-io依赖包</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>commons-io<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>commons-io<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>2.6<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过流程定义对象获取流程定义资源，获取bpmn和png</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">downloadFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//创建流程引擎配置文件</span><br>    <span class="hljs-type">ProcessEngineConfiguration</span> <span class="hljs-variable">configuration</span><br>            <span class="hljs-operator">=</span> ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="hljs-string">&quot;activiti.cgf.xml&quot;</span>,<span class="hljs-string">&quot;processEngineConfiguration&quot;</span>);<br>    <span class="hljs-comment">//通过配置文件，创建流程</span><br>    <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> configuration.buildProcessEngine();<br><br>    <span class="hljs-type">RepositoryService</span> <span class="hljs-variable">repositoryService</span> <span class="hljs-operator">=</span> processEngine.getRepositoryService();<br>    <span class="hljs-comment">//1repositoryService 获取相应的数据</span><br>    <span class="hljs-type">ProcessDefinition</span> <span class="hljs-variable">definition</span> <span class="hljs-operator">=</span> repositoryService.createProcessDefinitionQuery().processDefinitionKey(<span class="hljs-string">&quot;holiday&quot;</span>).singleResult();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">deploymentId</span> <span class="hljs-operator">=</span> definition.getDeploymentId();<br><br>    <span class="hljs-type">InputStream</span> <span class="hljs-variable">xmlFileInputStream</span> <span class="hljs-operator">=</span> repositoryService.getResourceAsStream(deploymentId,definition.getResourceName());<br>    <span class="hljs-type">InputStream</span> <span class="hljs-variable">pngInputStream</span> <span class="hljs-operator">=</span> repositoryService.getResourceAsStream(deploymentId, definition.getDiagramResourceName());<br><br>    <span class="hljs-comment">//2转成输出流，放到本地文件夹下</span><br>    FileOutputStream xmlFileOutputStream=<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;e:/holiday.bpmn20.xml&quot;</span>));<br>    FileOutputStream pngFileOutputStream=<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;e:/holiday.png&quot;</span>));<br><br>    <span class="hljs-comment">//3工具类把输入流转成输出流</span><br>    IOUtils.copy(xmlFileInputStream,xmlFileOutputStream);<br>    IOUtils.copy(pngInputStream,pngFileOutputStream);<br><br>    <span class="hljs-comment">//4关流</span><br>    pngFileOutputStream.close();<br>    xmlFileOutputStream.close();<br>    pngInputStream.close();<br>    xmlFileInputStream.close();<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><ol><li><pre><code>  deploymentId为流程部署ID
</code></pre></li><li><pre><code>  resource_name为act_ge_bytearray表中NAME_列的值
</code></pre></li><li><pre><code>  使用repositoryService的getDeploymentResourceNames方法可以获取指定部署下得所有文件的名称
</code></pre></li><li><pre><code>  使用repositoryService的getResourceAsStream方法传入部署ID和资源图片名称可以获取部署下指定名称文件的输入流
</code></pre></li></ol><p>最后的将输入流中的图片资源进行输出。</p><h3 id="九、流程历史信息的查看" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#九、流程历史信息的查看">#</a> 九、流程历史信息的查看</h3><p>即使流程定义已经删除了，流程执行的历史信息通过前面的分析，依然保存在activiti的act_hi_*相关的表中。所以我们还是可以查询流程执行的历史信息，可以通过HistoryService来查看相关的历史记录。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查看历史信息</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findHistoryInfo</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//      获取引擎</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><span class="hljs-comment">//        获取HistoryService</span><br>        <span class="hljs-type">HistoryService</span> <span class="hljs-variable">historyService</span> <span class="hljs-operator">=</span> processEngine.getHistoryService();<br><span class="hljs-comment">//        获取 actinst表的查询对象</span><br>        <span class="hljs-type">HistoricActivityInstanceQuery</span> <span class="hljs-variable">instanceQuery</span> <span class="hljs-operator">=</span> historyService.createHistoricActivityInstanceQuery();<br><span class="hljs-comment">//        查询 actinst表，条件：根据 InstanceId 查询</span><br><span class="hljs-comment">//        instanceQuery.processInstanceId(&quot;2503&quot;);</span><br><span class="hljs-comment">//        查询 actinst表，条件：根据 DefinitionId 查询</span><br>        instanceQuery.processDefinitionId(<span class="hljs-string">&quot;holiday:1:4&quot;</span>);<br><span class="hljs-comment">//        增加排序操作,orderByHistoricActivityInstanceStartTime 根据开始时间排序 asc 升序</span><br>        instanceQuery.orderByHistoricActivityInstanceStartTime().asc();<br><span class="hljs-comment">//        查询所有内容</span><br>        List&amp;lt;HistoricActivityInstance&amp;gt; activityInstanceList = instanceQuery.list();<br><span class="hljs-comment">//        输出</span><br>        <span class="hljs-keyword">for</span> (HistoricActivityInstance hi : activityInstanceList) &#123;<br>            System.out.println(hi.getActivityId());<br>            System.out.println(hi.getActivityName());<br>            System.out.println(hi.getProcessDefinitionId());<br>            System.out.println(hi.getProcessInstanceId());<br>            System.out.println(<span class="hljs-string">&quot;&amp;lt;==========================&amp;gt;&quot;</span>);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第七章-流程实例" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第七章-流程实例">#</a> 第七章 流程实例</h2><h3 id="一、什么是流程实例" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、什么是流程实例">#</a> 一、什么是流程实例</h3><p><strong>流程实例</strong>（ProcessInstance）代表流程定义的执行实例。</p><p>一个流程实例包括了所有的运行节点。我们可以利用这个对象来了解当前流程实例的进度等信息。</p><p>例如：用户或程序按照流程定义内容发起一个流程，这就是一个流程实例。</p><p>流程定义和流程实例的图解：</p><figure><img alt="image-20220913020819969" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913020819969-add71841.png" tabindex="0"/><figcaption>image-20220913020819969</figcaption></figure><figure><img alt="image-20220913022002864" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913022002864-632dcae3.png" tabindex="0"/><figcaption>image-20220913022002864</figcaption></figure><h3 id="二、启动流程实例-并添加businesskey-业务标识" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、启动流程实例-并添加businesskey-业务标识">#</a> 二、启动流程实例 并添加Businesskey（业务标识）</h3><p>流程定义部署在activiti后，就可以在系统中通过activiti去管理该流程的执行，执行流程表示流程的一次执行。</p><p>比如部署系统出差流程后，如果某用户要申请出差这时就需要执行这个流程，如果另外一个用户也要申请出差则也需要执行该流程，每个执行互不影响，每个执行是单独的流程实例。</p><p>启动流程实例时，指定的businesskey，就会在act_ru_execution #流程实例的执行表中存储businesskey。</p><p>Businesskey：业务标识，通常为业务表的主键，业务标识和流程实例一一对应。业务标识来源于业务系统。存储业务标识就是根据业务标识来关联查询业务系统的数据。</p><p>比如：出差流程启动一个流程实例，就可以将出差单的id作为业务标识存储到activiti中，将来查询activiti的流程实例信息就可以获取出差单的id从而关联查询业务系统数据库得到出差单信息。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 启动流程实例，添加businessKey</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addBusinessKey</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//        1、得到ProcessEngine</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><span class="hljs-comment">//        2、得到RunTimeService</span><br>        <span class="hljs-type">RuntimeService</span> <span class="hljs-variable">runtimeService</span> <span class="hljs-operator">=</span> processEngine.getRuntimeService();<br><span class="hljs-comment">//        3、启动流程实例，同时还要指定业务标识businessKey，也就是出差申请单id，这里是1001</span><br>        <span class="hljs-type">ProcessInstance</span> <span class="hljs-variable">processInstance</span> <span class="hljs-operator">=</span> runtimeService.<br>                startProcessInstanceByKey(<span class="hljs-string">&quot;holiday&quot;</span>,<span class="hljs-string">&quot;10001&quot;</span>);<br><span class="hljs-comment">//        4、输出processInstance相关属性</span><br>        System.out.println(<span class="hljs-string">&quot;id==&quot;</span>+processInstance.getBusinessKey());<br><br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Activiti的act_ru_execution中存储业务标识：</p><figure><img alt="image-20220913022849501" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/6Y%2BNrxjt.png" tabindex="0"/><figcaption>image-20220913022849501</figcaption></figure><h3 id="三、操作数据库表" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、操作数据库表">#</a> 三、操作数据库表</h3><p>启动流程实例，操作如下数据库表：</p><p>SELECT * FROM act_ru_execution #流程实例执行表，记录当前流程实例的执行情况</p><figure><img alt="image-20220913022900141" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913022900141-4d937984.png" tabindex="0"/><figcaption>image-20220913022900141</figcaption></figure><p>说明：</p><p>流程实例执行，如果当前只有一个分支时，一个流程实例只有一条记录且执行表的主键id和流程实例id相同，如果当前有多个分支正在运行则该执行表中有多条记录，存在执行表的主键和流程实例id不相同的记录。<strong>不论当前有几个分支总会有一条记录的执行表的主键和流程实例</strong>id<strong>相同</strong></p><p>一个流程实例运行完成，此表中与流程实例相关的记录删除。</p><p>SELECT * FROM act_ru_task #任务执行表，记录当前执行的任务</p><figure><img alt="image-20220913022915968" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913022915968-b2e399f1.png" tabindex="0"/><figcaption>image-20220913022915968</figcaption></figure><p>说明：启动流程实例，流程当前执行到第一个任务结点，此表会插入一条记录表示当前任务的执行情况，如果任务完成则记录删除。</p><p>SELECT * FROM act_ru_identitylink #任务参与者，记录当前参与任务的用户或组</p><figure><img alt="image-20220913022930729" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913022930729-6b32af9a.png" tabindex="0"/><figcaption>image-20220913022930729</figcaption></figure><p>SELECT * FROM act_hi_procinst #流程实例历史表</p><figure><img alt="image-20220913022945009" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913022945009-bd4dd3a9.png" tabindex="0"/><figcaption>image-20220913022945009</figcaption></figure><p>流程实例启动，会在此表插入一条记录，流程实例运行完成记录也不会删除。</p><p>SELECT * FROM act_hi_taskinst #任务历史表，记录所有任务</p><figure><img alt="image-20220913023007937" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913023007937-8c51e053.png" tabindex="0"/><figcaption>image-20220913023007937</figcaption></figure><p>开始一个任务，不仅在act_ru_task表插入记录，也会在历史任务表插入一条记录，任务历史表的主键就是任务id，任务完成此表记录不删除。</p><p>SELECT * FROM act_hi_actinst #活动历史表，记录所有活动</p><figure><img alt="image-20220913023030302" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913023030302-a9a6f230.png" tabindex="0"/><figcaption>image-20220913023030302</figcaption></figure><p>活动包括任务，所以此表中不仅记录了任务，还记录了流程执行过程的其它活动，比如开始事件、结束事件。</p><h3 id="四、挂起、激活流程实例" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、挂起、激活流程实例">#</a> 四、挂起、激活流程实例</h3><p>某些情况可能由于流程变更需要将当前运行的流程暂停而不是直接删除，流程暂停后将不会继续执行。</p><h4 id="_1、全部流程实例挂起" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、全部流程实例挂起">#</a> 1、全部流程实例挂起</h4><p>操作流程定义为挂起状态，该流程定义下边所有的流程实例全部暂停：</p><p>流程定义为挂起状态该流程定义将不允许启动新的流程实例，同时该流程定义下所有的流程实例将全部挂起暂停执行。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 全部流程实例挂起与激活</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SuspendAllProcessInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//        获取processEngine</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><span class="hljs-comment">//        获取repositoryService</span><br>        <span class="hljs-type">RepositoryService</span> <span class="hljs-variable">repositoryService</span> <span class="hljs-operator">=</span> processEngine.getRepositoryService();<br><span class="hljs-comment">//        查询流程定义的对象</span><br>        <span class="hljs-type">ProcessDefinition</span> <span class="hljs-variable">processDefinition</span> <span class="hljs-operator">=</span> repositoryService.createProcessDefinitionQuery().<br>                processDefinitionKey(<span class="hljs-string">&quot;holiday&quot;</span>).<br>                singleResult();<br><span class="hljs-comment">//        得到当前流程定义的实例是否都为暂停状态</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">suspended</span> <span class="hljs-operator">=</span> processDefinition.isSuspended();<br><span class="hljs-comment">//        流程定义id</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">processDefinitionId</span> <span class="hljs-operator">=</span> processDefinition.getId();<br><span class="hljs-comment">//        判断是否为暂停</span><br>        <span class="hljs-keyword">if</span>(suspended)&#123;<br><span class="hljs-comment">//         如果是暂停，可以执行激活操作 ,参数1 ：流程定义id ，参数2：是否激活，参数3：激活时间</span><br>            repositoryService.activateProcessDefinitionById(processDefinitionId,<br>                    <span class="hljs-literal">true</span>,<br>                    <span class="hljs-literal">null</span><br>            );<br>            System.out.println(<span class="hljs-string">&quot;processDefinitionId：&quot;</span>+processDefinitionId+<span class="hljs-string">&quot;,activate&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-comment">//          如果是激活状态，可以暂停，参数1 ：流程定义id ，参数2：是否暂停，参数3：暂停时间</span><br>            repositoryService.suspendProcessDefinitionById(processDefinitionId,<br>                    <span class="hljs-literal">true</span>,<br>                    <span class="hljs-literal">null</span>);<br>            System.out.println(<span class="hljs-string">&quot;processDefinitionId：&quot;</span>+processDefinitionId+<span class="hljs-string">&quot;,suspend&quot;</span>);<br>        &#125;<br><br>    &#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、单个流程实例挂起" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、单个流程实例挂起">#</a> 2、单个流程实例挂起</h4><p>操作流程实例对象，针对单个流程执行挂起操作，某个流程实例挂起则此流程不再继续执行，完成该流程实例的当前任务将报异常。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 单个流程实例挂起与激活</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SuspendSingleProcessInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//        获取processEngine</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><span class="hljs-comment">//        RuntimeService</span><br>        <span class="hljs-type">RuntimeService</span> <span class="hljs-variable">runtimeService</span> <span class="hljs-operator">=</span> processEngine.getRuntimeService();<br><span class="hljs-comment">//        查询流程定义的对象</span><br>        <span class="hljs-type">ProcessInstance</span> <span class="hljs-variable">processInstance</span> <span class="hljs-operator">=</span> runtimeService.<br>                createProcessInstanceQuery().<br>                processInstanceId(<span class="hljs-string">&quot;15001&quot;</span>).<br>                singleResult();<br><span class="hljs-comment">//        得到当前流程定义的实例是否都为暂停状态</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">suspended</span> <span class="hljs-operator">=</span> processInstance.isSuspended();<br><span class="hljs-comment">//        流程定义id</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">processDefinitionId</span> <span class="hljs-operator">=</span> processInstance.getId();<br><span class="hljs-comment">//        判断是否为暂停</span><br>        <span class="hljs-keyword">if</span>(suspended)&#123;<br><span class="hljs-comment">//         如果是暂停，可以执行激活操作 ,参数：流程定义id</span><br>            runtimeService.activateProcessInstanceById(processDefinitionId);<br>            System.out.println(<span class="hljs-string">&quot;processDefinitionId：&quot;</span>+processDefinitionId+<span class="hljs-string">&quot;,activate&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-comment">//          如果是激活状态，可以暂停，参数：流程定义id</span><br>            runtimeService.suspendProcessInstanceById( processDefinitionId);<br>            System.out.println(<span class="hljs-string">&quot;processDefinitionId：&quot;</span>+processDefinitionId+<span class="hljs-string">&quot;,suspend&quot;</span>);<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 测试完成个人任务</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">completTask</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//        获取引擎</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><span class="hljs-comment">//        获取操作任务的服务 TaskService</span><br>        <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br><span class="hljs-comment">//        完成任务,参数：流程实例id,完成zhangsan的任务</span><br>        <span class="hljs-type">Task</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService.createTaskQuery()<br>                .processInstanceId(<span class="hljs-string">&quot;15001&quot;</span>)<br>                .taskAssignee(<span class="hljs-string">&quot;itlils&quot;</span>)<br>                .singleResult();<br><br><br>        System.out.println(<span class="hljs-string">&quot;流程实例id=&quot;</span>+task.getProcessInstanceId());<br>        System.out.println(<span class="hljs-string">&quot;任务Id=&quot;</span>+task.getId());<br>        System.out.println(<span class="hljs-string">&quot;任务负责人=&quot;</span>+task.getAssignee());<br>        System.out.println(<span class="hljs-string">&quot;任务名称=&quot;</span>+task.getName());<br>        taskService.complete(task.getId());<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img alt="image-20220913031657929" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913031657929-22a5d821.png" tabindex="0"/><figcaption>image-20220913031657929</figcaption></figure><h2 id="第八章-个人任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第八章-个人任务">#</a> 第八章 个人任务</h2><h3 id="一、分配任务负责人" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、分配任务负责人">#</a> 一、分配任务负责人</h3><h4 id="_1、固定分配" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、固定分配">#</a> 1、固定分配</h4><p>在进行业务流程建模时指定固定的任务负责人， 如图：</p><figure><img alt="image-20220913015710752" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913015710752-24f668a3.png" tabindex="0"/><figcaption>image-20220913015710752</figcaption></figure><p>并在 properties 视图中，填写 Assignee 项为任务负责人。</p><h4 id="_2、表达式分配" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、表达式分配">#</a> 2、表达式分配</h4><p>由于固定分配方式，任务只管一步一步执行任务，执行到每一个任务将按照 bpmn 的配置去分配任务负责人。</p><h5 id="_1-uel-表达式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1-uel-表达式">#</a> （1）UEL 表达式</h5><p>Activiti 使用 UEL 表达式， UEL 是 java EE6 规范的一部分， UEL（Unified Expression Language）即 统一表达式语言， activiti 支持两个 UEL 表达式： UEL-value 和 UEL-method。</p><h6 id="a、uel-value-定义" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#a、uel-value-定义">#</a> a、UEL-value 定义</h6><p assignee0="">如图： $</p><figure><img alt="image-20220913034450183" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913034450183-d887e76d.png" tabindex="0"/><figcaption>image-20220913034450183</figcaption></figure><p>assignee 这个变量是 activiti 的一个流程变量，或者使用这种方式定义：</p><p user.assignee="">如图： $</p><figure><img alt="image-20220913051744701" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913051744701-940e6900.png" tabindex="0"/><figcaption>image-20220913051744701</figcaption></figure><p>user 也是 activiti 的一个流程变量， user.assignee 表示通过调用 user 的 getter 方法获取值。</p><h6 id="b、uel-method-方式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#b、uel-method-方式">#</a> b、UEL-method 方式</h6><p>如图： ${userBean.getUserId()</p><figure><img alt="image-20220913051802607" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913051802607-b765879d.png" tabindex="0"/><figcaption>image-20220913051802607</figcaption></figure><p>userBean 是 spring 容器中的一个 bean，表示调用该 bean 的 getUserId()方法。</p><h6 id="_3、uel-method-与-uel-value-结合" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、uel-method-与-uel-value-结合">#</a> 3、UEL-method 与 UEL-value 结合</h6><p>再比如： ${ldapService.findManagerForEmployee(emp)} ldapService 是 spring 容器的一个 bean，findManagerForEmployee 是该 bean 的一个方法，emp 是 activiti 流程变量， emp 作为参数传到 ldapService.findManagerForEmployee 方法中。</p><figure><img alt="image-20220913051832402" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913051832402-ad98b4b8.png" tabindex="0"/><figcaption>image-20220913051832402</figcaption></figure><h6 id="d、其它" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#d、其它">#</a> d、其它</h6><p>表达式支持解析基础类型、 bean、 list、 array 和 map，也可作为条件判断。 如下： <code>$&#123;order.price &gt; 100 &amp;&amp; order.price &lt; 250&#125; </code></p><h5 id="_2-编写代码配置负责人" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2-编写代码配置负责人">#</a> （2）编写代码配置负责人</h5><h6 id="a、定义任务分配流程变量" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#a、定义任务分配流程变量">#</a> a、定义任务分配流程变量</h6><p>如图：</p><figure><img alt="image-20220913034450183" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913034450183-d887e76d.png" tabindex="0"/><figcaption>image-20220913034450183</figcaption></figure><h6 id="b、设置流程变量" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#b、设置流程变量">#</a> b、设置流程变量</h6><p>在启动流程实例时设置流程变量，如下：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDeploy</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//创建流程引擎配置文件</span><br>    <span class="hljs-type">ProcessEngineConfiguration</span> <span class="hljs-variable">configuration</span><br>            <span class="hljs-operator">=</span> ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="hljs-string">&quot;activiti.cgf.xml&quot;</span>,<span class="hljs-string">&quot;processEngineConfiguration&quot;</span>);<br>    <span class="hljs-comment">//通过配置文件，创建流程</span><br>    <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> configuration.buildProcessEngine();<br><br>    <span class="hljs-type">RepositoryService</span> <span class="hljs-variable">repositoryService</span> <span class="hljs-operator">=</span> processEngine.getRepositoryService();<br>    <span class="hljs-type">Deployment</span> <span class="hljs-variable">deployment</span> <span class="hljs-operator">=</span> repositoryService.createDeployment()<br>            .addClasspathResource(<span class="hljs-string">&quot;bpmn/holiday-uel.bpmn20.xml&quot;</span>)<span class="hljs-comment">//增加bpmn.xml</span><br>            .name(<span class="hljs-string">&quot;出差流程-uel&quot;</span>) <span class="hljs-comment">//名字</span><br>            .deploy();<br><br>    System.out.println(<span class="hljs-string">&quot;id&quot;</span>+deployment.getId());<br>    System.out.println(<span class="hljs-string">&quot;Name&quot;</span>+deployment.getName());<br>&#125;<br><br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testStartProcess</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//创建流程引擎配置文件</span><br>    <span class="hljs-type">ProcessEngineConfiguration</span> <span class="hljs-variable">configuration</span><br>            <span class="hljs-operator">=</span> ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="hljs-string">&quot;activiti.cgf.xml&quot;</span>,<span class="hljs-string">&quot;processEngineConfiguration&quot;</span>);<br>    <span class="hljs-comment">//通过配置文件，创建流程</span><br>    <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> configuration.buildProcessEngine();<br><br>    <span class="hljs-type">RuntimeService</span> <span class="hljs-variable">runtimeService</span> <span class="hljs-operator">=</span> processEngine.getRuntimeService();<br>    <span class="hljs-comment">//启动实例</span><br>    Map&amp;lt;String,Object&amp;gt; map=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&amp;lt;&amp;gt;();<br>    map.put(<span class="hljs-string">&quot;assignee0&quot;</span>,<span class="hljs-string">&quot;itlils&quot;</span>);<br>    map.put(<span class="hljs-string">&quot;assignee1&quot;</span>,<span class="hljs-string">&quot;zhuzhu&quot;</span>);<br>    map.put(<span class="hljs-string">&quot;assignee2&quot;</span>,<span class="hljs-string">&quot;itnanls&quot;</span>);<br>    map.put(<span class="hljs-string">&quot;assignee3&quot;</span>,<span class="hljs-string">&quot;weiwei&quot;</span>);<br>    <span class="hljs-type">ProcessInstance</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> runtimeService.startProcessInstanceByKey(<span class="hljs-string">&quot;holiday1&quot;</span>,map);<br><br>    System.out.println(<span class="hljs-string">&quot;ProcessDefinitionId&quot;</span>+instance.getProcessDefinitionId());<br>    System.out.println(<span class="hljs-string">&quot;Id&quot;</span>+instance.getId());<br>    System.out.println(<span class="hljs-string">&quot;ActivityId&quot;</span>+instance.getActivityId());<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行成功后，可以在act_ru_variable表中看到刚才map中的数据</p><figure><img alt="image-20220913034231921" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913034231921-d10e1123.png" tabindex="0"/><figcaption>image-20220913034231921</figcaption></figure><h5 id="_3-注意事项" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3-注意事项">#</a> （3）注意事项</h5><p>由于使用了表达式分配，必须保证在任务执行过程表达式执行成功，比如： 某个任务使用了表达式${order.price &gt; 100 &amp;&amp; order.price &lt; 250}，当执行该任务时必须保证 order 在 流程变量中存在，否则 activiti 异常。</p><h4 id="_3、监听器分配" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、监听器分配">#</a> 3、监听器分配</h4><p>idea插件中没有，在Camunda modeler中可以查询</p><p>安装<strong>Camunda modeler</strong></p><ol><li>下载对应的软件,这里是在win10系统下,以<code>camunda-modeler-3.0.0-win-x64.zip</code>为例</li><li>将下载后的压缩包解压</li><li>在idea中File -&gt; Settings -&gt; Tools -&gt; External Tools里添加外部工具</li></ol><figure><img alt="./img" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/1419013-20220410101651570-1227868316-1b414069.png" tabindex="0"/><figcaption>./img</figcaption></figure><p>通过在项目中右键找到External Tools -&gt; camunda-modeler开始流程设计</p><p><strong><img alt="./img" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/1419013-20220327154203149-1314060857-9697f166.png"/></strong></p><p>本质</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>userTask id=&quot;sid-a69711e6-f4ae-41cb-b17e-acf4fe0f6ab7&quot; name=&quot;创建申请&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>extensionElements<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>activiti:taskListener class=&quot;com.ydlclass.delegrete.MyTaskListener&quot; event=&quot;create&quot; /<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/extensionElements<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/userTask<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以使用监听器来完成很多Activiti流程的业务。</p><p>在本章我们使用监听器的方式来指定负责人，那么在流程设计时就不需要指定assignee。</p><p>任务监听器是发生对应的任务相关事件时执行自定义 java 逻辑 或表达式。 任务相当事件包括：</p><p>Event的选项包含：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">Create：任务创建后触发<br>Assignment：任务分配后触发<br>Delete：任务完成后触发<br>All：所有事件发生都触发<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>定义任务监听类，且类必须实现 org.activiti.engine.delegate.TaskListener 接口</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTaskListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TaskListener</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notify</span><span class="hljs-params">(DelegateTask delegateTask)</span> &#123;<br>        <span class="hljs-keyword">if</span>(delegateTask.getName().equals(<span class="hljs-string">&quot;创建出差申请&quot;</span>)&amp;amp;&amp;amp;<br>                delegateTask.getEventName().equals(<span class="hljs-string">&quot;create&quot;</span>))&#123;<br>            <span class="hljs-comment">//这里指定任务负责人</span><br>            delegateTask.setAssignee(<span class="hljs-string">&quot;itlils&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>DelegateTask对象的内容如下：</p><figure><img alt="image-20220913043945281" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913043945281-ea97905b.png" tabindex="0"/><figcaption>image-20220913043945281</figcaption></figure><h5 id="_1、注意事项" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、注意事项">#</a> 1、注意事项</h5><p>使用监听器分配方式，按照监听事件去执行监听类的 notify 方法，方法如果不能正常执行也会影响任务的执行。</p><h3 id="二、查询任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、查询任务">#</a> 二、查询任务</h3><h4 id="_1、查询任务负责人的待办任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、查询任务负责人的待办任务">#</a> 1、查询任务负责人的待办任务</h4><p>代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 查询当前个人待执行的任务</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findPersonalTaskList</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 流程定义key</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">processDefinitionKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;myEvection1&quot;</span>;<br>    <span class="hljs-comment">// 任务负责人</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">assignee</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;itlils&quot;</span>;<br>    <span class="hljs-comment">// 获取TaskService</span><br>    <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br>    List&amp;lt;Task&amp;gt; taskList = taskService.createTaskQuery()<br>        .processDefinitionKey(processDefinitionKey)<br>        .includeProcessVariables()<br>        .taskAssignee(assignee)<br>        .list();<br>    <span class="hljs-keyword">for</span> (Task task : taskList) &#123;<br>        System.out.println(<span class="hljs-string">&quot;----------------------------&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;流程实例id： &quot;</span> + task.getProcessInstanceId());<br>        System.out.println(<span class="hljs-string">&quot;任务id： &quot;</span> + task.getId());<br>        System.out.println(<span class="hljs-string">&quot;任务负责人： &quot;</span> + task.getAssignee());<br>        System.out.println(<span class="hljs-string">&quot;任务名称： &quot;</span> + task.getName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、关联-businesskey" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、关联-businesskey">#</a> 2、关联 businessKey</h4><p>需求： 在 activiti 实际应用时，查询待办任务可能要显示出业务系统的一些相关信息。</p><p>比如：查询待审批出差任务列表需要将出差单的日期、 出差天数等信息显示出来。</p><p>出差天数等信息在业务系统中存在，而并没有在 activiti 数据库中存在，所以是无法通过 activiti 的 api 查询到出差天数等信息。 实现： 在查询待办任务时，通过 businessKey（业务标识 ）关联查询业务系统的出差单表，查询出出差天数等信息。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findProcessInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//        获取processEngine</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><span class="hljs-comment">//        获取TaskService</span><br>        <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br><span class="hljs-comment">//        获取RuntimeService</span><br>        <span class="hljs-type">RuntimeService</span> <span class="hljs-variable">runtimeService</span> <span class="hljs-operator">=</span> processEngine.getRuntimeService();<br><span class="hljs-comment">//        查询流程定义的对象</span><br>        <span class="hljs-type">Task</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService.createTaskQuery()<br>                .processDefinitionKey(<span class="hljs-string">&quot;holiday&quot;</span>)<br>                .taskAssignee(<span class="hljs-string">&quot;itlils&quot;</span>)<br>                .singleResult();<br><span class="hljs-comment">//        使用task对象获取实例id</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">processInstanceId</span> <span class="hljs-operator">=</span> task.getProcessInstanceId();<br><span class="hljs-comment">//          使用实例id，获取流程实例对象</span><br>        <span class="hljs-type">ProcessInstance</span> <span class="hljs-variable">processInstance</span> <span class="hljs-operator">=</span> runtimeService.createProcessInstanceQuery()<br>                .processInstanceId(processInstanceId)<br>                .singleResult();<br><span class="hljs-comment">//        使用processInstance，得到 businessKey</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">businessKey</span> <span class="hljs-operator">=</span> processInstance.getBusinessKey();<br><br>        System.out.println(<span class="hljs-string">&quot;businessKey==&quot;</span>+businessKey);<br><br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="三、办理任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、办理任务">#</a> 三、办理任务</h3><p>注意：在实际应用中，完成任务前需要校验任务的负责人是否具有该任务的办理权限 。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 完成任务，判断当前用户是否有权限</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">completTask</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//任务id</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;8888&quot;</span>;<br><span class="hljs-comment">//        任务负责人</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">assingee</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;itlils&quot;</span>;<br>        <span class="hljs-comment">//获取processEngine</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br>        <span class="hljs-comment">// 创建TaskService</span><br>        <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br><span class="hljs-comment">//        完成任务前，需要校验该负责人可以完成当前任务</span><br><span class="hljs-comment">//        校验方法：</span><br><span class="hljs-comment">//        根据任务id和任务负责人查询当前任务，如果查到该用户有权限，就完成</span><br>        <span class="hljs-type">Task</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService.createTaskQuery()<br>                .taskId(taskId)<br>                .taskAssignee(assingee)<br>                .singleResult();<br>        <span class="hljs-keyword">if</span>(task != <span class="hljs-literal">null</span>)&#123;<br>            taskService.complete(taskId);<br>            System.out.println(<span class="hljs-string">&quot;完成任务&quot;</span>);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第九章-流程变量" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第九章-流程变量">#</a> 第九章 流程变量</h2><h3 id="一、什么是流程变量" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、什么是流程变量">#</a> 一、什么是流程变量</h3><p>流程变量在 activiti 中是一个非常重要的角色，流程运转有时需要靠流程变量，业务系统和 activiti结合时少不了流程变量，流程变量就是 activiti 在管理工作流时根据管理需要而设置的变量。 比如：在出差申请流程流转时如果出差天数大于 3 天则由总经理审核，否则由人事直接审核， 出差天数就可以设置为流程变量，在流程流转时使用。</p><p><strong>注意：虽然流程变量中可以存储业务数据可以通过activiti的api查询流程变量从而实现查询业务数据，但是不建议这样使用，因为业务数据查询由业务系统负责，activiti设置流程变量是为了流程执行需要而创建。</strong></p><figure><img alt="image-20220913051254294" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913051254294-e0839d64.png" tabindex="0"/><figcaption>image-20220913051254294</figcaption></figure><h3 id="二、流程变量类型" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、流程变量类型">#</a> 二、流程变量类型</h3><p>如果将 pojo 存储到流程变量中，必须实现序列化接口 serializable，为了防止由于新增字段无法反序列化，需要生成 serialVersionUID。</p><figure><img alt="" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/20190731150933695-972195fb.png" tabindex="0"/><figcaption></figcaption></figure><h3 id="三、流程变量作用域" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、流程变量作用域">#</a> 三、流程变量作用域</h3><p>流程变量的作用域可以是一个流程实例(processInstance)，或一个任务(task)，或一个执行实例(execution)</p><h4 id="_1、globa变量" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、globa变量">#</a> 1、globa变量</h4><p>流程变量的默认作用域是流程实例。当一个流程变量的作用域为流程实例时，可以称为 global 变量</p><p>注意：</p><p>如： Global变量：userId（变量名）、itlils（变量值）</p><p>global 变量中变量名不允许重复，设置相同名称的变量，后设置的值会覆盖前设置的变量值。</p><h4 id="_2、local变量" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、local变量">#</a> 2、local变量</h4><p>任务和执行实例仅仅是针对一个任务和一个执行实例范围，范围没有流程实例大， 称为 local 变量。</p><p>Local 变量由于在不同的任务或不同的执行实例中，作用域互不影响，变量名可以相同没有影响。Local 变量名也可以和 global 变量名相同，没有影响。</p><h3 id="四、流程变量的使用方法" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、流程变量的使用方法">#</a> 四、流程变量的使用方法</h3><h4 id="_1、在属性上使用uel表达式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、在属性上使用uel表达式">#</a> 1、在属性上使用UEL表达式</h4><p>可以在 assignee 处设置 UEL 表达式，表达式的值为任务的负责人，比如： ${assignee}， assignee 就是一个流程变量名称。</p><p>Activiti获取UEL表达式的值，即流程变量assignee的值 ，将assignee的值作为任务的负责人进行任务分配</p><h4 id="_2、在连线上使用uel表达式" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、在连线上使用uel表达式">#</a> 2、在连线上使用UEL表达式</h4><p>可以在连线上设置UEL表达式，决定流程走向。</p><p>比如：${price&lt;10000} 。price就是一个流程变量名称，uel表达式结果类型为布尔类型。</p><p>如果UEL表达式是true，要决定 流程执行走向。</p><h3 id="五、使用global变量控制流程" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#五、使用global变量控制流程">#</a> 五、使用Global变量控制流程</h3><h4 id="_1、需求" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、需求">#</a> 1、需求</h4><p>员工创建出差申请单，由部门经理审核，部门经理审核通过后出差3天及以下由人财务直接审批，3天以上先由总经理审核，总经理审核通过再由财务审批。</p><figure><img alt="image-20220913053642543" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913053642543-65f9f0bb.png" tabindex="0"/><figcaption>image-20220913053642543</figcaption></figure><h4 id="_2、流程定义-1" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、流程定义-1">#</a> 2、流程定义</h4><p>a.出差天数大于等于3连线条件</p><figure><img alt="image-20220913053724027" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913053724027-80461689.png" tabindex="0"/><figcaption>image-20220913053724027</figcaption></figure><p>也可以使用对象参数命名，如holidays.num：</p><figure><img alt="image-20220913053700339" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913053700339-734546d7.png" tabindex="0"/><figcaption>image-20220913053700339</figcaption></figure><p>b、出差天数小于3连线条件</p><figure><img alt="image-20220913053744091" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913053744091-cf6cf8b6.png" tabindex="0"/><figcaption>image-20220913053744091</figcaption></figure><p>也可以使用对象参数命名，如：</p><figure><img alt="image-20220913053802914" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913053802914-be7e2d19.png" tabindex="0"/><figcaption>image-20220913053802914</figcaption></figure><h4 id="_3、设置global流程变量" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、设置global流程变量">#</a> 3、设置global流程变量</h4><p>在部门经理审核前设置流程变量，变量值为出差单信息（包括出差天数），部门经理审核后可以根据流程变量的值决定流程走向。</p><p>在设置流程变量时，可以在启动流程时设置，也可以在任务办理时设置</p><h5 id="a、创建pojo对象" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#a、创建pojo对象">#</a> a、创建POJO对象</h5><p>创建出差申请pojo对象</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Holidays</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 主键id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 出差申请单名称</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String holidaysName;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 出差天数</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Double num;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 预计开始时间</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Date beginDate;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 预计结束时间</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Date endDate;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 目的地</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String destination;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 出差事由</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String reson;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Holidays&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;id=&quot;</span> + id +<br>                <span class="hljs-string">&quot;, holidaysName=&#x27;&quot;</span> + holidaysName + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, num=&quot;</span> + num +<br>                <span class="hljs-string">&quot;, beginDate=&quot;</span> + beginDate +<br>                <span class="hljs-string">&quot;, endDate=&quot;</span> + endDate +<br>                <span class="hljs-string">&quot;, destination=&#x27;&quot;</span> + destination + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, reson=&#x27;&quot;</span> + reson + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getHolidaysName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> holidaysName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setHolidaysName</span><span class="hljs-params">(String holidaysName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.holidaysName = holidaysName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">getNum</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> num;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNum</span><span class="hljs-params">(Double num)</span> &#123;<br>        <span class="hljs-built_in">this</span>.num = num;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getBeginDate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> beginDate;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBeginDate</span><span class="hljs-params">(Date beginDate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.beginDate = beginDate;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getEndDate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> endDate;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setEndDate</span><span class="hljs-params">(Date endDate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.endDate = endDate;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDestination</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> destination;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDestination</span><span class="hljs-params">(String destination)</span> &#123;<br>        <span class="hljs-built_in">this</span>.destination = destination;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getReson</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> reson;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setReson</span><span class="hljs-params">(String reson)</span> &#123;<br>        <span class="hljs-built_in">this</span>.reson = reson;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="b、启动流程时设置变量" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#b、启动流程时设置变量">#</a> b、启动流程时设置变量</h5><p>在启动流程时设置流程变量，变量的作用域是整个流程实例。</p><p>通过Map&lt;key,value&gt;设置流程变量，map中可以设置多个变量，这个key就是流程变量的名字。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 启动流程实例,设置流程变量的值</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startProcess</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//创建流程引擎配置文件</span><br>    <span class="hljs-type">ProcessEngineConfiguration</span> <span class="hljs-variable">configuration</span><br>            <span class="hljs-operator">=</span> ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="hljs-string">&quot;activiti.cgf.xml&quot;</span>,<span class="hljs-string">&quot;processEngineConfiguration&quot;</span>);<br>    <span class="hljs-comment">//通过配置文件，创建流程</span><br>    <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> configuration.buildProcessEngine();<br><br>    <span class="hljs-type">RuntimeService</span> <span class="hljs-variable">runtimeService</span> <span class="hljs-operator">=</span> processEngine.getRuntimeService();<br>    <span class="hljs-comment">//启动实例</span><br>    Map&amp;lt;String,Object&amp;gt; map=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&amp;lt;&amp;gt;();<br>    <span class="hljs-type">Holidays</span> <span class="hljs-variable">holidays</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Holidays</span>();<br>    holidays.setNum(<span class="hljs-number">2d</span>);<br>    map.put(<span class="hljs-string">&quot;holidays&quot;</span>,holidays);<br><br>    map.put(<span class="hljs-string">&quot;assignee0&quot;</span>,<span class="hljs-string">&quot;itlils&quot;</span>);<br>    map.put(<span class="hljs-string">&quot;assignee1&quot;</span>,<span class="hljs-string">&quot;zhuzhu&quot;</span>);<br>    map.put(<span class="hljs-string">&quot;assignee2&quot;</span>,<span class="hljs-string">&quot;itnanls&quot;</span>);<br>    map.put(<span class="hljs-string">&quot;assignee3&quot;</span>,<span class="hljs-string">&quot;weiwei&quot;</span>);<br>    <span class="hljs-type">ProcessInstance</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> runtimeService.startProcessInstanceByKey(<span class="hljs-string">&quot;holiday-global1&quot;</span>,map);<br><br>    System.out.println(<span class="hljs-string">&quot;ProcessDefinitionId&quot;</span>+instance.getProcessDefinitionId());<br>    System.out.println(<span class="hljs-string">&quot;Id&quot;</span>+instance.getId());<br>    System.out.println(<span class="hljs-string">&quot;ActivityId&quot;</span>+instance.getActivityId());<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCompletTask</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//创建流程引擎配置文件</span><br>    <span class="hljs-type">ProcessEngineConfiguration</span> <span class="hljs-variable">configuration</span><br>            <span class="hljs-operator">=</span> ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="hljs-string">&quot;activiti.cgf.xml&quot;</span>,<span class="hljs-string">&quot;processEngineConfiguration&quot;</span>);<br>    <span class="hljs-comment">//通过配置文件，创建流程</span><br>    <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> configuration.buildProcessEngine();<br>    <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br><br>    <span class="hljs-type">Task</span> <span class="hljs-variable">task1</span> <span class="hljs-operator">=</span> taskService.createTaskQuery()<br>            .processDefinitionKey(<span class="hljs-string">&quot;holiday-global1&quot;</span>)<br>            .taskAssignee(<span class="hljs-string">&quot;weiwei1&quot;</span>)<br>            .singleResult();<br><br>    <span class="hljs-keyword">if</span>(task1!=<span class="hljs-literal">null</span>)&#123;<br>        taskService.complete(task1.getId());<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><p>startProcessInstanceByKey(processDefinitionKey, variables)</p><p>流程变量作用域是一个流程实例，流程变量使用Map存储，同一个流程实例设置变量map中key相同，后者覆盖前者。</p><h5 id="c、任务办理时设置变量" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#c、任务办理时设置变量">#</a> c、任务办理时设置变量</h5><p>在完成任务时设置流程变量，该流程变量只有在该任务完成后其它结点才可使用该变量，它的作用域是整个流程实例，如果设置的流程变量的key在流程实例中已存在相同的名字则后设置的变量替换前边设置的变量。</p><p>这里需要在创建出差单任务完成时设置流程变量</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 完成任务，判断当前用户是否有权限</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">completTask</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//任务id</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;holiday-global1&quot;</span>;<br><span class="hljs-comment">//        任务负责人</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">assingee</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;itlils&quot;</span>;<br><span class="hljs-comment">//       获取processEngine</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><span class="hljs-comment">//       创建TaskService</span><br>        <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br><span class="hljs-comment">//       创建变量集合</span><br>        Map&amp;lt;String, Object&amp;gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&amp;lt;&amp;gt;();<br><span class="hljs-comment">//        创建出差pojo对象</span><br>        <span class="hljs-type">Holidays</span> <span class="hljs-variable">holidays</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Holidays</span>();<br>        holidays.setNum(<span class="hljs-number">2d</span>);<br>        map.put(<span class="hljs-string">&quot;holidays&quot;</span>,holidays);<br><span class="hljs-comment">//        完成任务前，需要校验该负责人可以完成当前任务</span><br><span class="hljs-comment">//        校验方法：</span><br><span class="hljs-comment">//        根据任务id和任务负责人查询当前任务，如果查到该用户有权限，就完成</span><br>        <span class="hljs-type">Task</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService.createTaskQuery()<br>                .processDefinitionKey(key)<br>                .taskAssignee(assingee)<br>                .singleResult();<br>        <span class="hljs-keyword">if</span>(task != <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-comment">//完成任务是，设置流程变量的值</span><br>            taskService.complete(task.getId(),map);<br>            System.out.println(<span class="hljs-string">&quot;任务执行完成&quot;</span>);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><p>通过当前任务设置流程变量，需要指定当前任务id，如果当前执行的任务id不存在则抛出异常。</p><p>任务办理时也是通过map&lt;key,value&gt;设置流程变量，一次可以设置多个变量。</p><h5 id="d、通过当前流程实例设置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#d、通过当前流程实例设置">#</a> d、通过当前流程实例设置</h5><p>通过流程实例id设置全局变量，该流程实例必须未执行完成。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setGlobalVariableByExecutionId</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//    当前流程实例执行 id，通常设置为当前执行的流程实例</span><br>        String executionId=<span class="hljs-string">&quot;2601&quot;</span>;<br><span class="hljs-comment">//     获取processEngine</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br><span class="hljs-comment">//        获取RuntimeService</span><br>        <span class="hljs-type">RuntimeService</span> <span class="hljs-variable">runtimeService</span> <span class="hljs-operator">=</span> processEngine.getRuntimeService();<br><span class="hljs-comment">//        创建出差pojo对象</span><br>        <span class="hljs-type">Holidays</span> <span class="hljs-variable">holidays</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Holidays</span>();<br>        holidays.setNum(<span class="hljs-number">2d</span>);<br><span class="hljs-comment">//      通过流程实例 id设置流程变量</span><br>        runtimeService.setVariable(executionId, <span class="hljs-string">&quot;holidays&quot;</span>, holidays);<br><span class="hljs-comment">//      一次设置多个值</span><br><span class="hljs-comment">//      runtimeService.setVariables(executionId, variables)</span><br>    &#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：</p><p>executionId必须当前未结束 流程实例的执行id，通常此id设置流程实例 的id。也可以通runtimeService.getVariable()获取流程变量。</p><h5 id="e、通过当前任务设置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#e、通过当前任务设置">#</a> e、通过当前任务设置</h5><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setGlobalVariableByTaskId</span><span class="hljs-params">()</span>&#123;<br><br>        <span class="hljs-comment">//当前待办任务id</span><br>        String taskId=<span class="hljs-string">&quot;1404&quot;</span>;<br><span class="hljs-comment">//     获取processEngine</span><br>        <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br>        <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br>        <span class="hljs-type">Holidays</span> <span class="hljs-variable">holidays</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Holidays</span>();<br>        holidays.setNum(<span class="hljs-number">2d</span>);<br>        <span class="hljs-comment">//通过任务设置流程变量</span><br>        taskService.setVariable(taskId, <span class="hljs-string">&quot;holidays&quot;</span>, holidays);<br>        <span class="hljs-comment">//一次设置多个值 </span><br>        <span class="hljs-comment">//taskService.setVariables(taskId, variables)</span><br>    &#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：</p><p>任务id必须是当前待办任务id，act_ru_task中存在。如果该任务已结束，会报错</p><p>也可以通过taskService.getVariable()获取流程变量。</p><h4 id="_4、测试" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、测试">#</a> 4、测试</h4><p>正常测试：</p><p>​ 设置流程变量的值大于等于3天</p><p>​ 设计流程变量的值小于3天</p><p>异常测试：</p><p>​ 流程变量不存在</p><p>​ 流程变量的值为空NULL，price属性为空</p><p>​ UEL表达式都不符合条件</p><p>​ 不设置连线的条件</p><h4 id="_5、注意事项" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5、注意事项">#</a> 5、注意事项</h4><p>1、 如果UEL表达式中流程变量名不存在则报错。</p><p>2、 如果UEL表达式中流程变量值为空NULL，流程不按UEL表达式去执行，而流程结束 。</p><p>3、 如果UEL表达式都不符合条件，流程结束</p><p>4、 如果连线不设置条件，会走flow序号小的那条线</p><h4 id="_6、操作数据库表" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6、操作数据库表">#</a> 6、操作数据库表</h4><p>设置流程变量会在当前执行流程变量表插入记录，同时也会在历史流程变量表也插入记录。</p><div class="language-sql line-numbers-mode" data-ext="sql"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight sql"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>当前流程变量表<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> act_ru_variable <br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>记录当前运行流程实例可使用的流程变量，包括 global和local变量</p><p>Id_：主键</p><p>Type_：变量类型</p><p>Name_：变量名称</p><p>Execution_id_：所属流程实例执行id，global和local变量都存储</p><p>Proc_inst_id_：所属流程实例id，global和local变量都存储</p><p>Task_id_：所属任务id，local变量存储</p><p>Bytearray_：serializable类型变量存储对应act_ge_bytearray表的id</p><p>Double_：double类型变量值</p><p>Long_：long类型变量值</p><p>Text_：text类型变量值</p><div class="language-sql line-numbers-mode" data-ext="sql"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight sql"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"> #历史流程变量表<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> act_hi_varinst <br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>记录所有已创建的流程变量，包括 global和local变量</p><p>字段意义参考当前流程变量表。</p><h3 id="六、设置local流程变量" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#六、设置local流程变量">#</a> 六、设置local流程变量</h3><h4 id="_1、任务办理时设置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、任务办理时设置">#</a> 1、任务办理时设置</h4><p>任务办理时设置local流程变量，当前运行的流程实例只能在该任务结束前使用，任务结束该变量无法在当前流程实例使用，可以通过查询历史任务查询。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">*处理任务时设置local流程变量</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">completTask</span><span class="hljs-params">()</span> &#123;<br>   <span class="hljs-comment">//任务id</span><br>   <span class="hljs-type">String</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;1404&quot;</span>;<br><span class="hljs-comment">//  获取processEngine</span><br>    <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br>    <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br><span class="hljs-comment">//  定义流程变量</span><br>   Map&amp;lt;String, Object&amp;gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&amp;lt;String, Object&amp;gt;();<br>   <span class="hljs-type">Holidays</span> <span class="hljs-variable">holidays</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Holidays</span>();<br>   holidays.setNum(<span class="hljs-number">2d</span>);<br><span class="hljs-comment">// 定义流程变量</span><br>   Map&amp;lt;String, Object&amp;gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&amp;lt;String, Object&amp;gt;();<br><span class="hljs-comment">//  变量名是holiday，变量值是holiday对象</span><br>    variables.put(<span class="hljs-string">&quot;holidays&quot;</span>, holidays);<br><span class="hljs-comment">//  设置local变量，作用域为该任务</span><br>    taskService.setVariablesLocal(taskId, variables);<br><span class="hljs-comment">//  完成任务</span><br>   taskService.complete(taskId);<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><p>设置作用域为任务的local变量，每个任务可以设置同名的变量，互不影响。</p><h4 id="_2、通过当前任务设置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、通过当前任务设置">#</a> 2、通过当前任务设置</h4><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setLocalVariableByTaskId</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//   当前待办任务id</span><br>    String taskId=<span class="hljs-string">&quot;1404&quot;</span>;<br><span class="hljs-comment">//  获取processEngine</span><br>    <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br>    <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br>    <span class="hljs-type">Holidays</span> <span class="hljs-variable">holidays</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Holidays</span>();<br>    holidays.setNum(<span class="hljs-number">2d</span>);<br><span class="hljs-comment">//  通过任务设置流程变量</span><br>    taskService.setVariableLocal(taskId, <span class="hljs-string">&quot;holidays&quot;</span>, holidays);<br><span class="hljs-comment">//  一次设置多个值 </span><br>    <span class="hljs-comment">//taskService.setVariablesLocal(taskId, variables)</span><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：</p><p>任务id必须是当前待办任务id，act_ru_task中存在。</p><h4 id="_3、-local变量测试1" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、-local变量测试1">#</a> 3、 Local变量测试1</h4><p>如果上边例子中设置global变量改为设置local变量是否可行？为什么？</p><p>Local变量在任务结束后无法在当前流程实例执行中使用，如果后续的流程执行需要用到此变量则会报错。</p><h4 id="_4、-local变量测试2" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、-local变量测试2">#</a> 4、 Local变量测试2</h4><p>在部门经理审核、总经理审核、财务审核时设置local变量，可通过historyService查询每个历史任务时将流程变量的值也查询出来。</p><p>代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 创建历史任务查询对象</span><br>      <span class="hljs-type">HistoricTaskInstanceQuery</span> <span class="hljs-variable">historicTaskInstanceQuery</span> <span class="hljs-operator">=</span> historyService.createHistoricTaskInstanceQuery();<br>      <span class="hljs-comment">// 查询结果包括 local变量</span><br>      historicTaskInstanceQuery.includeTaskLocalVariables();<br><span class="hljs-keyword">for</span> (HistoricTaskInstance historicTaskInstance : list) &#123;<br>         System.out.println(<span class="hljs-string">&quot;==============================&quot;</span>);<br>         System.out.println(<span class="hljs-string">&quot;任务id：&quot;</span> + historicTaskInstance.getId());<br>         System.out.println(<span class="hljs-string">&quot;任务名称：&quot;</span> + historicTaskInstance.getName());<br>         System.out.println(<span class="hljs-string">&quot;任务负责人：&quot;</span> + historicTaskInstance.getAssignee());<br>     System.out.println(<span class="hljs-string">&quot;任务local变量：&quot;</span>+ historicTaskInstance.getTaskLocalVariables());<br><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：查询历史流程变量，特别是查询pojo变量需要经过反序列化，不推荐使用。</p><h2 id="第十章-组任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第十章-组任务">#</a> 第十章 组任务</h2><h3 id="一、需求" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、需求">#</a> 一、需求</h3><p>在流程定义中在任务结点的 assignee 固定设置任务负责人，在流程定义时将参与者固定设置在.bpmn 文件中，如果临时任务负责人变更则需要修改流程定义，系统可扩展性差。</p><p>针对这种情况可以给任务设置多个候选人，可以从候选人中选择参与者来完成任务。</p><h3 id="二、设置任务候选人" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、设置任务候选人">#</a> 二、设置任务候选人</h3><p>在流程图中任务节点的配置中设置 candidate-users(候选人)，多个候选人之间用逗号分开。</p><figure><img alt="image-20220913065958947" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913065958947-74cccf67.png" tabindex="0"/><figcaption>image-20220913065958947</figcaption></figure><p>查看bpmn文件</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>userTask id=&quot;sid-d5f4b312-5249-4630-a903-4957eb84d0c4&quot; name=&quot;部门经理审核&quot; activiti:candidateUsers=&quot;itwangls,itsongls&quot;/<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>我们可以看到部门经理的审核人已经设置为 lisi,wangwu 这样的一组候选人，可以使用</p><p>activiti:candiateUsers=”用户 1,用户 2,用户 3”的这种方式来实现设置一组候选人</p><h3 id="三、组任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、组任务">#</a> 三、组任务</h3><h4 id="_1、组任务办理流程" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、组任务办理流程">#</a> 1、组任务办理流程</h4><h5 id="_1-查询组任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1-查询组任务">#</a> （1）查询组任务</h5><p>指定候选人，查询该候选人当前的待办任务。</p><p>候选人不能立即办理任务。</p><h5 id="_2-拾取-claim-任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2-拾取-claim-任务">#</a> （2）拾取(claim)任务</h5><p>该组任务的所有候选人都能拾取。</p><p>将候选人的组任务，变成个人任务。原来候选人就变成了该任务的负责人。</p><p>如果拾取后不想办理该任务？</p><p>需要将已经拾取的个人任务归还到组里边，将个人任务变成了组任务。</p><h5 id="_3-查询个人任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3-查询个人任务">#</a> （3）查询个人任务</h5><p>查询方式同个人任务部分，根据assignee查询用户负责的个人任务。</p><h5 id="_4-办理个人任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4-办理个人任务">#</a> （4）办理个人任务</h5><h4 id="_2、查询组任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、查询组任务">#</a> 2、查询组任务</h4><p>根据候选人查询组任务</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findGroupTaskList</span><span class="hljs-params">()</span> &#123;<br>   <span class="hljs-comment">// 流程定义key</span><br>   <span class="hljs-type">String</span> <span class="hljs-variable">processDefinitionKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;holiday-group1&quot;</span>;<br>   <span class="hljs-comment">// 任务候选人</span><br>   <span class="hljs-type">String</span> <span class="hljs-variable">candidateUser</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;itwangls&quot;</span>;<br>    <span class="hljs-comment">//  获取processEngine</span><br>   <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br>   <span class="hljs-comment">// 创建TaskService</span><br>   <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br>   <span class="hljs-comment">//查询组任务</span><br>   List&amp;lt;Task&amp;gt; list = taskService.createTaskQuery()<br>          .processDefinitionKey(processDefinitionKey)<br>          .taskCandidateUser(candidateUser)<span class="hljs-comment">//根据候选人查询</span><br>          .list();<br>   <span class="hljs-keyword">for</span> (Task task : list) &#123;<br>       System.out.println(<span class="hljs-string">&quot;----------------------------&quot;</span>);<br>       System.out.println(<span class="hljs-string">&quot;InstanceId：&quot;</span> + task.getProcessInstanceId());<br>       System.out.println(<span class="hljs-string">&quot;id：&quot;</span> + task.getId());<br>       System.out.println(<span class="hljs-string">&quot;Assignee：&quot;</span> + task.getAssignee());<br>       System.out.println(<span class="hljs-string">&quot;Name：&quot;</span> + task.getName());<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3、拾取组任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、拾取组任务">#</a> 3、拾取组任务</h4><p>候选人员拾取组任务后该任务变为自己的个人任务。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">claimTask</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//  获取processEngine</span><br>      <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br>      <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br>      <span class="hljs-comment">//要拾取的任务id</span><br>      <span class="hljs-type">String</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;6302&quot;</span>;<br>      <span class="hljs-comment">//任务候选人id</span><br>      <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;itwangls&quot;</span>;<br>      <span class="hljs-comment">//拾取任务</span><br>      <span class="hljs-comment">//即使该用户不是候选人也能拾取(建议拾取时校验是否有资格)    </span><br>      <span class="hljs-comment">//校验该用户有没有拾取任务的资格</span><br>      <span class="hljs-type">Task</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService.createTaskQuery()<br>             .taskId(taskId)<br>             .taskCandidateUser(userId)<span class="hljs-comment">//根据候选人查询</span><br>             .singleResult();<br>      <span class="hljs-keyword">if</span>(task!=<span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-comment">//拾取任务</span><br>          taskService.claim(taskId, userId);<br>          System.out.println(<span class="hljs-string">&quot;任务拾取成功&quot;</span>);<br>      &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：即使该用户不是候选人也能拾取，建议拾取时校验是否有资格</p><p>组任务拾取后，该任务已有负责人，通过候选人将查询不到该任务</p><h4 id="_4、查询个人待办任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、查询个人待办任务">#</a> 4、查询个人待办任务</h4><p>查询方式同个人任务查询</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findPersonalTaskList</span><span class="hljs-params">()</span> &#123;<br>   <span class="hljs-comment">// 流程定义key</span><br>   <span class="hljs-type">String</span> <span class="hljs-variable">processDefinitionKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;evection1&quot;</span>;<br>   <span class="hljs-comment">// 任务负责人</span><br>   <span class="hljs-type">String</span> <span class="hljs-variable">assignee</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;itwangls&quot;</span>;<br>    <span class="hljs-comment">//  获取processEngine</span><br>      <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br>   <span class="hljs-comment">// 创建TaskService</span><br>   <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br>   List&amp;lt;Task&amp;gt; list = taskService.createTaskQuery()<br>       .processDefinitionKey(processDefinitionKey)<br>       .taskAssignee(assignee)<br>       .list();<br>   <span class="hljs-keyword">for</span> (Task task : list) &#123;<br>       System.out.println(<span class="hljs-string">&quot;----------------------------&quot;</span>);<br>       System.out.println(<span class="hljs-string">&quot;流程实例id：&quot;</span> + task.getProcessInstanceId());<br>       System.out.println(<span class="hljs-string">&quot;任务id：&quot;</span> + task.getId());<br>       System.out.println(<span class="hljs-string">&quot;任务负责人：&quot;</span> + task.getAssignee());<br>       System.out.println(<span class="hljs-string">&quot;任务名称：&quot;</span> + task.getName());<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5、办理个人任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5、办理个人任务">#</a> 5、办理个人任务</h4><p>同个人任务办理</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-comment">/*完成任务*/</span><br>   <span class="hljs-meta">@Test</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">completeTask</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//     任务ID</span><br>      <span class="hljs-type">String</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;12304&quot;</span>;<br><span class="hljs-comment">//     获取processEngine</span><br>      <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br>      processEngine.getTaskService()<br>                   .complete(taskId);<br>      System.out.println(<span class="hljs-string">&quot;完成任务：&quot;</span>+taskId);<br>   &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：建议完成任务前校验该用户是否是该任务的负责人。</p><h4 id="_6、归还组任务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6、归还组任务">#</a> 6、归还组任务</h4><p>如果个人不想办理该组任务，可以归还组任务，归还后该用户不再是该任务的负责人</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">*归还组任务，由个人任务变为组任务，还可以进行任务交接</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAssigneeToGroupTask</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//  获取processEngine</span><br>       <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br>   <span class="hljs-comment">// 查询任务使用TaskService</span><br>   <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br>   <span class="hljs-comment">// 当前待办任务</span><br>   <span class="hljs-type">String</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;6004&quot;</span>;<br>   <span class="hljs-comment">// 任务负责人</span><br>   <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;zhangsan2&quot;</span>;<br>    <span class="hljs-comment">// 校验userId是否是taskId的负责人，如果是负责人才可以归还组任务</span><br>   <span class="hljs-type">Task</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService<br>       .createTaskQuery()<br>       .taskId(taskId)<br>       .taskAssignee(userId)<br>       .singleResult();<br>    <span class="hljs-keyword">if</span> (task != <span class="hljs-literal">null</span>) &#123;<br>       <span class="hljs-comment">// 如果设置为null，归还组任务,该 任务没有负责人</span><br>       taskService.setAssignee(taskId, <span class="hljs-literal">null</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：建议归还任务前校验该用户是否是该任务的负责人</p><p>也可以通过setAssignee方法将任务委托给其它用户负责，注意被委托的用户可以不是候选人（建议不要这样使用）</p><h4 id="_7、任务交接" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_7、任务交接">#</a> 7、任务交接</h4><p>任务交接,任务负责人将任务交给其它候选人办理该任务</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAssigneeToCandidateUser</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//  获取processEngine</span><br>   <span class="hljs-type">ProcessEngine</span> <span class="hljs-variable">processEngine</span> <span class="hljs-operator">=</span> ProcessEngines.getDefaultProcessEngine();<br>   <span class="hljs-comment">// 查询任务使用TaskService</span><br>   <span class="hljs-type">TaskService</span> <span class="hljs-variable">taskService</span> <span class="hljs-operator">=</span> processEngine.getTaskService();<br>   <span class="hljs-comment">// 当前待办任务</span><br>   <span class="hljs-type">String</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;6004&quot;</span>;<br>   <span class="hljs-comment">// 任务负责人</span><br>   <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;itwangls&quot;</span>;<br>   <span class="hljs-comment">// 将此任务交给其它候选人办理该 任务</span><br>   <span class="hljs-type">String</span> <span class="hljs-variable">candidateuser</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;itsongls&quot;</span>;<br>   <span class="hljs-comment">// 校验userId是否是taskId的负责人，如果是负责人才可以归还组任务</span><br>   <span class="hljs-type">Task</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService<br>       .createTaskQuery()<br>       .taskId(taskId)<br>       .taskAssignee(userId)<br>       .singleResult();<br>   <span class="hljs-keyword">if</span> (task != <span class="hljs-literal">null</span>) &#123;<br>       taskService.setAssignee(taskId, candidateuser);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8、数据库表操作" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_8、数据库表操作">#</a> 8、数据库表操作</h4><p>查询当前任务执行表</p><div class="language-sql line-numbers-mode" data-ext="sql"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight sql"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> act_ru_task <br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>任务执行表，记录当前执行的任务，由于该任务当前是组任务，所有assignee为空，当拾取任务后该字段就是拾取用户的id</p><p>查询任务参与者</p><div class="language-sql line-numbers-mode" data-ext="sql"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight sql"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> act_ru_identitylink<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>任务参与者，记录当前参考任务用户或组，当前任务如果设置了候选人，会向该表插入候选人记录，有几个候选就插入几个</p><p>与act_ru_identitylink对应的还有一张历史表act_hi_identitylink，向act_ru_identitylink插入记录的同时也会向历史表插入记录。任务完成</p><h2 id="第十一章-网关" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第十一章-网关">#</a> 第十一章 网关</h2><p>网关用来控制流程的流向</p><h3 id="一、排他网关exclusivegateway" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、排他网关exclusivegateway">#</a> 一、排他网关ExclusiveGateway</h3><h4 id="_1、什么是排他网关" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、什么是排他网关">#</a> 1、什么是排他网关：</h4><p>排他网关，用来在流程中实现决策。 当流程执行到这个网关，所有分支都会判断条件是否为true，如果为true则执行该分支，</p><p><strong>注意</strong>：排他网关只会选择一个为true的分支执行。如果有两个分支条件都为true，排他网关会选择id值较小的一条分支去执行。</p><p>为什么要用排他网关？</p><p>不用排他网关也可以实现分支，如：在连线的condition条件上设置分支条件。</p><p>在连线设置condition条件的缺点：如果条件都不满足，流程就结束了(是异常结束)。</p><p>如果 使用排他网关决定分支的走向，如下：</p><figure><img alt="image-20220913082134602" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220913082134602-98f6d96c.png" tabindex="0"/><figcaption>image-20220913082134602</figcaption></figure><p>如果从网关出去的线所有条件都不满足则系统抛出异常。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">org.activiti.engine.ActivitiException: No outgoing sequence flow of the exclusive gateway <span class="hljs-string">&#x27;exclusivegateway1&#x27;</span> could be selected <span class="hljs-keyword">for</span> continuing the process<br>   at org.activiti.engine.impl.bpmn.behavior.ExclusiveGatewayActivityBehavior.leave(ExclusiveGatewayActivityBehavior.java:<span class="hljs-number">85</span>)<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、流程定义-2" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、流程定义-2">#</a> 2、流程定义</h4><p>排他网关图标，红框内：</p><img alt="image-20220915095835109" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220915095835109-4b5fc9ed.png" style="zoom:50%;"/><h4 id="_3、测试" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、测试">#</a> 3、测试</h4><p>在部门经理审核后，走排他网关，从排他网关出来的分支有两条，一条是判断出差天数是否大于3天，另一条是判断出差天数是否小于等于3天。</p><p>设置分支条件时，如果所有分支条件都不是true，报错：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">org.activiti.engine.ActivitiException: No outgoing sequence flow of the exclusive gateway <span class="hljs-string">&#x27;exclusivegateway1&#x27;</span> could be selected <span class="hljs-keyword">for</span> continuing the process<br>       at org.activiti.engine.impl.bpmn.behavior.ExclusiveGatewayActivityBehavior.leave(ExclusiveGatewayActivityBehavior.java:<span class="hljs-number">85</span>)<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二、并行网关parallelgateway" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、并行网关parallelgateway">#</a> 二、并行网关ParallelGateway</h3><h4 id="_1、什么是并行网关" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、什么是并行网关">#</a> 1、什么是并行网关</h4><p>并行网关允许将流程分成多条分支，也可以把多条分支汇聚到一起，并行网关的功能是基于进入和外出顺序流的：</p><p>l fork分支：</p><p>并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。</p><p>l join汇聚：</p><p>所有到达并行网关，在此等待的进入分支， 直到所有进入顺序流的分支都到达以后， 流程就会通过汇聚网关。</p><p>注意，如果同一个并行网关有多个进入和多个外出顺序流， 它就同时具有分支和汇聚功能。 这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。</p><p><strong>与其他网关的主要区别是，并行网关不会解析条件。</strong> <strong>即使顺序流中定义了条件，也会被忽略。</strong></p><p>例子：</p><figure><img alt="image-20220915100041975" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220915100041975-163e12af.png" tabindex="0"/><figcaption>image-20220915100041975</figcaption></figure><p>说明：</p><p>技术经理和项目经理是两个execution分支，在act_ru_execution表有两条记录分别是技术经理和项目经理，act_ru_execution还有一条记录表示该流程实例。</p><p>待技术经理和项目经理任务全部完成，在汇聚点汇聚，通过parallelGateway并行网关。</p><p>并行网关在业务应用中常用于会签任务，会签任务即多个参与者共同办理的任务。</p><h4 id="_2、流程定义-3" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、流程定义-3">#</a> 2、流程定义</h4><p>并行网关图标，红框内：</p><figure><img alt="image-20220914153206867" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220914153206867-0324f401.png" tabindex="0"/><figcaption>image-20220914153206867</figcaption></figure><h4 id="_3、测试-1" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、测试-1">#</a> 3、测试</h4><p>当执行到并行网关数据库跟踪如下：</p><p>当前任务表：SELECT * FROM act_ru_task</p><p>![image-20220914155246478](/Users/xiaoweiya/Desktop/笔记 2/img/image-20220914155246478.png)</p><figure><img alt="image-20220914155438995" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220914155438995-df980e20.png" tabindex="0"/><figcaption>image-20220914155438995</figcaption></figure><p>上图中：有两个任务当前执行。</p><p>查询流程实例执行表：SELECT * FROM act_ru_execution</p><figure><img alt="image-20220914155524185" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220914155524185-6ab2a2a5.png" tabindex="0"/><figcaption>image-20220914155524185</figcaption></figure><p>上图中，说明当前流程实例有多个分支(两个)在运行。</p><p>对并行任务的执行：</p><p>并行任务执行不分前后，由任务的负责人去执行即可。</p><p>执行部门经理任务后，查询当前任务表 SELECT * FROM act_ru_task</p><figure><img alt="image-20220914155613595" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220914155613595-c7ee7f63.png" tabindex="0"/><figcaption>image-20220914155613595</figcaption></figure><p>已完成的技术经理任务在当前任务表act_ru_task_已被删除。</p><p>有并行网关的汇聚结点：说明有一个分支已经到汇聚，等待其它的分支到达。</p><p>当所有分支任务都完成，都到达汇聚结点后：</p><figure><img alt="image-20220914155708054" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220914155708054-2ee65ee6.png" tabindex="0"/><figcaption>image-20220914155708054</figcaption></figure><p>总结：所有分支到达汇聚结点，并行网关执行完成。</p><h3 id="三、包含网关inclusivegateway" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、包含网关inclusivegateway">#</a> 三、包含网关InclusiveGateway</h3><h4 id="_1、什么是包含网关" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、什么是包含网关">#</a> 1、什么是包含网关</h4><p>包含网关可以看做是排他网关和并行网关的结合体。</p><p>和排他网关一样，你可以在外出顺序流上定义条件，包含网关会解析它们。 但是主要的区别是包含网关可以选择多于一条顺序流，这和并行网关一样。</p><p>包含网关的功能是基于进入和外出顺序流的：</p><p>l 分支：</p><p>所有外出顺序流的条件都会被解析，结果为true的顺序流会以并行方式继续执行， 会为每个顺序流创建一个分支。</p><p>l 汇聚：</p><p>所有并行分支到达包含网关，会进入等待状态， 直到每个包含流程token的进入顺序流的分支都到达。 这是与并行网关的最大不同。换句话说，包含网关只会等待被选中执行了的进入顺序流。 在汇聚之后，流程会穿过包含网关继续执行。</p><figure><img alt="image-20220915100459473" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220915100459473-ef6ca9a5.png" tabindex="0"/><figcaption>image-20220915100459473</figcaption></figure><h4 id="_2、流程定义-4" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、流程定义-4">#</a> 2、流程定义：</h4><p>出差申请大于等于3天需要由项目经理审批，小于3天由技术经理审批，出差申请必须经过人事经理审批。</p><p>包含网关图标，红框内：</p><img alt="image-20220915100914284" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220915100914284-d448ad2c.png" style="zoom:50%;"/><p>定义流程：</p><figure><img alt="image-20220915101105692" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220915101105692-033566de.png" tabindex="0"/><figcaption>image-20220915101105692</figcaption></figure><p>注意：通过包含网关的每个分支的连线上设置condition条件。</p><h4 id="_3、-测试" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、-测试">#</a> 3、 测试</h4><p>如果包含网关设置的条件中，流程变量不存在，报错;</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">org.activiti.engine.ActivitiException: Unknown property used in expression: $&#123;evection.num&amp;gt;=<span class="hljs-number">3</span>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>需要在流程启动时设置流程变量holidays.num。</p><p>task表：</p><p>(1)启动</p><figure><img alt="image-20220914162706418" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220914162706419-1ab2a109.png" tabindex="0"/><figcaption>image-20220914162706418</figcaption></figure><p>(2))itlils做完之后</p><figure><img alt="image-20220914162936322" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220914162936322-02a07dcd.png" tabindex="0"/><figcaption>image-20220914162936322</figcaption></figure><p>(3))zhuzhu 和 itwangls 完成</p><figure><img alt="image-20220914163024464" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220914163024464-515f84f1.png" tabindex="0"/><figcaption>image-20220914163024464</figcaption></figure><p>(4)改cto审核</p><figure><img alt="image-20220914163101190" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220914163101190-1b7d7ada.png" tabindex="0"/><figcaption>image-20220914163101190</figcaption></figure><h3 id="四、事件网关eventgateway" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、事件网关eventgateway">#</a> 四、事件网关EventGateway</h3><p>事件网关允许根据事件判断流向。网关的每个外出顺序流都要连接到一个中间捕获事件。 当流程到达一个基于事件网关，网关会进入等待状态：会暂停执行。与此同时，会为每个外出顺序流创建相对的事件订阅。</p><p>事件网关的外出顺序流和普通顺序流不同，这些顺序流不会真的"执行"， 相反它们让流程引擎去决定执行到事件网关的流程需要订阅哪些事件。 要考虑以下条件：</p><ol><li>事件网关必须有两条或以上外出顺序流；</li><li>事件网关后，只能使用intermediateCatchEvent类型（activiti不支持基于事件网关后连接ReceiveTask）</li><li>连接到事件网关的中间捕获事件必须只有一个入口顺序流。</li></ol><p>内部课程~~~~</p><h2 id="第十二章-activiti与spring整合开发" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第十二章-activiti与spring整合开发">#</a> 第十二章 Activiti与Spring整合开发</h2><h3 id="一、-activiti与spring整合的配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、-activiti与spring整合的配置">#</a> 一、 Activiti与Spring整合的配置</h3><h4 id="_1、在pom-xml文件引入坐标" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、在pom-xml文件引入坐标">#</a> 1、在pom.xml文件引入坐标</h4><p>如下</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>properties<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>slf4j.version<span class="hljs-symbol">&amp;gt;</span>1.6.6<span class="hljs-symbol">&amp;lt;</span>/slf4j.version<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>log4j.version<span class="hljs-symbol">&amp;gt;</span>1.2.12<span class="hljs-symbol">&amp;lt;</span>/log4j.version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/properties<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-engine<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>7.0.0.Beta1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-spring<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>7.0.0.Beta1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-bpmn-model<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>7.0.0.Beta1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-bpmn-converter<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>7.0.0.Beta1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-json-converter<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>7.0.0.Beta1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-bpmn-layout<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>7.0.0.Beta1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-cloud-services-api<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>7.0.0.Beta1<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>aspectj<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>aspectjweaver<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.5.4<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>mysql<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>mysql-connector-java<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>5.1.40<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>junit<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>junit<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>4.12<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-test<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>5.0.7.RELEASE<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- log start --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>log4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>log4j<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;log4j.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-api<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;slf4j.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-log4j12<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;slf4j.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.slf4j<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>slf4j-nop<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;slf4j.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- log end --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.mybatis<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>mybatis<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>3.4.5<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>commons-dbcp<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>commons-dbcp<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.4<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>repositories<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>repository<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>id<span class="hljs-symbol">&amp;gt;</span>alfresco<span class="hljs-symbol">&amp;lt;</span>/id<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>name<span class="hljs-symbol">&amp;gt;</span>Activiti Releases<span class="hljs-symbol">&amp;lt;</span>/name<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>url<span class="hljs-symbol">&amp;gt;</span>https://artifacts.alfresco.com/nexus/content/repositories/activiti-releases/<span class="hljs-symbol">&amp;lt;</span>/url<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>releases<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>enabled<span class="hljs-symbol">&amp;gt;</span>true<span class="hljs-symbol">&amp;lt;</span>/enabled<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/releases<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/repository<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/repositories<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在Activiti中核心类的是ProcessEngine流程引擎，与Spring整合就是让Spring来管理ProcessEngine</p><p>通过org.activiti.spring.SpringProcessEngineConfiguration 与Spring整合方式来创建ProcessEngine对象。</p><p>创建spring与activiti的整合配置文件：activiti-spring.xml（名称不固定）</p><h4 id="_2、创建activiti-spring-xml" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、创建activiti-spring-xml">#</a> 2、创建activiti-spring.xml</h4><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>       xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;<br>       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;<br>       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br>        http://www.springframework.org/schema/beans/spring-beans.xsd<br>        http://www.springframework.org/schema/tx<br>        http://www.springframework.org/schema/tx/spring-tx.xsd<br>        http://www.springframework.org/schema/aop<br>        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 数据源 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/activiti&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;username&quot; value=&quot;root&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;password&quot; value=&quot;123456&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;maxActive&quot; value=&quot;3&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;maxIdle&quot; value=&quot;1&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 工作流引擎配置bean --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;processEngineConfiguration&quot; class=&quot;org.activiti.spring.SpringProcessEngineConfiguration&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- 数据源 --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- 使用spring事务管理器 --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;transactionManager&quot; ref=&quot;transactionManager&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!-- 数据库策略 --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;databaseSchemaUpdate&quot; value=&quot;drop-create&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 流程引擎 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;processEngine&quot; class=&quot;org.activiti.spring.ProcessEngineFactoryBean&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;processEngineConfiguration&quot; ref=&quot;processEngineConfiguration&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 资源服务service --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;repositoryService&quot; factory-bean=&quot;processEngine&quot; factory-method=&quot;getRepositoryService&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 流程运行service --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;runtimeService&quot; factory-bean=&quot;processEngine&quot;  factory-method=&quot;getRuntimeService&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 任务管理service --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;taskService&quot; factory-bean=&quot;processEngine&quot; factory-method=&quot;getTaskService&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 历史管理service --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;historyService&quot; factory-bean=&quot;processEngine&quot; factory-method=&quot;getHistoryService&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 事务管理器 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/bean<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 通知 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>tx:attributes<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>!-- 传播行为 --<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;save*&quot; propagation=&quot;REQUIRED&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;insert*&quot; propagation=&quot;REQUIRED&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;delete*&quot; propagation=&quot;REQUIRED&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;update*&quot; propagation=&quot;REQUIRED&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;find*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot;/<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>tx:method name=&quot;get*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot;/<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/tx:attributes<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/tx:advice<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>!-- 切面，根据具体项目修改切点配置<br>    <span class="hljs-symbol">&amp;lt;</span>aop:config proxy-target-class=&quot;true&quot;<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>aop:advisor advice-ref=&quot;txAdvice&quot;<br>                     pointcut=&quot;execution(*com.ydlclass.service.impl..(..))&quot;/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/aop:config<span class="hljs-symbol">&amp;gt;</span>--<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/beans<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>databaseSchemaUpdate的取值内容：</p><p>flase： 默认值。activiti在启动时，会对比数据库表中保存的版本，如果没有表或者版本不匹配，将抛出异常。（生产环境常用） true： activiti会对数据库中所有表进行更新操作。如果表不存在，则自动创建。（开发时常用） create_drop： 在activiti启动时创建表，在关闭时删除表（必须手动关闭引擎，才能删除表）。（单元测试常用） drop-create： 在activiti启动时删除原来的旧表，然后在创建新表（不需要手动关闭引擎）。</p><h3 id="二、测试activiti与spring整合" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、测试activiti与spring整合">#</a> 二、测试Activiti与Spring整合</h3><h4 id="_1、测试代码" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、测试代码">#</a> 1、测试代码</h4><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">   测试activiti与spring整合是否成功</span><br><span class="hljs-comment">**/</span><br><span class="hljs-meta">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="hljs-meta">@ContextConfiguration(locations = &quot;classpath:activiti-spring.xml&quot;)</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ActivitiTest</span> &#123;<br>     <span class="hljs-meta">@Autowired</span><br>     <span class="hljs-keyword">private</span> RepositoryService repositoryService;<br><br>     <span class="hljs-meta">@Test</span><br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test01</span><span class="hljs-params">()</span>&#123;<br>         System.out.println(<span class="hljs-string">&quot;部署对象:&quot;</span>+repositoryService);<br>     &#125;<br> &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、执行流程分析" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、执行流程分析">#</a> 2、执行流程分析</h4><p>下面我们一起来分析Activiti与Spring整合加载的过程。</p><p>1、加载activiti-spring.xml配置文件</p><p>2、加载SpringProcessEngineConfiguration对象，这个对象它需要依赖注入dataSource对象和transactionManager对象。</p><p>3、加载ProcessEngineFactoryBean工厂来创建ProcessEngine对象，而ProcessEngineFactoryBean工厂又需要依赖注入processEngineConfiguration对象。</p><p>4、processEngine对象来负责创建我们的Service对象，从而简化Activiti的开发过程。</p><h2 id="第十三章-activiti7与springboot整合开发" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第十三章-activiti7与springboot整合开发">#</a> 第十三章 Activiti7与SpringBoot整合开发</h2><p>Activiti7发布正式版之后，它与SpringBoot2.x已经完全支持整合开发。</p><h3 id="一、springboot整合activiti7的配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、springboot整合activiti7的配置">#</a> 一、SpringBoot整合Activiti7的配置</h3><p>为了能够实现SpringBoot与Activiti7整合开发，首先我们要引入相关的依赖支持。</p><p>在工程的pom.xml文件中引入相关的依赖，其中activiti的依赖是：activiti-spring-boot-starter。</p><p>具体依赖如下所示：</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>parent<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-parent<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>2.1.0.RELEASE<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/parent<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>properties<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>project.build.sourceEncoding<span class="hljs-symbol">&amp;gt;</span>UTF-8<span class="hljs-symbol">&amp;lt;</span>/project.build.sourceEncoding<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>project.reporting.outputEncoding<span class="hljs-symbol">&amp;gt;</span>UTF-8<span class="hljs-symbol">&amp;lt;</span>/project.reporting.outputEncoding<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>java.version<span class="hljs-symbol">&amp;gt;</span>1.8<span class="hljs-symbol">&amp;lt;</span>/java.version<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/properties<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-web<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-jdbc<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-test<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.activiti<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>activiti-spring-boot-starter<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>7.0.0.Beta2<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>mysql<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>mysql-connector-java<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>5.1.29<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.projectlombok<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>lombok<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>build<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>plugins<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>plugin<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-maven-plugin<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/plugin<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/plugins<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/build<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过该pom.xml文件所导入的坐标，我们就可以实现activiti7与Springboot整合。</p><h3 id="二、-springboot的application-yml文件配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、-springboot的application-yml文件配置">#</a> 二、 SpringBoot的application.yml文件配置</h3><p>为了能够实现Activiti7生成的表放到Mysql数据库中，需要在配置文件application.yml中添加相关的配置</p><p>注意：activiti7默认没有开启数据库历史记录，需要手动配置开启</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql:///activiti?useUnicode=true&amp;amp;characterEncoding=utf8&amp;amp;serverTimezone=GMT</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br>  <span class="hljs-attr">activiti:</span><br>    <span class="hljs-comment">#1.flase：默认值。activiti在启动时，对比数据库表中保存的版本，如果没有表或者版本不匹配，将抛出异常</span><br>    <span class="hljs-comment">#2.true： activiti会对数据库中所有表进行更新操作。如果表不存在，则自动创建</span><br>    <span class="hljs-comment">#3.create_drop： 在activiti启动时创建表，在关闭时删除表（必须手动关闭引擎，才能删除表）</span><br>    <span class="hljs-comment">#4.drop-create： 在activiti启动时删除原来的旧表，然后在创建新表（不需要手动关闭引擎）</span><br>    <span class="hljs-attr">database-schema-update:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment">#检测历史表是否存在 activiti7默认没有开启数据库历史记录 启动数据库历史记录</span><br>    <span class="hljs-attr">db-history-used:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment">#记录历史等级 可配置的历史级别有none, activity, audit, full</span><br>    <span class="hljs-comment">#none：不保存任何的历史数据，因此，在流程执行过程中，这是最高效的。</span><br>    <span class="hljs-comment">#activity：级别高于none，保存流程实例与流程行为，其他数据不保存。</span><br>    <span class="hljs-comment">#audit：除activity级别会保存的数据外，还会保存全部的流程任务及其属性。audit为history的默认值。</span><br>    <span class="hljs-comment">#full：保存历史数据的最高级别，除了会保存audit级别的数据外，还会保存其他全部流程相关的细节数据，包括一些流程参数等。</span><br>    <span class="hljs-attr">history-level:</span> <span class="hljs-string">full</span><br>    <span class="hljs-comment">#校验流程文件，默认校验resources下的processes文件夹里的流程文件</span><br>    <span class="hljs-attr">check-process-definitions:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="三、编写启动类" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、编写启动类">#</a> 三、编写启动类</h3><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ActApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(ActApplication.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="四、添加springsecurity安全框架整合配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、添加springsecurity安全框架整合配置">#</a> 四、添加SpringSecurity安全框架整合配置</h3><p>因为Activiti7与SpringBoot整合后，默认情况下，集成了SpringSecurity安全框架，这样我们就要去准备SpringSecurity整合进来的相关用户权限配置信息。</p><p>SpringBoot的依赖包已经将SpringSecurity的依赖包也添加进项目中。</p><h4 id="_1、添加securityutil类" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、添加securityutil类">#</a> 1、添加SecurityUtil类</h4><p>为了能够快速实现SpringSecurity安全框架的配置，所添加的一个组件。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.utils;<br><br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;<br><span class="hljs-keyword">import</span> org.springframework.security.core.Authentication;<br><span class="hljs-keyword">import</span> org.springframework.security.core.GrantedAuthority;<br><span class="hljs-keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;<br><span class="hljs-keyword">import</span> org.springframework.security.core.context.SecurityContextImpl;<br><span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetails;<br><span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.util.Collection;<br><br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityUtil</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(SecurityUtil.class);<br><br>     <span class="hljs-meta">@Autowired</span><br>     <span class="hljs-meta">@Qualifier(&quot;myUserDetailsService&quot;)</span><br>     <span class="hljs-keyword">private</span> UserDetailsService userDetailsService;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logInAs</span><span class="hljs-params">(String username)</span> &#123;<br>     <span class="hljs-type">UserDetails</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userDetailsService.loadUserByUsername(username);<br><br>     <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;User &quot;</span> + username + <span class="hljs-string">&quot; doesn&#x27;t exist, please provide a valid user&quot;</span>);<br>     &#125;<br>     logger.info(<span class="hljs-string">&quot;&amp;gt; Logged in as: &quot;</span> + username);<br><br>     SecurityContextHolder.setContext(<br>             <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityContextImpl</span>(<br>                     <span class="hljs-keyword">new</span> <span class="hljs-title class_">Authentication</span>() &#123;<br>                         <span class="hljs-meta">@Override</span><br>                         <span class="hljs-keyword">public</span> Collection&amp;lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">GrantedAuthority</span>&amp;gt; getAuthorities() &#123;<br>                             <span class="hljs-keyword">return</span> user.getAuthorities();<br>                         &#125;<br>                         <span class="hljs-meta">@Override</span><br>                         <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getCredentials</span><span class="hljs-params">()</span> &#123;<br>                             <span class="hljs-keyword">return</span> user.getPassword();<br>                         &#125;<br>                         <span class="hljs-meta">@Override</span><br>                         <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getDetails</span><span class="hljs-params">()</span> &#123;<br>                             <span class="hljs-keyword">return</span> user;<br>                         &#125;<br>                         <span class="hljs-meta">@Override</span><br>                         <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getPrincipal</span><span class="hljs-params">()</span> &#123;<br>                             <span class="hljs-keyword">return</span> user;<br>                         &#125;<br>                         <span class="hljs-meta">@Override</span><br>                         <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAuthenticated</span><span class="hljs-params">()</span> &#123;<br>                             <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                         &#125;<br>                         <span class="hljs-meta">@Override</span><br>                         <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAuthenticated</span><span class="hljs-params">(<span class="hljs-type">boolean</span> isAuthenticated)</span> <span class="hljs-keyword">throws</span> IllegalArgumentException &#123; &#125;<br>                         <span class="hljs-meta">@Override</span><br>                         <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>                             <span class="hljs-keyword">return</span> user.getUsername();<br>                         &#125;<br>     &#125;));<br>     org.activiti.engine.impl.identity.Authentication.setAuthenticatedUserId(username);<br> &#125;<br>  &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个类可以从我们下载的Activiti7官方提供的Example中找到。</p><h4 id="_2、-添加demoapplicationconfig类" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-添加demoapplicationconfig类">#</a> 2、 添加DemoApplicationConfig类</h4><p>在Activiti7官方下载的Example中找到DemoApplicationConfig类，它的作用是为了实现SpringSecurity框架的用户权限的配置，这样我们就可以在系统中使用用户权限信息。</p><p>本次项目中基本是在文件中定义出来的用户信息，当然也可以是数据库中查询的用户权限信息。</p><p>后面处理流程时用到的任务负责人，需要添加在这里</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.config;<br><br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;<br><span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.User;<br><span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;<br><span class="hljs-keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;<br><span class="hljs-keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;<br><span class="hljs-keyword">import</span> org.springframework.security.provisioning.InMemoryUserDetailsManager;<br><br><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.stream.Collectors;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoApplicationConfiguration</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(DemoApplicationConfiguration.class);<br>     <span class="hljs-meta">@Bean</span><br>     <span class="hljs-keyword">public</span> UserDetailsService <span class="hljs-title function_">myUserDetailsService</span><span class="hljs-params">()</span> &#123;<br>         <span class="hljs-type">InMemoryUserDetailsManager</span> <span class="hljs-variable">inMemoryUserDetailsManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryUserDetailsManager</span>();<br>         <span class="hljs-comment">//这里添加用户，后面处理流程时用到的任务负责人，需要添加在这里</span><br>         String[][] usersGroupsAndRoles = &#123;<br>                 &#123;<span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;ROLE_ACTIVITI_USER&quot;</span>, <span class="hljs-string">&quot;GROUP_activitiTeam&quot;</span>&#125;,<br>                 &#123;<span class="hljs-string">&quot;rose&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;ROLE_ACTIVITI_USER&quot;</span>, <span class="hljs-string">&quot;GROUP_activitiTeam&quot;</span>&#125;,<br>                 &#123;<span class="hljs-string">&quot;tom&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;ROLE_ACTIVITI_USER&quot;</span>, <span class="hljs-string">&quot;GROUP_activitiTeam&quot;</span>&#125;,<br>                 &#123;<span class="hljs-string">&quot;other&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;ROLE_ACTIVITI_USER&quot;</span>, <span class="hljs-string">&quot;GROUP_otherTeam&quot;</span>&#125;,<br>                 &#123;<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;ROLE_ACTIVITI_USER&quot;</span>&#125;,<br>                 &#123;<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;ROLE_ACTIVITI_ADMIN&quot;</span>&#125;,<br>         &#125;;<br><br>         <span class="hljs-keyword">for</span> (String[] user : usersGroupsAndRoles) &#123;<br>             List&amp;lt;String&amp;gt; authoritiesStrings = Arrays.asList(Arrays.copyOfRange(user, <span class="hljs-number">2</span>, user.length));<br>             logger.info(<span class="hljs-string">&quot;&amp;gt; Registering new user: &quot;</span> + user[<span class="hljs-number">0</span>] + <span class="hljs-string">&quot; with the following Authorities[&quot;</span> + authoritiesStrings + <span class="hljs-string">&quot;]&quot;</span>);<br>             inMemoryUserDetailsManager.createUser(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(user[<span class="hljs-number">0</span>], passwordEncoder().encode(user[<span class="hljs-number">1</span>]),<br>                     authoritiesStrings.stream().map(s -&amp;gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleGrantedAuthority</span>(s)).collect(Collectors.toList())));<br>         &#125;<br><br>         <span class="hljs-keyword">return</span> inMemoryUserDetailsManager;<br>     &#125;<br>     <span class="hljs-meta">@Bean</span><br>     <span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title function_">passwordEncoder</span><span class="hljs-params">()</span> &#123;<br>         <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();<br>     &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="五、-创建bpmn文件" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#五、-创建bpmn文件">#</a> 五、 创建Bpmn文件</h3><p>Activiti7可以自动部署流程，前提是在resources目录下，创建一个新的目录processes，用来放置bpmn文件。</p><p>创建一个简单的Bpmn流程文件，并设置任务的用户组Candidate Groups。</p><p>Candidate Groups中的内容与上面DemoApplicationConfiguration类中出现的用户组名称要保持一致，可以填写：activitiTeam 或者 otherTeam。</p><p>这样填写的好处：当不确定到底由谁来负责当前任务的时候，只要是Groups内的用户都可以拾取这个任务</p><figure><img alt="image-20220915020433201" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220915020433201-cdf9047e.png" tabindex="0"/><figcaption>image-20220915020433201</figcaption></figure><h3 id="六、使用junit方式测试" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#六、使用junit方式测试">#</a> 六、使用Junit方式测试</h3><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass;<br><br><br><span class="hljs-keyword">import</span> com.ydlclass.config.SecurityUtil;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.activiti.api.process.model.ProcessDefinition;<br><span class="hljs-keyword">import</span> org.activiti.api.process.model.ProcessInstance;<br><span class="hljs-keyword">import</span> org.activiti.api.process.model.builders.ProcessPayloadBuilder;<br><span class="hljs-keyword">import</span> org.activiti.api.process.runtime.ProcessRuntime;<br><span class="hljs-keyword">import</span> org.activiti.api.runtime.shared.query.Page;<br><span class="hljs-keyword">import</span> org.activiti.api.runtime.shared.query.Pageable;<br><span class="hljs-keyword">import</span> org.activiti.api.task.model.Task;<br><span class="hljs-keyword">import</span> org.activiti.api.task.model.builders.ClaimTaskPayloadBuilder;<br><span class="hljs-keyword">import</span> org.activiti.api.task.model.builders.TaskPayloadBuilder;<br><span class="hljs-keyword">import</span> org.activiti.api.task.runtime.TaskRuntime;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> org.junit.runner.RunWith;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><span class="hljs-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RunWith(SpringRunner.class)</span><br><span class="hljs-meta">@SpringBootTest(classes = ActApplication.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestAct</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    ProcessRuntime processRuntime;<br><br>    <span class="hljs-meta">@Autowired</span><br>    SecurityUtil securityUtil;<br><br>    <span class="hljs-comment">//查看流程定义，体验自动部署：check-process-definitions: true</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProcessDef</span><span class="hljs-params">()</span> &#123;<br>        securityUtil.logInAs(<span class="hljs-string">&quot;admin&quot;</span>);<br><br>        Page&amp;lt;ProcessDefinition&amp;gt; processDefinitionPage = processRuntime.processDefinitions(Pageable.of(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>));<br>        log.info(<span class="hljs-string">&quot;num:&quot;</span> + processDefinitionPage.getTotalItems());<br><br>        List&amp;lt;ProcessDefinition&amp;gt; content = processDefinitionPage.getContent();<br>        <span class="hljs-keyword">for</span> (ProcessDefinition processDefinition : content) &#123;<br>            log.info(<span class="hljs-string">&quot;================&quot;</span>);<br>            log.info(<span class="hljs-string">&quot;DefinitionPag:&quot;</span> + processDefinition);<br>            log.info(<span class="hljs-string">&quot;================&quot;</span>);<br>        &#125;<br><br>    &#125;<br><br><br>    <span class="hljs-comment">//启动流程</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testStartProcess</span><span class="hljs-params">()</span> &#123;<br>        securityUtil.logInAs(<span class="hljs-string">&quot;itlils&quot;</span>);<br>        <span class="hljs-type">ProcessInstance</span> <span class="hljs-variable">holiday1</span> <span class="hljs-operator">=</span> processRuntime.start(<br>                ProcessPayloadBuilder<br>                        .start()<br>                        .withProcessDefinitionKey(<span class="hljs-string">&quot;holiday1&quot;</span>)<br>                        .build());<br>        log.info(holiday1.getId());<br>        log.info(holiday1.toString());<br>    &#125;<br><br>    <span class="hljs-meta">@Autowired</span><br>    TaskRuntime taskRuntime;<br><br>    <span class="hljs-comment">//拾取任务，完成任务</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testClaimAndCompleteTask</span><span class="hljs-params">()</span> &#123;<br>        securityUtil.logInAs(<span class="hljs-string">&quot;itnanls&quot;</span>);<br><br>        Page&amp;lt;Task&amp;gt; taskPage = taskRuntime.tasks(Pageable.of(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>));<br><br>        <span class="hljs-keyword">if</span> (taskPage.getTotalItems() &amp;gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">for</span> (Task task : taskPage.getContent()) &#123;<br>                <span class="hljs-comment">//拾取</span><br>                taskRuntime.claim(TaskPayloadBuilder.claim().withTaskId(task.getId()).build());<br>                log.info(<span class="hljs-string">&quot;itnanls claim task:&quot;</span>+task.getId());<br><br>                <span class="hljs-comment">//完成</span><br>                taskRuntime.complete(TaskPayloadBuilder.complete().withTaskId(task.getId()).build());<br>            &#125;<br>        &#125;<br><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第十四章-小demo" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第十四章-小demo">#</a> 第十四章 小demo</h2><p>代码在资源下载区，只需导入4个sql即可。</p><figure><img alt="image-20220915041911515" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220915041911515-6dbebef5.png" tabindex="0"/><figcaption>image-20220915041911515</figcaption></figure><p>项目结构</p><figure><img alt="image-20220915041931349" loading="lazy" src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E9%A1%B9%E7%9B%AE%E9%98%B6%E6%AE%B5/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/image-20220915041931349-01d6d934.png" tabindex="0"/><figcaption>image-20220915041931349</figcaption></figure></div></article>
<div class="article-footer">

</div>

<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"></div><div class="item" id="next"><div class="note">接下来阅读</div><a href="/wiki/YDLDoc4/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/">自动化构建</a></div></section></div>


  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>快来参与讨论吧~</p>

    </section>
    <section class='body cmt-body waline'>
      

<div id="waline_container" class="waline_thread"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>

    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p style="text-align:center" >
本站由 <a style="font-weight: bold;" href="/author/ThatCoder/">钟意</a> 使用 <a style="font-weight: bold;" target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.33.1">Stellar 1.33.1</a> 主题创建。
<br>
由 <a style="font-weight: bold;" target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral">又拍云</a> 提供CDN加速/云存储服务
<br>
由 <a style="font-weight: bold;" target="_blank" rel="noopener" href="https://vercel.com/">vercel</a>、<a style="font-weight: bold;" target="_blank" rel="noopener" href="https://www.netlify.com/">netlify</a>、<a style="font-weight: bold;" target="_blank" rel="noopener" href="https://www.cloudflare.com/">cloudflare</a> 提供托管服务
<br>
<a href="https://beian.miit.gov.cn/" target="_blank">湘ICP备2023019799号-1</a>
<br>
<!--不蒜子计数器-->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!--添加一个访问量-->
<span>总访问 <span id="busuanzi_value_site_pv" style="font-weight: bold;"></span> 次 
<!--本页访问 <span id="busuanzi_value_page_pv" style="font-weight: bold;"></span> 次</span>-->
<div id="siteruntime"></div>
</p>
<script>
function siteTime(){
    window.setTimeout("siteTime()", 1000);
    var seconds = 1000
    var minutes = seconds * 60
    var hours = minutes * 60
    var days = hours * 24
    var years = days * 365
    var today = new Date()
    var todayYear = today.getFullYear()
    var todayMonth = today.getMonth()
    var todayDate = today.getDate()
    var todayHour = today.getHours()
    var todayMinute = today.getMinutes()
    var todaySecond = today.getSeconds()
    var t1 = Date.UTC(2020,4,30,08,00,00)
    var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond)
    var diff = t2-t1
    var diffYears = Math.floor(diff/years)
    var diffDays = Math.floor((diff/days)-diffYears*365)
    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours)
    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes)
    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds)
    document.getElementById("siteruntime").innerHTML="<p style=\"text-align:center\">小破站已颠沛流离 "+diffYears+" 年 "+diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒</p>"
}
siteTime();
</script>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="auto"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%81%9A%E8%AF%BE%E7%9B%AE%E7%9A%84"><span class="toc-text"> 做课目的</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%80%82%E7%94%A8%E4%BA%BA%E7%BE%A4-%E6%99%AE%E9%80%9A%E4%BA%BA"><span class="toc-text"> 一、适用人群： 普通人</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%80%82%E7%94%A8%E9%A1%B9%E7%9B%AE-oa-crm-erp-%E7%B3%BB%E7%BB%9F"><span class="toc-text"> 二、适用项目：OA CRM ERP 系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%AF%BE%E7%A8%8B%E7%89%B9%E7%82%B9-%E8%AF%B4%E4%BA%BA%E8%AF%9D"><span class="toc-text"> 三、课程特点：说人话</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%B5%84%E6%96%99%E9%A2%86%E5%8F%96"><span class="toc-text"> 四、资料领取</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD"><span class="toc-text"> 第一章 工作流相关术语</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%BB%8B%E7%BB%8D"><span class="toc-text"> 一、工作流介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%B3%BB%E7%BB%9F"><span class="toc-text"> 二、工作流系统</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81-%E9%80%82%E7%94%A8%E8%A1%8C%E4%B8%9A"><span class="toc-text"> 1、 适用行业</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-%E5%85%B7%E4%BD%93%E5%BA%94%E7%94%A8"><span class="toc-text"> 2、 具体应用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"><span class="toc-text"> 三、工作流实现方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-text"> 四、工作流实现原理分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-activiti7-%E6%A6%82%E8%BF%B0"><span class="toc-text"> 第二章 Activiti7 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81activiti-%E4%BB%8B%E7%BB%8D"><span class="toc-text"> 一、Activiti 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81bpm"><span class="toc-text"> **1、BPM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-bpm-%E8%BD%AF%E4%BB%B6"><span class="toc-text"> 2、 BPM 软件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81-bpmn"><span class="toc-text"> 3、 BPMN</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81activit-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="toc-text"> 二、Activit 如何使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E9%83%A8%E7%BD%B2-activiti"><span class="toc-text"> 1、部署 activiti</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89"><span class="toc-text"> 2、流程定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89%E9%83%A8%E7%BD%B2"><span class="toc-text"> 3、流程定义部署</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AA%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B-processinstance"><span class="toc-text"> 4、启动一个流程实例（ProcessInstance）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_5%E3%80%81%E7%94%A8%E6%88%B7%E6%9F%A5%E8%AF%A2%E5%BE%85%E5%8A%9E%E4%BB%BB%E5%8A%A1-task"><span class="toc-text"> 5、用户查询待办任务(Task)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_6%E3%80%81%E7%94%A8%E6%88%B7%E5%8A%9E%E7%90%86%E4%BB%BB%E5%8A%A1"><span class="toc-text"> 6、用户办理任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_7%E3%80%81%E6%B5%81%E7%A8%8B%E7%BB%93%E6%9D%9F"><span class="toc-text"> 7、流程结束</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83"><span class="toc-text"> 第三章 搭建环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83"><span class="toc-text"> 一、项目环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-text"> 二、开发环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81-java-%E7%8E%AF%E5%A2%83"><span class="toc-text"> 1、 Java 环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text"> 2、 数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81-web-%E5%AE%B9%E5%99%A8"><span class="toc-text"> 3、 Web 容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81-%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7"><span class="toc-text"> 4、 开发工具</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81activiti-%E7%8E%AF%E5%A2%83"><span class="toc-text"> 三、Activiti 环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E4%B8%8B%E8%BD%BD-activiti7"><span class="toc-text"> 1、下载 activiti7</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_1-database"><span class="toc-text"> （1）Database：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8-%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85"><span class="toc-text"> 2、 流程设计器 插件安装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_1-%E7%AE%80%E4%BB%8B"><span class="toc-text"> （1）简介</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_2-%E5%AE%89%E8%A3%85-%E8%AE%BE%E7%BD%AE-%E6%8F%92%E4%BB%B6-%E6%90%9C%E7%B4%A2-bpmn"><span class="toc-text"> （2）安装（设置-插件-搜索 bpmn）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81-activiti-%E6%94%AF%E6%8C%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text"> 3、 Activiti 支持的数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E5%88%9B%E5%BB%BAmysql%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text"> 4、创建mysql数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_5%E3%80%81%E5%88%9B%E5%BB%BA%E8%A1%A8%E6%96%B9%E5%BC%8F"><span class="toc-text"> 5、创建表方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_1-%E5%88%9B%E5%BB%BA-java-%E5%B7%A5%E7%A8%8B"><span class="toc-text"> （1）创建 java 工程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_2-%E5%8A%A0%E5%85%A5-maven-%E4%BE%9D%E8%B5%96%E7%9A%84%E5%9D%90%E6%A0%87-jar-%E5%8C%85"><span class="toc-text"> （2）加入 maven **依赖的坐标（**jar 包）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_3-log4j-properties"><span class="toc-text"> （3） log4j.properties</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_4-activiti-cfg-xml"><span class="toc-text"> （4）activiti.cfg.xml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_5-%E7%BC%96%E5%86%99%E7%A8%8B%E5%BA%8F"><span class="toc-text"> （5）编写程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_6-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%9A%84%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-text"> （6）数据库表的命名规则</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a%E3%80%81%E8%A1%A8%E5%89%8D%E7%BC%80%E8%AF%B4%E6%98%8E"><span class="toc-text"> a、表前缀说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#b%E3%80%81activiti-%E6%95%B0%E6%8D%AE%E8%A1%A8%E6%B8%85%E5%8D%95"><span class="toc-text"> b、Activiti 数据表清单:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-activiti%E6%9E%B6%E6%9E%84"><span class="toc-text"> 第四章 Activiti架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81activiti-cfg-xml"><span class="toc-text"> 一、activiti.cfg.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81processengineconfiguration"><span class="toc-text"> 二、ProcessEngineConfiguration：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81-standaloneprocessengineconfiguration"><span class="toc-text"> 1、 StandaloneProcessEngineConfiguration</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81springprocessengineconfiguration"><span class="toc-text"> 2、SpringProcessEngineConfiguration</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E5%88%9B%E5%BB%BA-processengineconfiguration"><span class="toc-text"> 3、创建 processEngineConfiguration</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81processengine"><span class="toc-text"> 三、ProcessEngine</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E4%B8%80%E8%88%AC%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="toc-text"> 1、一般创建方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E7%AE%80%E5%8D%95%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="toc-text"> 2、简单创建方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81servcie%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="toc-text"> 四、Servcie服务接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81-service%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="toc-text"> 1、 Service创建方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-service%E6%80%BB%E8%A7%88"><span class="toc-text"> 2、 Service总览</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#runtimeservice"><span class="toc-text"> RuntimeService</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#taskservice"><span class="toc-text"> TaskService</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#historyservice"><span class="toc-text"> HistoryService</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#managementservice"><span class="toc-text"> ManagementService</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-activiti%E5%85%A5%E9%97%A8"><span class="toc-text"> 第五章 Activiti入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%B5%81%E7%A8%8B%E7%AC%A6%E5%8F%B7"><span class="toc-text"> 一、流程符号</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E4%BA%8B%E4%BB%B6-event"><span class="toc-text"> 1、事件 Event</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E6%B4%BB%E5%8A%A8-activity"><span class="toc-text"> 2、活动 Activity</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E7%BD%91%E5%85%B3-gateway"><span class="toc-text"> 3、网关 GateWay</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_1-%E6%8E%92%E4%BB%96%E7%BD%91%E5%85%B3-x"><span class="toc-text"> （1）排他网关 (x)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_2-%E5%B9%B6%E8%A1%8C%E7%BD%91%E5%85%B3"><span class="toc-text"> （2）并行网关 (+)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_3-%E5%8C%85%E5%AE%B9%E7%BD%91%E5%85%B3"><span class="toc-text"> （3）包容网关 (+)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_4-%E4%BA%8B%E4%BB%B6%E7%BD%91%E5%85%B3"><span class="toc-text"> （4）事件网关 (+)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E6%B5%81%E5%90%91-flow"><span class="toc-text"> 4、流向 Flow</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8%E4%BD%BF%E7%94%A8"><span class="toc-text"> 二、 流程设计器使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81activiti-bpmn-visualizer-%E4%BD%BF%E7%94%A8"><span class="toc-text"> 1、activiti BPMN visualizer 使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#palette-%E7%94%BB%E6%9D%BF"><span class="toc-text"> Palette（画板）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_1-%E6%96%B0%E5%BB%BA%E6%B5%81%E7%A8%8B-idea%E5%B7%A5%E5%85%B7"><span class="toc-text"> （1）新建流程(IDEA工具)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_2-%E7%BB%98%E5%88%B6%E6%B5%81%E7%A8%8B"><span class="toc-text"> （2）绘制流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_3-%E6%8C%87%E5%AE%9A%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89key"><span class="toc-text"> （3）指定流程定义Key</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_4-%E6%8C%87%E5%AE%9A%E4%BB%BB%E5%8A%A1%E8%B4%9F%E8%B4%A3%E4%BA%BA"><span class="toc-text"> （4）指定任务负责人</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-%E6%B5%81%E7%A8%8B%E6%93%8D%E4%BD%9C"><span class="toc-text"> 第六章 流程操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89"><span class="toc-text"> 一、流程定义</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E6%A6%82%E8%BF%B0"><span class="toc-text"> 1、概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-bpmn%E6%96%87%E4%BB%B6"><span class="toc-text"> 2、.bpmn文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E7%94%9F%E6%88%90-png%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6"><span class="toc-text"> 3、生成.png图片文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89%E9%83%A8%E7%BD%B2"><span class="toc-text"> 二、流程定义部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E6%A6%82%E8%BF%B0-1"><span class="toc-text"> 1、概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E5%8D%95%E4%B8%AA%E6%96%87%E4%BB%B6%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F"><span class="toc-text"> 2、单个文件部署方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E5%8E%8B%E7%BC%A9%E5%8C%85%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F"><span class="toc-text"> 3、压缩包部署方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="toc-text"> 4、操作数据表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B"><span class="toc-text"> 三、启动流程实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">#</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%BB%BB%E5%8A%A1%E6%9F%A5%E8%AF%A2"><span class="toc-text"> 四、任务查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%B5%81%E7%A8%8B%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-text"> 五、流程任务处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2"><span class="toc-text"> 六、流程定义信息查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%B5%81%E7%A8%8B%E5%88%A0%E9%99%A4"><span class="toc-text"> 七、流程删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%B5%81%E7%A8%8B%E8%B5%84%E6%BA%90%E4%B8%8B%E8%BD%BD"><span class="toc-text"> 八、流程资源下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E6%B5%81%E7%A8%8B%E5%8E%86%E5%8F%B2%E4%BF%A1%E6%81%AF%E7%9A%84%E6%9F%A5%E7%9C%8B"><span class="toc-text"> 九、流程历史信息的查看</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B"><span class="toc-text"> 第七章 流程实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B"><span class="toc-text"> 一、什么是流程实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B-%E5%B9%B6%E6%B7%BB%E5%8A%A0businesskey-%E4%B8%9A%E5%8A%A1%E6%A0%87%E8%AF%86"><span class="toc-text"> 二、启动流程实例 并添加Businesskey（业务标识）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8"><span class="toc-text"> 三、操作数据库表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%8C%82%E8%B5%B7%E3%80%81%E6%BF%80%E6%B4%BB%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B"><span class="toc-text"> 四、挂起、激活流程实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E5%85%A8%E9%83%A8%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B%E6%8C%82%E8%B5%B7"><span class="toc-text"> 1、全部流程实例挂起</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E5%8D%95%E4%B8%AA%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B%E6%8C%82%E8%B5%B7"><span class="toc-text"> 2、单个流程实例挂起</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0-%E4%B8%AA%E4%BA%BA%E4%BB%BB%E5%8A%A1"><span class="toc-text"> 第八章 个人任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%88%86%E9%85%8D%E4%BB%BB%E5%8A%A1%E8%B4%9F%E8%B4%A3%E4%BA%BA"><span class="toc-text"> 一、分配任务负责人</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E5%9B%BA%E5%AE%9A%E5%88%86%E9%85%8D"><span class="toc-text"> 1、固定分配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%88%86%E9%85%8D"><span class="toc-text"> 2、表达式分配</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_1-uel-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text"> （1）UEL 表达式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_2-%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%B4%A3%E4%BA%BA"><span class="toc-text"> （2）编写代码配置负责人</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_3-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text"> （3）注意事项</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E7%9B%91%E5%90%AC%E5%99%A8%E5%88%86%E9%85%8D"><span class="toc-text"> 3、监听器分配</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_1%E3%80%81%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text"> 1、注意事项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%9F%A5%E8%AF%A2%E4%BB%BB%E5%8A%A1"><span class="toc-text"> 二、查询任务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E6%9F%A5%E8%AF%A2%E4%BB%BB%E5%8A%A1%E8%B4%9F%E8%B4%A3%E4%BA%BA%E7%9A%84%E5%BE%85%E5%8A%9E%E4%BB%BB%E5%8A%A1"><span class="toc-text"> 1、查询任务负责人的待办任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E5%85%B3%E8%81%94-businesskey"><span class="toc-text"> 2、关联 businessKey</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%8A%9E%E7%90%86%E4%BB%BB%E5%8A%A1"><span class="toc-text"> 三、办理任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B9%9D%E7%AB%A0-%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F"><span class="toc-text"> 第九章 流程变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F"><span class="toc-text"> 一、什么是流程变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B"><span class="toc-text"> 二、流程变量类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-text"> 三、流程变量作用域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81globa%E5%8F%98%E9%87%8F"><span class="toc-text"> 1、globa变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81local%E5%8F%98%E9%87%8F"><span class="toc-text"> 2、local变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text"> 四、流程变量的使用方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E5%9C%A8%E5%B1%9E%E6%80%A7%E4%B8%8A%E4%BD%BF%E7%94%A8uel%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text"> 1、在属性上使用UEL表达式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E5%9C%A8%E8%BF%9E%E7%BA%BF%E4%B8%8A%E4%BD%BF%E7%94%A8uel%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text"> 2、在连线上使用UEL表达式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E4%BD%BF%E7%94%A8global%E5%8F%98%E9%87%8F%E6%8E%A7%E5%88%B6%E6%B5%81%E7%A8%8B"><span class="toc-text"> 五、使用Global变量控制流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E9%9C%80%E6%B1%82"><span class="toc-text"> 1、需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89-1"><span class="toc-text"> 2、流程定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E8%AE%BE%E7%BD%AEglobal%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F"><span class="toc-text"> 3、设置global流程变量</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a%E3%80%81%E5%88%9B%E5%BB%BApojo%E5%AF%B9%E8%B1%A1"><span class="toc-text"> a、创建POJO对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#b%E3%80%81%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E6%97%B6%E8%AE%BE%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-text"> b、启动流程时设置变量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#c%E3%80%81%E4%BB%BB%E5%8A%A1%E5%8A%9E%E7%90%86%E6%97%B6%E8%AE%BE%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-text"> c、任务办理时设置变量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#d%E3%80%81%E9%80%9A%E8%BF%87%E5%BD%93%E5%89%8D%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B%E8%AE%BE%E7%BD%AE"><span class="toc-text"> d、通过当前流程实例设置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#e%E3%80%81%E9%80%9A%E8%BF%87%E5%BD%93%E5%89%8D%E4%BB%BB%E5%8A%A1%E8%AE%BE%E7%BD%AE"><span class="toc-text"> e、通过当前任务设置</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text"> 4、测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_5%E3%80%81%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text"> 5、注意事项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_6%E3%80%81%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8"><span class="toc-text"> 6、操作数据库表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E8%AE%BE%E7%BD%AElocal%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F"><span class="toc-text"> 六、设置local流程变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E4%BB%BB%E5%8A%A1%E5%8A%9E%E7%90%86%E6%97%B6%E8%AE%BE%E7%BD%AE"><span class="toc-text"> 1、任务办理时设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E9%80%9A%E8%BF%87%E5%BD%93%E5%89%8D%E4%BB%BB%E5%8A%A1%E8%AE%BE%E7%BD%AE"><span class="toc-text"> 2、通过当前任务设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81-local%E5%8F%98%E9%87%8F%E6%B5%8B%E8%AF%951"><span class="toc-text"> 3、 Local变量测试1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81-local%E5%8F%98%E9%87%8F%E6%B5%8B%E8%AF%952"><span class="toc-text"> 4、 Local变量测试2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E7%AB%A0-%E7%BB%84%E4%BB%BB%E5%8A%A1"><span class="toc-text"> 第十章 组任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%9C%80%E6%B1%82"><span class="toc-text"> 一、需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%AE%BE%E7%BD%AE%E4%BB%BB%E5%8A%A1%E5%80%99%E9%80%89%E4%BA%BA"><span class="toc-text"> 二、设置任务候选人</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%BB%84%E4%BB%BB%E5%8A%A1"><span class="toc-text"> 三、组任务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E7%BB%84%E4%BB%BB%E5%8A%A1%E5%8A%9E%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-text"> 1、组任务办理流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_1-%E6%9F%A5%E8%AF%A2%E7%BB%84%E4%BB%BB%E5%8A%A1"><span class="toc-text"> （1）查询组任务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_2-%E6%8B%BE%E5%8F%96-claim-%E4%BB%BB%E5%8A%A1"><span class="toc-text"> （2）拾取(claim)任务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_3-%E6%9F%A5%E8%AF%A2%E4%B8%AA%E4%BA%BA%E4%BB%BB%E5%8A%A1"><span class="toc-text"> （3）查询个人任务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_4-%E5%8A%9E%E7%90%86%E4%B8%AA%E4%BA%BA%E4%BB%BB%E5%8A%A1"><span class="toc-text"> （4）办理个人任务</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E6%9F%A5%E8%AF%A2%E7%BB%84%E4%BB%BB%E5%8A%A1"><span class="toc-text"> 2、查询组任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E6%8B%BE%E5%8F%96%E7%BB%84%E4%BB%BB%E5%8A%A1"><span class="toc-text"> 3、拾取组任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E6%9F%A5%E8%AF%A2%E4%B8%AA%E4%BA%BA%E5%BE%85%E5%8A%9E%E4%BB%BB%E5%8A%A1"><span class="toc-text"> 4、查询个人待办任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_5%E3%80%81%E5%8A%9E%E7%90%86%E4%B8%AA%E4%BA%BA%E4%BB%BB%E5%8A%A1"><span class="toc-text"> 5、办理个人任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_6%E3%80%81%E5%BD%92%E8%BF%98%E7%BB%84%E4%BB%BB%E5%8A%A1"><span class="toc-text"> 6、归还组任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_7%E3%80%81%E4%BB%BB%E5%8A%A1%E4%BA%A4%E6%8E%A5"><span class="toc-text"> 7、任务交接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_8%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-text"> 8、数据库表操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0-%E7%BD%91%E5%85%B3"><span class="toc-text"> 第十一章 网关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%8E%92%E4%BB%96%E7%BD%91%E5%85%B3exclusivegateway"><span class="toc-text"> 一、排他网关ExclusiveGateway</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E6%8E%92%E4%BB%96%E7%BD%91%E5%85%B3"><span class="toc-text"> 1、什么是排他网关：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89-2"><span class="toc-text"> 2、流程定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text"> 3、测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%B9%B6%E8%A1%8C%E7%BD%91%E5%85%B3parallelgateway"><span class="toc-text"> 二、并行网关ParallelGateway</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%B9%B6%E8%A1%8C%E7%BD%91%E5%85%B3"><span class="toc-text"> 1、什么是并行网关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89-3"><span class="toc-text"> 2、流程定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E6%B5%8B%E8%AF%95-1"><span class="toc-text"> 3、测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%8C%85%E5%90%AB%E7%BD%91%E5%85%B3inclusivegateway"><span class="toc-text"> 三、包含网关InclusiveGateway</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%8C%85%E5%90%AB%E7%BD%91%E5%85%B3"><span class="toc-text"> 1、什么是包含网关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89-4"><span class="toc-text"> 2、流程定义：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81-%E6%B5%8B%E8%AF%95"><span class="toc-text"> 3、 测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%BA%8B%E4%BB%B6%E7%BD%91%E5%85%B3eventgateway"><span class="toc-text"> 四、事件网关EventGateway</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0-activiti%E4%B8%8Espring%E6%95%B4%E5%90%88%E5%BC%80%E5%8F%91"><span class="toc-text"> 第十二章 Activiti与Spring整合开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81-activiti%E4%B8%8Espring%E6%95%B4%E5%90%88%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-text"> 一、 Activiti与Spring整合的配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E5%9C%A8pom-xml%E6%96%87%E4%BB%B6%E5%BC%95%E5%85%A5%E5%9D%90%E6%A0%87"><span class="toc-text"> 1、在pom.xml文件引入坐标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E5%88%9B%E5%BB%BAactiviti-spring-xml"><span class="toc-text"> 2、创建activiti-spring.xml</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%B5%8B%E8%AF%95activiti%E4%B8%8Espring%E6%95%B4%E5%90%88"><span class="toc-text"> 二、测试Activiti与Spring整合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="toc-text"> 1、测试代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-text"> 2、执行流程分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0-activiti7%E4%B8%8Espringboot%E6%95%B4%E5%90%88%E5%BC%80%E5%8F%91"><span class="toc-text"> 第十三章 Activiti7与SpringBoot整合开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81springboot%E6%95%B4%E5%90%88activiti7%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-text"> 一、SpringBoot整合Activiti7的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-springboot%E7%9A%84application-yml%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-text"> 二、 SpringBoot的application.yml文件配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%BC%96%E5%86%99%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-text"> 三、编写启动类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%B7%BB%E5%8A%A0springsecurity%E5%AE%89%E5%85%A8%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88%E9%85%8D%E7%BD%AE"><span class="toc-text"> 四、添加SpringSecurity安全框架整合配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E6%B7%BB%E5%8A%A0securityutil%E7%B1%BB"><span class="toc-text"> 1、添加SecurityUtil类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-%E6%B7%BB%E5%8A%A0demoapplicationconfig%E7%B1%BB"><span class="toc-text"> 2、 添加DemoApplicationConfig类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81-%E5%88%9B%E5%BB%BAbpmn%E6%96%87%E4%BB%B6"><span class="toc-text"> 五、 创建Bpmn文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E4%BD%BF%E7%94%A8junit%E6%96%B9%E5%BC%8F%E6%B5%8B%E8%AF%95"><span class="toc-text"> 六、使用Junit方式测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0-%E5%B0%8Fdemo"><span class="toc-text"> 第十四章 小demo</span></a></li></ol></div><div class="widget-footer"><a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ --><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/><path d="M7 3.338A9.95 9.95 0 0 1 12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12c0-1.821.487-3.53 1.338-5"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ --><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M8 10.5h8M8 14h5.5M17 3.338A9.95 9.95 0 0 0 12 2C6.477 2 2 6.477 2 12c0 1.6.376 3.112 1.043 4.453c.178.356.237.763.134 1.148l-.595 2.226a1.3 1.3 0 0 0 1.591 1.592l2.226-.596a1.63 1.63 0 0 1 1.149.133A9.96 9.96 0 0 0 12 22c5.523 0 10-4.477 10-10c0-1.821-.487-3.53-1.338-5"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">


<script type="text/javascript">
  window.canonical = {"originalHost":"blog.thatcoder.cn","officialHosts":["localhost","en.blog.thatcoder.cn","hexo.thatcoder.cn","thatcoder.vercel.app","thatcoder.netlify.app","cn-coder.vercel.app","thatcoders.github.io","thatcoder.pages.dev","cncoder.pages.dev"],"encoded":"YmxvZy50aGF0Y29kZXIuY24="};
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
    tag_plugins: {
      chat: Object.assign({"api":"https://siteinfo.listentothewind.cn/api/v1"}),
    }
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"post, page, docs","path":"/search.json","content":true,"skip_search":null,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
    loading: `https://api.iconify.design/eos-icons:three-dots-loading.svg?color=%231cd0fd`,
  };
  const deps = {
    jquery: `https://gcore.jsdelivr.net/npm/jquery@3.7/dist/jquery.min.js`,
    marked: `https://gcore.jsdelivr.net/npm/marked@13.0/lib/marked.umd.min.js`,
    lazyload: `/%5Bobject%20Object%5D`
  }
  

</script>

<script type="text/javascript">
  
  function RunItem() {
    this.list = []; // 存放回调函数
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = () => {
          utils.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) => {
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index, 1);
        }
      }
    }
    // 构造一个可以run的对象
    function Item(fn, name) {
      // 函数名称
      this.name = name || fn.name;
      // run方法
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }

  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')) {
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function () {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },

    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      const maxRetry = 3;
      let retryCount = 0;

      return new Promise((resolve, reject) => {
        const load = () => {
          utils.onLoading?.(el);

          let timedOut = false;
          const timeout = setTimeout(() => {
            timedOut = true;
            console.warn('[request] 超时:', url);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject('请求超时');
            } else {
              setTimeout(load, 1000);
            }
          }, 5000);

          fetch(url).then(resp => {
            if (timedOut) return;
            clearTimeout(timeout);

            if (!resp.ok) throw new Error('响应失败');
            return resp;
          }).then(data => {
            if (timedOut) return;
            utils.onLoadSuccess?.(el);
            callback(data);
            resolve(data);
          }).catch(err => {
            clearTimeout(timeout);
            console.warn('[request] 错误:', err);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject(err);
            } else {
              setTimeout(load, 1000);
            }
          });
        };

        load();
      });
    },
    requestWithoutLoading: (url, options = {}, maxRetry = 2, timeout = 5000) => {
      return new Promise((resolve, reject) => {
        let retryCount = 0;

        const tryRequest = () => {
          let timedOut = false;
          const timer = setTimeout(() => {
            timedOut = true;
            if (++retryCount > maxRetry) reject('timeout');
            else tryRequest();
          }, timeout);

          fetch(url, options)
            .then(resp => {
              clearTimeout(timer);
              if (!resp.ok) throw new Error('bad response');
              resolve(resp);
            })
            .catch(err => {
              clearTimeout(timer);
              if (++retryCount > maxRetry) reject(err);
              else setTimeout(tryRequest, 500);
            });
        };

        tryRequest();
      });
    },
    /********************** requestAnimationFrame ********************************/
    // 1、requestAnimationFrame 会把每一帧中的所有 DOM 操作集中起来，在一次重绘或回流中就完成，并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率，一般来说，这个频率为每秒60帧。
    // 2、在隐藏或不可见的元素中，requestAnimationFrame 将不会进行重绘或回流，这当然就意味着更少的的 cpu，gpu 和内存使用量。
    requestAnimationFrame: (fn) => {
      if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
      }
      window.requestAnimationFrame(fn)
    },
    dark: {},
  };

  // utils.dark.mode 当前模式 dark or light
  // utils.dark.toggle() 暗黑模式触发器
  // utils.dark.push(callBack[,"callBackName"]) 传入触发器回调函数
  utils.dark.method = {
    toggle: new RunItem(),
  };
  utils.dark = Object.assign(utils.dark, {
    push: utils.dark.method.toggle.push,
  });
</script>
<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>

<script async src="https://gcore.jsdelivr.net/npm/vanilla-lazyload@19.1/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
    callback_loaded: (el) => {
      el.classList.add('loaded');
      const wrapper = el.closest('.lazy-box');
      const icon = wrapper?.querySelector('.lazy-icon');
      if (icon) icon.remove();
    }
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });

  window.wrapLazyloadImages = (container) => {
    if (typeof container === 'string') {
      container = document.querySelector(container);
    }
    if (!container) return;
    
    const images = container.querySelectorAll('img');
    images.forEach((img) => {
      if (img.classList.contains('lazy')) return;

      const src = img.getAttribute('src');
      if (!src) return;

      const wrapper = document.createElement('div');
      wrapper.className = 'lazy-box';

      const newImg = img.cloneNode();
      newImg.removeAttribute('src');
      newImg.setAttribute('data-src', src);
      newImg.classList.add('lazy');

      const icon = document.createElement('div');
      icon.className = 'lazy-icon';
      if (def.loading) {
        icon.style.backgroundImage = `url("${def.loading}")`;
      }

      wrapper.appendChild(newImg);
      wrapper.appendChild(icon);

      img.replaceWith(wrapper);
    });

    // 通知 LazyLoad 更新
    if (window.lazyLoadInstance?.update) {
      window.lazyLoadInstance.update();
    }
  }
  
</script>

<!-- required -->
<script src="/js/main.js?v=1.33.1" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    // applyThemeToGiscus(theme)
  }

  // FIXME: 这会导致无法使用 preferred_color_scheme 以外的主题
  const applyThemeToGiscus = (theme) => {
    // theme = theme === 'auto' ? 'preferred_color_scheme' : theme
    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)
    utils.dark.mode = newTheme === 'auto' ? (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light") : newTheme;
    utils.dark.method.toggle.start();

    const messages = {
      light: `切换到浅色模式`,
      dark: `切换到深色模式`,
      auto: `切换到跟随系统配色`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    } else {
      utils.dark.mode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }
    utils.dark.method.toggle.start();
  })()
</script>


<!-- optional -->

  <script type="module">
  import { init } from 'https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline.js';

  const el = document.getElementById('waline_container');
  util.viewportLazyload(el, load_waline, false);

  function load_waline(){
    if (!el) return;

    utils.css('https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline.css');
    utils.css('https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline-meta.css');

    const path = el.getAttribute('comment_id') ?? decodeURI(window.location.pathname);
    const waline = init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline.js","css":"https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline.css","meta_css":"https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline-meta.css","serverURL":"https://waline.thatapi.cn/","commentCount":true,"pageview":false,"search":false,"locale":{"placeholder":"  遇事不决, 可问春风..."},"emoji":["https://upyun.thatcdn.cn/public/web/emojis/bilibili","https://upyun.thatcdn.cn/public/web/emojis/qq","https://upyun.thatcdn.cn/public/web/emojis/tieba","https://upyun.thatcdn.cn/public/web/emojis/weibo"],"reaction":["https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_thumbsup.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_cute.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_sunglasses.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_crazy.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_trollface.png"],"meta":["nick","mail","link"],"imageUploader":{"fileName":"file","tokenName":"Authorization","api":"https://lsky.thatcoder.cn/api/v1/upload","token":"Bearer 6|x9vHGJGHAnjqbO0PGEE5vM7r9S9hdqFA9bmdESdm","resp":"data.links.url"}}, {
      el: '#waline_container',
      path: path,
      
        imageUploader: function(file) {
          const headers = new Headers();
          headers.set('Accept', 'application/json');
          
            headers.set('Authorization', 'Bearer 6|x9vHGJGHAnjqbO0PGEE5vM7r9S9hdqFA9bmdESdm')
          
          const formData = new FormData();
          formData.append('file', file);
          return fetch('https://lsky.thatcoder.cn/api/v1/upload',{
            method: 'POST',
            body: formData,
            headers: headers
            }).then((resp) => resp.json())
              .then((resp) => resp.data.links.url)
        },
      
    }));
  }
</script>




<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"rating":{"js":"/js/services/rating.js","api":"https://star-vote.xaox.cc/api/rating"},"vote":{"js":"/js/services/vote.js","api":"https://star-vote.xaox.cc/api/vote"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"friends_and_posts":{"js":"/js/services/friends_and_posts.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"},"voice":{"js":"/js/plugins/voice.js"},"video":{"js":"/js/plugins/video.js"},"download-file":{"js":"/js/plugins/download-file.js"},"twikoo":{"js":"/js/services/twikoo_latest_comment.js"},"waline":{"js":"/js/services/waline_latest_comment.js"},"artalk":{"js":"/js/services/artalk_latest_comment.js"},"giscus":{"js":"/js/services/giscus_latest_comment.js"},"contributors":{"edit_this_page":{"_posts/":null,"wiki/stellar/":"https://github.com/xaoxuu/hexo-theme-stellar-docs/blob/main/"},"js":"/js/services/contributors.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else if (id == 'voice') {
        ctx.voiceAudios = document.querySelectorAll('.voice>audio');
        if (ctx.voiceAudios?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            createVoiceDom(ctx.voiceAudios);
          });
        }
      } else if (id == 'video') {
        ctx.videos = document.querySelectorAll('.video>video');
        if (ctx.videos?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            videoEvents(ctx.videos);
          });
        }
      } else if (id == 'download-file') {
        ctx.files = document.querySelectorAll('.file');
        if (ctx.files?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            downloadFileEvent(ctx.files);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }

    // chat iphone time
    let phoneTimes = document.querySelectorAll('.chat .status-bar .time');

    if (phoneTimes.length > 0) {
      NowTime();
      var date = new Date();
      var sec = date.getSeconds();
      var firstAdjustInterval = setInterval(firstAdjustTime, 1000 * (60 - sec));
    }

    function firstAdjustTime() {
      NowTime();
      clearInterval(firstAdjustInterval);
      setInterval(NowTime, 1000 * 60);
    }

    function NowTime() {
      for (let i = 0; i < phoneTimes.length; ++i) {
        var timeSpan = phoneTimes[i];
        var date = new Date();
        var hour = date.getHours();
        var min = date.getMinutes();
        timeSpan.innerHTML = check(hour) + ":" + check(min);
      }
    };

    function check(val) {
      if (val < 10) {
        return ("0" + val);
      }
      return (val);
    }

    // chat quote
    const chat_quote_obverser = new IntersectionObserver((entries, observer) => {
      entries.filter((entry) => { return entry.isIntersecting }).sort((a, b) => a.intersectionRect.y !== b.intersectionRect.y ? a.intersectionRect.y - b.intersectionRect.y : a.intersectionRect.x - b.intersectionRect.x).forEach((entry, index) => {
          observer.unobserve(entry.target);
          setTimeout(() => {
            entry.target.classList.add('quote-blink');
            setTimeout(() => {
              entry.target.classList.remove('quote-blink');
            }, 1000);
          }, Math.max(100, 16) * (index + 1));
        });
    });

    var chatQuotes = document.querySelectorAll(".chat .talk .quote");
    chatQuotes.forEach((quote) => {
      quote.addEventListener('click', function () {
        var chatCellDom = document.getElementById("quote-" + quote.getAttribute("quotedCellTag"));
        if (chatCellDom) {
          var chatDiv = chatCellDom.parentElement;
          var mid = chatDiv.clientHeight / 2;
          var offsetTop = chatCellDom.offsetTop;
          if (offsetTop > mid - chatCellDom.clientHeight / 2) {
            chatDiv.scrollTo({
              top: chatCellDom.offsetTop - mid + chatCellDom.clientHeight / 2,
              behavior: "smooth"
            });
          } else {
            chatDiv.scrollTo({
              top: 0,
              behavior: "smooth"
            });
          }
          chat_quote_obverser.observe(chatCellDom);
        }
      });
    });
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://gcore.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script>
  ctx.fancybox = {
    selector: `.swiper-slide img, .md-text.content p>img, .md-text.content li img , .wl-content img, waline_container .vcontent img, .timeline .body .image img,  .timeline .gallery img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error), .with-fancybox .atk-content img:not([atk-emoticon])';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const memos = document.getElementsByClassName('ds-memos');
    if (memos != undefined && memos.length > 0) {
      needFancybox = true;
    }
    const fancybox = document.getElementsByClassName('with-fancybox');
    if (fancybox != undefined && fancybox.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>




<!-- inject -->
<script type="text/javascript" src="/custom/js/ZYUtil.js"></script><script type="text/javascript" src="/custom/js/ZYDark.js"></script><script type="text/javascript" src="/custom/js/ZYCategory.js"></script><script type="text/javascript" src="/custom/js/ZYCode.js"></script><script type="text/javascript" src="/custom/js/timetmpl.js"></script>
</div></body></html>
