
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.31.0" theme-name="Stellar" theme-version="1.31.0">
  <link rel="canonical" href="https://blog.thatcoder.cn/wiki/YDLDoc3/springcloud/SpringCloud/SpringCloud">
  
  <meta name="generator" content="Hexo 7.1.1">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  <title>YDLDoc3：SpringCloud - 那个码农</title>

  
    <meta name="description" content="提示课程视频教程链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1tT4y1a7LAopen in new window# 介绍：课程介绍# 1、前置​ javaSE,javaEE,SSM,Boot​ 为什么：一线城市，上了规模大厂、中厂，都需要cloud。​ cloud,薪资高# 2、特点​ 各大机构视频教程、网络文章、spring官网以及本人8年的java开发经验。​">
<meta property="og:type" content="website">
<meta property="og:title" content="SpringCloud">
<meta property="og:url" content="https://blog.thatcoder.cn/wiki/YDLDoc3/springcloud/SpringCloud/SpringCloud.html">
<meta property="og:site_name" content="那个码农">
<meta property="og:description" content="提示课程视频教程链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1tT4y1a7LAopen in new window# 介绍：课程介绍# 1、前置​ javaSE,javaEE,SSM,Boot​ 为什么：一线城市，上了规模大厂、中厂，都需要cloud。​ cloud,薪资高# 2、特点​ 各大机构视频教程、网络文章、spring官网以及本人8年的java开发经验。​">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://upyun.thatcdn.cn/hexo/stellar/image/favicon.webp">
<meta property="article:published_time" content="2023-12-16T19:23:22.897Z">
<meta property="article:modified_time" content="2023-12-16T19:23:22.897Z">
<meta property="article:author" content="钟意">
<meta property="article:tag" content="那个码农">
<meta property="article:tag" content="码农钟意">
<meta property="article:tag" content="钟意的博客">
<meta property="article:tag" content="钟意博客">
<meta property="article:tag" content="That Coder">
<meta property="article:tag" content="thatcoder">
<meta property="article:tag" content="源柒拾柒雅舍">
<meta property="article:tag" content="源WebGary">
<meta property="article:tag" content="giligili.work">
<meta property="article:tag" content="seclusion.work">
<meta property="article:tag" content="GalGame">
<meta property="article:tag" content="Hexo Stellar">
<meta property="article:tag" content="江西木村拓哉">
<meta property="article:tag" content="江西吴彦祖">
<meta property="article:tag" content="江西胡歌">
<meta property="article:tag" content="龙南木村拓哉">
<meta property="article:tag" content="龙南吴彦祖">
<meta property="article:tag" content="龙南胡歌">
<meta property="article:tag" content="九江职业技术学院">
<meta property="article:tag" content="南昌交通学院">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://upyun.thatcdn.cn/hexo/stellar/image/favicon.webp">
  
  

  <meta name="keywords" content="那个码农,码农钟意,钟意的博客,钟意博客,That Coder,thatcoder,源柒拾柒雅舍,源WebGary,giligili.work,seclusion.work,GalGame,Hexo Stellar,江西木村拓哉,江西吴彦祖,江西胡歌,龙南木村拓哉,龙南吴彦祖,龙南胡歌,九江职业技术学院,南昌交通学院">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="那个码农" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.31.0">


  
    <link rel="shortcut icon" href="https://upyun.thatcdn.cn/hexo/stellar/image/favicon.webp">
  

  
    
<link rel="stylesheet" href="/custom/css/ZYCode.css">

  

  <link rel="Shortcut Icon" href="/favicon.ico" type="image/x-icon" /><link rel="stylesheet" href="https://upyun.thatcdn.cn/public/font/lxgw/result.css" /><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="/custom/css/ZYTimetmpl.css" /><meta itemprop="name" content="钟意博客"><meta itemprop="description" content="笔名钟意, 记录代码与生活."><meta itemprop="image" content="https://upyun.thatcdn.cn/hexo/stellar/image/shot.webp"><link rel="stylesheet" href="/custom/css/ZYGlobal.css"><link rel="stylesheet" href="/custom/css/ZYWaline.css"><link rel="stylesheet" href="/custom/css/ZYPage.css"><script type="text/javascript" src="/custom/js/header.js"></script><!-- Clarity tracking code for https://blog.thatcoder.cn/ -->
<script>    (function(c,l,a,r,i,t,y){        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i+"?ref=bwt";        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);    })(window, document, "clarity", "script", "fi1zg7i5q5");</script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H6GM3XZWV7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-H6GM3XZWV7');
</script>
<!-- BaiDu-ZhanZhang
<meta name="baidu-site-verification" content="codeva-8tnFVr706d" />
<!-- BaiDu-Tongji -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?233765a020502d5d6a92d4fe306d36c2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>
<body>



<div class="l_body s:aa content tech " id="start" layout="wiki" type="tech" ><aside class="l_left"><div class="sidebg"></div><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><div class="icon"><img no-lazy class="icon" src="/custom/img/ydl.png" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></div><a class="title" href="/wiki/YDLDoc3/ELK%E5%85%A5%E9%97%A8/elk%E5%85%A5%E9%97%A8/elk%E5%85%A5%E9%97%A8.html"><div class="main" ff="title">YDLDoc3</div><div class="sub normal cap">关于YDLDoc的笔记</div><div class="sub hover cap" style="opacity:0"> 不对之处请指出</div></a></div></header>

<div class="nav-area">

<nav class="menu dis-select"><a class="nav-item" title="博客" href="/"><span>博客</span></a><a class="nav-item active" title="笔记" href="/wiki/"><span>笔记</span></a><a class="nav-item" title="便签" href="/notes/"><span>便签</span></a><a class="nav-item" title="社交" href="/links/"><span>社交</span></a></nav>
</div>
<div class="widgets">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" data-filter="/wiki/YDLDoc3/" placeholder="在 YDLDoc3 中搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<widget class="widget-wrapper post-list"><div class="widget-body fs14"><a class="link" href="/wiki/YDLDoc3/ELK%E5%85%A5%E9%97%A8/elk%E5%85%A5%E9%97%A8/elk%E5%85%A5%E9%97%A8.html#start"><span class="toc-text">elk入门</span></a><a class="link" href="/wiki/YDLDoc3/kafka/kafka%E5%85%A5%E9%97%A8/kafka%E5%85%A5%E9%97%A8.html"><span class="toc-text">kafka入门</span></a><a class="link" href="/wiki/YDLDoc3/kafka/kafka%E8%BF%9B%E9%98%B6/kafka%E8%BF%9B%E9%98%B6.html"><span class="toc-text">kafka进阶</span></a><a class="link" href="/wiki/YDLDoc3/ELK%E5%85%A5%E9%97%A8/elk%E8%BF%9B%E9%98%B6/elk%E8%BF%9B%E9%98%B6.html"><span class="toc-text">elk进阶</span></a><a class="link active" href="/wiki/YDLDoc3/springcloud/SpringCloud/SpringCloud.html"><span class="toc-text">SpringCloud</span><svg class="active-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M21 11.098v4.993c0 3.096 0 4.645-.734 5.321c-.35.323-.792.526-1.263.58c-.987.113-2.14-.907-4.445-2.946c-1.02-.901-1.529-1.352-2.118-1.47a2.225 2.225 0 0 0-.88 0c-.59.118-1.099.569-2.118 1.47c-2.305 2.039-3.458 3.059-4.445 2.945a2.238 2.238 0 0 1-1.263-.579C3 20.736 3 19.188 3 16.091v-4.994C3 6.81 3 4.666 4.318 3.333C5.636 2 7.758 2 12 2c4.243 0 6.364 0 7.682 1.332C21 4.665 21 6.81 21 11.098" opacity=".5"/><path fill="currentColor" d="M9 5.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5z"/></svg></a><a class="link" href="/wiki/YDLDoc3/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx%E5%85%A5%E9%97%A8/nginx%E5%85%A5%E9%97%A8.html"><span class="toc-text">nginx入门</span></a><a class="link" href="/wiki/YDLDoc3/springcloud/SpringCloudAlibaba/SpringCloudAlibaba.html"><span class="toc-text">SpringCloudAlibaba</span></a><a class="link" href="/wiki/YDLDoc3/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMQ/rocketMQ.html"><span class="toc-text">rocketMQ</span></a><a class="link" href="/wiki/YDLDoc3/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/rabbitMQ/rabbitMQ.html"><span class="toc-text">rabbitMQ</span></a></div></widget>

<widget class="widget-wrapper post-card"><div class="widget-header dis-select"><span class="name">更多：开发</span></div><div class="widget-body"><a class="item wiki" href="/wiki/YDLDoc1/mysql%E5%AD%A6%E4%B9%A0/mysql%E5%85%A5%E9%97%A8/mysql%E5%85%A5%E9%97%A8.html"><span class="title">元动力摘录 - JAVA阶段一</span><span class="excerpt">钟意关于YDLDoc的笔记</span></a><a class="item wiki" href="/wiki/YDLDoc2/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/maven%E5%85%A5%E9%97%A8/maven%E5%85%A5%E9%97%A8.html"><span class="title">元动力摘录 - JAVA阶段二</span><span class="excerpt">钟意关于YDLDoc的笔记</span></a><a class="item wiki" href="/wiki/YDLDoc4/%E9%A1%B9%E7%9B%AE%E8%BF%9B%E9%98%B6/%E5%B7%A5%E4%BD%9C%E6%B5%81/%E5%B7%A5%E4%BD%9C%E6%B5%81.html"><span class="title">元动力摘录 - JAVA项目阶段</span><span class="excerpt">钟意关于YDLDoc的笔记</span></a><a class="item wiki" href="/wiki/YuDaoBoot/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A0%87%E7%AD%BE/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A0%87%E7%AD%BE.html"><span class="title">艿艿若依Boot - 开发指南</span><span class="excerpt">关于艿艿若依Boot的文档</span></a><a class="item wiki" href="/wiki/YuDaoCloud/%E5%89%8D%E7%AB%AF%E6%89%8B%E5%86%8C%20Vue%202/Icon%20%E5%9B%BE%E6%A0%87/Icon%20%E5%9B%BE%E6%A0%87.html"><span class="title">艿艿若依Cloud - 开发指南</span><span class="excerpt">关于艿艿若依Cloud的文档</span></a><a class="item wiki" href="/wiki/MySql/basics/select.html"><span class="title">MySql - 关系型数据库管理系统</span><span class="excerpt">钟意关于关系型数据库MySql的笔记</span></a><a class="item wiki" href="/wiki/Laf/start/start.html"><span class="title">Laf - 开箱即用的 serverless</span><span class="excerpt">钟意关于Laf的笔记</span></a><a class="item wiki" href="/wiki/SpringCloud/start.html"><span class="title">SpringCloud - JAVA系分布式微服务架构</span><span class="excerpt">钟意关于SpringCloud的笔记</span></a></div></widget>

<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/wiki/LoadBalance/multiple/proxy.html"><span class="title"><strong>LoadBalance</strong><span class="dot"></span>负载均衡</span></a><a class="item title" href="/wiki/LoadBalance/multiple/multiple.html"><span class="title"><strong>LoadBalance</strong><span class="dot"></span>多平台部署前置</span></a><a class="item title" href="/wiki/LoadBalance/multiple/panel.html"><span class="title"><strong>LoadBalance</strong><span class="dot"></span>服务器面板</span></a><a class="item title" href="/wiki/LoadBalance/deploy/vercel.html"><span class="title"><strong>LoadBalance</strong><span class="dot"></span>Vercel 部署</span></a><a class="item title" href="/wiki/LoadBalance/deploy/config.html"><span class="title"><strong>LoadBalance</strong><span class="dot"></span>部署前置</span></a><a class="item title" href="/wiki/LoadBalance/deploy/netlify.html"><span class="title"><strong>LoadBalance</strong><span class="dot"></span>Netlify 部署</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" style="grid-column: span 3;height:32px;padding: 0;" href="https://space.bilibili.com/1664687779" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" height="32px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-banner.jpg"/></a><a class="social" style="grid-column: span 3;height:32px;padding: 0;" href="https://muselink.cc/naive" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" height="32px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/wechat-banner.jpg"/></a><a class="social" style="grid-column: span 3;height:32px;padding: 0;" href="https://github.com/ThatCoders" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" height="32px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-banner.jpg"/></a><a class="social" href="javascript:ThemeChange('dark');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/Moon.png"/></a><a class="social" href="javascript:ThemeChange('light');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/Sun.png"/></a><a class="social" href="javascript:ThemeChange('auto');" rel="noopener noreferrer"><img class="lazy" id="ThemeAI" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/AI.png"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
    <div class="content">
      <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" id="menu" href="/wiki">文档</a><span class="sep"></span><a class="cap breadcrumb" id="proj" href="/wiki/YDLDoc3/ELK%E5%85%A5%E9%97%A8/elk%E5%85%A5%E9%97%A8/elk%E5%85%A5%E9%97%A8.html">YDLDoc3</a></div>
<div class="flex-row" id="post-meta"><span class="text created">更新于：<time datetime="2023-12-16T19:23:22.897Z">2023-12-17</time></span></div></div></div>
      
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>SpringCloud</span></h1>
        
      </div>
    </div>
    
    </div>
    </div><article class="md-text content"><div class="theme-hope-content"><div class="hint-container tip"><p class="hint-container-title">提示</p><p>课程视频教程链接：<a href="https://www.bilibili.com/video/BV1tT4y1a7LA" rel="noopener noreferrer" target="_blank">https://www.bilibili.com/video/BV1tT4y1a7LA<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><h2 id="介绍-课程介绍" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#介绍-课程介绍">#</a> 介绍：课程介绍</h2><h3 id="_1、前置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、前置">#</a> 1、前置</h3><p>​ javaSE,javaEE,SSM,Boot</p><p>​ 为什么：一线城市，上了规模大厂、中厂，都需要cloud。</p><p>​ cloud,薪资高</p><h3 id="_2、特点" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、特点">#</a> 2、特点</h3><p>​ 各大机构视频教程、网络文章、spring官网以及本人8年的java开发经验。</p><p>​ 跟着本课程，写就可以了。</p><p>​ 入门课程，会用cloud。</p><h3 id="_3、如何学习" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、如何学习">#</a> 3、如何学习</h3><p>​ 保姆级教程。</p><p>​ 代码和课程图片粘贴md格式的文档上面。</p><p>​ 倍速播放。关闭弹幕。</p><p>​ 学完一个知识点，有任何问题，弹幕、评论、粉丝群大家讨论。</p><h3 id="_4、面向人员" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、面向人员">#</a> 4、面向人员</h3><p>​ 大学生朋友：大学当中，科班非科班，毕业找一份java工作，没问题。</p><p>​ 工作1-3年朋友：自己行业又累薪资又低。4-6个月，坚持下来，转行找到java开发职位没问题。</p><h3 id="_5、心态" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_5、心态">#</a> 5、心态</h3><p>​ 太简单了、太难。 我不是RMB,做不到14亿人都喜欢。 右上角有个X,点击一下退出可以了。</p><p>​ 不要吃饱了骂厨子、念完经打和尚、过河拆桥。</p><p>​</p><p>​ Talk is cheap ,show me the code 。 坚持。30小结。都看完，知识就是你的了。</p><p>​ 欢迎大家，一键三连。</p><h3 id="_6、获取资料" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_6、获取资料">#</a> 6、获取资料</h3><p><a href="http://www.ydlclass.com" rel="noopener noreferrer" target="_blank">www.ydlclass.com<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 文档区，免费下载即可。</p><p>我<strong>itlils</strong>和楠哥<strong>itnanls</strong> java学习整套路径，列出来。 <strong>教程都由我和楠哥亲自录制</strong>。 免费自学java成功。</p><p>案例：免费自学，java工作，应届生，一线，10k。</p><p>随时一对一解决问题，规划，简历修改。加入我们会员。</p><h2 id="第一章-springcloud简介" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第一章-springcloud简介">#</a> 第一章 SpringCloud简介</h2><h3 id="一、-软件架构演进" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、-软件架构演进">#</a> 一、 软件架构演进</h3><p>单体架构</p><figure><img class="lazy" alt="image-20220328172416767" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220328172416767-61fb5e07.png" tabindex="0"/><figcaption>image-20220328172416767</figcaption></figure><p>垂直架构</p><figure><img class="lazy" alt="image-20220328172721883" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220328172721883-2d51c59e.png" tabindex="0"/><figcaption>image-20220328172721883</figcaption></figure><p>分布式架构</p><figure><img class="lazy" alt="image-20220328173112642" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220328173112642-b0ee1ce2.png" tabindex="0"/><figcaption>image-20220328173112642</figcaption></figure><p>SOA架构</p><figure><img class="lazy" alt="image-20220328174118241" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220328174118241-23f135ec.png" tabindex="0"/><figcaption>image-20220328174118241</figcaption></figure><p>微服务架构</p><figure><img class="lazy" alt="image-20220328174633493" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220328174633493-6d3e8f1b.png" tabindex="0"/><figcaption>image-20220328174633493</figcaption></figure><h3 id="二、微服务架构" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、微服务架构">#</a> 二、微服务架构</h3><h4 id="_1、-微服务理念" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、-微服务理念">#</a> 1、 微服务理念</h4><p>①"微服务”一词源 于 Martin Fowler的名为 Microservices的博文,可以在他的官方博客上找到<a href="http://martinfowler.com/articles/microservices.html" rel="noopener noreferrer" target="_blank">http://martinfowler.com/articles/microservices.html<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>②微服务是系统架构上的一种设计风格,它的主旨是将一个原本独立的系统拆分成多个小型服务,这些小型服务都在各自独立的进程中运行,服务之间一般通过 HTTP 的 RESTfuL API 进行通信协作。</p><p><strong>restfull 风格</strong>：数据的增删改查，使用http的不同方式。数据传输用json。</p><div class="language-http line-numbers-mode" data-ext="http"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight http"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs http">​    查询   GET ip:port/user/1<br><br>​   新增   POST ip:port/user    json&#123;username:itlils,age:18&#125;<br><br>​   修改   PUT ip:port/user/1  json&#123;username:itlils,age:19&#125;<br><br>​   删除  DELETE ip:port/user/1<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>③由于有了轻量级的通信协作基础,所以这些微服务可以使用不同的语言来编写。大厂，各种语言混用。</p><p>cloud官网: <a href="https://spring.io/" rel="noopener noreferrer" target="_blank">https://spring.io/<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220329154419410" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220329154419410-35fc4235.png" tabindex="0"/><figcaption>image-20220329154419410</figcaption></figure><figure><img class="lazy" alt="image-20220329152020956" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220329152020956-6168854b.png" tabindex="0"/><figcaption>image-20220329152020956</figcaption></figure><h4 id="_2、-现在大型互联网公司-都在使用微服务架构" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-现在大型互联网公司-都在使用微服务架构">#</a> 2、 现在大型互联网公司，都在使用微服务架构：</h4><p>京东的促销节架构：618</p><figure><img class="lazy" alt="image-20220329152531517" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220329152531517-e9aa4638.png" tabindex="0"/><figcaption>image-20220329152531517</figcaption></figure><p>阿里的架构：</p><figure><img class="lazy" alt="image-20220329152552588" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220329152552588-ea1b80bc.png" tabindex="0"/><figcaption>image-20220329152552588</figcaption></figure><p>京东物流的架构：</p><figure><img class="lazy" alt="image-20220329152611053" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220329152611053-1bdac904.png" tabindex="0"/><figcaption>image-20220329152611053</figcaption></figure><h4 id="_3、-springcloud组件" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、-springcloud组件">#</a> 3、 springcloud组件：</h4><figure><img class="lazy" alt="image-20220329152758773" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220329152758773-9e65bcd2.png" tabindex="0"/><figcaption>image-20220329152758773</figcaption></figure><figure><img class="lazy" alt="image-20220329153147800" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220329153147800-c1b6698c.png" tabindex="0"/><figcaption>image-20220329153147800</figcaption></figure><h2 id="第二章-走进springcloud" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第二章-走进springcloud">#</a> 第二章 走进springcloud</h2><h3 id="一、了解springcloud" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、了解springcloud">#</a> 一、了解springcloud</h3><p>①Spring Cloud 是<strong>一系列框架</strong>的有序集合。</p><p>②Spring Cloud 并没有重复制造轮子，它只是将目前各家公司开发的比较成熟、经得起实际考验的服务框架组合起来。</p><p>netflix eureka 1.1,alibaba 2.2</p><p>③通过 <strong>Spring Boot</strong> 风格进行再封装,屏蔽掉了复杂的配置和实现原理，最终给开发者留出了一套简单易懂、易部署和易维护的分布式系统开发工具包。</p><p>④它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务发现注册、配置中心、消息总线、负载均衡、 断路器、数据监控等，都可以用Spring Boot的开发风格做到一键启动和部署。</p><p>⑤Spring Cloud项目官方网址：<a href="https://spring.io/projects/spring-cloud" rel="noopener noreferrer" target="_blank">https://spring.io/projects/spring-cloud<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>⑥Spring Cloud 版本命名方式采用了<strong>伦敦地铁站的名称</strong>，同时根据字母表的顺序来对应版本时间顺序，比如：最早的Release版本：Angel，第二个Release版本：Brixton，然后是Camden、Dalston、Edgware，Finchley，Greenwich，Hoxton。</p><p>目前最新的是2021.0.1版本。</p><figure><img class="lazy" alt="image-20220329161144299" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220329161144299-73a4c7f1.png" tabindex="0"/><figcaption>image-20220329161144299</figcaption></figure><h3 id="二、-cloud与boot版本对应关系" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、-cloud与boot版本对应关系">#</a> 二、 cloud与boot版本对应关系</h3><figure><img class="lazy" alt="image-20220329164540295" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220329164540295-576a76f5.png" tabindex="0"/><figcaption>image-20220329164540295</figcaption></figure><h3 id="三、-dubbo对比" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、-dubbo对比">#</a> 三、 dubbo对比</h3><figure><img class="lazy" alt="image-20220329161102849" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220329161102849-d44ade71.png" tabindex="0"/><figcaption>image-20220329161102849</figcaption></figure><p><strong>相同点</strong>：Spring Cloud 与 Dubbo 都是实现微服务有效的工具。</p><p><strong>不同点</strong>：</p><p>1Dubbo 只是实现了服务治理，而 Spring Cloud 子项目分别覆盖了微服务架构下的众多部件。</p><p>2Dubbo 使用 RPC 通讯协议，Spring Cloud 使用 RESTful 完成通信，Dubbo 效率略高于 Spring Cloud。</p><p><strong>小结</strong></p><p>• 微服务就是将项目的各个模块拆分为可独立运行、部署、测试的架构设计风格。</p><p>• Spring 公司将其他公司中微服务架构常用的组件整合起来，并使用 SpringBoot 简化其开发、配置。称为 Spring Cloud。</p><p>• Spring Cloud 与 Dubbo都是实现微服务有效的工具。Dubbo 性能更好，而 Spring Cloud 功能更全面。Dubbo 已经融入到spingcloudAlibaba这一套</p><p><strong>本课程技术特点</strong>： 两套springcloud.</p><p>​ 1. 5年前的项目。springcloud netflix(eureka config hystrix) hoxton。会讲到。</p><p>​ 2. 新项目 springcloud alibaba(nacos sentinel)。也会讲到。</p><h2 id="第三章-停更-升级-替换" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第三章-停更-升级-替换">#</a> 第三章 停更/升级/替换</h2><p>红色不维护。</p><p>绿色是alibaba一套，推荐使用。</p><figure><img class="lazy" alt="image-20220329171255668" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220329171255668-cddd16e1.png" tabindex="0"/><figcaption>image-20220329171255668</figcaption></figure><h2 id="第四章-微服务架构编码构建" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第四章-微服务架构编码构建">#</a> 第四章 微服务架构编码构建</h2><figure><img class="lazy" alt="image-20220404103923982" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220404103923982-85c56e15.png" tabindex="0"/><figcaption>image-20220404103923982</figcaption></figure><h3 id="一、-搭建-provider-和-consumer-服务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、-搭建-provider-和-consumer-服务">#</a> 一、 搭建 Provider 和 Consumer 服务</h3><h4 id="_1、父工程-spring-cloud-parent" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、父工程-spring-cloud-parent">#</a> 1、父工程 spring-cloud-parent</h4><figure><img class="lazy" alt="image-20220404103149867" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220404103149867-f3234ca1.png" tabindex="0"/><figcaption>image-20220404103149867</figcaption></figure><p>使用utf-8编码</p><figure><img class="lazy" alt="image-20220404103334670" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220404103334670-9bfcbddd.png" tabindex="0"/><figcaption>image-20220404103334670</figcaption></figure><p>maven设置</p><figure><img class="lazy" alt="image-20220404103417399" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220404103417399-f4982f5b.png" tabindex="0"/><figcaption>image-20220404103417399</figcaption></figure><p>pom.xml</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;<br>         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>modelVersion<span class="hljs-symbol">&amp;gt;</span>4.0.0<span class="hljs-symbol">&amp;lt;</span>/modelVersion<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>com.ydlclass<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-parent<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.0.0<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!--spring boot 环境 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>parent<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-parent<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>2.2.11.RELEASE<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>relativePath/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/parent<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>properties<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>maven.compiler.source<span class="hljs-symbol">&amp;gt;</span>8<span class="hljs-symbol">&amp;lt;</span>/maven.compiler.source<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>maven.compiler.target<span class="hljs-symbol">&amp;gt;</span>8<span class="hljs-symbol">&amp;lt;</span>/maven.compiler.target<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>project.build.sourceEncoding<span class="hljs-symbol">&amp;gt;</span>UTF-8<span class="hljs-symbol">&amp;lt;</span>/project.build.sourceEncoding<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>project.reporting.outputEncoding<span class="hljs-symbol">&amp;gt;</span>UTF-8<span class="hljs-symbol">&amp;lt;</span>/project.reporting.outputEncoding<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/properties<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/project<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、提供者-eureka-provider" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、提供者-eureka-provider">#</a> 2、提供者 eureka-provider</h4><figure><img class="lazy" alt="image-20220330164728077" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220330164728077-62e821de.png" tabindex="0"/><figcaption>image-20220330164728077</figcaption></figure><p>搭建springboot工程：步骤把大象装冰箱有几步？ 工作中别问同事</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">1 pom 导包<br>2 配置文件<br>3 主启动类<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>pom.xml</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;<br>         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>parent<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-parent<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>com.ydlclass<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.0.0<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/parent<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>modelVersion<span class="hljs-symbol">&amp;gt;</span>4.0.0<span class="hljs-symbol">&amp;lt;</span>/modelVersion<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>eureka-provider<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>properties<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>maven.compiler.source<span class="hljs-symbol">&amp;gt;</span>8<span class="hljs-symbol">&amp;lt;</span>/maven.compiler.source<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>maven.compiler.target<span class="hljs-symbol">&amp;gt;</span>8<span class="hljs-symbol">&amp;lt;</span>/maven.compiler.target<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/properties<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-web<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/project<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application.yml</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">server:<br>  port: 8000<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>主启动类 ProviderApp</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.provider;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProviderApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(ProviderApplication.class,args);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Goods</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.provider.domain;<br><br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Goods</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<span class="hljs-comment">//商品id</span><br>    <span class="hljs-keyword">private</span> String title;<span class="hljs-comment">//商品名</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> price;<span class="hljs-comment">//价格</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> count;<span class="hljs-comment">//库存</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Goods</span><span class="hljs-params">(<span class="hljs-type">int</span> id, String title, <span class="hljs-type">double</span> price, <span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>        <span class="hljs-built_in">this</span>.title = title;<br>        <span class="hljs-built_in">this</span>.price = price;<br>        <span class="hljs-built_in">this</span>.count = count;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Goods&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;id=&quot;</span> + id +<br>                <span class="hljs-string">&quot;, title=&#x27;&quot;</span> + title + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, price=&quot;</span> + price +<br>                <span class="hljs-string">&quot;, count=&quot;</span> + count +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTitle</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> title;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTitle</span><span class="hljs-params">(String title)</span> &#123;<br>        <span class="hljs-built_in">this</span>.title = title;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> price;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(<span class="hljs-type">double</span> price)</span> &#123;<br>        <span class="hljs-built_in">this</span>.price = price;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCount</span><span class="hljs-params">(<span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-built_in">this</span>.count = count;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>GoodsController</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.provider.controller;<br><br><span class="hljs-keyword">import</span> com.ydlclass.provider.domain.Goods;<br><span class="hljs-keyword">import</span> com.ydlclass.provider.service.GoodsService;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/goods&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodsController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    GoodsService goodsService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;findById/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-type">int</span> id)</span>&#123;<br>        <span class="hljs-type">Goods</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> goodsService.findById(id);<br>        <span class="hljs-keyword">return</span> goods;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>GoodsService</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.provider.service;<br><br><span class="hljs-keyword">import</span> com.ydlclass.provider.dao.GoodsDao;<br><span class="hljs-keyword">import</span> com.ydlclass.provider.domain.Goods;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodsService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    GoodsDao goodsDao;<br><br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span>&#123;<br>        <span class="hljs-type">Goods</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> goodsDao.findById(id);<br>        <span class="hljs-keyword">return</span> goods;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>GoodsDao</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.provider.dao;<br><br><span class="hljs-keyword">import</span> com.ydlclass.provider.domain.Goods;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodsDao</span> &#123;<br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span>&#123;<br>        <span class="hljs-comment">//查数据库</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Goods</span>(id,<span class="hljs-string">&quot;手机&quot;</span>,<span class="hljs-number">2000</span>,<span class="hljs-number">100</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试：</strong></p><p>访问：<a href="http://localhost:8000/goods/findById/1" rel="noopener noreferrer" target="_blank">http://localhost:8000/goods/findById/1<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220330170647529" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220330170647529-2bf7e1c4.png" tabindex="0"/><figcaption>image-20220330170647529</figcaption></figure><h4 id="_3、消费者-eureka-consumer" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、消费者-eureka-consumer">#</a> 3、消费者 eureka-consumer</h4><figure><img class="lazy" alt="image-20220404111105516" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220404111105516-f67f7a56.png" tabindex="0"/><figcaption>image-20220404111105516</figcaption></figure><p>pom.xml</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;<br>         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>parent<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-parent<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>com.ydlclass<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.0-SNAPSHOT<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/parent<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>modelVersion<span class="hljs-symbol">&amp;gt;</span>4.0.0<span class="hljs-symbol">&amp;lt;</span>/modelVersion<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>eureka-consumer<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><br><br>    <span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>!--spring boot web--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-web<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/project<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Goods</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.consumer.domain;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 商品实体类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Goods</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">private</span> String title;<span class="hljs-comment">//商品标题</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> price;<span class="hljs-comment">//商品价格</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> count;<span class="hljs-comment">//商品库存</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Goods</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Goods</span><span class="hljs-params">(<span class="hljs-type">int</span> id, String title, <span class="hljs-type">double</span> price, <span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>        <span class="hljs-built_in">this</span>.title = title;<br>        <span class="hljs-built_in">this</span>.price = price;<br>        <span class="hljs-built_in">this</span>.count = count;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTitle</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> title;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTitle</span><span class="hljs-params">(String title)</span> &#123;<br>        <span class="hljs-built_in">this</span>.title = title;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> price;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(<span class="hljs-type">double</span> price)</span> &#123;<br>        <span class="hljs-built_in">this</span>.price = price;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCount</span><span class="hljs-params">(<span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-built_in">this</span>.count = count;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>OrderController</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.consumer.controller;<br><br><span class="hljs-keyword">import</span> com.ydlclass.consumer.domain.Goods;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/order&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/add/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;<br>        <span class="hljs-comment">//业务逻辑</span><br>        <span class="hljs-comment">//1查询商品</span><br>        <span class="hljs-comment">//2减库存</span><br>        <span class="hljs-comment">//3支付</span><br>        <span class="hljs-comment">//4物流</span><br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Goods</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试：</strong></p><p><a href="http://localhost:9000/order/add/2" rel="noopener noreferrer" target="_blank">http://localhost:9000/order/add/2<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220404112103333" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220404112103333-e5ed7fec.png" tabindex="0"/><figcaption>image-20220404112103333</figcaption></figure><h3 id="二、使用-resttemplate-完成远程调用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、使用-resttemplate-完成远程调用">#</a> 二、使用 RestTemplate 完成远程调用</h3><ul><li>Spring提供的一种简单便捷的模板类，用于在 java 代码里访问 restful 服务。</li><li>其功能与 HttpClient 类似，但是 RestTemplate 实现更优雅，使用更方便。</li></ul><p><strong>consumer工程中</strong></p><p>RestTemplateConfig</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.consumer.config;<br><br><br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestTemplateConfig</span> &#123;<br><br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title function_">restTemplate</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>OrderController</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.consumer.controller;<br><br><br><span class="hljs-keyword">import</span> com.ydlclass.consumer.domain.Goods;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 服务的调用方</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/order&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/goods/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">findGoodsById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-type">int</span> id)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;findGoodsById...&quot;</span>+id);<br><br><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">            //远程调用Goods服务中的findOne接口</span><br><span class="hljs-comment">            使用RestTemplate</span><br><span class="hljs-comment">            1. 定义Bean  restTemplate</span><br><span class="hljs-comment">            2. 注入Bean</span><br><span class="hljs-comment">            3. 调用方法</span><br><span class="hljs-comment">         */</span><br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://localhost:8000/goods/findOne/&quot;</span>+id;<br>        <span class="hljs-comment">// 3. 调用方法</span><br>        <span class="hljs-type">Goods</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> restTemplate.getForObject(url, Goods.class);<br><br><br>        <span class="hljs-keyword">return</span> goods;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试：</strong></p><h2 id="第五章-eureka服务注册与发现" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第五章-eureka服务注册与发现">#</a> 第五章 Eureka服务注册与发现</h2><h3 id="一、eureka" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、eureka">#</a> 一、Eureka</h3><p><strong>概念：</strong></p><p>• Eureka 是 Netflix 公司开源的一个服务注册与发现的组件 。</p><p>• Eureka 和其他 Netflix 公司的服务组件（例如负载均衡、熔断器、网关等） 一起，被 Spring Cloud 社区整合为Spring-Cloud-Netflix 模块。</p><p>• Eureka 包含两个组件：Eureka Server (注册中心) 和 Eureka Client (服务提供者、服务消费者)。</p><p><strong>操作：</strong></p><figure><img class="lazy" alt="image-20200606113829765" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20200606113829765-1648628667299-b0fb85d7.png" tabindex="0"/><figcaption>image-20200606113829765</figcaption></figure><h3 id="二、-搭建-eureka-server-服务" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、-搭建-eureka-server-服务">#</a> 二、 搭建 Eureka Server 服务</h3><p>（1）创建 eureka-server 模块</p><p>（2） 引入 SpringCloud 和 euraka-server 相关依赖</p><p>（3）完成 Eureka Server 相关配置</p><p>（4）启动该模块</p><p><strong>父工程 pom</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;<br>         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>modelVersion<span class="hljs-symbol">&amp;gt;</span>4.0.0<span class="hljs-symbol">&amp;lt;</span>/modelVersion<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>com.ydlclass<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-parent<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>packaging<span class="hljs-symbol">&amp;gt;</span>pom<span class="hljs-symbol">&amp;lt;</span>/packaging<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.0-SNAPSHOT<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>modules<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>module<span class="hljs-symbol">&amp;gt;</span>eureka-provider<span class="hljs-symbol">&amp;lt;</span>/module<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>module<span class="hljs-symbol">&amp;gt;</span>eureka-consumer<span class="hljs-symbol">&amp;lt;</span>/module<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>module<span class="hljs-symbol">&amp;gt;</span>eureka-server<span class="hljs-symbol">&amp;lt;</span>/module<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/modules<span class="hljs-symbol">&amp;gt;</span><br><br><br>    <span class="hljs-symbol">&amp;lt;</span>!--spring boot 环境 --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>parent<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-parent<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>2.1.0.RELEASE<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>relativePath/<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/parent<span class="hljs-symbol">&amp;gt;</span><br><br><br>    <span class="hljs-symbol">&amp;lt;</span>properties<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>project.build.sourceEncoding<span class="hljs-symbol">&amp;gt;</span>UTF-8<span class="hljs-symbol">&amp;lt;</span>/project.build.sourceEncoding<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>project.reporting.outputEncoding<span class="hljs-symbol">&amp;gt;</span>UTF-8<span class="hljs-symbol">&amp;lt;</span>/project.reporting.outputEncoding<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>java.version<span class="hljs-symbol">&amp;gt;</span>1.8<span class="hljs-symbol">&amp;lt;</span>/java.version<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--spring cloud 版本--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>spring-cloud.version<span class="hljs-symbol">&amp;gt;</span>Greenwich.RELEASE<span class="hljs-symbol">&amp;lt;</span>/spring-cloud.version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/properties<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>!--引入Spring Cloud 依赖--<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependencyManagement<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-dependencies<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>$&#123;spring-cloud.version&#125;<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>type<span class="hljs-symbol">&amp;gt;</span>pom<span class="hljs-symbol">&amp;lt;</span>/type<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>scope<span class="hljs-symbol">&amp;gt;</span>import<span class="hljs-symbol">&amp;lt;</span>/scope<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependencyManagement<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/project<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>eureka-server工程</strong></p><p>pom</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;<br>         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>parent<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-parent<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>com.ydlclass<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.0-SNAPSHOT<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/parent<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>modelVersion<span class="hljs-symbol">&amp;gt;</span>4.0.0<span class="hljs-symbol">&amp;lt;</span>/modelVersion<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>eureka-server<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><br><br><br>    <span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-web<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>!-- eureka-server --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-netflix-eureka-server<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br><br><br><span class="hljs-symbol">&amp;lt;</span>/project<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>EurekaApp</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.eureka;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-comment">// 启用EurekaServer</span><br><span class="hljs-meta">@EnableEurekaServer</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EurekaApp</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(EurekaApp.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8761</span><br><br><span class="hljs-comment"># eureka 配置</span><br><span class="hljs-comment"># eureka 一共有4部分 配置</span><br><span class="hljs-comment"># 1. dashboard:eureka的web控制台配置</span><br><span class="hljs-comment"># 2. server:eureka的服务端配置</span><br><span class="hljs-comment"># 3. client:eureka的客户端配置</span><br><span class="hljs-comment"># 4. instance:eureka的实例配置</span><br><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment"># 主机名</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka</span> <span class="hljs-comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span><br><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># 是否将自己的路径 注册到eureka上。eureka server 不需要的，eureka provider client 需要</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># 是否需要从eureka中抓取路径。eureka server 不需要的，eureka consumer client 需要</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**测试： ** 访问 localhost:8761</p><figure><img class="lazy" alt="image-20200611013357920" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20200611013357920-c3a39136.png" tabindex="0"/><figcaption>image-20200611013357920</figcaption></figure><h3 id="三、-改造-provider-和-consumer-称为-eureka-client" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、-改造-provider-和-consumer-称为-eureka-client">#</a> 三、 改造 Provider 和 Consumer 称为 Eureka Client</h3><p>① 引 eureka-client 相关依赖</p><p>② 完成 eureka client 相关配置</p><p>③ 启动 测试</p><p><strong>Provider工程</strong></p><p>pom</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- eureka-client --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ProviderApp</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableEurekaClient</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>application.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8001</span><br><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment"># 主机名</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:8761/eureka</span> <span class="hljs-comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">eureka-provider</span> <span class="hljs-comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Consumer</strong></p><p>pom</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- eureka-client --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ConsumerApp</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.consumer;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;<br><span class="hljs-keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;<br><br><span class="hljs-meta">@EnableDiscoveryClient</span> <span class="hljs-comment">// 激活DiscoveryClient</span><br><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerApp</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(ConsumerApp.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment"># 主机名</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:8761/eureka</span> <span class="hljs-comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">eureka-consumer</span> <span class="hljs-comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="四、-consumer-服务-通过从-eureka-server-中抓取-provider-地址-完成远程调用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、-consumer-服务-通过从-eureka-server-中抓取-provider-地址-完成远程调用">#</a> 四、 Consumer 服务 通过从 Eureka Server 中抓取 Provider 地址，完成远程调用</h3><p><strong>Consumer</strong></p><p>OrderController</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.consumer.controller;<br><br><span class="hljs-keyword">import</span> com.ydlclass.consumer.domain.Goods;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.cloud.client.ServiceInstance;<br><span class="hljs-keyword">import</span> org.springframework.cloud.client.discovery.DiscoveryClient;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/order&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    RestTemplate restTemplate;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DiscoveryClient discoveryClient;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/add/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;<br>        <span class="hljs-comment">//业务逻辑</span><br>        <span class="hljs-comment">//1查询商品</span><br>        <span class="hljs-comment">//2减库存</span><br>        <span class="hljs-comment">//3支付</span><br>        <span class="hljs-comment">//4物流</span><br>        <span class="hljs-comment">//直接调用</span><br>        <span class="hljs-comment">//String url=&quot;http://localhost:8000/goods/findById/&quot;+id;</span><br>        <span class="hljs-comment">//Goods goods = restTemplate.getForObject(url, Goods.class);</span><br><br>        <span class="hljs-comment">//服务发现</span><br>        List&amp;lt;ServiceInstance&amp;gt; instances = discoveryClient.getInstances(<span class="hljs-string">&quot;EUREKA-PROVIDER&quot;</span>);<br>        <span class="hljs-keyword">if</span>(instances==<span class="hljs-literal">null</span>||instances.size()&amp;lt;=<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-comment">//通过某个策略拿到一个实例</span><br>        <span class="hljs-type">ServiceInstance</span> <span class="hljs-variable">serviceInstance</span> <span class="hljs-operator">=</span> instances.get(<span class="hljs-number">0</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">host</span> <span class="hljs-operator">=</span> serviceInstance.getHost();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> serviceInstance.getPort();<br>        System.out.println(host);<br>        System.out.println(port);<br><br>        String url=<span class="hljs-string">&quot;http://&quot;</span>+host+<span class="hljs-string">&quot;:&quot;</span>+port+<span class="hljs-string">&quot;/goods/findById/&quot;</span>+id;<br>        <span class="hljs-type">Goods</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> restTemplate.getForObject(url, Goods.class);<br><br>        <span class="hljs-keyword">return</span> goods;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="五、-euraka配置详解" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#五、-euraka配置详解">#</a> 五、 Euraka配置详解</h3><p>Eureka包含四个部分的配置</p><ul><li>instance：当前Eureka Instance实例信息配置</li><li>client：Eureka Client客户端特性配置</li><li>server：Eureka Server注册中心特性配置</li><li>dashboard：Eureka Server注册中心仪表盘配置</li></ul><h4 id="_1、实例信息配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、实例信息配置">#</a> 1、实例信息配置</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">eureka:</span><br>    <span class="hljs-attr">instance:</span><br>        <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment"># 主机名</span><br>        <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-comment"># 是否将自己的ip注册到eureka中，默认false 注册 主机名</span><br>        <span class="hljs-attr">ip-address:</span> <span class="hljs-comment"># 设置当前实例ip</span><br>        <span class="hljs-attr">instance-id:</span> <span class="hljs-comment"># 修改instance-id显示</span><br>        <span class="hljs-attr">lease-renewal-interval-in-seconds:</span> <span class="hljs-number">30</span> <span class="hljs-comment"># 每一次eureka client 向 eureka server发送心跳的时间间隔</span><br>        <span class="hljs-attr">lease-expiration-duration-in-seconds:</span> <span class="hljs-number">90</span> <span class="hljs-comment"># 如果90秒内eureka server没有收到eureka client的心跳包，则剔除该服务</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Eureka Instance的配置信息全部保存在org.springframework.cloud.netflix.eureka.EurekaInstanceConfigBean配置类里，实际上它是com.netflix.appinfo.EurekaInstanceConfig的实现类，替代了netflix的com.netflix.appinfo.CloudInstanceConfig的默认实现。</p><p>Eureka Instance的配置信息全部以eureka.instance.xxx的格式配置。</p><p><strong>配置列表</strong></p><ul><li>appname = unknown</li></ul><p>应用名，首先获取spring.application.name的值，如果取值为空，则取默认unknown。</p><ul><li>appGroupName = null</li></ul><p>应用组名</p><ul><li>instanceEnabledOnit = false</li></ul><p>实例注册到Eureka上是，是否立刻开启通讯。有时候应用在准备好服务之前需要一些预处理。</p><ul><li>nonSecurePort = 80</li></ul><p>非安全的端口</p><ul><li>securePort = 443</li></ul><p>安全端口</p><ul><li>nonSecurePortEnabled = true</li></ul><p>是否开启非安全端口通讯</p><ul><li>securePortEnabled = false</li></ul><p>是否开启安全端口通讯</p><ul><li>leaseRenewalIntervalInSeconds = 30</li></ul><p>实例续约间隔时间</p><ul><li>leaseExpirationDurationInSeconds = 90</li></ul><p>实例超时时间，表示最大leaseExpirationDurationInSeconds秒后没有续约，Server就认为他不可用了，随之就会将其剔除。</p><ul><li>virtualHostName = unknown</li></ul><p>虚拟主机名，首先获取spring.application.name的值，如果取值为空，则取默认unknown。</p><ul><li>instanceId</li></ul><p>注册到eureka上的唯一实例ID，不能与相同appname的其他实例重复。</p><ul><li>secureVirtualHostName = unknown</li></ul><p>安全虚拟主机名，首先获取spring.application.name的值，如果取值为空，则取默认unknown。</p><ul><li>metadataMap = new HashMap();</li></ul><p>实例元数据，可以供其他实例使用。比如spring-boot-admin在监控时，获取实例的上下文和端口。</p><ul><li>dataCenterInfo = new MyDataCenterInfo(DataCenterInfo.Name.MyOwn);</li></ul><p>实例部署的数据中心。如AWS、MyOwn。</p><ul><li>ipAddress=null</li></ul><p>实例的IP地址</p><ul><li>statusPageUrlPath = "/actuator/info"</li></ul><p>实例状态页相对url</p><ul><li>statusPageUrl = null</li></ul><p>实例状态页绝对URL</p><ul><li>homePageUrlPath = "/"</li></ul><p>实例主页相对URL</p><ul><li>homePageUrl = null</li></ul><p>实例主页绝对URL</p><ul><li>healthCheckUrlUrlPath = "/actuator/health"</li></ul><p>实例健康检查相对URL</p><ul><li>healthCheckUrl = null</li></ul><p>实例健康检查绝对URL</p><ul><li>secureHealthCheckUrl = null</li></ul><p>实例安全的健康检查绝对URL</p><ul><li>namespace = "eureka"</li></ul><p>配置属性的命名空间（Spring Cloud中被忽略）</p><ul><li>hostname = null</li></ul><p>主机名,不配置的时候讲根据操作系统的主机名来获取</p><ul><li>preferIpAddress = false</li></ul><p>是否优先使用IP地址作为主机名的标识</p><h4 id="_2、客户端特性配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、客户端特性配置">#</a> 2、客户端特性配置</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">eureka:</span><br>    <span class="hljs-attr">client:</span><br>        <span class="hljs-attr">service-url:</span><br>             <span class="hljs-comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span><br>            <span class="hljs-attr">defaultZone:</span> <br>        <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-comment"># 是否将自己的路径 注册到eureka上。</span><br>        <span class="hljs-attr">fetch-registry:</span> <span class="hljs-comment"># 是否需要从eureka中抓取数据。</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Eureka Client客户端特性配置是对作为Eureka客户端的特性配置，包括Eureka注册中心，本身也是一个Eureka Client。</p><p>Eureka Client特性配置全部在org.springframework.cloud.netflix.eureka.EurekaClientConfigBean中，实际上它是com.netflix.discovery.EurekaClientConfig的实现类，替代了netxflix的默认实现。</p><p>Eureka Client客户端特性配置全部以eureka.client.xxx的格式配置。</p><p><strong>配置列表</strong></p><ul><li>enabled=true</li></ul><p>是否启用Eureka client。</p><ul><li>registryFetchIntervalSeconds=30</li></ul><p>定时从Eureka Server拉取服务注册信息的间隔时间</p><ul><li>instanceInfoReplicationIntervalSeconds=30</li></ul><p>定时将实例信息（如果变化了）复制到Eureka Server的间隔时间。（InstanceInfoReplicator线程）</p><ul><li>initialInstanceInfoReplicationIntervalSeconds=40</li></ul><p>首次将实例信息复制到Eureka Server的延迟时间。（InstanceInfoReplicator线程）</p><ul><li>eurekaServiceUrlPollIntervalSeconds=300</li></ul><p>拉取Eureka Server地址的间隔时间（Eureka Server有可能增减）</p><ul><li>proxyPort=null</li></ul><p>Eureka Server的代理端口</p><ul><li>proxyHost=null</li></ul><p>Eureka Server的代理主机名</p><ul><li>proxyUserName=null</li></ul><p>Eureka Server的代理用户名</p><ul><li>proxyPassword=null</li></ul><p>Eureka Server的代理密码</p><ul><li>eurekaServerReadTimeoutSeconds=8</li></ul><p>从Eureka Server读取信息的超时时间</p><ul><li>eurekaServerConnectTimeoutSeconds=5</li></ul><p>连接Eureka Server的超时时间</p><ul><li>backupRegistryImpl=null</li></ul><p>Eureka Client第一次启动时获取服务注册信息的调用的回溯实现。Eureka Client启动时首次会检查有没有BackupRegistry的实现类，如果有实现类，则优先从这个实现类里获取服务注册信息。</p><ul><li>eurekaServerTotalConnections=200</li></ul><p>Eureka client连接Eureka Server的链接总数</p><ul><li>eurekaServerTotalConnectionsPerHost=50</li></ul><p>Eureka client连接单台Eureka Server的链接总数</p><ul><li>eurekaServerURLContext=null</li></ul><p>当Eureka server的列表在DNS中时，Eureka Server的上下文路径。如<a href="http://xxxx/eureka%E3%80%82" rel="noopener noreferrer" target="_blank">http://xxxx/eureka。<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ul><li>eurekaServerPort=null</li></ul><p>当Eureka server的列表在DNS中时，Eureka Server的端口。</p><ul><li>eurekaServerDNSName=null</li></ul><p>当Eureka server的列表在DNS中时，且要通过DNSName获取Eureka Server列表时，DNS名字。</p><ul><li>region="us-east-1"</li></ul><p>实例所属区域。</p><ul><li>eurekaConnectionIdleTimeoutSeconds = 30</li></ul><p>Eureka Client和Eureka Server之间的Http连接的空闲超时时间。</p><ul><li>heartbeatExecutorThreadPoolSize=2</li></ul><p>心跳（续约）执行器线程池大小。</p><ul><li>heartbeatExecutorExponentialBackOffBound=10</li></ul><p>心跳执行器在续约过程中超时后的再次执行续约的最大延迟倍数。默认最大延迟时间=10 * eureka.instance.leaseRenewalIntervalInSeconds</p><ul><li>cacheRefreshExecutorThreadPoolSize=2</li></ul><p>cacheRefreshExecutord的线程池大小（获取注册信息）</p><ul><li>cacheRefreshExecutorExponentialBackOffBound=10</li></ul><p>cacheRefreshExecutord的再次执行的最大延迟倍数。默认最大延迟时间=10 *eureka.client.registryFetchIntervalSeconds</p><ul><li>serviceUrl= new HashMap();serviceUrl.put(DEFAULT_ZONE, DEFAULT_URL);</li></ul><p>Eureka Server的分区地址。默认添加了一个defualtZone。也就是最常用的配置eureka.client.service-url.defaultZone=xxx</p><ul><li>registerWithEureka=true</li></ul><p>是否注册到Eureka Server。</p><ul><li>preferSameZoneEureka=true</li></ul><p>是否使用相同Zone下的Eureka server。</p><ul><li>logDeltaDiff=false</li></ul><p>是否记录Eureka Server和Eureka Client之间注册信息的差异</p><ul><li>disableDelta=false</li></ul><p>是否开启增量同步注册信息。</p><ul><li>fetchRemoteRegionsRegistry=null</li></ul><p>获取注册服务的远程地区，以逗号隔开。</p><ul><li>availabilityZones=new HashMap()</li></ul><p>可用分区列表。用逗号隔开。</p><ul><li>filterOnlyUpInstances = true</li></ul><p>是否只拉取UP状态的实例。</p><ul><li>fetchRegistry=true</li></ul><p>是否拉取注册信息。</p><ul><li>shouldUnregisterOnShutdown = true</li></ul><p>是否在停止服务的时候向Eureka Server发起Cancel指令。</p><ul><li>shouldEnforceRegistrationAtInit = false</li></ul><p>是否在初始化过程中注册服务。</p><h4 id="_3、注册中心端配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、注册中心端配置">#</a> 3、注册中心端配置</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">eureka:</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-comment">#是否开启自我保护机制，默认true</span><br>        <span class="hljs-attr">enable-self-preservation:</span> <br>        <span class="hljs-attr">eviction-interval-timer-in-ms:</span> <span class="hljs-number">120</span> <span class="hljs-number">2</span><span class="hljs-string">月#清理间隔（单位毫秒，默认是60*1000）</span><br>    <span class="hljs-attr">instance:</span><br>        <span class="hljs-attr">lease-renewal-interval-in-seconds:</span> <span class="hljs-number">30</span> <span class="hljs-comment"># 每一次eureka client 向 eureka server发送心跳的时间间隔</span><br>        <span class="hljs-attr">lease-expiration-duration-in-seconds:</span> <span class="hljs-number">90</span> <span class="hljs-comment"># 如果90秒内eureka server没有收到eureka client的心跳包，则剔除该服务        </span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Eureka Server注册中心端的配置是对注册中心的特性配置。Eureka Server的配置全部在org.springframework.cloud.netflix.eureka.server.EurekaServerConfigBean里，实际上它是com.netflix.eureka.EurekaServerConfig的实现类，替代了netflix的默认实现。</p><p>Eureka Server的配置全部以eureka.server.xxx的格式进行配置。</p><p><strong>配置列表</strong></p><ul><li>enableSelfPreservation=true</li></ul><p>是否开启自我保护</p><ul><li>renewalPercentThreshold = 0.85</li></ul><p>自我保护续约百分比阀值因子。如果实际续约数小于续约数阀值，则开启自我保护</p><ul><li>renewalThresholdUpdateIntervalMs = 15 * 60 * 1000</li></ul><p>续约数阀值更新频率。</p><ul><li>peerEurekaNodesUpdateIntervalMs = 10 * 60 * 1000</li></ul><p>Eureka Server节点更新频率。</p><ul><li>enableReplicatedRequestCompression = false</li></ul><p>是否启用复制请求压缩。</p><ul><li>waitTimeInMsWhenSyncEmpty=5 * 60 * 1000</li></ul><p>当从其他节点同步实例信息为空时等待的时间。</p><ul><li>peerNodeConnectTimeoutMs=200</li></ul><p>节点间连接的超时时间。</p><ul><li>peerNodeReadTimeoutMs=200</li></ul><p>节点间读取信息的超时时间。</p><ul><li>peerNodeTotalConnections=1000</li></ul><p>节点间连接总数。</p><ul><li>peerNodeTotalConnectionsPerHost = 500;</li></ul><p>单个节点间连接总数。</p><ul><li>peerNodeConnectionIdleTimeoutSeconds = 30;</li></ul><p>节点间连接空闲超时时间。</p><ul><li>retentionTimeInMSInDeltaQueue = 3 * MINUTES;</li></ul><p>增量队列的缓存时间。</p><ul><li>deltaRetentionTimerIntervalInMs = 30 * 1000;</li></ul><p>清理增量队列中过期的频率。</p><ul><li>evictionIntervalTimerInMs = 60 * 1000;</li></ul><p>剔除任务频率。</p><ul><li>responseCacheAutoExpirationInSeconds = 180;</li></ul><p>注册列表缓存超时时间（当注册列表没有变化时）</p><ul><li>responseCacheUpdateIntervalMs = 30 * 1000;</li></ul><p>注册列表缓存更新频率。</p><ul><li>useReadOnlyResponseCache = true;</li></ul><p>是否开启注册列表的二级缓存。</p><ul><li>disableDelta=false。</li></ul><p>是否为client提供增量信息。</p><ul><li>maxThreadsForStatusReplication = 1;</li></ul><p>状态同步的最大线程数。</p><ul><li>maxElementsInStatusReplicationPool = 10000;</li></ul><p>状态同步队列的最大容量。</p><ul><li>syncWhenTimestampDiffers = true;</li></ul><p>当时间差异时是否同步。</p><ul><li>registrySyncRetries = 0;</li></ul><p>注册信息同步重试次数。</p><ul><li>registrySyncRetryWaitMs = 30 * 1000;</li></ul><p>注册信息同步重试期间的时间间隔。</p><ul><li>maxElementsInPeerReplicationPool = 10000;</li></ul><p>节点间同步事件的最大容量。</p><ul><li>minThreadsForPeerReplication = 5;</li></ul><p>节点间同步的最小线程数。</p><ul><li>maxThreadsForPeerReplication = 20;</li></ul><p>节点间同步的最大线程数。</p><ul><li>maxTimeForReplication = 30000;</li></ul><p>节点间同步的最大时间，单位为毫秒。</p><ul><li>disableDeltaForRemoteRegions = false；</li></ul><p>是否启用远程区域增量。</p><ul><li>remoteRegionConnectTimeoutMs = 1000;</li></ul><p>远程区域连接超时时间。</p><ul><li>remoteRegionReadTimeoutMs = 1000;</li></ul><p>远程区域读取超时时间。</p><ul><li>remoteRegionTotalConnections = 1000;</li></ul><p>远程区域最大连接数</p><ul><li>remoteRegionTotalConnectionsPerHost = 500;</li></ul><p>远程区域单机连接数</p><ul><li>remoteRegionConnectionIdleTimeoutSeconds = 30;</li></ul><p>远程区域连接空闲超时时间。</p><ul><li>remoteRegionRegistryFetchInterval = 30;</li></ul><p>远程区域注册信息拉取频率。</p><ul><li>remoteRegionFetchThreadPoolSize = 20;</li></ul><p>远程区域注册信息线程数。</p><h4 id="_4、仪表盘配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_4、仪表盘配置">#</a> 4、仪表盘配置</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">eureka:</span><br>    <span class="hljs-attr">dashboard:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 是否启用eureka web控制台</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">/</span> <span class="hljs-comment"># 设置eureka web控制台默认访问路径</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注册中心仪表盘的配置主要是控制注册中心的可视化展示。以eureka.dashboard.xxx的格式配置。</p><ul><li>path="/"</li></ul><p>仪表盘访问路径</p><ul><li>enabled=true</li></ul><p>是否启用仪表盘</p><p><strong>改造 provider</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8001</span><br><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment"># 主机名</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 将当前实例的ip注册到eureka server 中。默认是false 注册主机名</span><br>    <span class="hljs-attr">ip-address:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> <span class="hljs-comment"># 设置当前实例的ip</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;eureka.instance.ip-address&#125;:$&#123;spring.application.name&#125;:$&#123;server.port&#125;</span> <span class="hljs-comment"># 设置web控制台显示的 实例id</span><br>    <span class="hljs-attr">lease-renewal-interval-in-seconds:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># 每隔3 秒发一次心跳包</span><br>    <span class="hljs-attr">lease-expiration-duration-in-seconds:</span> <span class="hljs-number">9</span> <span class="hljs-comment"># 如果9秒没有发心跳包，服务器呀，你把我干掉吧~</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:8761/eureka</span> <span class="hljs-comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">eureka-provider</span> <span class="hljs-comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>consumer</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span><br><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment"># 主机名</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:8761/eureka</span> <span class="hljs-comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">eureka-consumer</span> <span class="hljs-comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>server</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8761</span><br><br><span class="hljs-comment"># eureka 配置</span><br><span class="hljs-comment"># eureka 一共有4部分 配置</span><br><span class="hljs-comment"># 1. dashboard:eureka的web控制台配置</span><br><span class="hljs-comment"># 2. server:eureka的服务端配置</span><br><span class="hljs-comment"># 3. client:eureka的客户端配置</span><br><span class="hljs-comment"># 4. instance:eureka的实例配置</span><br><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment"># 主机名</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka</span> <span class="hljs-comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># 是否将自己的路径 注册到eureka上。eureka server 不需要的，eureka provider client 需要</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># 是否需要从eureka中抓取路径。eureka server 不需要的，eureka consumer client 需要</span><br>  <span class="hljs-attr">server:</span><br>    <span class="hljs-attr">enable-self-preservation:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># 关闭自我保护机制</span><br>    <span class="hljs-attr">eviction-interval-timer-in-ms:</span> <span class="hljs-number">3000</span> <span class="hljs-comment"># 检查服务的时间间隔</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="六、高可用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#六、高可用">#</a> 六、高可用</h3><figure><img class="lazy" alt="image-20220406114821846" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220406114821846-5d110f1f.png" tabindex="0"/><figcaption>image-20220406114821846</figcaption></figure><ol><li><p>准备两个Eureka Server</p></li><li><p>分别进行配置，<strong>相互注册</strong></p></li><li><p>Eureka Client 分别注册到这两个 Eureka Server中</p></li></ol><p><strong>创建eureka-server1</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8761</span><br><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">eureka-server1</span> <span class="hljs-comment"># 主机名</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://eureka-server2:8762/eureka</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 是否将自己的路径 注册到eureka上。eureka server 不需要的，eureka provider client 需要</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 是否需要从eureka中抓取路径。eureka server 不需要的，eureka consumer client 需要</span><br><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">eureka-server-ha</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>创建eureka-server2</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8762</span><br><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">eureka-server2</span> <span class="hljs-comment"># 主机名</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://eureka-server1:8761/eureka</span><br><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 是否将自己的路径 注册到eureka上。eureka server 不需要的，eureka provider client 需要</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 是否需要从eureka中抓取路径。eureka server 不需要的，eureka consumer client 需要</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">eureka-server-ha</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>修改</strong>：C:\Windows\System32\drivers\etc\hosts</p><p>127.0.0.1 eureka-server1 127.0.0.1 eureka-server2</p><figure><img class="lazy" alt="image-20220406144138369" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220406144138369-3a3af0a9.png" tabindex="0"/><figcaption>image-20220406144138369</figcaption></figure><p>测试：</p><p>provider</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8001</span><br><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment"># 主机名</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 将当前实例的ip注册到eureka server 中。默认是false 注册主机名</span><br>    <span class="hljs-attr">ip-address:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> <span class="hljs-comment"># 设置当前实例的ip</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;eureka.instance.ip-address&#125;:$&#123;spring.application.name&#125;:$&#123;server.port&#125;</span> <span class="hljs-comment"># 设置web控制台显示的 实例id</span><br>    <span class="hljs-attr">lease-renewal-interval-in-seconds:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># 每隔3 秒发一次心跳包</span><br>    <span class="hljs-attr">lease-expiration-duration-in-seconds:</span> <span class="hljs-number">9</span> <span class="hljs-comment"># 如果9秒没有发心跳包，服务器呀，你把我干掉吧~</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://eureka-server1:8761/eureka,http://eureka-server2:8762/eureka</span> <span class="hljs-comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">eureka-provider</span> <span class="hljs-comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>consumer</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span><br><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment"># 主机名</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span>  <span class="hljs-string">http://eureka-server1:8761/eureka,http://eureka-server2:8762/eureka</span>  <span class="hljs-comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">eureka-consumer</span> <span class="hljs-comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>访问：<a href="http://localhost:9000/order/add/4" rel="noopener noreferrer" target="_blank">http://localhost:9000/order/add/4<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220406144153992" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220406144153992-acdf6713.png" tabindex="0"/><figcaption>image-20220406144153992</figcaption></figure><p>高可用测试：停掉一个eureka,依然可以访问consumer。</p><p>eureka不更新了，所以淘汰了。</p><h2 id="第六章-zookeeper服务注册与发现" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第六章-zookeeper服务注册与发现">#</a> 第六章 Zookeeper服务注册与发现</h2><figure><img class="lazy" alt="image-20220406194741473" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220406194741473-cc3720e9.png" tabindex="0"/><figcaption>image-20220406194741473</figcaption></figure><p>有的老项目以前是dubbo，升级到微服务，使用zookeeper做注册中心。</p><p>zookeeper是一个分布式协调工具，可以实现注册中心功能。dubbo,大数据组件hadoop,hive,kafka。</p><p><strong>实质</strong>：注册中心换成zk</p><p>1下载：<a href="https://zookeeper.apache.org/" rel="noopener noreferrer" target="_blank">https://zookeeper.apache.org/<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220406152809933" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220406152809933-e8b336fb.png" tabindex="0"/><figcaption>image-20220406152809933</figcaption></figure><p>zoo.cfg</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs text"># The number of milliseconds of each tick<br>tickTime=2000<br># The number of ticks that the initial <br># synchronization phase can take<br>initLimit=10<br># The number of ticks that can pass between <br># sending a request and getting an acknowledgement<br>syncLimit=5<br># the directory where the snapshot is stored.<br># do not use /tmp for storage, /tmp here is just <br># example sakes.<br>dataDir=F:/apache-zookeeper-3.5.6-bin/data<br># the port at which the clients will connect<br>clientPort=2181<br># the maximum number of client connections.<br># increase this if you need to handle more clients<br>#maxClientCnxns=60<br>#<br># Be sure to read the maintenance section of the <br># administrator guide before turning on autopurge.<br>#<br># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance<br>#<br># The number of snapshots to retain in dataDir<br>#autopurge.snapRetainCount=3<br># Purge task interval in hours<br># Set to &quot;0&quot; to disable auto purge feature<br>#autopurge.purgeInterval=1<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动 bin目录下</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">zkServer.cmd<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><figure><img class="lazy" alt="image-20220406153622431" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220406153622431-66776d12.png" tabindex="0"/><figcaption>image-20220406153622431</figcaption></figure><p>2zookeeper-provider</p><p>pom</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs text">&amp;lt;artifactId&amp;gt;zookeeper-provider&amp;lt;/artifactId&amp;gt;<br><br>&amp;lt;dependencies&amp;gt;<br>    &amp;lt;!--springcloud 整合 zookeeper 组件--&amp;gt;<br>    &amp;lt;dependency&amp;gt;<br>        &amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;<br>        &amp;lt;!--zk发现--&amp;gt;<br>        &amp;lt;artifactId&amp;gt;spring-cloud-starter-zookeeper-discovery&amp;lt;/artifactId&amp;gt;<br>        &amp;lt;exclusions&amp;gt;<br>            &amp;lt;exclusion&amp;gt;<br>                &amp;lt;groupId&amp;gt;org.apache.zookeeper&amp;lt;/groupId&amp;gt;<br>                &amp;lt;artifactId&amp;gt;zookeeper&amp;lt;/artifactId&amp;gt;<br>            &amp;lt;/exclusion&amp;gt;<br>        &amp;lt;/exclusions&amp;gt;<br>    &amp;lt;/dependency&amp;gt;<br>    &amp;lt;dependency&amp;gt;<br>        &amp;lt;groupId&amp;gt;org.apache.zookeeper&amp;lt;/groupId&amp;gt;<br>        &amp;lt;artifactId&amp;gt;zookeeper&amp;lt;/artifactId&amp;gt;<br>        &amp;lt;version&amp;gt;3.4.9&amp;lt;/version&amp;gt;<br>        &amp;lt;exclusions&amp;gt;<br>            &amp;lt;exclusion&amp;gt;<br>                &amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;<br>                &amp;lt;artifactId&amp;gt;slf4j-log4j12&amp;lt;/artifactId&amp;gt;<br>            &amp;lt;/exclusion&amp;gt;<br>        &amp;lt;/exclusions&amp;gt;<br>    &amp;lt;/dependency&amp;gt;<br><br>    &amp;lt;dependency&amp;gt;<br>        &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;<br>        &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;<br>    &amp;lt;/dependency&amp;gt;<br><br>&amp;lt;/dependencies&amp;gt;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>yml</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs text">server:<br>  port: 8004<br><br>spring:<br>  application:<br>    name: zookeeper-provider<br>  cloud:<br>    zookeeper:<br>      connect-string: 127.0.0.1:2181 # zk地址<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>主启动类</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs text">package com.ydlclass.zk;<br><br>import org.springframework.boot.SpringApplication;<br>import org.springframework.boot.autoconfigure.SpringBootApplication;<br>import org.springframework.cloud.client.discovery.EnableDiscoveryClient;<br><br>/**<br> * @Created by IT李老师<br> * 公主号 “元动力课堂”<br> * 个人微 itlils<br> */<br>@SpringBootApplication<br>@EnableDiscoveryClient //开启发现客户端<br>public class ProviderApp &#123;<br>    public static void main(String[] args) &#123;<br>        SpringApplication.run(ProviderApp.class,args);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>业务逻辑代码直接复制粘贴过来</p><figure><img class="lazy" alt="image-20220406172259585" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220406172259585-d9bdd516.png" tabindex="0"/><figcaption>image-20220406172259585</figcaption></figure><p>3zookeeper-consumer</p><p>pom</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs text">&amp;lt;artifactId&amp;gt;zookeeper-consumer&amp;lt;/artifactId&amp;gt;<br><br> &amp;lt;properties&amp;gt;<br>     &amp;lt;maven.compiler.source&amp;gt;8&amp;lt;/maven.compiler.source&amp;gt;<br>     &amp;lt;maven.compiler.target&amp;gt;8&amp;lt;/maven.compiler.target&amp;gt;<br> &amp;lt;/properties&amp;gt;<br><br> &amp;lt;dependencies&amp;gt;<br>     &amp;lt;!--springcloud 整合 zookeeper 组件--&amp;gt;<br>     &amp;lt;dependency&amp;gt;<br>         &amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;<br>         &amp;lt;!--zk发现--&amp;gt;<br>         &amp;lt;artifactId&amp;gt;spring-cloud-starter-zookeeper-discovery&amp;lt;/artifactId&amp;gt;<br>         &amp;lt;exclusions&amp;gt;<br>             &amp;lt;exclusion&amp;gt;<br>                 &amp;lt;groupId&amp;gt;org.apache.zookeeper&amp;lt;/groupId&amp;gt;<br>                 &amp;lt;artifactId&amp;gt;zookeeper&amp;lt;/artifactId&amp;gt;<br>             &amp;lt;/exclusion&amp;gt;<br>         &amp;lt;/exclusions&amp;gt;<br>     &amp;lt;/dependency&amp;gt;<br>     &amp;lt;dependency&amp;gt;<br>         &amp;lt;groupId&amp;gt;org.apache.zookeeper&amp;lt;/groupId&amp;gt;<br>         &amp;lt;artifactId&amp;gt;zookeeper&amp;lt;/artifactId&amp;gt;<br>         &amp;lt;version&amp;gt;3.5.6&amp;lt;/version&amp;gt;<br>         &amp;lt;exclusions&amp;gt;<br>             &amp;lt;exclusion&amp;gt;<br>                 &amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;<br>                 &amp;lt;artifactId&amp;gt;slf4j-log4j12&amp;lt;/artifactId&amp;gt;<br>             &amp;lt;/exclusion&amp;gt;<br>         &amp;lt;/exclusions&amp;gt;<br>     &amp;lt;/dependency&amp;gt;<br><br>     &amp;lt;dependency&amp;gt;<br>         &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;<br>         &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;<br>     &amp;lt;/dependency&amp;gt;<br><br> &amp;lt;/dependencies&amp;gt;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>yml</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs text">server:<br>  port: 8005<br><br>spring:<br>  application:<br>    name: zookeeper-consumer<br>  cloud:<br>    zookeeper:<br>      connect-string: 127.0.0.1:2181 # zk地址<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动类</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs text">package com.ydlclass.zk;<br><br>import org.springframework.boot.SpringApplication;<br>import org.springframework.boot.autoconfigure.SpringBootApplication;<br>import org.springframework.cloud.client.discovery.EnableDiscoveryClient;<br><br>/**<br> * @Created by IT李老师<br> * 公主号 “元动力课堂”<br> * 个人微 itlils<br> */<br>@SpringBootApplication<br>@EnableDiscoveryClient<br>public class ConsumerApp &#123;<br>    public static void main(String[] args) &#123;<br>        SpringApplication.run(ConsumerApp.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>业务逻辑代码直接复制粘贴过来</p><figure><img class="lazy" alt="image-20220406185656845" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220406185656845-d3703bb1.png" tabindex="0"/><figcaption>image-20220406185656845</figcaption></figure><p>controller只改一个</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">List&amp;lt;ServiceInstance&amp;gt; instances = discoveryClient.getInstances(&quot;zookeeper-provider&quot;);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>测试：<a href="http://localhost:8005/order/add/5" rel="noopener noreferrer" target="_blank">http://localhost:8005/order/add/5<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220407144912417" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220407144912417-fd30484b.png" tabindex="0"/><figcaption>image-20220407144912417</figcaption></figure><h2 id="第七章-consul服务注册与发现" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第七章-consul服务注册与发现">#</a> 第七章 Consul服务注册与发现</h2><figure><img class="lazy" alt="image-20220407161804433" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220407161804433-7424151c.png" tabindex="0"/><figcaption>image-20220407161804433</figcaption></figure><h3 id="一、-是什么" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、-是什么">#</a> 一、 是什么：</h3><ul><li>Consul 是由 HashiCorp 基于 GoLanguage 语言开发的，支持多数据中心，分布式高可用的服务发布和注册服务软件。</li><li>用于实现分布式系统的服务发现与配置。</li><li>使用起来也较 为简单。具有天然可移植性(支持Linux、windows和Mac OS X)；安装包仅包含一个可执行文件，方便部署 。</li><li>Consul官网：<a href="https://www.consul.io/" rel="noopener noreferrer" target="_blank">https://www.consul.io/<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> Consul中文文档：<a href="https://www.springcloud.cc/spring-cloud-consul.html" rel="noopener noreferrer" target="_blank">https://www.springcloud.cc/spring-cloud-consul.html<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h3 id="二、-怎么用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、-怎么用">#</a> 二、 怎么用：</h3><h4 id="_1、-准备" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、-准备">#</a> 1、 准备</h4><figure><img class="lazy" alt="image-20220407161630689" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220407161630689-ac7c0b2d.png" tabindex="0"/><figcaption>image-20220407161630689</figcaption></figure><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">consul.exe agent -dev<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><figure><img class="lazy" alt="image-20220407161746354" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220407161746354-b746e58c.png" tabindex="0"/><figcaption>image-20220407161746354</figcaption></figure><h4 id="_2、-搭建-consul-provider" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、-搭建-consul-provider">#</a> 2、 搭建 consul-provider</h4><p>pom</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs text">&amp;lt;dependencies&amp;gt;<br>    &amp;lt;dependency&amp;gt;<br>        &amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;<br>        &amp;lt;artifactId&amp;gt;spring-cloud-starter-consul-discovery&amp;lt;/artifactId&amp;gt;<br>    &amp;lt;/dependency&amp;gt;<br><br>    &amp;lt;dependency&amp;gt;<br>        &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;<br>        &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;<br>    &amp;lt;/dependency&amp;gt;<br><br>&amp;lt;/dependencies&amp;gt;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>yml</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs text">server:<br>  port: 8006<br><br>spring:<br>  application:<br>    name: consul-provider<br>  cloud:<br>    consul:<br>      host: 127.0.0.1<br>      port: 8500<br>      discovery:<br>        service-name: $&#123;spring.application.name&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动类</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs text">package com.ydlclass.consul;<br><br>import org.springframework.boot.SpringApplication;<br>import org.springframework.boot.autoconfigure.SpringBootApplication;<br>import org.springframework.cloud.client.discovery.EnableDiscoveryClient;<br><br>/**<br> * @Created by IT李老师<br> * 公主号 “元动力课堂”<br> * 个人微 itlils<br> */<br>@SpringBootApplication<br>@EnableDiscoveryClient<br>public class ProviderApp &#123;<br>    public static void main(String[] args) &#123;<br>        SpringApplication.run(ProviderApp.class,args);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>业务逻辑复制</p><figure><img class="lazy" alt="image-20220407163424691" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220407163424691-9008997e.png" tabindex="0"/><figcaption>image-20220407163424691</figcaption></figure><p>启动</p><figure><img class="lazy" alt="image-20220407162423209" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220407162423209-689703ea.png" tabindex="0"/><figcaption>image-20220407162423209</figcaption></figure><h4 id="_3、搭建-consul-consumer" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、搭建-consul-consumer">#</a> 3、搭建 consul-consumer</h4><p>pom</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-consul-discovery<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-web<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8007</span><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">consul-consumer</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">consul:</span><br>      <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">8500</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">service-name:</span> <span class="hljs-string">$&#123;spring.application.name&#125;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动类</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.consul;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableDiscoveryClient</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerApp</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(ConsumerApp.class,args);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>业务逻辑复制</p><figure><img class="lazy" alt="image-20220407164001822" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220407164001822-47a4a47b.png" tabindex="0"/><figcaption>image-20220407164001822</figcaption></figure><p>controller只改一句话</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">List&amp;lt;ServiceInstance&amp;gt; instances = discoveryClient.getInstances(<span class="hljs-string">&quot;consul-provider&quot;</span>);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>启动</p><figure><img class="lazy" alt="image-20220407164133404" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220407164133404-c379b922.png" tabindex="0"/><figcaption>image-20220407164133404</figcaption></figure><p>最终测试调用成功即可：<a href="http://localhost:8007/order/add/9" rel="noopener noreferrer" target="_blank">http://localhost:8007/order/add/9<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220407164211124" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/GcHhRhIA.png" tabindex="0"/><figcaption>image-20220407164211124</figcaption></figure><h3 id="三、-三个注册中心的异同" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、-三个注册中心的异同">#</a> 三、 三个注册中心的异同</h3><table><thead><tr><th>组件</th><th>语言</th><th>cap</th><th>健康检查</th><th>暴露接口</th><th>cloud集成</th></tr></thead><tbody><tr><td>eureka</td><td>java</td><td>ap</td><td>支持</td><td>http</td><td>已经集成</td></tr><tr><td>zookeeper</td><td>java</td><td>cp</td><td>支持</td><td>tcp</td><td>已经集成</td></tr><tr><td>consul</td><td>go</td><td>cp</td><td>支持</td><td>http</td><td>已经集成</td></tr></tbody></table><p>cap</p><ul><li><p>c:consustency 强一致性</p></li><li><p>a:avalibility 可用性</p></li><li><p>p:partition tolerance 分区容忍性</p></li></ul><h2 id="第八章-ribbon负载均衡服务调用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第八章-ribbon负载均衡服务调用">#</a> 第八章 Ribbon负载均衡服务调用</h2><h3 id="一、是什么" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、是什么">#</a> 一、是什么</h3><p>Netflix公司推出的http和TCP的客户端负载均衡工具。</p><p>ribbon:</p><ul><li><p>简化远程调用代码</p></li><li><p>内置很多负载均衡算法</p></li></ul><h4 id="_1、服务端负载均衡" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、服务端负载均衡">#</a> 1、服务端负载均衡</h4><p>负载均衡算法在服务端，服务端维护服务列表。</p><figure><img class="lazy" alt="image-20220407173053676" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220407173053676-2349faf0.png" tabindex="0"/><figcaption>image-20220407173053676</figcaption></figure><h4 id="_2、客户端负载均衡" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、客户端负载均衡">#</a> 2、客户端负载均衡</h4><ul><li><p>负载均衡算法在客户端</p></li><li><p>客户端维护服务列表</p></li></ul><figure><img class="lazy" alt="image-20220407173409352" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220407173409352-2bb522c4.png" tabindex="0"/><figcaption>image-20220407173409352</figcaption></figure><h3 id="二、如何使用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、如何使用">#</a> 二、如何使用</h3><p>1.新版的eureka依赖以及集成了Ribbon依赖，所以可以不引用</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text"> &amp;lt;!--Ribbon的依赖--&amp;gt;<br> &amp;lt;dependency&amp;gt;<br>     &amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;<br>     &amp;lt;artifactId&amp;gt;spring-cloud-starter-netflix-ribbon&amp;lt;/artifactId&amp;gt;<br>&amp;lt;/dependency&amp;gt;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img class="lazy" alt="image-20220408112040713" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220408112040713-49705355.png" tabindex="0"/><figcaption>image-20220408112040713</figcaption></figure><p>2.声明restTemplate时@LoadBalanced</p><p>3.restTemplate请求远程服务时，ip端口替换为服务名</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">String url=<span class="hljs-string">&quot;http://EUREKA-PROVIDER/goods/findById/&quot;</span>+id;<br><span class="hljs-type">Goods</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> restTemplate.getForObject(url, Goods.class);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>测试：</p><p>1.启动2个provider</p><p>controller</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">goods.setTitle(goods.getTitle()+&quot;|端口号：&quot;+port);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>idea设置 能启动两份 provider</p><figure><img class="lazy" alt="image-20220408112658153" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220408112658153-df840762.png" tabindex="0"/><figcaption>image-20220408112658153</figcaption></figure><figure><img class="lazy" alt="image-20220408112814966" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220408112814966-37a23e92.png" tabindex="0"/><figcaption>image-20220408112814966</figcaption></figure><p>2.多次访问consumer</p><figure><img class="lazy" alt="image-20220408113212684" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220408113212684-cc4cce36.png" tabindex="0"/><figcaption>image-20220408113212684</figcaption></figure><figure><img class="lazy" alt="image-20220408113134662" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220408113134662-3d63cf60.png" tabindex="0"/><figcaption>image-20220408113134662</figcaption></figure><p>多次刷新，发现：ribbon客户端，默认使用轮询算法，经行负载均衡调用。</p><h3 id="三、ribbon-负载均衡策略" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、ribbon-负载均衡策略">#</a> 三、ribbon 负载均衡策略</h3><table><thead><tr><th><strong>内置负载均衡规则类</strong></th><th><strong>规则描述</strong></th></tr></thead><tbody><tr><td>RoundRobinRule</td><td>简单轮询服务列表来选择服务器。它是Ribbon默认的负载均衡规则。</td></tr><tr><td>AvailabilityFilteringRule</td><td>对以下两种服务器进行忽略：（1）在默认情况下，这台服务器如果3次连接失败，这台服务器就会被设置为“短路”状态。短路状态将持续30秒，如果再次连接失败，短路的持续时间就会几何级地增加。注意：可以通过修改配置loadbalancer.&lt;clientName&gt;.connectionFailureCountThreshold来修改连接失败多少次之后被设置为短路状态。默认是3次。（2）并发数过高的服务器。如果一个服务器的并发连接数过高，配置了AvailabilityFilteringRule规则的客户端也会将其忽略。并发连接数的上线，可以由客户端的&lt;clientName&gt;.&lt;clientConfigNameSpace&gt;.ActiveConnectionsLimit属性进行配置。</td></tr><tr><td>WeightedResponseTimeRule</td><td>为每一个服务器赋予一个权重值。服务器响应时间越长，这个服务器的权重就越小。这个规则会随机选择服务器，这个权重值会影响服务器的选择。</td></tr><tr><td>ZoneAvoidanceRule</td><td>以区域可用的服务器为基础进行服务器的选择。使用Zone对服务器进行分类，这个Zone可以理解为一个机房、一个机架等。</td></tr><tr><td>BestAvailableRule</td><td>忽略哪些短路的服务器，并选择并发数较低的服务器。</td></tr><tr><td>RandomRule</td><td>随机选择一个可用的服务器。</td></tr><tr><td>Retry</td><td>重试机制的选择逻辑</td></tr></tbody></table><h3 id="四、-设置ribbon-负载均衡策略" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、-设置ribbon-负载均衡策略">#</a> 四、 设置ribbon 负载均衡策略</h3><h4 id="_1、代码" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、代码">#</a> 1、代码</h4><p>consumer工程</p><p>1.MyRule 返回想要的规则即可</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.consumer.config;<br><br><span class="hljs-keyword">import</span> com.netflix.loadbalancer.IRule;<br><span class="hljs-keyword">import</span> com.netflix.loadbalancer.RandomRule;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * creste by ydlclass.itcast</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRule</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> IRule <span class="hljs-title function_">rule</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomRule</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.启动类</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RibbonClient(name =&quot;EUREKA-PROVIDER&quot;,configuration = MyRule.class)</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>总结：</p><p>1.irule的具体实现类，看到他带的几个策略的写法。</p><p>2.仿照策略的写法，自己写策略。</p><p>3.调用不同的其他微服务时，可以采用不同的策略。</p><h4 id="_2、配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、配置">#</a> 2、配置</h4><p>consumer工程</p><p>application.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">EUREKA-PROVIDER:</span> <span class="hljs-comment">#远程服务名</span><br>  <span class="hljs-attr">ribbon:</span><br>    <span class="hljs-attr">NFLoadBalancerRuleClassName:</span> <span class="hljs-string">com.netflix.loadbalancer.RandomRule</span> <span class="hljs-comment">#策略</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>作用：方便运维修改，重启。随时切换策略。</p><h2 id="第九章、openfeign服务接口调用" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第九章、openfeign服务接口调用">#</a> 第九章、OpenFeign服务接口调用</h2><h3 id="一、概述" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、概述">#</a> 一、概述</h3><ul><li>Feign 是一个声明式的 REST 客户端，它用了<strong>基于接口的注解方式</strong>，很方便实现客户端像调用本地接口方法一样，进行远程调用。</li><li>Feign 最初由 Netflix 公司提供，但不支持SpringMVC注解，后由 SpringCloud 对其封装，支持了SpringMVC注解，让使用者更易于接受。</li><li><a href="https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/#spring-cloud-openfeign" rel="noopener noreferrer" target="_blank">https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/#spring-cloud-openfeign<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h3 id="二、快速入门" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、快速入门">#</a> 二、快速入门</h3><p>a.在消费端引入 open-feign 依赖：</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-openfeign<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>b.编写Feign调用接口。<strong>复制粘贴被调方的conreoller方法,加上类路径。</strong></p><p>GoodsFeignClient：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.consumer.feign;<br><br><span class="hljs-keyword">import</span> com.ydlclass.consumer.domain.Goods;<br><span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FeignClient;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@FeignClient(&quot;EUREKA-PROVIDER&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GoodsFeign</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/goods/findById/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>c.在启动类 添加 @EnableFeignClients 注解，开启Feign功能</p><p>d.测试调用</p><p>OrderController</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.consumer.controller;<br><br><span class="hljs-keyword">import</span> com.ydlclass.consumer.domain.Goods;<br><span class="hljs-keyword">import</span> com.ydlclass.consumer.feign.GoodsFeign;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.cloud.client.ServiceInstance;<br><span class="hljs-keyword">import</span> org.springframework.cloud.client.discovery.DiscoveryClient;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/order&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    RestTemplate restTemplate;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DiscoveryClient discoveryClient;<br><br>    <span class="hljs-meta">@Autowired</span><br>    GoodsFeign goodsFeign;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/add/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;<br>        <span class="hljs-comment">//业务逻辑</span><br>        <span class="hljs-comment">//1查询商品</span><br>        <span class="hljs-comment">//2减库存</span><br>        <span class="hljs-comment">//3支付</span><br>        <span class="hljs-comment">//4物流</span><br>        <span class="hljs-comment">//直接调用</span><br>        <span class="hljs-comment">//String url=&quot;http://localhost:8000/goods/findById/&quot;+id;</span><br>        <span class="hljs-comment">//Goods goods = restTemplate.getForObject(url, Goods.class);</span><br><br><span class="hljs-comment">//        //1服务发现</span><br><span class="hljs-comment">//        List&amp;lt;ServiceInstance&amp;gt; instances = discoveryClient.getInstances(&quot;EUREKA-PROVIDER&quot;);</span><br><span class="hljs-comment">//        if(instances==null||instances.size()&amp;lt;=0)&#123;</span><br><span class="hljs-comment">//            return null;</span><br><span class="hljs-comment">//        &#125;</span><br><span class="hljs-comment">//        //2通过某个策略拿到一个实例 算法</span><br><span class="hljs-comment">//        ServiceInstance serviceInstance = instances.get(0);</span><br><span class="hljs-comment">//        String host = serviceInstance.getHost();</span><br><span class="hljs-comment">//        int port = serviceInstance.getPort();</span><br><span class="hljs-comment">//        System.out.println(host);</span><br><span class="hljs-comment">//        System.out.println(port);</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//        String url=&quot;http://&quot;+host+&quot;:&quot;+port+&quot;/goods/findById/&quot;+id;</span><br><span class="hljs-comment">//        Goods goods = restTemplate.getForObject(url, Goods.class);</span><br><br>        <span class="hljs-comment">//ribbon</span><br><span class="hljs-comment">//        String url=&quot;http://EUREKA-PROVIDER/goods/findById/&quot;+id;</span><br><span class="hljs-comment">//        Goods goods = restTemplate.getForObject(url, Goods.class);</span><br><br>        <span class="hljs-comment">//feign调用</span><br>        <span class="hljs-type">Goods</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> goodsFeign.findById(id);<br><br>        <span class="hljs-keyword">return</span> goods;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="三、其他设置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、其他设置">#</a> 三、其他设置</h3><h4 id="_1、超时设置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、超时设置">#</a> 1、超时设置</h4><p>• Feign 底层依赖于 Ribbon 实现负载均衡和远程调用</p><figure><img class="lazy" alt="image-20220408171431530" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220408171431530-17dcc892.png" tabindex="0"/><figcaption>image-20220408171431530</figcaption></figure><p>• Ribbon默认1秒超时。</p><p>• 超时配置： yml中</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text"># 设置Ribbon的超时时间<br>ribbon:<br>  ConnectTimeout: 1000 # 连接超时时间 默认1s<br>  ReadTimeout: 3000 # 逻辑处理的超时时间 默认1s<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试：</p><p>1.连接超时，provider都停掉</p><figure><img class="lazy" alt="image-20220408172036937" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220408172036937-989a933a.png" tabindex="0"/><figcaption>image-20220408172036937</figcaption></figure><p>2.逻辑处理的超时时间</p><p>provider</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs text">@GetMapping(&quot;/findById/&#123;id&#125;&quot;)<br>public Goods findById(@PathVariable(&quot;id&quot;) Integer id)&#123;<br>    Goods goods = goodsService.findById(id);<br>    goods.setTitle(goods.getTitle()+&quot;|端口号：&quot;+port);<br><br>    //模拟业务逻辑比较繁忙<br>    try &#123;<br>        Thread.sleep(5000);<br>    &#125; catch (InterruptedException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    return goods;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img class="lazy" alt="image-20220408172302166" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220408172302166-9b28bb4d.png" tabindex="0"/><figcaption>image-20220408172302166</figcaption></figure><h4 id="_2、日志记录" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、日志记录">#</a> 2、日志记录</h4><p>1.Feign 只能记录 debug 级别的日志信息。</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text"># 设置当前的日志级别 debug，feign只支持记录debug级别的日志<br>logging:<br>  level:<br>    com.ydlclass: debug<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>• 定义Feign日志级别Bean</p><p>FeignLogConfig</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.consumer.config;<br><br><span class="hljs-keyword">import</span> feign.Logger;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FeignLogConfig</span> &#123;<br><br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        NONE,不记录</span><br><span class="hljs-comment">        BASIC,记录基本的请求行，响应状态码数据</span><br><span class="hljs-comment">        HEADERS,记录基本的请求行，响应状态码数据，记录响应头信息</span><br><span class="hljs-comment">        FULL;记录完成的请求 响应数据</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Logger.Level <span class="hljs-title function_">level</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> Logger.Level.FULL;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>启用该Bean：</li></ol><p>GoodsFeignClient</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">@FeignClient(value = &quot;FEIGN-PROVIDER&quot;,configuration = FeignLogConfig.class)<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><h2 id="" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#">#</a> <img class="lazy" alt="image-20220408182551922" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220408182551922-f2ea6561.png"/></h2><p>设置为headers</p><figure><img class="lazy" alt="image-20220408182713438" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220408182713438-68ea41ae.png" tabindex="0"/><figcaption>image-20220408182713438</figcaption></figure><h2 id="第十章-hystrix断路器-豪猪-保险丝" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第十章-hystrix断路器-豪猪-保险丝">#</a> 第十章 Hystrix断路器 （豪猪）-保险丝</h2><h3 id="一、概述-1" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、概述-1">#</a> 一、概述</h3><p>重点：能让服务的调用方，够快的知道被调方挂了！不至于说让用户在等待。</p><p>Hystix 是 Netflix 开源的一个延迟和容错库，用于隔离访问远程服务、第三方库，防止出现级联失败（雪崩）。</p><p>雪崩：一个服务失败，导致整条链路的服务都失败的情形。</p><figure><img class="lazy" alt="image-20220411101214886" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411101214886-e1894fb1.png" tabindex="0"/><figcaption>image-20220411101214886</figcaption></figure><figure><img class="lazy" alt="image-20220411104119551" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411104119551-5dbb216d.png" tabindex="0"/><figcaption>image-20220411104119551</figcaption></figure><figure><img class="lazy" alt="image-20220411101248131" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411101248131-23fdbc68.png" tabindex="0"/><figcaption>image-20220411101248131</figcaption></figure><figure><img class="lazy" alt="image-20220411101310179" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411101310179-039fb050.png" tabindex="0"/><figcaption>image-20220411101310179</figcaption></figure><p><strong>Hystix 主要功能</strong></p><figure><img class="lazy" alt="image-20220411101741096" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411101741096-ad89764b.png" tabindex="0"/><figcaption>image-20220411101741096</figcaption></figure><p><strong>隔离</strong></p><ol><li><p>线程池隔离</p><p>没有hystrix,a重试100次，才知道c挂了！</p><figure><img class="lazy" alt="image-20220411102317061" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411102317061-a569d3eb.png" tabindex="0"/><figcaption>image-20220411102317061</figcaption></figure><p>使用了hystrix,更细分线程池，只需要重试40次，让a更快的知道c挂了</p><figure><img class="lazy" alt="image-20220411102720425" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411102720425-31875f98.png" tabindex="0"/><figcaption>image-20220411102720425</figcaption></figure></li><li><p>信号量隔离</p><p>没有hystrix,a一个带着认证信息的线程，重试100次，才知道c挂了！</p><figure><img class="lazy" alt="image-20220411103036778" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411103036778-e2674a15.png" tabindex="0"/><figcaption>image-20220411103036778</figcaption></figure><p>使用了hystrix,更细分线程池，一个带着认证信息的线程,只需要重试40次，让a更快的知道c挂了</p><figure><img class="lazy" alt="image-20220411103152275" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411103152275-926f5142.png" tabindex="0"/><figcaption>image-20220411103152275</figcaption></figure></li></ol><p><strong>降级</strong>：</p><p>服务提供方降级(异常，超时)</p><figure><img class="lazy" alt="image-20220411104951728" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411104951728-51506d7b.png" tabindex="0"/><figcaption>image-20220411104951728</figcaption></figure><p>消费方降级</p><figure><img class="lazy" alt="image-20220411112946547" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411112946547-e3d81fb6.png" tabindex="0"/><figcaption>image-20220411112946547</figcaption></figure><p><strong>熔断</strong></p><p><strong>限流</strong></p><p>​ 是有限流，但是，项目一般不用。nginx或者网关限流。</p><h3 id="二、服务降级" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、服务降级">#</a> 二、服务降级</h3><p><strong>服务提供方</strong></p><p>a、在服务提供方，引入 hystrix 依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- hystrix --<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-netflix-hystrix<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>b、方法</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/** 定义降级方法   返回特殊对象</span><br><span class="hljs-comment">     *  1方法的返回值要和原方法一致</span><br><span class="hljs-comment">     *  2方法参数和原方法一样</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">findById_fallback</span><span class="hljs-params">(Integer id)</span>&#123;<br>        Goods goods=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Goods</span>();<br>        goods.setGoodId(-<span class="hljs-number">1</span>);<br>        goods.setTitle(<span class="hljs-string">&quot;provider提供方降级！&quot;</span>);<br>        goods.setPrice(-<span class="hljs-number">9.9</span>);<br>        goods.setStock(-<span class="hljs-number">10</span>);<br><br>        <span class="hljs-keyword">return</span> goods;<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>c、使用 @HystrixCommand 注解配置降级方法</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/findById/&#123;id&#125;&quot;)</span><br>    <span class="hljs-meta">@HystrixCommand(fallbackMethod = &quot;findById_fallback&quot;,commandProperties = &#123;</span><br><span class="hljs-meta">            //设置Hystrix的超时时间，默认1s</span><br><span class="hljs-meta">            @HystrixProperty(name=&quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value = &quot;3000&quot;)</span><br><span class="hljs-meta">    &#125;)</span><br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;<br>        <span class="hljs-type">Goods</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> goodsService.findById(id);<br>        goods.setTitle(goods.getTitle()+<span class="hljs-string">&quot;|端口号：&quot;</span>+port);<br><br>        <span class="hljs-comment">//模拟出异常</span><br><span class="hljs-comment">//        int a=1/0;</span><br><br>        <span class="hljs-comment">//模拟业务逻辑比较繁忙</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">5000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> goods;<br>    &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>d、在启动类上开启Hystrix功能：@EnableCircuitBreaker</p><p>测试：<a href="http://localhost:9000/order/add/10" rel="noopener noreferrer" target="_blank">http://localhost:9000/order/add/10<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>1.出错，服务方降级了</p><figure><img class="lazy" alt="image-20220411110206538" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411110206538-c3351b31.png" tabindex="0"/><figcaption>image-20220411110206538</figcaption></figure><p>2.3000超时，服务方降级了</p><figure><img class="lazy" alt="image-20220411111020806" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411111020806-407514d5.png" tabindex="0"/><figcaption>image-20220411111020806</figcaption></figure><p><strong>服务消费方</strong></p><p>a、feign 组件已经集成了 hystrix 组件。</p><p>b、</p><figure><img class="lazy" alt="image-20220411113035040" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411113035040-f3c891d5.png" tabindex="0"/><figcaption>image-20220411113035040</figcaption></figure><p>c、定义feign 调用接口实现类，复写方法，即 降级方法</p><p>GoodsFeignClientFallback</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.consumer.feign;<br><br><span class="hljs-keyword">import</span> com.ydlclass.consumer.domain.Goods;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodsFeignCallback</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GoodsFeign</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">findById</span><span class="hljs-params">(Integer id)</span> &#123;<br>        Goods goods=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Goods</span>();<br>        goods.setGoodId(-<span class="hljs-number">2</span>);<br>        goods.setTitle(<span class="hljs-string">&quot;调用方降级了！&quot;</span>);<br>        goods.setPrice(-<span class="hljs-number">5.5</span>);<br>        goods.setStock(-<span class="hljs-number">5</span>);<br>        <span class="hljs-keyword">return</span> goods;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>d、在 @FeignClient 注解中使用 fallback 属性设置降级处理类。</p><p>GoodsFeignClient</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.consumer.feign;<br><br><span class="hljs-keyword">import</span> com.ydlclass.consumer.config.FeignLogConfig;<br><span class="hljs-keyword">import</span> com.ydlclass.consumer.domain.Goods;<br><span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FeignClient;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@FeignClient(value = &quot;EUREKA-PROVIDER&quot;,configuration = FeignLogConfig.class,fallback = GoodsFeignCallback.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GoodsFeign</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/goods/findById/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>e、配置开启</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text"># 开启feign对hystrix的支持<br>feign:<br>  hystrix:<br>    enabled: true<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试：停掉provider</p><p><a href="http://localhost:9000/order/add/10" rel="noopener noreferrer" target="_blank">http://localhost:9000/order/add/10<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220411113635280" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411113635280-1081b217.png" tabindex="0"/><figcaption>image-20220411113635280</figcaption></figure><h3 id="三、熔断" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、熔断">#</a> 三、熔断</h3><figure><img class="lazy" alt="image-20220411114750082" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411114750082-1a48c986.png" tabindex="0"/><figcaption>image-20220411114750082</figcaption></figure><p>测试：</p><p>provider</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.proviver.controller;<br><br><span class="hljs-keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;<br><span class="hljs-keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;<br><span class="hljs-keyword">import</span> com.ydlclass.proviver.domain.Goods;<br><span class="hljs-keyword">import</span> com.ydlclass.proviver.service.GoodsService;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/goods&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodsController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    GoodsService goodsService;<br>    <span class="hljs-meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span><br>    <span class="hljs-type">int</span> port;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/findById/&#123;id&#125;&quot;)</span><br>    <span class="hljs-meta">@HystrixCommand(fallbackMethod = &quot;findById_fallback&quot;,commandProperties = &#123;</span><br><span class="hljs-meta">            //设置Hystrix的超时时间，默认1s</span><br><span class="hljs-meta">            @HystrixProperty(name=&quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value = &quot;3000&quot;)</span><br><span class="hljs-meta">    &#125;)</span><br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;<br>        <span class="hljs-type">Goods</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> goodsService.findById(id);<br>        goods.setTitle(goods.getTitle()+<span class="hljs-string">&quot;|端口号：&quot;</span>+port);<br><br>        <span class="hljs-keyword">if</span>(id==<span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-comment">//模拟出异常</span><br>            <span class="hljs-type">int</span> a=<span class="hljs-number">1</span>/<span class="hljs-number">0</span>;<br>        &#125;<br><br>        <span class="hljs-comment">//模拟出异常</span><br><span class="hljs-comment">//        int a=1/0;</span><br><br>        <span class="hljs-comment">//模拟业务逻辑比较繁忙</span><br><span class="hljs-comment">//        try &#123;</span><br><span class="hljs-comment">//            Thread.sleep(5000);</span><br><span class="hljs-comment">//        &#125; catch (InterruptedException e) &#123;</span><br><span class="hljs-comment">//            e.printStackTrace();</span><br><span class="hljs-comment">//        &#125;</span><br>        <span class="hljs-keyword">return</span> goods;<br>    &#125;<br><br>    <span class="hljs-comment">/** 定义降级方法   返回特殊对象</span><br><span class="hljs-comment">     *  1方法的返回值要和原方法一致</span><br><span class="hljs-comment">     *  2方法参数和原方法一样</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Goods <span class="hljs-title function_">findById_fallback</span><span class="hljs-params">(Integer id)</span>&#123;<br>        Goods goods=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Goods</span>();<br>        goods.setGoodId(-<span class="hljs-number">1</span>);<br>        goods.setTitle(<span class="hljs-string">&quot;provider提供方降级！&quot;</span>);<br>        goods.setPrice(-<span class="hljs-number">9.9</span>);<br>        goods.setStock(-<span class="hljs-number">10</span>);<br><br>        <span class="hljs-keyword">return</span> goods;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>访问两个接口</p><ol><li><a href="http://localhost:9000/order/add/10" rel="noopener noreferrer" target="_blank">http://localhost:9000/order/add/10<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol><figure><img class="lazy" alt="image-20220411115310796" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411115310796-faba6ed0.png" tabindex="0"/><figcaption>image-20220411115310796</figcaption></figure><ol start="2"><li>多次访问 <a href="http://localhost:9000/order/add/1" rel="noopener noreferrer" target="_blank">http://localhost:9000/order/add/1<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol><figure><img class="lazy" alt="image-20220411115332277" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411115332277-ce2b6c94.png" tabindex="0"/><figcaption>image-20220411115332277</figcaption></figure><p>3.导致10也不能访问了</p><figure><img class="lazy" alt="image-20220411115128870" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411115128870-15162f17.png" tabindex="0"/><figcaption>image-20220411115128870</figcaption></figure><p>4.再过一会儿，半开状态</p><p><a href="http://localhost:9000/order/add/10" rel="noopener noreferrer" target="_blank">http://localhost:9000/order/add/10<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220411115423173" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411115423173-573f7494.png" tabindex="0"/><figcaption>image-20220411115423173</figcaption></figure><p>Hyst rix 熔断机制，用于监控微服务调用情况，当失败的情况达到预定的阈值（5秒失败20次），会打开断路器，拒绝所有请求，直到服务恢复正常为止。</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">circuitBreaker.sleepWindowInMilliseconds：监控时间<br>circuitBreaker.requestVolumeThreshold：失败次数<br>circuitBreaker.errorThresholdPercentage：失败率<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>提供者controller中</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@HystrixCommand(fallbackMethod = &quot;findOne_fallback&quot;,commandProperties = &#123;</span><br><span class="hljs-meta">        //设置Hystrix的超时时间，默认1s</span><br><span class="hljs-meta">        @HystrixProperty(name=&quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value = &quot;3000&quot;),</span><br><span class="hljs-meta">        //监控时间 默认5000 毫秒</span><br><span class="hljs-meta">        @HystrixProperty(name=&quot;circuitBreaker.sleepWindowInMilliseconds&quot;,value = &quot;5000&quot;),</span><br><span class="hljs-meta">        //失败次数。默认20次</span><br><span class="hljs-meta">        @HystrixProperty(name=&quot;circuitBreaker.requestVolumeThreshold&quot;,value = &quot;20&quot;),</span><br><span class="hljs-meta">        //失败率 默认50%</span><br><span class="hljs-meta">        @HystrixProperty(name=&quot;circuitBreaker.errorThresholdPercentage&quot;,value = &quot;50&quot;)</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">&#125;)</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="四、熔断监控-运维" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、熔断监控-运维">#</a> 四、熔断监控**-运维</h3><figure><img class="lazy" alt="image-20200612072519498" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20200612072519498-077b0382.png" tabindex="0"/><figcaption>image-20200612072519498</figcaption></figure><p>Hystrix 提供了 Hystrix-dashboard 功能，用于实时监控微服务运行状态。</p><p>但是Hystrix-dashboard只能监控一个微服务。</p><p>Netflix 还提供了 Turbine ，进行聚合监控。</p><figure><img class="lazy" alt="image-20200612072621556" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20200612072621556-5e1b0aa0.png" tabindex="0"/><figcaption>image-20200612072621556</figcaption></figure><p><strong>Turbine聚合监控</strong></p><h4 id="_1、搭建监控模块" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、搭建监控模块">#</a> 1、搭建监控模块</h4><p><strong>a、 创建监控模块</strong></p><p>创建hystrix-monitor模块，使用Turbine聚合监控多个Hystrix dashboard功能,</p><p><strong>b、引入Turbine聚合监控起步依赖</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;<br>         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>parent<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-parent<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>com.ydlclass<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.0.0<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/parent<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>modelVersion<span class="hljs-symbol">&amp;gt;</span>4.0.0<span class="hljs-symbol">&amp;lt;</span>/modelVersion<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>hystrix-monitor<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>properties<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>maven.compiler.source<span class="hljs-symbol">&amp;gt;</span>8<span class="hljs-symbol">&amp;lt;</span>/maven.compiler.source<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>maven.compiler.target<span class="hljs-symbol">&amp;gt;</span>8<span class="hljs-symbol">&amp;lt;</span>/maven.compiler.target<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/properties<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-netflix-turbine<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-actuator<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-test<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>scope<span class="hljs-symbol">&amp;gt;</span>test<span class="hljs-symbol">&amp;lt;</span>/scope<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>build<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>plugins<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>plugin<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>                <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-maven-plugin<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>/plugin<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/plugins<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/build<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/project<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>d、修改application.yml</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">hystrix-monitor</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8769</span><br><span class="hljs-attr">turbine:</span><br>  <span class="hljs-attr">combine-host-port:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># 配置需要监控的服务名称列表</span><br>  <span class="hljs-attr">app-config:</span> <span class="hljs-string">EUREKA-PROVIDER,EUREKA-CONSUMER</span><br>  <span class="hljs-attr">cluster-name-expression:</span> <span class="hljs-string">&quot;&#x27;default&#x27;&quot;</span><br>  <span class="hljs-attr">aggregator:</span><br>    <span class="hljs-attr">cluster-config:</span> <span class="hljs-string">default</span><br>  <span class="hljs-comment">#instanceUrlSuffix: /actuator/hystrix.stream</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">serviceUrl:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:8761/eureka/</span><br><span class="hljs-attr">hystrix:</span><br>  <span class="hljs-attr">dashboard:</span><br>    <span class="hljs-attr">proxy-stream-allow-list:</span> <span class="hljs-string">&quot;*&quot;</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>e、创建启动类</strong></p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.monitor;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;<br><span class="hljs-keyword">import</span> org.springframework.cloud.netflix.hystrix.dashboard.EnableHystrixDashboard;<br><span class="hljs-keyword">import</span> org.springframework.cloud.netflix.turbine.EnableTurbine;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-meta">@EnableTurbine</span> <span class="hljs-comment">//开启Turbine 很聚合监控功能</span><br><span class="hljs-meta">@EnableHystrixDashboard</span> <span class="hljs-comment">//开启Hystrix仪表盘监控功能</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HystrixMonitorApp</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(HystrixMonitorApp.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、修改被监控模块" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、修改被监控模块">#</a> 2、修改被监控模块</h4><p>需要分别修改 hystrix-provider 和 hystrix-consumer 模块：</p><p><strong>a、导入依赖：</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>       <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>       <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-actuator<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>   <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>   <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>       <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>       <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-netflix-hystrix<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>   <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>   <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>       <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>       <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>   <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>b、配置Bean</strong></p><p>此处为了方便，将其配置在启动类中。</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br> <span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title function_">getServlet</span><span class="hljs-params">()</span> &#123;<br>     <span class="hljs-type">HystrixMetricsStreamServlet</span> <span class="hljs-variable">streamServlet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HystrixMetricsStreamServlet</span>();<br>     <span class="hljs-type">ServletRegistrationBean</span> <span class="hljs-variable">registrationBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletRegistrationBean</span>(streamServlet);<br>     registrationBean.setLoadOnStartup(<span class="hljs-number">1</span>);<br>     registrationBean.addUrlMappings(<span class="hljs-string">&quot;/actuator/hystrix.stream&quot;</span>);<br>     registrationBean.setName(<span class="hljs-string">&quot;HystrixMetricsStreamServlet&quot;</span>);<br>     <span class="hljs-keyword">return</span> registrationBean;<br> &#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>c、启动类上添加注解@EnableHystrixDashboard</strong></p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableDiscoveryClient</span><br><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableFeignClients</span> <br><span class="hljs-meta">@EnableHystrixDashboard</span> <span class="hljs-comment">// 开启Hystrix仪表盘监控功能</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerApp</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(ConsumerApp.class,args);<br>    &#125;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title function_">getServlet</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">HystrixMetricsStreamServlet</span> <span class="hljs-variable">streamServlet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HystrixMetricsStreamServlet</span>();<br>        <span class="hljs-type">ServletRegistrationBean</span> <span class="hljs-variable">registrationBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletRegistrationBean</span>(streamServlet);<br>        registrationBean.setLoadOnStartup(<span class="hljs-number">1</span>);<br>        registrationBean.addUrlMappings(<span class="hljs-string">&quot;/actuator/hystrix.stream&quot;</span>);<br>        registrationBean.setName(<span class="hljs-string">&quot;HystrixMetricsStreamServlet&quot;</span>);<br>        <span class="hljs-keyword">return</span> registrationBean;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3、启动测试" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_3、启动测试">#</a> 3、启动测试</h4><p><strong>a、启动服务：</strong></p><ul><li><p>eureka-server</p></li><li><p>hystrix-provider</p></li><li><p>hystrix-consumer</p></li><li><p>hystrix-monitor</p></li></ul><p><strong>b、访问：</strong></p><p>在浏览器访问<a href="http://localhost:8769/hystrix/" rel="noopener noreferrer" target="_blank">http://localhost:8769/hystrix/<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 进入Hystrix Dashboard界面</p><figure><img class="lazy" alt="1585421193757" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/1585421193757-41f28cbc.png" tabindex="0"/><figcaption>1585421193757</figcaption></figure><p>界面中输入监控的Url地址 <a href="http://localhost:8769/turbine.stream%EF%BC%8C%E7%9B%91%E6%8E%A7%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%942000%E6%AF%AB%E7%A7%92%E5%92%8Ctitle%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE" rel="noopener noreferrer" target="_blank">http://localhost:8769/turbine.stream，监控时间间隔2000毫秒和title，如下图<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220411154048113" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411154048113-1c256874.png" tabindex="0"/><figcaption>image-20220411154048113</figcaption></figure><ul><li>实心圆：它有颜色和大小之分，分别代表实例的监控程度和流量大小。如上图所示，它的健康度从绿色、黄色、橙色、红色递减。通过该实心圆的展示，我们就可以在大量的实例中快速的发现故障实例和高压力实例。</li><li>曲线：用来记录 2 分钟内流量的相对变化，我们可以通过它来观察到流量的上升和下降趋势。</li></ul><p>1-</p><h2 id="第十一章、zuul路由网关" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第十一章、zuul路由网关">#</a> 第十一章、zuul路由网关</h2><p>zuul核心人员走了两个，zuul2的研发过久，spring公司等不及，自己研发的Gateway网关。</p><p><a href="https://github.com/Netflix/zuul/wiki" rel="noopener noreferrer" target="_blank">https://github.com/Netflix/zuul/wiki<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="第十二章-gateway新一代网关" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第十二章-gateway新一代网关">#</a> 第十二章 Gateway新一代网关</h2><p>功能：路由+过滤</p><h3 id="一、-概述" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、-概述">#</a> 一、 <strong>概述</strong></h3><p><a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/" rel="noopener noreferrer" target="_blank">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>不使用</p><p>存在的问题：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">解决缺点：1客户端需要记录不同微服务地址，增加客户端的复杂性<br>2每个后台微服务都需要认证<br>3http 发请求，涉及到跨域<br>4后台新增微服务，不能动态知道地址<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img class="lazy" alt="image-20220411172117753" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411172117753-e3893d54.png" tabindex="0"/><figcaption>image-20220411172117753</figcaption></figure><p>使用了网关的话：</p><p>• 网关旨在为微服务架构提供一种简单而有效的统一的API路由管理方式。</p><p>• 在微服务架构中，不同的微服务可以有不同的网络地址，各个微服务之间通过互相调用完成用户请求，客户端可能通过调用N个微服务的接口完成一个用户请求。</p><p>• 网关就是系统的入口，封装了应用程序的内部结构，为客户端提供统一服务，一些与业务本身功能无关的公共逻辑可以在这里实现，诸如认证、鉴权、监控、缓存、负载均衡、流量管控、路由转发等</p><p>• 在目前的网关解决方案里，有Nginx+ Lua、Netflix Zuul/zuul2 、Spring Cloud Gateway等等</p><figure><img class="lazy" alt="image-20220411172632761" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411172632761-c415bd79.png" tabindex="0"/><figcaption>image-20220411172632761</figcaption></figure><h3 id="二、-快速入门" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、-快速入门">#</a> 二、 <strong>快速入门</strong></h3><p>（1）搭建网关模块 api-gateway-server</p><p>（2）引入依赖：starter-gateway</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;<br>         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>parent<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>gateway-parent<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>com.ydlclass<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.0-SNAPSHOT<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/parent<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>modelVersion<span class="hljs-symbol">&amp;gt;</span>4.0.0<span class="hljs-symbol">&amp;lt;</span>/modelVersion<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>api-gateway-server<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><br><br>    <span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>!--引入gateway 网关--<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-gateway<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>!-- eureka-client --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/project<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）编写启动类</p><p>ApiGatewayApp</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.gateway;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiGatewayApp</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(ApiGatewayApp.class,args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（4）编写配置文件</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs text">server:<br>  port: 80<br><br>spring:<br>  application:<br>    name: api-gateway-server<br><br>  cloud:<br>    # 网关配置<br>    gateway:<br>      # 路由配置：转发规则<br>      routes: #集合。<br>      # id: 唯一标识。默认是一个UUID<br>      # uri: 转发路径<br>      # predicates: 条件,用于请求网关路径的匹配规则<br>      # filters：配置局部过滤器的<br><br>      - id: eureka-provider<br>        # 静态路由<br>        # uri: http://localhost:8001/<br>        # 动态路由<br>        uri: lb://GATEWAY-PROVIDER<br>        predicates:<br>        - Path=/goods/**<br>        filters:<br>        - AddRequestParameter=username,zhangsan<br><br>      - id: eureka-consumer<br>        # uri: http://localhost:9000<br>        uri: lb://GATEWAY-CONSUMER<br>        predicates:<br>        - Path=/order/**<br>        # 微服务名称配置<br>      discovery:<br>        locator:<br>          enabled: true # 设置为true 请求路径前可以添加微服务名称<br>          lower-case-service-id: true # 允许为小写<br><br><br>eureka:<br>  client:<br>    service-url:<br>      defaultZone: http://localhost:8761/eureka<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（5）启动测试</p><p><a href="http://localhost/goods/findById/2" rel="noopener noreferrer" target="_blank">http://localhost/goods/findById/2<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220411174704253" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411174704253-4e93d626.png" tabindex="0"/><figcaption>image-20220411174704253</figcaption></figure><figure><img class="lazy" alt="image-20220411174649892" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411174649892-b2b39013.png" tabindex="0"/><figcaption>image-20220411174649892</figcaption></figure><h3 id="三、-静态路由" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、-静态路由">#</a> 三、 <strong>静态路由</strong></h3><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">uri: http://localhost:8000/<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><h3 id="四、动态路由" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#四、动态路由">#</a> 四、<strong>动态路由</strong></h3><figure><img class="lazy" alt="image-20220411180512597" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411180512597-da56cec1.png" tabindex="0"/><figcaption>image-20220411180512597</figcaption></figure><h4 id="_1、引入eureka-client配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_1、引入eureka-client配置">#</a> 1、引入eureka-client配置</h4><p>pom</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">&amp;lt;dependency&amp;gt;<br>       &amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;<br>       &amp;lt;artifactId&amp;gt;spring-cloud-starter-netflix-eureka-client&amp;lt;/artifactId&amp;gt;<br>   &amp;lt;/dependency&amp;gt;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>yml</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">eureka:<br>  client:<br>    service-url:<br>      defaultZone: http://localhost:8761/eureka<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、修改uri属性-uri-lb-服务名称" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#_2、修改uri属性-uri-lb-服务名称">#</a> 2、修改uri属性：uri: lb://服务名称</h4><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">uri: lb://eureka-provider<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>测试：</p><p><a href="http://localhost/goods/findById/2" rel="noopener noreferrer" target="_blank">http://localhost/goods/findById/2<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220411180644761" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411180644761-e575ff25.png" tabindex="0"/><figcaption>image-20220411180644761</figcaption></figure><h3 id="五、微服务名称配置" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#五、微服务名称配置">#</a> 五、微服务名称配置**</h3><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs text">spring:<br>  cloud:<br>    # 网关配置<br>    gateway:   <br>    # 微服务名称配置<br>      discovery:<br>        locator:<br>          enabled: true # 设置为true 请求路径前可以添加微服务名称<br>          lower-case-service-id: true # 允许为小写<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试：<a href="http://localhost/eureka-provider/goods/findById/2" rel="noopener noreferrer" target="_blank">http://localhost/eureka-provider/goods/findById/2<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220411180853933" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411180853933-7e0bf46f.png" tabindex="0"/><figcaption>image-20220411180853933</figcaption></figure><h3 id="六、过滤器" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#六、过滤器">#</a> 六、过滤器</h3><p>（1）两个维度：</p><p>内置过滤器 自定义过滤器</p><p>局部过滤器 全局过滤器</p><p>（2）过滤器种类：</p><p>内置局部过滤器</p><p>内置全局过滤器</p><p>自定义局部过滤器</p><p>自定义全局过滤器</p><figure><img class="lazy" alt="image-20200612075159655" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20200612075159655-4dd53e5a.png" tabindex="0"/><figcaption>image-20200612075159655</figcaption></figure><ul><li><p>Gateway 支持过滤器功能，对请求或响应进行拦截，完成一些通用操作。</p></li><li><p>Gateway 提供两种过滤器方式：“pre”和“post”</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">pre 过滤器，在转发之前执行，可以做参数校验、权限校验、流量监控、日志输出、协议转换等。<br>post 过滤器，在响应之前执行，可以做响应内容、响应头的修改，日志的输出，流量监控等。<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Gateway 还提供了两种类型过滤器</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">GatewayFilter：局部过滤器，针对单个路由<br>GlobalFilter ：全局过滤器，针对所有路由<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>内置过滤器 局部过滤器：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">gateway-provider</span><br>     <span class="hljs-comment">#uri: http://localhost:8001/</span><br>     <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://GATEWAY-PROVIDER</span><br>     <span class="hljs-attr">predicates:</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/goods/**</span><br>        <span class="hljs-attr">filters:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">AddResponseHeader=foo,</span> <span class="hljs-string">bar</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img class="lazy" alt="image-20220411182635931" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411182635931-65d3b487.png" tabindex="0"/><figcaption>image-20220411182635931</figcaption></figure><p>内置过滤器 全局过滤器： route同级</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">default-filters:<br>  - AddResponseHeader=yld,itlils<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img class="lazy" alt="image-20220411182831552" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411182831552-1af37136.png" tabindex="0"/><figcaption>image-20220411182831552</figcaption></figure><figure><img class="lazy" alt="image-20220411182910608" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411182910608-586ba685.png" tabindex="0"/><figcaption>image-20220411182910608</figcaption></figure><p><strong>拓展：</strong></p><p>内置的过滤器工厂</p><p>这里简单将Spring Cloud Gateway内置的所有过滤器工厂整理成了一张表格。如下：</p><table><thead><tr><th style="text-align:left;">过滤器工厂</th><th style="text-align:left;">作用</th><th style="text-align:left;">参数</th></tr></thead><tbody><tr><td style="text-align:left;">AddRequestHeader</td><td style="text-align:left;">为原始请求添加Header</td><td style="text-align:left;">Header的名称及值</td></tr><tr><td style="text-align:left;">AddRequestParameter</td><td style="text-align:left;">为原始请求添加请求参数</td><td style="text-align:left;">参数名称及值</td></tr><tr><td style="text-align:left;">AddResponseHeader</td><td style="text-align:left;">为原始响应添加Header</td><td style="text-align:left;">Header的名称及值</td></tr><tr><td style="text-align:left;">DedupeResponseHeader</td><td style="text-align:left;">剔除响应头中重复的值</td><td style="text-align:left;">需要去重的Header名称及去重策略</td></tr><tr><td style="text-align:left;">Hystrix</td><td style="text-align:left;">为路由引入Hystrix的断路器保护</td><td style="text-align:left;"><code>HystrixCommand</code>的名称</td></tr><tr><td style="text-align:left;">FallbackHeaders</td><td style="text-align:left;">为fallbackUri的请求头中添加具体的异常信息</td><td style="text-align:left;">Header的名称</td></tr><tr><td style="text-align:left;">PrefixPath</td><td style="text-align:left;">为原始请求路径添加前缀</td><td style="text-align:left;">前缀路径</td></tr><tr><td style="text-align:left;">PreserveHostHeader</td><td style="text-align:left;">为请求添加一个preserveHostHeader=true的属性，路由过滤器会检查该属性以决定是否要发送原始的Host</td><td style="text-align:left;">无</td></tr><tr><td style="text-align:left;">RequestRateLimiter</td><td style="text-align:left;">用于对请求限流，限流算法为令牌桶</td><td style="text-align:left;">keyResolver、rateLimiter、statusCode、denyEmptyKey、emptyKeyStatus</td></tr><tr><td style="text-align:left;">RedirectTo</td><td style="text-align:left;">将原始请求重定向到指定的URL</td><td style="text-align:left;">http状态码及重定向的url</td></tr><tr><td style="text-align:left;">RemoveHopByHopHeadersFilter</td><td style="text-align:left;">为原始请求删除IETF组织规定的一系列Header</td><td style="text-align:left;">默认就会启用，可以通过配置指定仅删除哪些Header</td></tr><tr><td style="text-align:left;">RemoveRequestHeader</td><td style="text-align:left;">为原始请求删除某个Header</td><td style="text-align:left;">Header名称</td></tr><tr><td style="text-align:left;">RemoveResponseHeader</td><td style="text-align:left;">为原始响应删除某个Header</td><td style="text-align:left;">Header名称</td></tr><tr><td style="text-align:left;">RewritePath</td><td style="text-align:left;">重写原始的请求路径</td><td style="text-align:left;">原始路径正则表达式以及重写后路径的正则表达式</td></tr><tr><td style="text-align:left;">RewriteResponseHeader</td><td style="text-align:left;">重写原始响应中的某个Header</td><td style="text-align:left;">Header名称，值的正则表达式，重写后的值</td></tr><tr><td style="text-align:left;">SaveSession</td><td style="text-align:left;">在转发请求之前，强制执行<code>WebSession::save</code>操作</td><td style="text-align:left;">无</td></tr><tr><td style="text-align:left;">secureHeaders</td><td style="text-align:left;">为原始响应添加一系列起安全作用的响应头</td><td style="text-align:left;">无，支持修改这些安全响应头的值</td></tr><tr><td style="text-align:left;">SetPath</td><td style="text-align:left;">修改原始的请求路径</td><td style="text-align:left;">修改后的路径</td></tr><tr><td style="text-align:left;">SetResponseHeader</td><td style="text-align:left;">修改原始响应中某个Header的值</td><td style="text-align:left;">Header名称，修改后的值</td></tr><tr><td style="text-align:left;">SetStatus</td><td style="text-align:left;">修改原始响应的状态码</td><td style="text-align:left;">HTTP 状态码，可以是数字，也可以是字符串</td></tr><tr><td style="text-align:left;">StripPrefix</td><td style="text-align:left;">用于截断原始请求的路径</td><td style="text-align:left;">使用数字表示要截断的路径的数量</td></tr><tr><td style="text-align:left;">Retry</td><td style="text-align:left;">针对不同的响应进行重试</td><td style="text-align:left;">retries、statuses、methods、series</td></tr><tr><td style="text-align:left;">RequestSize</td><td style="text-align:left;">设置允许接收最大请求包的大小。如果请求包大小超过设置的值，则返回 <code>413 Payload Too Large</code></td><td style="text-align:left;">请求包大小，单位为字节，默认值为5M</td></tr><tr><td style="text-align:left;">ModifyRequestBody</td><td style="text-align:left;">在转发请求之前修改原始请求体内容</td><td style="text-align:left;">修改后的请求体内容</td></tr><tr><td style="text-align:left;">ModifyResponseBody</td><td style="text-align:left;">修改原始响应体的内容</td><td style="text-align:left;">修改后的响应体内容</td></tr><tr><td style="text-align:left;">Default</td><td style="text-align:left;">为所有路由添加过滤器</td><td style="text-align:left;">过滤器工厂名称及值</td></tr></tbody></table><p>**Tips：**每个过滤器工厂都对应一个实现类，并且这些类的名称必须以<code>GatewayFilterFactory</code>结尾，这是Spring Cloud Gateway的一个约定，例如<code>AddRequestHeader</code>对应的实现类为<code>AddRequestHeaderGatewayFilterFactory</code>。</p><hr/><p>1、AddRequestHeader GatewayFilter Factory</p><p>为原始请求添加Header，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">add_request_header_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestHeader=X-Request-Foo,</span> <span class="hljs-string">Bar</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为原始请求添加名为 <code>X-Request-Foo</code> ，值为 <code>Bar</code> 的请求头</p><p>2、AddRequestParameter GatewayFilter Factory</p><p>为原始请求添加请求参数及值，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">add_request_parameter_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestParameter=foo,</span> <span class="hljs-string">bar</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为原始请求添加名为foo，值为bar的参数，即：<code>foo=bar</code></p><p>3、AddResponseHeader GatewayFilter Factory</p><p>为原始响应添加Header，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">add_response_header_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">AddResponseHeader=X-Response-Foo,</span> <span class="hljs-string">Bar</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为原始响应添加名为 <code>X-Request-Foo</code> ，值为 <code>Bar</code> 的响应头</p><p>4、DedupeResponseHeader GatewayFilter Factory</p><p>DedupeResponseHeader可以根据配置的Header名称及去重策略剔除响应头中重复的值，这是Spring Cloud Greenwich SR2提供的新特性，低于这个版本无法使用。</p><p>我们在Gateway以及微服务上都设置了CORS（解决跨域）Header的话，如果不做任何配置，那么请求 -&gt; 网关 -&gt; 微服务，获得的CORS Header的值，就将会是这样的：</p><div class="language-bash line-numbers-mode" data-ext="sh"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight bash"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Access-Control-Allow-Credentials: <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span><br>Access-Control-Allow-Origin: https://musk.mars, https://musk.mars<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到这两个Header的值都重复了，若想把这两个Header的值去重的话，就需要使用到DedupeResponseHeader，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">dedupe_response_header_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-comment"># 若需要去重的Header有多个，使用空格分隔</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">DedupeResponseHeader=Access-Control-Allow-Credentials</span> <span class="hljs-string">Access-Control-Allow-Origin</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>去重策略：</p><ul><li>RETAIN_FIRST：默认值，保留第一个值</li><li>RETAIN_LAST：保留最后一个值</li><li>RETAIN_UNIQUE：保留所有唯一值，以它们第一次出现的顺序保留</li></ul><p>若想对该过滤器工厂有个比较全面的了解的话，建议阅读该过滤器工厂的源码，因为源码里有详细的注释及示例，比官方文档写得还好：<code>org.springframework.cloud.gateway.filter.factory.DedupeResponseHeaderGatewayFilterFactory</code></p><p>5、Hystrix GatewayFilter Factory</p><p>为路由引入Hystrix的断路器保护，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">hystrix_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Hystrix=myCommandName</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Hystrix是Spring Cloud第一代容错组件，不过已经进入维护模式，未来Hystrix会被Spring Cloud移除掉，取而代之的是Alibaba Sentinel/Resilience4J。所以本文不做详细介绍了，感兴趣的话可以参考官方文档：</p><ul><li><a href="https://cloud.spring.io/spring-cloud-static/Greenwich.SR2/single/spring-cloud.html#hystrix" rel="noopener noreferrer" target="_blank">Hystrix GatewayFilter Factory<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>6、FallbackHeaders GatewayFilter Factory</p><p>同样是对Hystrix的支持，上一小节所介绍的过滤器工厂支持一个配置参数：<code>fallbackUri</code>，该配置用于当发生异常时将请求转发到一个特定的uri上。而<code>FallbackHeaders</code>这个过滤工厂可以在转发请求到该uri时添加一个Header，这个Header的值为具体的异常信息。配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">ingredients</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://ingredients</span><br>        <span class="hljs-attr">predicates:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Path=//ingredients/**</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Hystrix</span><br>          <span class="hljs-attr">args:</span><br>            <span class="hljs-attr">name:</span> <span class="hljs-string">fetchIngredients</span><br>            <span class="hljs-attr">fallbackUri:</span> <span class="hljs-string">forward:/fallback</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">ingredients-fallback</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">http://localhost:9994</span><br>        <span class="hljs-attr">predicates:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/fallback</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">FallbackHeaders</span><br>          <span class="hljs-attr">args:</span><br>            <span class="hljs-attr">executionExceptionTypeHeaderName:</span> <span class="hljs-string">Test-Header</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里也不做详细介绍了，感兴趣可以参考官方文档：</p><ul><li><a href="https://cloud.spring.io/spring-cloud-static/Greenwich.SR2/single/spring-cloud.html#fallback-headers" rel="noopener noreferrer" target="_blank">FallbackHeaders GatewayFilter Factory<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>7、PrefixPath GatewayFilter Factory</p><p>为原始的请求路径添加一个前缀路径，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">prefixpath_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">PrefixPath=/mypath</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该配置使访问<code>$&#123;GATEWAY_URL&#125;/hello</code> 会转发到<code>https://example.org/mypath/hello</code></p><p>8、PreserveHostHeader GatewayFilter Factory</p><p>为请求添加一个preserveHostHeader=true的属性，路由过滤器会检查该属性以决定是否要发送原始的Host Header。配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">preserve_host_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">PreserveHostHeader</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果不设置，那么名为 <code>Host</code> 的Header将由Http Client控制</p><p>9、RequestRateLimiter GatewayFilter Factory</p><p>用于对请求进行限流，限流算法为令牌桶。配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">requestratelimiter_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">RequestRateLimiter</span><br>          <span class="hljs-attr">args:</span><br>            <span class="hljs-attr">redis-rate-limiter.replenishRate:</span> <span class="hljs-number">10</span><br>            <span class="hljs-attr">redis-rate-limiter.burstCapacity:</span> <span class="hljs-number">20</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于另一篇文章中已经介绍过如何使用该过滤器工厂实现网关限流，所以这里就不再赘述了：</p><ul><li><a href="https://blog.51cto.com/zero01/2430532" rel="noopener noreferrer" target="_blank">Spring Cloud Gateway - 扩展<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>或者参考官方文档：</p><ul><li><a href="https://cloud.spring.io/spring-cloud-static/Greenwich.SR2/single/spring-cloud.html#_requestratelimiter_gatewayfilter_factory" rel="noopener noreferrer" target="_blank">RequestRateLimiter GatewayFilter Factory<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>10、RedirectTo GatewayFilter Factory</p><p>将原始请求重定向到指定的Url，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">redirect_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">RedirectTo=302,</span> <span class="hljs-string">https://acme.org</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该配置使访问 <code>$&#123;GATEWAY_URL&#125;/hello</code> 会被重定向到 <code>https://acme.org/hello</code> ，并且携带一个 <code>Location:http://acme.org</code> 的Header，而返回客户端的HTTP状态码为302</p><p>注意事项：</p><ul><li>HTTP状态码应为3xx，例如301</li><li>URL必须是合法的URL，该URL会作为<code>Location</code> Header的值</li></ul><p>11、RemoveHopByHopHeadersFilter GatewayFilter Factory</p><p>为原始请求删除<a href="https://tools.ietf.org/html/draft-ietf-httpbis-p1-messaging-14#section-7.1.3" rel="noopener noreferrer" target="_blank">IETF<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>组织规定的一系列Header，默认删除的Header如下：</p><ul><li>Connection</li><li>Keep-Alive</li><li>Proxy-Authenticate</li><li>Proxy-Authorization</li><li>TE</li><li>Trailer</li><li>Transfer-Encoding</li><li>Upgrade</li></ul><p>可以通过配置去指定仅删除哪些Header，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">filter:</span><br>        <span class="hljs-attr">remove-hop-by-hop:</span><br>          <span class="hljs-comment"># 多个Header使用逗号（,）分隔</span><br>          <span class="hljs-attr">headers:</span> <span class="hljs-string">Connection,Keep-Alive</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>12、RemoveRequestHeader GatewayFilter Factory</p><p>为原始请求删除某个Header，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">removerequestheader_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">RemoveRequestHeader=X-Request-Foo</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>删除原始请求中名为 <code>X-Request-Foo</code> 的请求头</p><p>13、RemoveResponseHeader GatewayFilter Factory</p><p>为原始响应删除某个Header，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">removeresponseheader_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">RemoveResponseHeader=X-Response-Foo</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>删除原始响应中名为 <code>X-Request-Foo</code> 的响应头</p><p>14、RewritePath GatewayFilter Factory</p><p>通过正则表达式重写原始的请求路径，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">rewritepath_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">predicates:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/foo/**</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-comment"># 参数1为原始路径的正则表达式，参数2为重写后路径的正则表达式</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">RewritePath=/foo/(?&amp;lt;segment&amp;gt;.*),</span> <span class="hljs-string">/$\&#123;segment&#125;</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该配置使得访问 <code>/foo/bar</code> 时，会将路径重写为<code>/bar</code> 再进行转发，也就是会转发到 <code>https://example.org/bar</code>。需要注意的是：由于YAML语法，需用<code>$\</code> 替换 <code>$</code></p><p>15、RewriteResponseHeader GatewayFilter Factory</p><p>重写原始响应中的某个Header，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">rewriteresponseheader_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-comment"># 参数1为Header名称，参数2为值的正则表达式，参数3为重写后的值</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">RewriteResponseHeader=X-Response-Foo,</span> <span class="hljs-string">password=[^&amp;amp;]+,</span> <span class="hljs-string">password=***</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该配置的意义在于：如果响应头中 <code>X-Response-Foo</code> 的值为<code>/42?user=ford&amp;password=omg!what&amp;flag=true</code>，那么就会被按照配置的值重写成<code>/42?user=ford&amp;password=***&amp;flag=true</code>，也就是把其中的<code>password=omg!what</code>重写成了<code>password=***</code></p><p>16、SaveSession GatewayFilter Factory</p><p>在转发请求之前，强制执行<code>WebSession::save</code>操作，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">save_session</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">predicates:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/foo/**</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">SaveSession</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>主要用在那种像 Spring Session 延迟数据存储（数据不是立刻持久化）的，并希望在请求转发前确保session状态保存情况。如果你将Spring Secutiry于Spring Session集成使用，并想确保安全信息都传到下游机器，你就需要配置这个filter。</p><p>17、secureHeaders GatewayFilter Factory</p><p>secureHeaders过滤器工厂主要是参考了<a href="https://blog.appcanary.com/2017/http-security-headers.html" rel="noopener noreferrer" target="_blank">这篇博客<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中的建议，为原始响应添加了一系列起安全作用的响应头。默认会添加如下Headers（包括值）：</p><ul><li><code>X-Xss-Protection:1; mode=block</code></li><li><code>Strict-Transport-Security:max-age=631138519</code></li><li><code>X-Frame-Options:DENY</code></li><li><code>X-Content-Type-Options:nosniff</code></li><li><code>Referrer-Policy:no-referrer</code></li><li><code>Content-Security-Policy:default-src 'self' https:; font-src 'self' https: data:; img-src 'self' https: data:; object-src 'none'; script-src https:; style-src 'self' https: 'unsafe-inline'</code></li><li><code>X-Download-Options:noopen</code></li><li><code>X-Permitted-Cross-Domain-Policies:none</code></li></ul><p>如果你想修改这些Header的值，那么就需要使用这些Headers对应的后缀，如下：</p><ul><li><code>xss-protection-header</code></li><li><code>strict-transport-security</code></li><li><code>frame-options</code></li><li><code>content-type-options</code></li><li><code>referrer-policy</code></li><li><code>content-security-policy</code></li><li><code>download-options</code></li><li><code>permitted-cross-domain-policies</code></li></ul><p>配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">filter:</span><br>        <span class="hljs-attr">secure-headers:</span><br>          <span class="hljs-comment"># 修改 X-Xss-Protection 的值为 2; mode=unblock</span><br>          <span class="hljs-attr">xss-protection-header:</span> <span class="hljs-number">2</span><span class="hljs-string">;</span> <span class="hljs-string">mode=unblock</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果想禁用某些Header，可使用如下配置：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">filter:</span><br>        <span class="hljs-attr">secure-headers:</span><br>          <span class="hljs-comment"># 多个使用逗号（,）分隔</span><br>          <span class="hljs-attr">disable:</span> <span class="hljs-string">frame-options,download-options</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>18、SetPath GatewayFilter Factory</p><p>修改原始的请求路径，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">setpath_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">predicates:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/foo/&#123;segment&#125;</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">SetPath=/&#123;segment&#125;</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该配置使访问 <code>$&#123;GATEWAY_URL&#125;/foo/bar</code> 时会转发到 <code>https://example.org/bar</code> ，也就是原本的<code>/foo/bar</code>被修改为了<code>/bar</code></p><p>19、SetResponseHeader GatewayFilter Factory</p><p>修改原始响应中某个Header的值，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">setresponseheader_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">SetResponseHeader=X-Response-Foo,</span> <span class="hljs-string">Bar</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将原始响应中 <code>X-Response-Foo</code> 的值修改为 <code>Bar</code></p><p>20、SetStatus GatewayFilter Factory</p><p>修改原始响应的状态码，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">setstatusstring_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-comment"># 字符串形式</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">SetStatus=BAD_REQUEST</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">setstatusint_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://example.org</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-comment"># 数字形式</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">SetStatus=401</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SetStatusd的值可以是数字，也可以是字符串。但一定要是Spring <code>HttpStatus</code> 枚举类中的值。上面这两种配置都可以返回401这个HTTP状态码。</p><p>21、StripPrefix GatewayFilter Factory</p><p>用于截断原始请求的路径，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">nameRoot</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">http://nameservice</span><br>        <span class="hljs-attr">predicates:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/name/**</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-comment"># 数字表示要截断的路径的数量</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">StripPrefix=2</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如上配置，如果请求的路径为 <code>/name/bar/foo</code> ，那么则会截断成<code>/foo</code>后进行转发 ，也就是会截断2个路径。</p><p>22、Retry GatewayFilter Factory</p><p>针对不同的响应进行重试，例如可以针对HTTP状态码进行重试，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">retry_test</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">http://localhost:8080/flakey</span><br>        <span class="hljs-attr">predicates:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Host=*.retry.com</span><br>        <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Retry</span><br>          <span class="hljs-attr">args:</span><br>            <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span><br>            <span class="hljs-attr">statuses:</span> <span class="hljs-string">BAD_GATEWAY</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可配置如下参数：</p><ul><li><code>retries</code>：重试次数</li><li><code>statuses</code>：需要重试的状态码，取值在 <code>org.springframework.http.HttpStatus</code> 中</li><li><code>methods</code>：需要重试的请求方法，取值在 <code>org.springframework.http.HttpMethod</code> 中</li><li><code>series</code>：HTTP状态码序列，取值在 <code>org.springframework.http.HttpStatus.Series</code> 中</li></ul><p>23、RequestSize GatewayFilter Factory</p><p>设置允许接收最大请求包的大小，配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">request_size_route</span><br>      <span class="hljs-attr">uri:</span> <span class="hljs-string">http://localhost:8080/upload</span><br>      <span class="hljs-attr">predicates:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/upload</span><br>      <span class="hljs-attr">filters:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">RequestSize</span><br>        <span class="hljs-attr">args:</span><br>          <span class="hljs-comment"># 单位为字节</span><br>          <span class="hljs-attr">maxSize:</span> <span class="hljs-number">5000000</span><br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果请求包大小超过设置的值，则会返回 <code>413 Payload Too Large</code>以及一个<code>errorMessage</code></p><p>24、Modify Request Body GatewayFilter Factory</p><p>在转发请求之前修改原始请求体内容，该过滤器工厂只能通过代码配置，不支持在配置文件中配置。代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title function_">routes</span><span class="hljs-params">(RouteLocatorBuilder builder)</span> &#123;<br>    <span class="hljs-keyword">return</span> builder.routes()<br>        .route(<span class="hljs-string">&quot;rewrite_request_obj&quot;</span>, r -&amp;gt; r.host(<span class="hljs-string">&quot;*.rewriterequestobj.org&quot;</span>)<br>            .filters(f -&amp;gt; f.prefixPath(<span class="hljs-string">&quot;/httpbin&quot;</span>)<br>                .modifyRequestBody(String.class, Hello.class, MediaType.APPLICATION_JSON_VALUE,<br>                    (exchange, s) -&amp;gt; <span class="hljs-keyword">return</span> Mono.just(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Hello</span>(s.toUpperCase())))).uri(uri))<br>        .build();<br>&#125;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hello</span> &#123;<br>    String message;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Hello</span><span class="hljs-params">()</span> &#123; &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Hello</span><span class="hljs-params">(String message)</span> &#123;<br>        <span class="hljs-built_in">this</span>.message = message;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMessage</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> message;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMessage</span><span class="hljs-params">(String message)</span> &#123;<br>        <span class="hljs-built_in">this</span>.message = message;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Tips：该过滤器工厂处于 <strong>BETA</strong> 状态，未来API可能会变化，生产环境请慎用</p></blockquote><p>25、Modify Response Body GatewayFilter Factory</p><p>可用于修改原始响应体的内容，该过滤器工厂同样只能通过代码配置，不支持在配置文件中配置。代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title function_">routes</span><span class="hljs-params">(RouteLocatorBuilder builder)</span> &#123;<br>    <span class="hljs-keyword">return</span> builder.routes()<br>        .route(<span class="hljs-string">&quot;rewrite_response_upper&quot;</span>, r -&amp;gt; r.host(<span class="hljs-string">&quot;*.rewriteresponseupper.org&quot;</span>)<br>            .filters(f -&amp;gt; f.prefixPath(<span class="hljs-string">&quot;/httpbin&quot;</span>)<br>                .modifyResponseBody(String.class, String.class,<br>                    (exchange, s) -&amp;gt; Mono.just(s.toUpperCase()))).uri(uri)<br>        .build();<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Tips：该过滤器工厂处于 <strong>BETA</strong> 状态，未来API可能会变化，生产环境请慎用</p></blockquote><p>26、Default Filters</p><p>Default Filters用于为所有路由添加过滤器工厂，也就是说通过Default Filter所配置的过滤器工厂会作用到所有的路由上。配置示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">default-filters:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">AddResponseHeader=X-Response-Default-Foo,</span> <span class="hljs-string">Default-Bar</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">PrefixPath=/httpbin</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr/><p>官方文档：<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html#_gatewayfilter_factories" rel="noopener noreferrer" target="_blank">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html#_gatewayfilter_factories<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="自定义过滤器" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#自定义过滤器">#</a> 自定义过滤器</h4><p>1、自定义 局部过滤器</p><p>麻烦，很少。</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs text">//<br>// Source code recreated from a .class file by IntelliJ IDEA<br>// (powered by FernFlower decompiler)<br>//<br><br>package org.springframework.cloud.gateway.filter.factory;<br><br>import java.util.Arrays;<br>import java.util.List;<br>import org.springframework.cloud.gateway.filter.GatewayFilter;<br>import org.springframework.cloud.gateway.filter.GatewayFilterChain;<br>import org.springframework.cloud.gateway.support.GatewayToStringStyler;<br>import org.springframework.cloud.gateway.support.ServerWebExchangeUtils;<br>import org.springframework.http.server.reactive.ServerHttpRequest;<br>import org.springframework.util.StringUtils;<br>import org.springframework.web.server.ServerWebExchange;<br>import reactor.core.publisher.Mono;<br><br>public class StripPrefixGatewayFilterFactory extends AbstractGatewayFilterFactory&amp;lt;StripPrefixGatewayFilterFactory.Config&amp;gt; &#123;<br>    public static final String PARTS_KEY = &quot;parts&quot;;<br><br>    public StripPrefixGatewayFilterFactory() &#123;<br>        super(StripPrefixGatewayFilterFactory.Config.class);<br>    &#125;<br><br>    public List&amp;lt;String&amp;gt; shortcutFieldOrder() &#123;<br>        return Arrays.asList(&quot;parts&quot;);<br>    &#125;<br><br>    public GatewayFilter apply(StripPrefixGatewayFilterFactory.Config config) &#123;<br>        return new GatewayFilter() &#123;<br>            public Mono&amp;lt;Void&amp;gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;<br>                ServerHttpRequest request = exchange.getRequest();<br>                ServerWebExchangeUtils.addOriginalRequestUrl(exchange, request.getURI());<br>                String path = request.getURI().getRawPath();<br>                String[] originalParts = StringUtils.tokenizeToStringArray(path, &quot;/&quot;);<br>                StringBuilder newPath = new StringBuilder(&quot;/&quot;);<br><br>                for(int i = 0; i &amp;lt; originalParts.length; ++i) &#123;<br>                    if (i &amp;gt;= config.getParts()) &#123;<br>                        if (newPath.length() &amp;gt; 1) &#123;<br>                            newPath.append(&#x27;/&#x27;);<br>                        &#125;<br><br>                        newPath.append(originalParts[i]);<br>                    &#125;<br>                &#125;<br><br>                if (newPath.length() &amp;gt; 1 &amp;amp;&amp;amp; path.endsWith(&quot;/&quot;)) &#123;<br>                    newPath.append(&#x27;/&#x27;);<br>                &#125;<br><br>                ServerHttpRequest newRequest = request.mutate().path(newPath.toString()).build();<br>                exchange.getAttributes().put(ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR, newRequest.getURI());<br>                return chain.filter(exchange.mutate().request(newRequest).build());<br>            &#125;<br><br>            public String toString() &#123;<br>                return GatewayToStringStyler.filterToStringCreator(StripPrefixGatewayFilterFactory.this).append(&quot;parts&quot;, config.getParts()).toString();<br>            &#125;<br>        &#125;;<br>    &#125;<br><br>    public static class Config &#123;<br>        private int parts;<br><br>        public Config() &#123;<br>        &#125;<br><br>        public int getParts() &#123;<br>            return this.parts;<br>        &#125;<br><br>        public void setParts(int parts) &#123;<br>            this.parts = parts;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2、自定义 全局过滤器</p><p>需求：1黑客ip，直接给你拒接掉。</p><p>​ 2某些请求路径 如“goods/findById”,危险操作，记录日志。</p><p>自定义全局过滤器步骤：</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">1. 定义类实现 GlobalFilter 和 Ordered接口<br>2. 复写方法<br>3. 完成逻辑处理<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>IpFilter</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.gateway.filter;<br><br><span class="hljs-keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;<br><span class="hljs-keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;<br><span class="hljs-keyword">import</span> org.springframework.core.Ordered;<br><span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;<br><span class="hljs-keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;<br><span class="hljs-keyword">import</span> org.springframework.http.server.reactive.ServerHttpResponse;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.web.server.ServerWebExchange;<br><span class="hljs-keyword">import</span> reactor.core.publisher.Mono;<br><br><span class="hljs-keyword">import</span> java.net.InetAddress;<br><span class="hljs-keyword">import</span> java.net.InetSocketAddress;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IpFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GlobalFilter</span>, Ordered &#123;<br><br>    <span class="hljs-comment">//写业务逻辑</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Mono&amp;lt;Void&amp;gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;<br>        <span class="hljs-comment">//1黑客ip，直接给你拒接掉。</span><br><br>        <span class="hljs-comment">//拿到请求和响应，为所欲为</span><br>        <span class="hljs-type">ServerHttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> exchange.getRequest();<br>        <span class="hljs-type">ServerHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> exchange.getResponse();<br><br>        <span class="hljs-type">InetSocketAddress</span> <span class="hljs-variable">remoteAddress</span> <span class="hljs-operator">=</span> request.getRemoteAddress();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">hostName</span> <span class="hljs-operator">=</span> remoteAddress.getHostName();<br>        System.out.println(hostName);<br>        <span class="hljs-type">InetAddress</span> <span class="hljs-variable">address</span> <span class="hljs-operator">=</span> remoteAddress.getAddress();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">hostAddress</span> <span class="hljs-operator">=</span> address.getHostAddress();<br>        System.out.println(hostAddress);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">hostName1</span> <span class="hljs-operator">=</span> address.getHostName();<br>        System.out.println(hostName1);<br><br>        <span class="hljs-keyword">if</span> (hostAddress.equals(<span class="hljs-string">&quot;192.168.31.11&quot;</span>)) &#123;<br>            <span class="hljs-comment">//拒绝</span><br>            response.setStatusCode(HttpStatus.UNAUTHORIZED);<br>            <span class="hljs-keyword">return</span> response.setComplete();<br>        &#125;<br><br>        <span class="hljs-comment">//走完了，该到下一个过滤器了</span><br>        <span class="hljs-keyword">return</span> chain.filter(exchange);<br>    &#125;<br><br>    <span class="hljs-comment">//返回数值，越小越先执行</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>UrlFilter</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs text">package com.ydlclass.gateway.filter;<br><br>import org.springframework.cloud.gateway.filter.GatewayFilterChain;<br>import org.springframework.cloud.gateway.filter.GlobalFilter;<br>import org.springframework.core.Ordered;<br>import org.springframework.http.server.reactive.ServerHttpRequest;<br>import org.springframework.http.server.reactive.ServerHttpResponse;<br>import org.springframework.stereotype.Component;<br>import org.springframework.web.server.ServerWebExchange;<br>import reactor.core.publisher.Mono;<br><br>import java.net.URI;<br><br>/**<br> * @Created by IT李老师<br> * 公主号 “元动力课堂”<br> * 个人微 itlils<br> */<br>@Component<br>public class UrlFilter implements GlobalFilter, Ordered &#123;<br>    @Override<br>    public Mono&amp;lt;Void&amp;gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;<br>        //某些请求路径 如“goods/findById”,危险操作，记录日志。<br><br>        //拿到请求和响应，为所欲为<br>        ServerHttpRequest request = exchange.getRequest();<br>        ServerHttpResponse response = exchange.getResponse();<br><br>        URI uri = request.getURI();<br>        String path = uri.getPath();<br>        System.out.println(path);<br><br>        if(path.contains(&quot;goods/findById&quot;))&#123;<br>            //打日志<br>            System.out.println(&quot;path很危险！&quot;);<br>        &#125;<br><br>        return chain.filter(exchange);<br>    &#125;<br><br>    @Override<br>    public int getOrder() &#123;<br>        return 1;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试：</p><p>1、ipfilter</p><figure><img class="lazy" alt="image-20220411191527069" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411191527069-40d06e6f.png" tabindex="0"/><figcaption>image-20220411191527069</figcaption></figure><p>把自己的ip设置为拒绝访问的话</p><figure><img class="lazy" alt="image-20220411191641610" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411191641610-d8bde2dd.png" tabindex="0"/><figcaption>image-20220411191641610</figcaption></figure><p>2、</p><figure><img class="lazy" alt="image-20220411192132436" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220411192132436-09d8d5e2.png" tabindex="0"/><figcaption>image-20220411192132436</figcaption></figure><h2 id="第十三章-分布式配置中心" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第十三章-分布式配置中心">#</a> 第十三章 分布式配置中心</h2><p>13-16组件，超大型公司才会用到</p><p>国内BATJ,或者国外FLAG:facebook linkedin amazon google</p><p>处理大规模微服务的技术。</p><h3 id="一、config-概述" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、config-概述">#</a> 一、Config 概述</h3><figure><img class="lazy" alt="image-20220418081959807" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418081959807-439382b4.png" tabindex="0"/><figcaption>image-20220418081959807</figcaption></figure><p>Spring Cloud Config 解决了在分布式场景下多环境配置文件的管理和维护。</p><p>好处：</p><p>• 集中管理配置文件</p><p>• 不同环境不同配置，动态化的配置更新</p><p>• 配置信息改变时，不需要重启即可更新配置信息到服务</p><h3 id="二、config-快速入门" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、config-快速入门">#</a> 二、Config 快速入门</h3><figure><img class="lazy" alt="image-20220418082533367" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418082533367-271fa629.png" tabindex="0"/><figcaption>image-20220418082533367</figcaption></figure><p><strong>config-server：</strong></p><ol><li><p>使用gitee创建远程仓库，上传配置文件</p><p>config-dev.yml</p></li><li><p>搭建 config-server 模块</p><p>ConfigServerApp</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.config;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.cloud.config.server.EnableConfigServer;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableConfigServer</span> <span class="hljs-comment">// 启用config server功能</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigServerApp</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(ConfigServerApp.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>导入 config-server 依赖</p><p>pom</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-symbol">&amp;lt;</span>!-- config-server --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-config-server<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>编写配置，设置 gitee 远程仓库地址</p><p>application.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9527</span><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">config-server</span><br>  <span class="hljs-comment"># spring cloud config</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">config:</span><br>      <span class="hljs-attr">server:</span><br>        <span class="hljs-comment"># git 的 远程仓库地址</span><br>        <span class="hljs-attr">git:</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">https://gitee.com/ydlclass_cch/ydlclass-configs.git</span><br>      <span class="hljs-attr">label:</span> <span class="hljs-string">master</span> <span class="hljs-comment"># 分支配置</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>测试访问远程配置文件</p><p><a href="http://localhost:9527/master/provider-dev.yml" rel="noopener noreferrer" target="_blank">http://localhost:9527/master/provider-dev.yml<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ol><figure><img class="lazy" alt="image-20220418083733698" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418083733698-508dfd18.png" tabindex="0"/><figcaption>image-20220418083733698</figcaption></figure><p><strong>config-client：</strong> provider</p><ol><li><p>导入 starter-config 依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!--config client --<span class="hljs-symbol">&amp;gt;</span><br> <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>     <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>     <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-config<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br> <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>配置config server 地址，读取配置文件名称等信息</p><p>bootstrap.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 配置config-server地址</span><br><span class="hljs-comment"># 配置获得配置文件的名称等信息</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">config:</span><br>      <span class="hljs-comment"># 配置config-server地址</span><br>      <span class="hljs-attr">uri:</span> <span class="hljs-string">http://localhost:9527</span><br>      <span class="hljs-comment"># 配置获得配置文件的名称等信息</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">provider</span> <span class="hljs-comment"># 文件名</span><br>      <span class="hljs-attr">profile:</span> <span class="hljs-string">dev</span> <span class="hljs-comment"># profile指定，  config-dev.yml</span><br>      <span class="hljs-attr">label:</span> <span class="hljs-string">master</span> <span class="hljs-comment"># 分支</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>获取配置值</p><p>GoodsController</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Value(&quot;$&#123;ydlclass&#125;&quot;)</span><br><span class="hljs-keyword">private</span> String ydlclass;<br><br>goods.setTitle(goods.getTitle()+<span class="hljs-string">&quot;|端口号：&quot;</span>+port+<span class="hljs-string">&quot;|ydlclass&quot;</span>+ydlclass);<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>启动测试</p><p><a href="http://localhost:8000/goods/findById/9" rel="noopener noreferrer" target="_blank">http://localhost:8000/goods/findById/9<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ol><figure><img class="lazy" alt="image-20220418084608302" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418084608302-978afefa.png" tabindex="0"/><figcaption>image-20220418084608302</figcaption></figure><p><strong>Config 客户端刷新</strong></p><figure><img class="lazy" alt="image-20220418085057098" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418085057098-ae365b9f.png" tabindex="0"/><figcaption>image-20220418085057098</figcaption></figure><ol><li><p>在 config 客户端引入 actuator 依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>       <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>       <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-actuator<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>   <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>获取配置信息类上，添加 @RefreshScope 注解</p><p>GoodsController</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RefreshScope</span> <span class="hljs-comment">// 开启刷新功能</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div></li><li><p>添加配置</p><p>bootstrap.yml</p></li></ol><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">web:</span><br>      <span class="hljs-attr">exposure:</span><br>        <span class="hljs-attr">include:</span> <span class="hljs-string">&#x27;*&#x27;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li><p>使用curl工具发送post请求</p><p>curl -X POST <a href="http://localhost:8000/actuator/refresh" rel="noopener noreferrer" target="_blank">http://localhost:8000/actuator/refresh<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220418085907801" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418085907801-edb89cde.png" tabindex="0"/><figcaption>image-20220418085907801</figcaption></figure></li></ol><p>测试： 值已经变了</p><figure><img class="lazy" alt="image-20220418085930400" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418085930400-9adcb0c7.png" tabindex="0"/><figcaption>image-20220418085930400</figcaption></figure><h3 id="三、config-集成eureka" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、config-集成eureka">#</a> 三、Config 集成Eureka</h3><figure><img class="lazy" alt="image-20220418090254336" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418090254336-8b4469ba.png" tabindex="0"/><figcaption>image-20220418090254336</figcaption></figure><p><strong>config-client配置：</strong></p><p>pom</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- eureka-client --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ProviderApp</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableEurekaClient</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>bootstrap.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 配置config-server地址</span><br><span class="hljs-comment"># 配置获得配置文件的名称等信息</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">config:</span><br>      <span class="hljs-comment"># 配置config-server地址</span><br>      <span class="hljs-comment">#uri: http://localhost:9527</span><br>      <span class="hljs-comment"># 配置获得配置文件的名称等信息</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">config</span> <span class="hljs-comment"># 文件名</span><br>      <span class="hljs-attr">profile:</span> <span class="hljs-string">dev</span> <span class="hljs-comment"># profile指定，  config-dev.yml</span><br>      <span class="hljs-attr">label:</span> <span class="hljs-string">master</span> <span class="hljs-comment"># 分支</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">service-id:</span> <span class="hljs-string">CONFIG-SERVER</span><br><br><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">web:</span><br>      <span class="hljs-attr">exposure:</span><br>        <span class="hljs-attr">include:</span> <span class="hljs-string">&#x27;*&#x27;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>config-server配置:</strong></p><p>pom</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- eureka-client --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ConfigServerApp</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableEurekaClient</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div></div></div><p>application.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">eureka:</span><br>   <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:8761/eureka</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试：</p><figure><img class="lazy" alt="image-20220418093808497" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418093808497-b6035ff7.png" tabindex="0"/><figcaption>image-20220418093808497</figcaption></figure><h2 id="第十四章-springcloud-bus消息总线" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第十四章-springcloud-bus消息总线">#</a> 第十四章 SpringCloud Bus消息总线</h2><p>远程的配置文件更新了，运维只需要发一个请求，所有用到这个配置文件的几百个应用更新了。</p><h3 id="一、bus-概述" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、bus-概述">#</a> 一、Bus 概述</h3><figure><img class="lazy" alt="image-20220418094548555" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418094548555-e5074738.png" tabindex="0"/><figcaption>image-20220418094548555</figcaption></figure><p>Spring Cloud Bus 是用轻量的消息中间件将分布式的节点连接起来，可以用于广播配置文件的更改或者服务的监控管理。关键的思想就是，消息总线可以为微服务做监控，也可以实现应用程序之间相通信。</p><p>Spring Cloud Bus 可选的消息中间件包括 RabbitMQ 和 Kafka 。</p><h3 id="二、rabbitmq-回顾" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、rabbitmq-回顾">#</a> 二、RabbitMQ 回顾</h3><p>message queue</p><p>异步、解耦、削峰填谷</p><figure><img class="lazy" alt="image-20200613074044506" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20200613074044506-2b1f2272.png" tabindex="0"/><figcaption>image-20200613074044506</figcaption></figure><figure><img class="lazy" alt="image-20200613074052830" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20200613074052830-5aedea61.png" tabindex="0"/><figcaption>image-20200613074052830</figcaption></figure><p>RabbitMQ 提供了 6 种工作模式：简单模式、work queues、Publish/Subscribe 发布与订阅模式、Routing</p><p>路由模式、Topics 主题模式、RPC 远程调用模式（远程调用，不太算 MQ；暂不作介绍）。</p><figure><img class="lazy" alt="image-20200613074109383" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20200613074109383-dc1a9615.png" tabindex="0"/><figcaption>image-20200613074109383</figcaption></figure><h3 id="三、bus-快速入门-运维" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、bus-快速入门-运维">#</a> 三、Bus 快速入门-运维</h3><figure><img class="lazy" alt="image-20220418094548555" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418094548555-e5074738.png" tabindex="0"/><figcaption>image-20220418094548555</figcaption></figure><p>1、分别在 config-server 和 config-client中引入 bus依赖：bus-amqp</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- bus --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-bus-amqp<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-actuator<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2、分别在 config-server 和 config-client中配置 RabbitMQ</p><p>server 的配置文件：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9527</span><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">config-server</span><br>  <span class="hljs-comment"># spring cloud config</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">config:</span><br>      <span class="hljs-attr">server:</span><br>        <span class="hljs-comment"># git 的 远程仓库地址</span><br>        <span class="hljs-attr">git:</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">https://gitee.com/ydlclass_cch/ydlclass-configs.git</span><br>      <span class="hljs-attr">label:</span> <span class="hljs-string">master</span> <span class="hljs-comment"># 分支配置</span><br>  <span class="hljs-comment">#配置rabbitmq信息</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span><br>    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span><br><br><span class="hljs-comment"># 将自己注册到eureka中</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:8761/eureka</span><br><br><span class="hljs-comment"># 暴露bus的刷新端点</span><br><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">web:</span><br>      <span class="hljs-attr">exposure:</span><br>        <span class="hljs-attr">include:</span> <span class="hljs-string">&#x27;bus-refresh&#x27;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>client的配置文件 bootstrap.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 配置config-server地址</span><br><span class="hljs-comment"># 配置获得配置文件的名称等信息</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">config:</span><br>      <span class="hljs-comment"># 配置config-server地址</span><br>      <span class="hljs-comment"># uri: http://localhost:9527</span><br>      <span class="hljs-comment"># 配置获得配置文件的名称等信息</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">config</span> <span class="hljs-comment"># 文件名</span><br>      <span class="hljs-attr">profile:</span> <span class="hljs-string">dev</span> <span class="hljs-comment"># profile指定，  config-dev.yml</span><br>      <span class="hljs-attr">label:</span> <span class="hljs-string">master</span> <span class="hljs-comment"># 分支</span><br>      <span class="hljs-comment"># 从注册中心去寻找config-server地址</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">service-id:</span> <span class="hljs-string">CONFIG-SERVER</span><br>  <span class="hljs-comment">#配置rabbitmq信息</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span><br>    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span><br><br><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">web:</span><br>      <span class="hljs-attr">exposure:</span><br>        <span class="hljs-attr">include:</span> <span class="hljs-string">&#x27;*&#x27;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>在config-server中设置暴露监控断点：bus-refresh</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 暴露bus的刷新端点</span><br><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">web:</span><br>      <span class="hljs-attr">exposure:</span><br>        <span class="hljs-attr">include:</span> <span class="hljs-string">&#x27;bus-refresh&#x27;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>bus自动在mq中建立交换机</p><figure><img class="lazy" alt="image-20220418095857082" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418095857082-c146dc82.png" tabindex="0"/><figcaption>image-20220418095857082</figcaption></figure><p>只要微服务起起来，自动在mq中，建立队列，和交换机绑定</p><figure><img class="lazy" alt="image-20220418100013437" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418100013437-ff032e6b.png" tabindex="0"/><figcaption>image-20220418100013437</figcaption></figure><p>启动测试</p><p>1.git配置改变</p><figure><img class="lazy" alt="image-20220418104835631" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418104835631-9d49fe01.png" tabindex="0"/><figcaption>image-20220418104835631</figcaption></figure><p>2.往配置中心发请求</p><p>curl -X POST <a href="http://localhost:9527/actuator/bus-refresh" rel="noopener noreferrer" target="_blank">http://localhost:9527/actuator/bus-refresh<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20220418104622908" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/ZAQAAwKk.png" tabindex="0"/><figcaption>image-20220418104622908</figcaption></figure><p>3.微服务自动重启</p><figure><img class="lazy" alt="image-20220418104702500" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418104702500-bbdf21ca.png" tabindex="0"/><figcaption>image-20220418104702500</figcaption></figure><p>4.访问微服务，发现配置已经改变</p><figure><img class="lazy" alt="image-20220418104819862" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418104819862-b829a33e.png" tabindex="0"/><figcaption>image-20220418104819862</figcaption></figure><h2 id="第十五章-springcloud-stream消息驱动" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第十五章-springcloud-stream消息驱动">#</a> 第十五章 SpringCloud Stream消息驱动</h2><h3 id="一、stream-概述" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、stream-概述">#</a> 一、Stream 概述</h3><figure><img class="lazy" alt="image-20220418111329857" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418111329857-7c8547d2.png" tabindex="0"/><figcaption>image-20220418111329857</figcaption></figure><p>1.Spring Cloud Stream 是一个构建消息驱动微服务应用的框架。</p><p>2.Stream 解决了开发人员<strong>无感知</strong>的使用消息中间件的问题，因为Stream对消息中间件的进一步封装，可以做到代码层面对中间件的无感知，甚至于<strong>动态的切换中间件</strong>，使得微服务开发的高度解耦，服务可以关注更多自己的业务流程。</p><p>3.Spring Cloud Stream目前支持两种消息中间件RabbitMQ和Kafka</p><p>就像jdbc一样</p><figure><img class="lazy" alt="image-20220418111643163" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418111643163-1006efdf.png" tabindex="0"/><figcaption>image-20220418111643163</figcaption></figure><p><strong>Stream 组件</strong></p><figure><img class="lazy" alt="image-20200613074759833" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20200613074759833-b4428b4e.png" tabindex="0"/><figcaption>image-20200613074759833</figcaption></figure><p>Spring Cloud Stream 构建的应用程序与消息中间件之间是通过绑定器 Binder 相关联的。绑定器对于应用程序而言起到了隔离作用， 它使得不同消息中间件的实现细节对应用程序来说是透明的。</p><p>binding 是我们通过配置把应用和spring cloud stream 的 binder 绑定在一起</p><p>output：发送消息 Channel，内置 Source接口</p><p>input：接收消息 Channel，内置 Sink接口</p><h3 id="二、stream-消息生产者" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、stream-消息生产者">#</a> 二、Stream 消息生产者</h3><p>pom</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;<br>         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>parent<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>stream-parent<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>com.ydlclass<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.0-SNAPSHOT<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/parent<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>modelVersion<span class="hljs-symbol">&amp;gt;</span>4.0.0<span class="hljs-symbol">&amp;lt;</span>/modelVersion<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>stream-producer<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><br><br>    <span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>!--spring boot web--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-web<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br><br>        <span class="hljs-symbol">&amp;lt;</span>!-- stream --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-stream-rabbit<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>/project<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ProducerApp</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.stream;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProducerApp</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        SpringApplication.run(ProducerApp.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8000</span><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">stream:</span><br>      <span class="hljs-comment"># 定义绑定器，绑定到哪个消息中间件上</span><br>      <span class="hljs-attr">binders:</span><br>        <span class="hljs-attr">ydlclass_binder:</span> <span class="hljs-comment"># 自定义的绑定器名称</span><br>          <span class="hljs-attr">type:</span> <span class="hljs-string">rabbit</span> <span class="hljs-comment"># 绑定器类型</span><br>          <span class="hljs-attr">environment:</span> <span class="hljs-comment"># 指定mq的环境</span><br>            <span class="hljs-attr">spring:</span><br>              <span class="hljs-attr">rabbitmq:</span><br>                <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>                <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br>                <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span><br>                <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span><br>                <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span><br>      <span class="hljs-attr">bindings:</span><br>        <span class="hljs-attr">output:</span> <span class="hljs-comment"># channel名称</span><br>          <span class="hljs-attr">binder:</span> <span class="hljs-string">ydlclass_binder</span> <span class="hljs-comment">#指定使用哪一个binder</span><br>          <span class="hljs-attr">destination:</span> <span class="hljs-string">ydlclass_exchange</span> <span class="hljs-comment"># 消息目的地</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>消息发送类 MessageProducer</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.stream.producer;<br><br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.cloud.stream.annotation.EnableBinding;<br><span class="hljs-keyword">import</span> org.springframework.cloud.stream.messaging.Source;<br><span class="hljs-keyword">import</span> org.springframework.messaging.MessageChannel;<br><span class="hljs-keyword">import</span> org.springframework.messaging.support.MessageBuilder;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@EnableBinding(Source.class)</span><span class="hljs-comment">//这个类是stream的发送者</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageProducer</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    MessageChannel output;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">send</span><span class="hljs-params">(String msg)</span>&#123;<br>        output.send(MessageBuilder.withPayload(msg).build());<br>        System.out.println(<span class="hljs-string">&quot;MessageProducer 确实发了消息了！&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>调用的controller ProducerController</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.stream.controller;<br><br><span class="hljs-keyword">import</span> com.ydlclass.stream.producer.MessageProducer;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Created</span> by IT李老师</span><br><span class="hljs-comment"> * 公主号 “元动力课堂”</span><br><span class="hljs-comment"> * 个人微 itlils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;test&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProducerController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    MessageProducer messageProducer;<br>    <span class="hljs-comment">//业务逻辑</span><br>    <span class="hljs-meta">@GetMapping(&quot;/send&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">send</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//发消息</span><br>        String msg=<span class="hljs-string">&quot;使用stream来发消息了！&quot;</span>;<br><br>        messageProducer.send(msg);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success!&quot;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img class="lazy" alt="image-20220418114016165" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418114016165-e7af66ff.png" tabindex="0"/><figcaption>image-20220418114016165</figcaption></figure><h3 id="三、stream-消息消费者" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#三、stream-消息消费者">#</a> 三、Stream 消息消费者</h3><p>pom</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;<br>         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>parent<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>stream-parent<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>com.ydlclass<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>version<span class="hljs-symbol">&amp;gt;</span>1.0-SNAPSHOT<span class="hljs-symbol">&amp;lt;</span>/version<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>/parent<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>modelVersion<span class="hljs-symbol">&amp;gt;</span>4.0.0<span class="hljs-symbol">&amp;lt;</span>/modelVersion<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>stream-consumer<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><br><br>    <span class="hljs-symbol">&amp;lt;</span>dependencies<span class="hljs-symbol">&amp;gt;</span><br><br>        <span class="hljs-symbol">&amp;lt;</span>!--spring boot web--<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.boot<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-boot-starter-web<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br><br>        <span class="hljs-symbol">&amp;lt;</span>!-- stream --<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>            <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-stream-rabbit<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br>        <span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br><br>    <span class="hljs-symbol">&amp;lt;</span>/dependencies<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/project<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ConsumerApp</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.stream;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerApp</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        SpringApplication.run(ConsumerApp.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span><br><br><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">stream:</span><br>      <span class="hljs-comment"># 定义绑定器，绑定到哪个消息中间件上</span><br>      <span class="hljs-attr">binders:</span><br>        <span class="hljs-attr">ydlclass_binder:</span> <span class="hljs-comment"># 自定义的绑定器名称</span><br>          <span class="hljs-attr">type:</span> <span class="hljs-string">rabbit</span> <span class="hljs-comment"># 绑定器类型</span><br>          <span class="hljs-attr">environment:</span> <span class="hljs-comment"># 指定mq的环境</span><br>            <span class="hljs-attr">spring:</span><br>              <span class="hljs-attr">rabbitmq:</span><br>                <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>                <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br>                <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span><br>                <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span><br>                <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span><br>      <span class="hljs-attr">bindings:</span><br>        <span class="hljs-attr">input:</span> <span class="hljs-comment"># channel名称</span><br>          <span class="hljs-attr">binder:</span> <span class="hljs-string">ydlclass_binder</span> <span class="hljs-comment">#指定使用哪一个binder</span><br>          <span class="hljs-attr">destination:</span> <span class="hljs-string">ydlclass_exchange</span> <span class="hljs-comment"># 消息目的地</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>消息接收类 MessageListener</p><div class="language-java line-numbers-mode" data-ext="java"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight java"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ydlclass.stream.consumer;<br><br><span class="hljs-keyword">import</span> org.springframework.cloud.stream.annotation.EnableBinding;<br><span class="hljs-keyword">import</span> org.springframework.cloud.stream.annotation.StreamListener;<br><span class="hljs-keyword">import</span> org.springframework.cloud.stream.messaging.Sink;<br><span class="hljs-keyword">import</span> org.springframework.messaging.Message;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 消息接收类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@EnableBinding(&#123;Sink.class&#125;)</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageListener</span> &#123;<br><br>    <span class="hljs-meta">@StreamListener(Sink.INPUT)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receive</span><span class="hljs-params">(Message message)</span>&#123;<br><br>        System.out.println(message);<br>        System.out.println(message.getPayload());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试</p><figure><img class="lazy" alt="image-20220418154602979" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418154602979-4f1f002f.png" tabindex="0"/><figcaption>image-20220418154602979</figcaption></figure><h2 id="第十六章-springcloud-sleuth分布式请求链路追踪" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#第十六章-springcloud-sleuth分布式请求链路追踪">#</a> 第十六章 SpringCloud Sleuth分布式请求链路追踪</h2><h3 id="一、概述-2" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#一、概述-2">#</a> 一、概述</h3><figure><img class="lazy" alt="image-20220418155007573" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418155007573-1c1b8bdd.png" tabindex="0"/><figcaption>image-20220418155007573</figcaption></figure><p>Spring Cloud Sleuth 其实是一个工具,它在整个分布式系统中能跟踪一个用户请求的过程，捕获这些跟踪数据，就能构建微服务的整个调用链的视图，这是调试和监控微服务的关键工具。</p><div class="language-text line-numbers-mode" data-ext="text"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight text"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">耗时分析 <br>可视化错误 <br>链路优化<br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Zipkin 是 Twitter 的一个开源项目，它致力于收集服务的定时数据，以解决微服务架构中的延迟问题，包括数据的收集、存储、查找和展现。</p><h3 id="二、快速入门-1" tabindex="-1"><a aria-hidden="true" class="header-anchor" href="#二、快速入门-1">#</a> 二、快速入门</h3><ol><li><p>安装启动zipkin。 java –jar zipkin.jar</p><figure><img class="lazy" alt="image-20220418185033323" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418185033323-76dc027c.png" tabindex="0"/><figcaption>image-20220418185033323</figcaption></figure></li><li><p>访问zipkin web界面。 <a href="http://localhost:9411/" rel="noopener noreferrer" target="_blank">http://localhost:9411/<span><svg aria-hidden="true" class="external-link-icon" focusable="false" height="15" viewbox="0 0 100 100" width="15" x="0px" xmlns="http://www.w3.org/2000/svg" y="0px"><path d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" fill="currentColor"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img class="lazy" alt="image-20200613080015686" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20200613080015686-e297485f.png" tabindex="0"/><figcaption>image-20200613080015686</figcaption></figure></li><li><p>在服务提供方和消费方分别引入 sleuth 和 zipkin 依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight xml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;lt;</span>!-- sleuth-zipkin --<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>!--<span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-sleuth<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span>--<span class="hljs-symbol">&amp;gt;</span><br><br><span class="hljs-symbol">&amp;lt;</span>dependency<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>groupId<span class="hljs-symbol">&amp;gt;</span>org.springframework.cloud<span class="hljs-symbol">&amp;lt;</span>/groupId<span class="hljs-symbol">&amp;gt;</span><br>    <span class="hljs-symbol">&amp;lt;</span>artifactId<span class="hljs-symbol">&amp;gt;</span>spring-cloud-starter-zipkin<span class="hljs-symbol">&amp;lt;</span>/artifactId<span class="hljs-symbol">&amp;gt;</span><br><span class="hljs-symbol">&amp;lt;</span>/dependency<span class="hljs-symbol">&amp;gt;</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>分别配置服务提供方和消费方。</p><p>provider</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8001</span><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:8761/eureka</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">feign-provider</span><br>  <span class="hljs-attr">zipkin:</span><br>    <span class="hljs-attr">base-url:</span> <span class="hljs-string">http://localhost:9411/</span>  <span class="hljs-comment"># 设置zipkin的服务端路径</span><br>  <span class="hljs-attr">sleuth:</span><br>    <span class="hljs-attr">sampler:</span><br>      <span class="hljs-attr">probability:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># 采集率 默认 0.1 百分之十。</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>consumer</p><div class="language-yaml line-numbers-mode" data-ext="yml"><button aria-label="复制代码" class="copy-code-button" data-copied="已复制"><div class="copy-icon"></div></button>

<figure class="highlight yaml"><figcaption><span>From: 元动力</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment"># 主机名</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:8761/eureka</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">feign-consumer</span> <span class="hljs-comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span><br>  <span class="hljs-attr">zipkin:</span><br>    <span class="hljs-attr">base-url:</span> <span class="hljs-string">http://localhost:9411/</span>  <span class="hljs-comment"># 设置zipkin的服务端路径</span><br>  <span class="hljs-attr">sleuth:</span><br>    <span class="hljs-attr">sampler:</span><br>      <span class="hljs-attr">probability:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># 采集率 默认 0.1 百分之十。</span><br><span class="hljs-attr">logging:</span><br>  <span class="hljs-attr">level:</span><br>    <span class="hljs-attr">com.ydlclass:</span> <span class="hljs-string">debug</span><br></code></pre></td></tr></table></figure>

<div aria-hidden="true" class="line-numbers"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>启动，测试</p></li></ol><figure><img class="lazy" alt="image-20220418160537372" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418160537372-c7993f21.png" tabindex="0"/><figcaption>image-20220418160537372</figcaption></figure><p>调用关系图也能展现</p><figure><img class="lazy" alt="image-20220418160602065" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/ydldoc/YDLImages/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/springcloud/SpringCloud/image-20220418160602065-25c4ceff.png" tabindex="0"/><figcaption>image-20220418160602065</figcaption></figure></div></article>
<div class="article-footer"></div>

<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">回顾上一篇</div><a href="/wiki/YDLDoc3/ELK%E5%85%A5%E9%97%A8/elk%E8%BF%9B%E9%98%B6/elk%E8%BF%9B%E9%98%B6.html">elk进阶</a></div><div class="item" id="next"><div class="note">接下来阅读</div><a href="/wiki/YDLDoc3/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx%E5%85%A5%E9%97%A8/nginx%E5%85%A5%E9%97%A8.html">nginx入门</a></div></section></div>


  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>快来参与讨论吧~</p>

    </section>
    <section class='body cmt-body waline'>
      

<div id="waline_container" class="waline_thread"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>

    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="sitemap"><div class="sitemap-group"><span class="fs15">博客</span><a href="/">近期</a><a href="/categories/">分类</a><a href="/tags/">标签</a><a href="/archives/">归档</a></div><div class="sitemap-group"><span class="fs15">站点</span><a target="_blank" rel="noopener" href="https://status.thatcoder.cn/status/public/">公共服务</a><a target="_blank" rel="noopener" href="https://ai.thatcoder.cn/">ChatGPT</a><a target="_blank" rel="noopener" href="https://alist.thatcdn.cn/">文件资源</a><a target="_blank" rel="noopener" href="https://docs.thatapi.cn/">公共接口</a></div><div class="sitemap-group"><span class="fs15">社交</span><a href="/links/">友人帐</a><a href="/links/#comments">留言板</a><a href="/animes/">在追番</a><a href="/cinemas/">还追剧</a></div><div class="sitemap-group"><span class="fs15">更多</span><a href="/about/#tab_1-1/">本站动态</a><a target="_blank" rel="noopener" href="https://muselink.cc/naive">联系博主</a><a target="_blank" rel="noopener" href="https://github.com/ThatCoders">GitHub</a><a target="_blank" rel="noopener" href="https://gitea.thatcdn.cn/thatcoder">Gitea</a></div></div><div class="text"><p style="text-align:center" >
本站由 <a style="font-weight: bold;" href="/author/ThatCoder/">钟意</a> 使用 <a style="font-weight: bold;" target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.31.0">Stellar 1.31.0</a> 主题创建。
<br>
由 <a style="font-weight: bold;" target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral">又拍云</a> 提供CDN加速/云存储服务
<br>
由 <a style="font-weight: bold;" target="_blank" rel="noopener" href="https://vercel.com/">vercel</a>、<a style="font-weight: bold;" target="_blank" rel="noopener" href="https://www.netlify.com/">netlify</a>、<a style="font-weight: bold;" target="_blank" rel="noopener" href="https://www.cloudflare.com/">cloudflare</a> 提供托管服务
<br>
<a href="https://beian.miit.gov.cn/" target="_blank">湘ICP备2023019799号-1</a>
<br>
<!--不蒜子计数器-->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!--添加一个访问量-->
<span>总访问 <span id="busuanzi_value_site_pv" style="font-weight: bold;"></span> 次 
<!--本页访问 <span id="busuanzi_value_page_pv" style="font-weight: bold;"></span> 次</span>-->
<div id="siteruntime"></div>
</p>
<script>
function siteTime(){
    window.setTimeout("siteTime()", 1000);
    var seconds = 1000
    var minutes = seconds * 60
    var hours = minutes * 60
    var days = hours * 24
    var years = days * 365
    var today = new Date()
    var todayYear = today.getFullYear()
    var todayMonth = today.getMonth()
    var todayDate = today.getDate()
    var todayHour = today.getHours()
    var todayMinute = today.getMinutes()
    var todaySecond = today.getSeconds()
    var t1 = Date.UTC(2020,4,30,08,00,00)
    var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond)
    var diff = t2-t1
    var diffYears = Math.floor(diff/years)
    var diffDays = Math.floor((diff/days)-diffYears*365)
    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours)
    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes)
    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds)
    document.getElementById("siteruntime").innerHTML="<p style=\"text-align:center\">小破站已颠沛流离 "+diffYears+" 年 "+diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒</p>"
}
siteTime();
</script>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="auto"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-%E8%AF%BE%E7%A8%8B%E4%BB%8B%E7%BB%8D"><span class="toc-text"> 介绍：课程介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#_1%E3%80%81%E5%89%8D%E7%BD%AE"><span class="toc-text"> 1、前置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#_2%E3%80%81%E7%89%B9%E7%82%B9"><span class="toc-text"> 2、特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#_3%E3%80%81%E5%A6%82%E4%BD%95%E5%AD%A6%E4%B9%A0"><span class="toc-text"> 3、如何学习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#_4%E3%80%81%E9%9D%A2%E5%90%91%E4%BA%BA%E5%91%98"><span class="toc-text"> 4、面向人员</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#_5%E3%80%81%E5%BF%83%E6%80%81"><span class="toc-text"> 5、心态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#_6%E3%80%81%E8%8E%B7%E5%8F%96%E8%B5%84%E6%96%99"><span class="toc-text"> 6、获取资料</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-springcloud%E7%AE%80%E4%BB%8B"><span class="toc-text"> 第一章 SpringCloud简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81-%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B"><span class="toc-text"> 一、 软件架构演进</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-text"> 二、微服务架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%90%86%E5%BF%B5"><span class="toc-text"> 1、 微服务理念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-%E7%8E%B0%E5%9C%A8%E5%A4%A7%E5%9E%8B%E4%BA%92%E8%81%94%E7%BD%91%E5%85%AC%E5%8F%B8-%E9%83%BD%E5%9C%A8%E4%BD%BF%E7%94%A8%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-text"> 2、 现在大型互联网公司，都在使用微服务架构：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81-springcloud%E7%BB%84%E4%BB%B6"><span class="toc-text"> 3、 springcloud组件：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E8%B5%B0%E8%BF%9Bspringcloud"><span class="toc-text"> 第二章 走进springcloud</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BA%86%E8%A7%A3springcloud"><span class="toc-text"> 一、了解springcloud</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-cloud%E4%B8%8Eboot%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB"><span class="toc-text"> 二、 cloud与boot版本对应关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81-dubbo%E5%AF%B9%E6%AF%94"><span class="toc-text"> 三、 dubbo对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%81%9C%E6%9B%B4-%E5%8D%87%E7%BA%A7-%E6%9B%BF%E6%8D%A2"><span class="toc-text"> 第三章 停更&#x2F;升级&#x2F;替换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%BC%96%E7%A0%81%E6%9E%84%E5%BB%BA"><span class="toc-text"> 第四章 微服务架构编码构建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81-%E6%90%AD%E5%BB%BA-provider-%E5%92%8C-consumer-%E6%9C%8D%E5%8A%A1"><span class="toc-text"> 一、 搭建 Provider 和 Consumer 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E7%88%B6%E5%B7%A5%E7%A8%8B-spring-cloud-parent"><span class="toc-text"> 1、父工程 spring-cloud-parent</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E6%8F%90%E4%BE%9B%E8%80%85-eureka-provider"><span class="toc-text"> 2、提供者 eureka-provider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E6%B6%88%E8%B4%B9%E8%80%85-eureka-consumer"><span class="toc-text"> 3、消费者 eureka-consumer</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8-resttemplate-%E5%AE%8C%E6%88%90%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="toc-text"> 二、使用 RestTemplate 完成远程调用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-eureka%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0"><span class="toc-text"> 第五章 Eureka服务注册与发现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81eureka"><span class="toc-text"> 一、Eureka</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-%E6%90%AD%E5%BB%BA-eureka-server-%E6%9C%8D%E5%8A%A1"><span class="toc-text"> 二、 搭建 Eureka Server 服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81-%E6%94%B9%E9%80%A0-provider-%E5%92%8C-consumer-%E7%A7%B0%E4%B8%BA-eureka-client"><span class="toc-text"> 三、 改造 Provider 和 Consumer 称为 Eureka Client</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81-consumer-%E6%9C%8D%E5%8A%A1-%E9%80%9A%E8%BF%87%E4%BB%8E-eureka-server-%E4%B8%AD%E6%8A%93%E5%8F%96-provider-%E5%9C%B0%E5%9D%80-%E5%AE%8C%E6%88%90%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="toc-text"> 四、 Consumer 服务 通过从 Eureka Server 中抓取 Provider 地址，完成远程调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81-euraka%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3"><span class="toc-text"> 五、 Euraka配置详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E5%AE%9E%E4%BE%8B%E4%BF%A1%E6%81%AF%E9%85%8D%E7%BD%AE"><span class="toc-text"> 1、实例信息配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%89%B9%E6%80%A7%E9%85%8D%E7%BD%AE"><span class="toc-text"> 2、客户端特性配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="toc-text"> 3、注册中心端配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_4%E3%80%81%E4%BB%AA%E8%A1%A8%E7%9B%98%E9%85%8D%E7%BD%AE"><span class="toc-text"> 4、仪表盘配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-text"> 六、高可用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-zookeeper%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0"><span class="toc-text"> 第六章 Zookeeper服务注册与发现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0"><span class="toc-text"> 第七章 Consul服务注册与发现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text"> 一、 是什么：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-%E6%80%8E%E4%B9%88%E7%94%A8"><span class="toc-text"> 二、 怎么用：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81-%E5%87%86%E5%A4%87"><span class="toc-text"> 1、 准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81-%E6%90%AD%E5%BB%BA-consul-provider"><span class="toc-text"> 2、 搭建 consul-provider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E6%90%AD%E5%BB%BA-consul-consumer"><span class="toc-text"> 3、搭建 consul-consumer</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81-%E4%B8%89%E4%B8%AA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%9A%84%E5%BC%82%E5%90%8C"><span class="toc-text"> 三、 三个注册中心的异同</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0-ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8"><span class="toc-text"> 第八章 Ribbon负载均衡服务调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text"> 一、是什么</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-text"> 1、服务端负载均衡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-text"> 2、客户端负载均衡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="toc-text"> 二、如何使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81ribbon-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5"><span class="toc-text"> 三、ribbon 负载均衡策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81-%E8%AE%BE%E7%BD%AEribbon-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5"><span class="toc-text"> 四、 设置ribbon 负载均衡策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E4%BB%A3%E7%A0%81"><span class="toc-text"> 1、代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E9%85%8D%E7%BD%AE"><span class="toc-text"> 2、配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B9%9D%E7%AB%A0%E3%80%81openfeign%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8"><span class="toc-text"> 第九章、OpenFeign服务接口调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="toc-text"> 一、概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text"> 二、快速入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%85%B6%E4%BB%96%E8%AE%BE%E7%BD%AE"><span class="toc-text"> 三、其他设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E8%B6%85%E6%97%B6%E8%AE%BE%E7%BD%AE"><span class="toc-text"> 1、超时设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="toc-text"> 2、日志记录</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text"> </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E7%AB%A0-hystrix%E6%96%AD%E8%B7%AF%E5%99%A8-%E8%B1%AA%E7%8C%AA-%E4%BF%9D%E9%99%A9%E4%B8%9D"><span class="toc-text"> 第十章 Hystrix断路器 （豪猪）-保险丝</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0-1"><span class="toc-text"> 一、概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7"><span class="toc-text"> 二、服务降级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%86%94%E6%96%AD"><span class="toc-text"> 三、熔断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E7%86%94%E6%96%AD%E7%9B%91%E6%8E%A7-%E8%BF%90%E7%BB%B4"><span class="toc-text"> 四、熔断监控**-运维</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E6%90%AD%E5%BB%BA%E7%9B%91%E6%8E%A7%E6%A8%A1%E5%9D%97"><span class="toc-text"> 1、搭建监控模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E4%BF%AE%E6%94%B9%E8%A2%AB%E7%9B%91%E6%8E%A7%E6%A8%A1%E5%9D%97"><span class="toc-text"> 2、修改被监控模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_3%E3%80%81%E5%90%AF%E5%8A%A8%E6%B5%8B%E8%AF%95"><span class="toc-text"> 3、启动测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%E3%80%81zuul%E8%B7%AF%E7%94%B1%E7%BD%91%E5%85%B3"><span class="toc-text"> 第十一章、zuul路由网关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0-gateway%E6%96%B0%E4%B8%80%E4%BB%A3%E7%BD%91%E5%85%B3"><span class="toc-text"> 第十二章 Gateway新一代网关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81-%E6%A6%82%E8%BF%B0"><span class="toc-text"> 一、 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text"> 二、 快速入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81-%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-text"> 三、 静态路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-text"> 四、动态路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_1%E3%80%81%E5%BC%95%E5%85%A5eureka-client%E9%85%8D%E7%BD%AE"><span class="toc-text"> 1、引入eureka-client配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#_2%E3%80%81%E4%BF%AE%E6%94%B9uri%E5%B1%9E%E6%80%A7-uri-lb-%E6%9C%8D%E5%8A%A1%E5%90%8D%E7%A7%B0"><span class="toc-text"> 2、修改uri属性：uri: lb:&#x2F;&#x2F;服务名称</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%90%8D%E7%A7%B0%E9%85%8D%E7%BD%AE"><span class="toc-text"> 五、微服务名称配置**</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-text"> 六、过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-text"> 自定义过滤器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0-%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="toc-text"> 第十三章 分布式配置中心</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81config-%E6%A6%82%E8%BF%B0"><span class="toc-text"> 一、Config 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81config-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text"> 二、Config 快速入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81config-%E9%9B%86%E6%88%90eureka"><span class="toc-text"> 三、Config 集成Eureka</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0-springcloud-bus%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF"><span class="toc-text"> 第十四章 SpringCloud Bus消息总线</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81bus-%E6%A6%82%E8%BF%B0"><span class="toc-text"> 一、Bus 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81rabbitmq-%E5%9B%9E%E9%A1%BE"><span class="toc-text"> 二、RabbitMQ 回顾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81bus-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8-%E8%BF%90%E7%BB%B4"><span class="toc-text"> 三、Bus 快速入门-运维</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%94%E7%AB%A0-springcloud-stream%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8"><span class="toc-text"> 第十五章 SpringCloud Stream消息驱动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81stream-%E6%A6%82%E8%BF%B0"><span class="toc-text"> 一、Stream 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81stream-%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-text"> 二、Stream 消息生产者</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81stream-%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-text"> 三、Stream 消息消费者</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%85%AD%E7%AB%A0-springcloud-sleuth%E5%88%86%E5%B8%83%E5%BC%8F%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA"><span class="toc-text"> 第十六章 SpringCloud Sleuth分布式请求链路追踪</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0-2"><span class="toc-text"> 一、概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8-1"><span class="toc-text"> 二、快速入门</span></a></li></ol></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ --><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/><path d="M7 3.338A9.95 9.95 0 0 1 12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12c0-1.821.487-3.53 1.338-5"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ --><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M8 10.5h8M8 14h5.5M17 3.338A9.95 9.95 0 0 0 12 2C6.477 2 2 6.477 2 12c0 1.6.376 3.112 1.043 4.453c.178.356.237.763.134 1.148l-.595 2.226a1.3 1.3 0 0 0 1.591 1.592l2.226-.596a1.63 1.63 0 0 1 1.149.133A9.96 9.96 0 0 0 12 22c5.523 0 10-4.477 10-10c0-1.821-.487-3.53-1.338-5"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Website","@id":"https://blog.thatcoder.cn/wiki/YDLDoc3/springcloud/SpringCloud/SpringCloud.html","author":{"@type":"Person","name":"钟意","sameAs":[],"image":"https://upyun.thatcdn.cn/hexo/stellar/image/favicon.webp"},"name":"SpringCloud","description":"提示课程视频教程链接：https://www.bilibili.com/video/BV1tT4y1a7LAopen in new window# 介绍：课程介绍# 1、前置​ javaSE,javaEE,SSM,Boot​ 为什么：一线城市，上了规模大厂、中厂，都需要cloud。​ cloud,薪资高# 2、特点​ 各大机构视频教程、网络文章、spring官网以及本人8年的java开发经验...","url":"https://blog.thatcoder.cn/wiki/YDLDoc3/springcloud/SpringCloud/SpringCloud.html","keywords":"那个码农, 码农钟意, 钟意的博客, 钟意博客, That Coder, thatcoder, 源柒拾柒雅舍, 源WebGary, giligili.work, seclusion.work, GalGame, Hexo Stellar, 江西木村拓哉, 江西吴彦祖, 江西胡歌, 龙南木村拓哉, 龙南吴彦祖, 龙南胡歌, 九江职业技术学院, 南昌交通学院"}</script>


<script type="text/javascript">
  window.canonical = {"originalHost":"blog.thatcoder.cn","officialHosts":["localhost","en.blog.thatcoder.cn","hexo.thatcoder.cn","cn-coder.netlify.app","cn-coder.vercel.app","thatcoders.github.io","thatcoder.pages.dev","cncoder.pages.dev","acncoder.vercel.app"],"encoded":"YmxvZy50aGF0Y29kZXIuY24="};
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
    tag_plugins: {
      chat: Object.assign({"api":"https://siteinfo.listentothewind.cn/api/v1"}),
    }
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"post, page, docs","path":"/search.json","content":true,"skip_search":null,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://gcore.jsdelivr.net/npm/jquery@3.7/dist/jquery.min.js`,
    marked: `https://gcore.jsdelivr.net/npm/marked@13.0/lib/marked.umd.min.js`
  }
  

</script>

<script type="text/javascript">
  function RunItem() {
    this.list = []; // 存放回调函数
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = () => {
          utils.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) => {
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index, 1);
        }
      }
    }
    // 构造一个可以run的对象
    function Item(fn, name) {
      // 函数名称
      this.name = name || fn.name;
      // run方法
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }

  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')) {
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function () {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },

    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function (response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response;
            }
            throw new Error('Network response was not ok.');
          }).then(function (data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function (error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
    /********************** requestAnimationFrame ********************************/
    // 1、requestAnimationFrame 会把每一帧中的所有 DOM 操作集中起来，在一次重绘或回流中就完成，并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率，一般来说，这个频率为每秒60帧。
    // 2、在隐藏或不可见的元素中，requestAnimationFrame 将不会进行重绘或回流，这当然就意味着更少的的 cpu，gpu 和内存使用量。
    requestAnimationFrame: (fn) => {
      if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
      }
      window.requestAnimationFrame(fn)
    },
    dark: {},
  };

  // utils.dark.mode 当前模式 dark or light
  // utils.dark.toggle() 暗黑模式触发器
  // utils.dark.push(callBack[,"callBackName"]) 传入触发器回调函数
  utils.dark.method = {
    toggle: new RunItem(),
  };
  utils.dark = Object.assign(utils.dark, {
    push: utils.dark.method.toggle.push,
  });
</script>
<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>


<!-- required -->
<script src="/js/main.js?v=1.31.0" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    applyThemeToGiscus(theme)
  }

  const applyThemeToGiscus = (theme) => {
    theme = theme === 'auto' ? 'preferred_color_scheme' : theme

    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)
    utils.dark.mode = newTheme === 'auto' ? (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light") : newTheme;
    utils.dark.method.toggle.start();

    const messages = {
      light: `切换到浅色模式`,
      dark: `切换到深色模式`,
      auto: `切换到跟随系统配色`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    } else {
      utils.dark.mode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }
    utils.dark.method.toggle.start();
  })()
</script>


<!-- optional -->

  <script type="module">
  import { init } from 'https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline.js';

  const el = document.getElementById('waline_container');
  util.viewportLazyload(el, load_waline, false);

  function load_waline(){
    if (!el) return;

    utils.css('https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline.css');
    utils.css('https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline-meta.css');

    const path = el.getAttribute('comment_id') ?? decodeURI(window.location.pathname);
    const waline = init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline.js","css":"https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline.css","meta_css":"https://gcore.jsdelivr.net/npm/@waline/client@3.1/dist/waline-meta.css","serverURL":"https://waline.thatapi.cn/","commentCount":true,"pageview":false,"search":false,"locale":{"placeholder":"  遇事不决, 可问春风..."},"emoji":["https://upyun.thatcdn.cn/public/web/emojis/bilibili","https://upyun.thatcdn.cn/public/web/emojis/qq","https://upyun.thatcdn.cn/public/web/emojis/tieba","https://upyun.thatcdn.cn/public/web/emojis/weibo"],"reaction":["https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_thumbsup.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_cute.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_sunglasses.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_crazy.png","https://upyun.thatcdn.cn/public/web/emojis/bilibili/bb_trollface.png"],"meta":["nick","mail","link"],"imageUploader":{"fileName":"file","tokenName":"Authorization","api":"https://lsky.thatcoder.cn/api/v1/upload","token":"Bearer 6|x9vHGJGHAnjqbO0PGEE5vM7r9S9hdqFA9bmdESdm","resp":"data.links.url"}}, {
      el: '#waline_container',
      path: path,
      
        imageUploader: function(file) {
          const headers = new Headers();
          headers.set('Accept', 'application/json');
          
            headers.set('Authorization', 'Bearer 6|x9vHGJGHAnjqbO0PGEE5vM7r9S9hdqFA9bmdESdm')
          
          const formData = new FormData();
          formData.append('file', file);
          return fetch('https://lsky.thatcoder.cn/api/v1/upload',{
            method: 'POST',
            body: formData,
            headers: headers
            }).then((resp) => resp.json())
              .then((resp) => resp.data.links.url)
        },
      
    }));
  }
</script>




<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"friends_and_posts":{"js":"/js/services/friends_and_posts.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"},"voice":{"js":"/js/plugins/voice.js"},"video":{"js":"/js/plugins/video.js"},"download-file":{"js":"/js/plugins/download-file.js"},"twikoo":{"js":"/js/services/twikoo_latest_comment.js"},"waline":{"js":"/js/services/waline_latest_comment.js"},"artalk":{"js":"/js/services/artalk_latest_comment.js"},"giscus":{"js":"/js/services/giscus_latest_comment.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else if (id == 'voice') {
        ctx.voiceAudios = document.querySelectorAll('.voice>audio');
        if (ctx.voiceAudios?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            createVoiceDom(ctx.voiceAudios);
          });
        }
      } else if (id == 'video') {
        ctx.videos = document.querySelectorAll('.video>video');
        if (ctx.videos?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            videoEvents(ctx.videos);
          });
        }
      } else if (id == 'download-file') {
        ctx.files = document.querySelectorAll('.file');
        if (ctx.files?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            downloadFileEvent(ctx.files);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }

    // chat iphone time
    let phoneTimes = document.querySelectorAll('.chat .status-bar .time');

    if (phoneTimes.length > 0) {
      NowTime();
      var date = new Date();
      var sec = date.getSeconds();
      var firstAdjustInterval = setInterval(firstAdjustTime, 1000 * (60 - sec));
    }

    function firstAdjustTime() {
      NowTime();
      clearInterval(firstAdjustInterval);
      setInterval(NowTime, 1000 * 60);
    }

    function NowTime() {
      for (let i = 0; i < phoneTimes.length; ++i) {
        var timeSpan = phoneTimes[i];
        var date = new Date();
        var hour = date.getHours();
        var min = date.getMinutes();
        timeSpan.innerHTML = check(hour) + ":" + check(min);
      }
    };

    function check(val) {
      if (val < 10) {
        return ("0" + val);
      }
      return (val);
    }

    // chat quote
    const chat_quote_obverser = new IntersectionObserver((entries, observer) => {
      entries.filter((entry) => { return entry.isIntersecting }).sort((a, b) => a.intersectionRect.y !== b.intersectionRect.y ? a.intersectionRect.y - b.intersectionRect.y : a.intersectionRect.x - b.intersectionRect.x).forEach((entry, index) => {
          observer.unobserve(entry.target);
          setTimeout(() => {
            entry.target.classList.add('quote-blink');
            setTimeout(() => {
              entry.target.classList.remove('quote-blink');
            }, 1000);
          }, Math.max(100, 16) * (index + 1));
        });
    });

    var chatQuotes = document.querySelectorAll(".chat .talk .quote");
    chatQuotes.forEach((quote) => {
      quote.addEventListener('click', function () {
        var chatCellDom = document.getElementById("quote-" + quote.getAttribute("quotedCellTag"));
        if (chatCellDom) {
          var chatDiv = chatCellDom.parentElement;
          var mid = chatDiv.clientHeight / 2;
          var offsetTop = chatCellDom.offsetTop;
          if (offsetTop > mid - chatCellDom.clientHeight / 2) {
            chatDiv.scrollTo({
              top: chatCellDom.offsetTop - mid + chatCellDom.clientHeight / 2,
              behavior: "smooth"
            });
          } else {
            chatDiv.scrollTo({
              top: 0,
              behavior: "smooth"
            });
          }
          chat_quote_obverser.observe(chatCellDom);
        }
      });
    });
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://gcore.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script defer src="https://gcore.jsdelivr.net/npm/vanilla-lazyload@19.1/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.swiper-slide img, .md-text.content p>img, .md-text.content li img , .wl-content img, waline_container .vcontent img, .timeline .body .image img,  .timeline .gallery img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>




<!-- inject -->
<script type="text/javascript" src="/custom/js/ZYUtil.js"></script><script type="text/javascript" src="/custom/js/ZYDark.js"></script><script type="text/javascript" src="/custom/js/ZYCategory.js"></script><script type="text/javascript" src="/custom/js/ZYCode.js"></script><script type="text/javascript" src="/custom/js/timetmpl.js"></script>
</div></body></html>
